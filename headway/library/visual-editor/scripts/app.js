function ITStylesheet(e,t){return"undefined"!=typeof e.document&&(this.document=e.document,delete e.document),this.property_dom_names={},this.property_standard_names={},this.converted_rgb_values={},this.args="undefined"!=typeof e?e:{},this.action="undefined"!=typeof t?t:"load",this.init=function(){"find"===this.action?this._find_stylesheet():this._load_stylesheet()},this._load_stylesheet=function(){e=this.args;var t;"undefined"!=typeof e.href?(t=this.document.createElement("link"),t.href=e.href,this.type="link"):(t=this.document.createElement("style"),this.type="style"),t.type="text/css","undefined"!=typeof e.title&&(t.title=e.title),"undefined"!=typeof e.rel&&(t.rel=e.rel),"undefined"!=typeof e.media&&(t.media=e.media),"undefined"!=typeof e.href&&"undefined"==typeof e.rel&&(t.rel="stylesheet");var n="";"undefined"!=typeof e.content&&(n=e.content,delete e.content);var r=Math.floor(Math.random()*1e3)+1;this.$stylesheet_node=jQuery(t).insertBefore($i("style#live-css-holder")).addClass("ITStylesheet").attr("id","itstylesheet-"+r),this.stylesheet_node=this.$stylesheet_node[0];var i=this;jQuery.each(this.document.styleSheets,function(e,t){if(typeof t.ownerNode.id=="undefined"||!t.ownerNode.id||t.ownerNode.id!="itstylesheet-"+r)return;return i.stylesheet=t,!1}),this._find_rules(),""!==n&&this.set_rules(n)},this._find_stylesheet=function(){e=this.args;for(var t=0;t<this.document.styleSheets.length;t++){if("undefined"!=typeof e.href&&(typeof this.document.styleSheets[t].href=="string"&&this.document.styleSheets[t].href.indexOf(e.href)===-1||!this.document.styleSheets[t].href))continue;if("undefined"!=typeof e.title&&e.title!==this.document.styleSheets[t].title)continue;if("undefined"!=typeof e.rel&&e.rel!==this.document.styleSheets[t].rel)continue;if("undefined"!=typeof e.media&&e.media!==this.document.styleSheets[t].media)continue;if("undefined"!=typeof e.type&&e.type!==this.document.styleSheets[t].type)continue;if("undefined"!=typeof e.disabled&&e.disabled!==this.document.styleSheets[t].disabled)continue;this.type="link",this.stylesheet=this.document.styleSheets[t],this._find_rules();break}},this._find_rules=function(){if("undefined"==typeof this.stylesheet)return;this.stylesheet.cssRules?this.rules=this.stylesheet.cssRules:this.rules=this.stylesheet.rules},this._get_style_from_declarations=function(e){var t="";for(property in e)t+=property+":"+e[property]+"; ";return t},this._get_rules_obj_from_string=function(e){var t={},n=e.match(/\s*[^{;]+\s*{\s*[^{}]+\s*}/g);if(-1===n)return t;for(var r=0;r<n.length;r++){var i=n[r].match(/\s*([^{;]+)\s*{\s*([^{}]+)\s*}/);t[i[1]]=i[2]}return t},this._get_property_dom_name=function(e){if("undefined"!=typeof this.property_dom_names[e])return this.property_dom_names[e];var t=e.split("-"),n=t.shift();while(t.length>0){var r=t.shift();r=r.charAt(0).toUpperCase()+r.substr(1),n+=r}return this.property_dom_names[e]=n,n},this._get_property_standard_name=function(e){if("undefined"!=typeof this.property_standard_names[e])return this.property_standard_names[e];var t=e;return"padding-right-value"===e?t="padding-right":"padding-left-value"===e?t="padding-left":"margin-right-value"===e?t="margin-right":"margin-left-value"===e&&(t="margin-left"),this.property_standard_names[e]=t,t},this._delete_rule_at_index=function(e){this.stylesheet.deleteRule?this.stylesheet.deleteRule(e):this.stylesheet.removeRule(e)},this._get_stylesheet_rules=function(e){return e.cssRules?e.cssRules:e.rules},this._get_stylesheet_rules_object=function(e){var t=this._get_stylesheet_rules(e),n={},r=[];for(var i=0;i<t.length;i++)n[t[i].selectorText]=this._get_rule_declarations_object(t[i]),r.push(t[i].selectorText);r.sort();var s={};for(var i=0;i<r.length;i++)s[r[i]]=n[r[i]];return s},this._get_rule_declarations_object=function(e){var t={},n;e.style?n=e.style:n=e;var r=[];for(var i=0;i<n.length;i++)r.push(n[i]);r.sort();for(var i=0;i<r.length;i++){var s=this._get_property_standard_name(r[i]);"undefined"!=typeof n[s]?t[s]=n[s]:t[s]=n[this._get_property_dom_name(s)]}return t},this.get_rule_index=function(e){if("undefined"==typeof e)return!1;indexes=new Array,this.rules||this._find_rules();if(!this.rules)return!1;if("undefined"!=typeof this.rules[e])return e;for(var t=0;t<this.rules.length;t++)typeof this.rules[t].selectorText=="string"&&this.rules[t].selectorText.toLowerCase()==e.toLowerCase()&&indexes.push(t);return indexes.length!==0?indexes[indexes.length-1]:!1},this.get_rule=function(e){if("undefined"==typeof e)return!1;var t=this.get_rule_index(e);return!1===t||"undefined"==typeof this.rules[t]?!1:this.rules[t]},this.add_rule=function(e,t){return this.update_rule(e,t)},this.update_rule=function(e,t,n){if("undefined"==typeof this.rules||"undefined"==typeof e)return!1;"undefined"==typeof t&&(t={}),"undefined"==typeof n&&(n=!1);if(n)var r=e.split(",");else var r=new Array(e);var i=[];for(var s=0;s<r.length;s++){var o=r[s];if("undefined"==typeof o)continue;var u=this.get_rule(o);try{if(!1===u){var a=this.rules.length;string_declarations="string"==typeof t?t:this._get_style_from_declarations(t),this.stylesheet.addRule?this.stylesheet.addRule(o,string_declarations,a):this.stylesheet.insertRule(o+" {"+string_declarations+"}",a),u=this.rules[a]}else for(property in t)u.style.setAttribute?u.style.setAttribute(property,t[property]):u.style.setProperty(property,t[property],null);i.push(u)}catch(f){}}return i},this.delete_all_rules=function(){while(this.rules.length>0)this._delete_rule_at_index(0)},this.delete_rule=function(e){var t=this.get_rule_index(e);return!1===t?!1:(this._delete_rule_at_index(t),!0)},this.delete_rule_property=function(e,t){var n={};n[t]=null,this.update_rule(e,n)},this._convert_rgb_to_hex=function(e){if("undefined"!=typeof this.converted_rgb_values[e])return this.converted_rgb_values[e];var t=/rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(e),n=parseInt(t[1]),r=parseInt(t[2]),i=parseInt(t[3]),s=i|r<<8|n<<16;hex=s.toString(16).toUpperCase();while(hex.length<6)hex="0"+hex;return this.converted_rgb_values[e]="#"+hex,"#"+hex},this.get_stylesheet_text=function(){var e=this._get_stylesheet_rules_object(this.stylesheet),t="",n=/^rgb\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*\)/;for(selector in e){var r="";for(property in e[selector]){var i=e[selector][property];if("undefined"==typeof i)continue;n.test(i)&&(i=this._convert_rgb_to_hex(i)),r+="	"+property+": "+i+";\n"}if(""===r)continue;""!==t&&(t+="\n"),t+=selector+" {\n"+r+"}"}return t},this.get_computed_style=function(e){return window.getComputedStyle?window.getComputedStyle(e,""):e.currentStyle},this.set_rules=function(e){this.delete_all_rules(),"string"==typeof e&&(e=this._get_rules_obj_from_string(e));for(selector in e)this.update_rule(selector,e[selector])},this.init(),!0}define("util.misc",["jquery"],function(e){updateQueryStringParameter=function(e,t,n){var r=new RegExp("([?|&])"+t+"=.*?(&|$)","i"),i=e.indexOf("?")!==-1?"&":"?";return e.match(r)?e.replace(r,"$1"+t+"="+n+"$2"):e+i+t+"="+n},jQuery.fn.reverse=[].reverse,Number.prototype.toNearest=function(e){return Math.round(this/e)*e},Math._round=Math.round,Math.round=function(e,t){t=Math.abs(parseInt(t))||0;var n=Math.pow(10,t);return Math._round(e*n)/n},String.prototype.repeatStr=function(e){return e<=0?"":Array.prototype.join.call({length:e+1},this)},String.prototype.capitalize=function(){return this.replace(/(^|\s)([a-z])/g,function(e,t,n){return t+n.toUpperCase()})},hwBoolean=function(e){if(typeof e=="boolean")return e;if(typeof e=="undefined")return!1;if(typeof e=="number")return e===1?!0:e===0?!1:null;if(e===null)return!1;if(typeof e=="string"){var t=e.split(/\b/g);return t[0]==="1"||t[0]==="true"?!0:t[0]==="0"||t[0]==="false"?!1:null}return null},Number.prototype.toBool=function(){return this===1?!0:this===0?!1:null},String.prototype.toBool=function(){var e=this.split(/\b/g);return e[0]==="1"||e[0]==="true"?!0:e[0]==="0"||e[0]==="false"?!1:null},String.prototype.escapeHTML=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}}),define("util.loader",["jquery","util.misc"],function(e){createCog=function(t,n,r,i,s){if(e(t).length===0||e(t).find(".cog-container:visible").length)return!1;var r=typeof r=="undefined"?!1:r,o='<div class="cog-container"><div class="cog-bottom-left"></div><div class="cog-top-right"></div></div>';return r?t.append(o):t.html(o),typeof s!="undefined"&&t.find(".cog-container").css({opacity:s}),!0},changeTitle=function(t){return e("title").text(t)},startTitleActivityIndicator=function(){return typeof titleActivityIndicatorInstance=="number"?!1:(titleActivityIndicatorInstance=window.setInterval(titleActivityIndicator,500),titleActivityIndicatorSavedTitle=e("title").text(),!0)},stopTitleActivityIndicator=function(){return typeof titleActivityIndicatorInstance!="number"?!1:(window.clearInterval(titleActivityIndicatorInstance),changeTitle(titleActivityIndicatorSavedTitle),delete titleActivityIndicatorCounter,delete titleActivityIndicatorSavedTitle,delete titleActivityIndicatorInstance,!0)},titleActivityIndicator=function(){typeof titleActivityIndicatorCounter=="undefined"&&(titleActivityIndicatorCounter=0,titleActivityIndicatorCounterPos=!0),titleActivityIndicatorCounterPos===!0?++titleActivityIndicatorCounter:--titleActivityIndicatorCounter,titleActivityIndicatorCounter===3?titleActivityIndicatorCounterPos=!1:titleActivityIndicatorCounter===0&&(titleActivityIndicatorCounterPos=!0);var e=titleActivityIndicatorSavedTitle+".".repeatStr(titleActivityIndicatorCounter);changeTitle(e)}}),function(){var DEBUG=!0;(function(undefined){var window=this||(0,eval)("this"),document=window.document,navigator=window.navigator,jQueryInstance=window.jQuery,JSON=window.JSON;(function(e){if(typeof require=="function"&&typeof exports=="object"&&typeof module=="object"){var t=module.exports||exports;e(t,require)}else typeof define=="function"&&define.amd?define("knockout",["exports","require"],e):e(window.ko={})})(function(e,t){function i(e,t){var n=e===null||typeof e in r;return n?e===t:!1}function s(e,t){var n;return function(){n||(n=setTimeout(function(){n=undefined,e()},t))}}function o(e,t){var n;return function(){clearTimeout(n),n=setTimeout(e,t)}}function u(e){var t=this;return e&&n.utils.objectForEach(e,function(e,r){var i=n.extenders[e];typeof i=="function"&&(t=i(t,r)||t)}),t}function v(e){n.bindingHandlers[e]={init:function(t,r,i,s,o){var u=function(){var t={};return t[e]=r(),t};return n.bindingHandlers.event.init.call(this,t,u,i,s,o)}}}function y(e,t,r,i){n.bindingHandlers[e]={init:function(e,s,o,u,a){var f,l;return n.computed(function(){var o=n.utils.unwrapObservable(s()),u=!r!=!o,c=!l,h=c||t||u!==f;h&&(c&&n.computedContext.getDependenciesCount()&&(l=n.utils.cloneNodes(n.virtualElements.childNodes(e),!0)),u?(c||n.virtualElements.setDomNodeChildren(e,n.utils.cloneNodes(l)),n.applyBindingsToDescendants(i?i(a,o):a,e)):n.virtualElements.emptyNode(e),f=u)},null,{disposeWhenNodeIsRemoved:e}),{controlsDescendantBindings:!0}}},n.expressionRewriting.bindingRewriteValidators[e]=!1,n.virtualElements.allowedBindings[e]=!0}var n=typeof e!="undefined"?e:{};n.exportSymbol=function(e,t){var r=e.split("."),i=n;for(var s=0;s<r.length-1;s++)i=i[r[s]];i[r[r.length-1]]=t},n.exportProperty=function(e,t,n){e[t]=n},n.version="3.2.0",n.exportSymbol("version",n.version),n.utils=function(){function e(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function t(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function r(e,t){return e.__proto__=t,e}function h(e,t){if(n.utils.tagNameLower(e)!=="input"||!e.type)return!1;if(t.toLowerCase()!="click")return!1;var r=e.type;return r=="checkbox"||r=="radio"}var i={__proto__:[]}instanceof Array,s={},o={},u=navigator&&/Firefox\/2/i.test(navigator.userAgent)?"KeyboardEvent":"UIEvents";s[u]=["keyup","keydown","keypress"],s.MouseEvents=["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave"],e(s,function(e,t){if(t.length)for(var n=0,r=t.length;n<r;n++)o[t[n]]=e});var a={propertychange:!0},f=document&&function(){var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");while(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->",n[0]);return e>4?e:undefined}(),l=f===6,c=f===7;return{fieldsIncludedWithJsonPost:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(e,t){for(var n=0,r=e.length;n<r;n++)t(e[n],n)},arrayIndexOf:function(e,t){if(typeof Array.prototype.indexOf=="function")return Array.prototype.indexOf.call(e,t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},arrayFirst:function(e,t,n){for(var r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r))return e[r];return null},arrayRemoveItem:function(e,t){var r=n.utils.arrayIndexOf(e,t);r>0?e.splice(r,1):r===0&&e.shift()},arrayGetDistinctValues:function(e){e=e||[];var t=[];for(var r=0,i=e.length;r<i;r++)n.utils.arrayIndexOf(t,e[r])<0&&t.push(e[r]);return t},arrayMap:function(e,t){e=e||[];var n=[];for(var r=0,i=e.length;r<i;r++)n.push(t(e[r],r));return n},arrayFilter:function(e,t){e=e||[];var n=[];for(var r=0,i=e.length;r<i;r++)t(e[r],r)&&n.push(e[r]);return n},arrayPushAll:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,r=t.length;n<r;n++)e.push(t[n]);return e},addOrRemoveItem:function(e,t,r){var i=n.utils.arrayIndexOf(n.utils.peekObservable(e),t);i<0?r&&e.push(t):r||e.splice(i,1)},canSetPrototype:i,extend:t,setPrototypeOf:r,setPrototypeOfOrExtend:i?r:t,objectForEach:e,objectMap:function(e,t){if(!e)return e;var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r],r,e));return n},emptyDomNode:function(e){while(e.firstChild)n.removeNode(e.firstChild)},moveCleanedNodesToContainerElement:function(e){var t=n.utils.makeArray(e),r=document.createElement("div");for(var i=0,s=t.length;i<s;i++)r.appendChild(n.cleanNode(t[i]));return r},cloneNodes:function(e,t){for(var r=0,i=e.length,s=[];r<i;r++){var o=e[r].cloneNode(!0);s.push(t?n.cleanNode(o):o)}return s},setDomNodeChildren:function(e,t){n.utils.emptyDomNode(e);if(t)for(var r=0,i=t.length;r<i;r++)e.appendChild(t[r])},replaceDomNodes:function(e,t){var r=e.nodeType?[e]:e;if(r.length>0){var i=r[0],s=i.parentNode;for(var o=0,u=t.length;o<u;o++)s.insertBefore(t[o],i);for(var o=0,u=r.length;o<u;o++)n.removeNode(r[o])}},fixUpContinuousNodeArray:function(e,t){if(e.length){t=t.nodeType===8&&t.parentNode||t;while(e.length&&e[0].parentNode!==t)e.shift();if(e.length>1){var n=e[0],r=e[e.length-1];e.length=0;while(n!==r){e.push(n),n=n.nextSibling;if(!n)return}e.push(r)}}return e},setOptionNodeSelectionState:function(e,t){f<7?e.setAttribute("selected",t):e.selected=t},stringTrim:function(e){return e===null||e===undefined?"":e.trim?e.trim():e.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},stringStartsWith:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},domNodeIsContainedBy:function(e,t){if(e===t)return!0;if(e.nodeType===11)return!1;if(t.contains)return t.contains(e.nodeType===3?e.parentNode:e);if(t.compareDocumentPosition)return(t.compareDocumentPosition(e)&16)==16;while(e&&e!=t)e=e.parentNode;return!!e},domNodeIsAttachedToDocument:function(e){return n.utils.domNodeIsContainedBy(e,e.ownerDocument.documentElement)},anyDomNodeIsAttachedToDocument:function(e){return!!n.utils.arrayFirst(e,n.utils.domNodeIsAttachedToDocument)},tagNameLower:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},registerEventHandler:function(e,t,r){var i=f&&a[t];if(!i&&jQueryInstance)jQueryInstance(e).bind(t,r);else if(!i&&typeof e.addEventListener=="function")e.addEventListener(t,r,!1);else{if(typeof e.attachEvent=="undefined")throw new Error("Browser doesn't support addEventListener or attachEvent");var s=function(t){r.call(e,t)},o="on"+t;e.attachEvent(o,s),n.utils.domNodeDisposal.addDisposeCallback(e,function(){e.detachEvent(o,s)})}},triggerEvent:function(e,t){if(!e||!e.nodeType)throw new Error("element must be a DOM node when calling triggerEvent");var n=h(e,t);if(jQueryInstance&&!n)jQueryInstance(e).trigger(t);else if(typeof document.createEvent=="function"){if(typeof e.dispatchEvent!="function")throw new Error("The supplied element doesn't support dispatchEvent");var r=o[t]||"HTMLEvents",i=document.createEvent(r);i.initEvent(t,!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(i)}else if(n&&e.click)e.click();else{if(typeof e.fireEvent=="undefined")throw new Error("Browser doesn't support triggering events");e.fireEvent("on"+t)}},unwrapObservable:function(e){return n.isObservable(e)?e():e},peekObservable:function(e){return n.isObservable(e)?e.peek():e},toggleDomNodeCssClass:function(e,t,r){if(t){var i=/\S+/g,s=e.className.match(i)||[];n.utils.arrayForEach(t.match(i),function(e){n.utils.addOrRemoveItem(s,e,r)}),e.className=s.join(" ")}},setTextContent:function(e,t){var r=n.utils.unwrapObservable(t);if(r===null||r===undefined)r="";var i=n.virtualElements.firstChild(e);!i||i.nodeType!=3||n.virtualElements.nextSibling(i)?n.virtualElements.setDomNodeChildren(e,[e.ownerDocument.createTextNode(r)]):i.data=r,n.utils.forceRefresh(e)},setElementName:function(e,t){e.name=t;if(f<=7)try{e.mergeAttributes(document.createElement("<input name='"+e.name+"'/>"),!1)}catch(n){}},forceRefresh:function(e){if(f>=9){var t=e.nodeType==1?e:e.parentNode;t.style&&(t.style.zoom=t.style.zoom)}},ensureSelectElementIsRenderedCorrectly:function(e){if(f){var t=e.style.width;e.style.width=0,e.style.width=t}},range:function(e,t){e=n.utils.unwrapObservable(e),t=n.utils.unwrapObservable(t);var r=[];for(var i=e;i<=t;i++)r.push(i);return r},makeArray:function(e){var t=[];for(var n=0,r=e.length;n<r;n++)t.push(e[n]);return t},isIe6:l,isIe7:c,ieVersion:f,getFormFields:function(e,t){var r=n.utils.makeArray(e.getElementsByTagName("input")).concat(n.utils.makeArray(e.getElementsByTagName("textarea"))),i=typeof t=="string"?function(e){return e.name===t}:function(e){return t.test(e.name)},s=[];for(var o=r.length-1;o>=0;o--)i(r[o])&&s.push(r[o]);return s},parseJson:function(e){if(typeof e=="string"){e=n.utils.stringTrim(e);if(e)return JSON&&JSON.parse?JSON.parse(e):(new Function("return "+e))()}return null},stringifyJson:function(e,t,r){if(!JSON||!JSON.stringify)throw new Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return JSON.stringify(n.utils.unwrapObservable(e),t,r)},postJson:function(t,r,i){i=i||{};var s=i.params||{},o=i.includeFields||this.fieldsIncludedWithJsonPost,u=t;if(typeof t=="object"&&n.utils.tagNameLower(t)==="form"){var a=t;u=a.action;for(var f=o.length-1;f>=0;f--){var l=n.utils.getFormFields(a,o[f]);for(var c=l.length-1;c>=0;c--)s[l[c].name]=l[c].value}}r=n.utils.unwrapObservable(r);var h=document.createElement("form");h.style.display="none",h.action=u,h.method="post";for(var p in r){var d=document.createElement("input");d.type="hidden",d.name=p,d.value=n.utils.stringifyJson(n.utils.unwrapObservable(r[p])),h.appendChild(d)}e(s,function(e,t){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t,h.appendChild(n)}),document.body.appendChild(h),i.submitter?i.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)}}}(),n.exportSymbol("utils",n.utils),n.exportSymbol("utils.arrayForEach",n.utils.arrayForEach),n.exportSymbol("utils.arrayFirst",n.utils.arrayFirst),n.exportSymbol("utils.arrayFilter",n.utils.arrayFilter),n.exportSymbol("utils.arrayGetDistinctValues",n.utils.arrayGetDistinctValues),n.exportSymbol("utils.arrayIndexOf",n.utils.arrayIndexOf),n.exportSymbol("utils.arrayMap",n.utils.arrayMap),n.exportSymbol("utils.arrayPushAll",n.utils.arrayPushAll),n.exportSymbol("utils.arrayRemoveItem",n.utils.arrayRemoveItem),n.exportSymbol("utils.extend",n.utils.extend),n.exportSymbol("utils.fieldsIncludedWithJsonPost",n.utils.fieldsIncludedWithJsonPost),n.exportSymbol("utils.getFormFields",n.utils.getFormFields),n.exportSymbol("utils.peekObservable",n.utils.peekObservable),n.exportSymbol("utils.postJson",n.utils.postJson),n.exportSymbol("utils.parseJson",n.utils.parseJson),n.exportSymbol("utils.registerEventHandler",n.utils.registerEventHandler),n.exportSymbol("utils.stringifyJson",n.utils.stringifyJson),n.exportSymbol("utils.range",n.utils.range),n.exportSymbol("utils.toggleDomNodeCssClass",n.utils.toggleDomNodeCssClass),n.exportSymbol("utils.triggerEvent",n.utils.triggerEvent),n.exportSymbol("utils.unwrapObservable",n.utils.unwrapObservable),n.exportSymbol("utils.objectForEach",n.utils.objectForEach),n.exportSymbol("utils.addOrRemoveItem",n.utils.addOrRemoveItem),n.exportSymbol("unwrap",n.utils.unwrapObservable),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments),e=n.shift();return function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}),n.utils.domData=new function(){function r(r,i){var s=r[t],o=s&&s!=="null"&&n[s];if(!o){if(!i)return undefined;s=r[t]="ko"+e++,n[s]={}}return n[s]}var e=0,t="__ko__"+(new Date).getTime(),n={};return{get:function(e,t){var n=r(e,!1);return n===undefined?undefined:n[t]},set:function(e,t,n){if(n===undefined&&r(e,!1)===undefined)return;var i=r(e,!0);i[t]=n},clear:function(e){var r=e[t];return r?(delete n[r],e[t]=null,!0):!1},nextKey:function(){return e++ +t}}},n.exportSymbol("utils.domData",n.utils.domData),n.exportSymbol("utils.domData.clear",n.utils.domData.clear),n.utils.domNodeDisposal=new function(){function i(t,r){var i=n.utils.domData.get(t,e);return i===undefined&&r&&(i=[],n.utils.domData.set(t,e,i)),i}function s(t){n.utils.domData.set(t,e,undefined)}function o(e){var t=i(e,!1);if(t){t=t.slice(0);for(var s=0;s<t.length;s++)t[s](e)}n.utils.domData.clear(e),n.utils.domNodeDisposal.cleanExternalData(e),r[e.nodeType]&&u(e)}function u(e){var t,n=e.firstChild;while(t=n)n=t.nextSibling,t.nodeType===8&&o(t)}var e=n.utils.domData.nextKey(),t={1:!0,8:!0,9:!0},r={1:!0,9:!0};return{addDisposeCallback:function(e,t){if(typeof t!="function")throw new Error("Callback must be a function");i(e,!0).push(t)},removeDisposeCallback:function(e,t){var r=i(e,!1);r&&(n.utils.arrayRemoveItem(r,t),r.length==0&&s(e))},cleanNode:function(e){if(t[e.nodeType]){o(e);if(r[e.nodeType]){var i=[];n.utils.arrayPushAll(i,e.getElementsByTagName("*"));for(var s=0,u=i.length;s<u;s++)o(i[s])}}return e},removeNode:function(e){n.cleanNode(e),e.parentNode&&e.parentNode.removeChild(e)},cleanExternalData:function(e){jQueryInstance&&typeof jQueryInstance["cleanData"]=="function"&&jQueryInstance.cleanData([e])}}},n.cleanNode=n.utils.domNodeDisposal.cleanNode,n.removeNode=n.utils.domNodeDisposal.removeNode,n.exportSymbol("cleanNode",n.cleanNode),n.exportSymbol("removeNode",n.removeNode),n.exportSymbol("utils.domNodeDisposal",n.utils.domNodeDisposal),n.exportSymbol("utils.domNodeDisposal.addDisposeCallback",n.utils.domNodeDisposal.addDisposeCallback),n.exportSymbol("utils.domNodeDisposal.removeDisposeCallback",n.utils.domNodeDisposal.removeDisposeCallback),function(){function t(e){var t=n.utils.stringTrim(e).toLowerCase(),r=document.createElement("div"),i=t.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!t.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!t.indexOf("<td")||!t.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],s="ignored<div>"+i[1]+e+i[2]+"</div>";typeof window["innerShiv"]=="function"?r.appendChild(window.innerShiv(s)):r.innerHTML=s;while(i[0]--)r=r.lastChild;return n.utils.makeArray(r.lastChild.childNodes)}function r(e){if(jQueryInstance.parseHTML)return jQueryInstance.parseHTML(e)||[];var t=jQueryInstance.clean([e]);if(t&&t[0]){var n=t[0];while(n.parentNode&&n.parentNode.nodeType!==11)n=n.parentNode;n.parentNode&&n.parentNode.removeChild(n)}return t}var e=/^(\s*)<!--(.*?)-->/;n.utils.parseHtmlFragment=function(e){return jQueryInstance?r(e):t(e)},n.utils.setHtml=function(e,t){n.utils.emptyDomNode(e),t=n.utils.unwrapObservable(t);if(t!==null&&t!==undefined){typeof t!="string"&&(t=t.toString());if(jQueryInstance)jQueryInstance(e).html(t);else{var r=n.utils.parseHtmlFragment(t);for(var i=0;i<r.length;i++)e.appendChild(r[i])}}}}(),n.exportSymbol("utils.parseHtmlFragment",n.utils.parseHtmlFragment),n.exportSymbol("utils.setHtml",n.utils.setHtml),n.memoization=function(){function t(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function r(){return t()+t()}function i(e,t){if(!e)return;if(e.nodeType==8){var r=n.memoization.parseMemoText(e.nodeValue);r!=null&&t.push({domNode:e,memoId:r})}else if(e.nodeType==1)for(var s=0,o=e.childNodes,u=o.length;s<u;s++)i(o[s],t)}var e={};return{memoize:function(t){if(typeof t!="function")throw new Error("You can only pass a function to ko.memoization.memoize()");var n=r();return e[n]=t,"<!--[ko_memo:"+n+"]-->"},unmemoize:function(t,n){var r=e[t];if(r===undefined)throw new Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return r.apply(null,n||[]),!0}finally{delete e[t]}},unmemoizeDomNodeAndDescendants:function(e,t){var r=[];i(e,r);for(var s=0,o=r.length;s<o;s++){var u=r[s].domNode,a=[u];t&&n.utils.arrayPushAll(a,t),n.memoization.unmemoize(r[s].memoId,a),u.nodeValue="",u.parentNode&&u.parentNode.removeChild(u)}},parseMemoText:function(e){var t=e.match(/^\[ko_memo\:(.*?)\]$/);return t?t[1]:null}}}(),n.exportSymbol("memoization",n.memoization),n.exportSymbol("memoization.memoize",n.memoization.memoize),n.exportSymbol("memoization.unmemoize",n.memoization.unmemoize),n.exportSymbol("memoization.parseMemoText",n.memoization.parseMemoText),n.exportSymbol("memoization.unmemoizeDomNodeAndDescendants",n.memoization.unmemoizeDomNodeAndDescendants),n.extenders={throttle:function(e,t){e.throttleEvaluation=t;var r=null;return n.dependentObservable({read:e,write:function(n){clearTimeout(r),r=setTimeout(function(){e(n)},t)}})},rateLimit:function(e,t){var n,r,i;typeof t=="number"?n=t:(n=t.timeout,r=t.method),i=r=="notifyWhenChangesStop"?o:s,e.limit(function(e){return i(e,n)})},notify:function(e,t){e.equalityComparer=t=="always"?null:i}};var r={"undefined":1,"boolean":1,number:1,string:1};n.exportSymbol("extenders",n.extenders),n.subscription=function(e,t,r){this.target=e,this.callback=t,this.disposeCallback=r,this.isDisposed=!1,n.exportProperty(this,"dispose",this.dispose)},n.subscription.prototype.dispose=function(){this.isDisposed=!0,this.disposeCallback()},n.subscribable=function(){n.utils.setPrototypeOfOrExtend(this,n.subscribable.fn),this._subscriptions={}};var a="change",f={subscribe:function(e,t,r){var i=this;r=r||a;var s=t?e.bind(t):e,o=new n.subscription(i,s,function(){n.utils.arrayRemoveItem(i._subscriptions[r],o),i.afterSubscriptionRemove&&i.afterSubscriptionRemove(r)});return i.beforeSubscriptionAdd&&i.beforeSubscriptionAdd(r),i._subscriptions[r]||(i._subscriptions[r]=[]),i._subscriptions[r].push(o),o},notifySubscribers:function(e,t){t=t||a;if(this.hasSubscriptionsForEvent(t))try{n.dependencyDetection.begin();for(var r=this._subscriptions[t].slice(0),i=0,s;s=r[i];++i)s.isDisposed||s.callback(e)}finally{n.dependencyDetection.end()}},limit:function(e){var t=this,r=n.isObservable(t),i,s,o,u="beforeChange";t._origNotifySubscribers||(t._origNotifySubscribers=t.notifySubscribers,t.notifySubscribers=function(e,n){!n||n===a?t._rateLimitedChange(e):n===u?t._rateLimitedBeforeChange(e):t._origNotifySubscribers(e,n)});var f=e(function(){r&&o===t&&(o=t()),i=!1,t.isDifferent(s,o)&&t._origNotifySubscribers(s=o)});t._rateLimitedChange=function(e){i=!0,o=e,f()},t._rateLimitedBeforeChange=function(e){i||(s=e,t._origNotifySubscribers(e,u))}},hasSubscriptionsForEvent:function(e){return this._subscriptions[e]&&this._subscriptions[e].length},getSubscriptionsCount:function(){var e=0;return n.utils.objectForEach(this._subscriptions,function(t,n){e+=n.length}),e},isDifferent:function(e,t){return!this.equalityComparer||!this.equalityComparer(e,t)},extend:u};n.exportProperty(f,"subscribe",f.subscribe),n.exportProperty(f,"extend",f.extend),n.exportProperty(f,"getSubscriptionsCount",f.getSubscriptionsCount),n.utils.canSetPrototype&&n.utils.setPrototypeOf(f,Function.prototype),n.subscribable.fn=f,n.isSubscribable=function(e){return e!=null&&typeof e.subscribe=="function"&&typeof e["notifySubscribers"]=="function"},n.exportSymbol("subscribable",n.subscribable),n.exportSymbol("isSubscribable",n.isSubscribable),n.computedContext=n.dependencyDetection=function(){function i(){return++r}function s(n){e.push(t),t=n}function o(){t=e.pop()}var e=[],t,r=0;return{begin:s,end:o,registerDependency:function(e){if(t){if(!n.isSubscribable(e))throw new Error("Only subscribable things can act as dependencies");t.callback(e,e._id||(e._id=i()))}},ignore:function(e,t,n){try{return s(),e.apply(t,n||[])}finally{o()}},getDependenciesCount:function(){if(t)return t.computed.getDependenciesCount()},isInitial:function(){if(t)return t.isInitial}}}(),n.exportSymbol("computedContext",n.computedContext),n.exportSymbol("computedContext.getDependenciesCount",n.computedContext.getDependenciesCount),n.exportSymbol("computedContext.isInitial",n.computedContext.isInitial),n.exportSymbol("computedContext.isSleeping",n.computedContext.isSleeping),n.observable=function(e){function r(){return arguments.length>0?(r.isDifferent(t,arguments[0])&&(r.valueWillMutate(),t=arguments[0],DEBUG&&(r._latestValue=t),r.valueHasMutated()),this):(n.dependencyDetection.registerDependency(r),t)}var t=e;return n.subscribable.call(r),n.utils.setPrototypeOfOrExtend(r,n.observable.fn),DEBUG&&(r._latestValue=t),r.peek=function(){return t},r.valueHasMutated=function(){r.notifySubscribers(t)},r.valueWillMutate=function(){r.notifySubscribers(t,"beforeChange")},n.exportProperty(r,"peek",r.peek),n.exportProperty(r,"valueHasMutated",r.valueHasMutated),n.exportProperty(r,"valueWillMutate",r.valueWillMutate),r},n.observable.fn={equalityComparer:i};var l=n.observable.protoProperty="__ko_proto__";n.observable.fn[l]=n.observable,n.utils.canSetPrototype&&n.utils.setPrototypeOf(n.observable.fn,n.subscribable.fn),n.hasPrototype=function(e,t){return e===null||e===undefined||e[l]===undefined?!1:e[l]===t?!0:n.hasPrototype(e[l],t)},n.isObservable=function(e){return n.hasPrototype(e,n.observable)},n.isWriteableObservable=function(e){return typeof e=="function"&&e[l]===n.observable?!0:typeof e=="function"&&e[l]===n.dependentObservable&&e.hasWriteFunction?!0:!1},n.exportSymbol("observable",n.observable),n.exportSymbol("isObservable",n.isObservable),n.exportSymbol("isWriteableObservable",n.isWriteableObservable),n.exportSymbol("isWritableObservable",n.isWriteableObservable),n.observableArray=function(e){e=e||[];if(typeof e=="object"&&"length"in e){var t=n.observable(e);return n.utils.setPrototypeOfOrExtend(t,n.observableArray.fn),t.extend({trackArrayChanges:!0})}throw new Error("The argument passed when initializing an observable array must be an array, or null, or undefined.")},n.observableArray.fn={remove:function(e){var t=this.peek(),r=[],i=typeof e=="function"&&!n.isObservable(e)?e:function(t){return t===e};for(var s=0;s<t.length;s++){var o=t[s];i(o)&&(r.length===0&&this.valueWillMutate(),r.push(o),t.splice(s,1),s--)}return r.length&&this.valueHasMutated(),r},removeAll:function(e){if(e===undefined){var t=this.peek(),r=t.slice(0);return this.valueWillMutate(),t.splice(0,t.length),this.valueHasMutated(),r}return e?this.remove(function(t){return n.utils.arrayIndexOf(e,t)>=0}):[]},destroy:function(e){var t=this.peek(),r=typeof e=="function"&&!n.isObservable(e)?e:function(t){return t===e};this.valueWillMutate();for(var i=t.length-1;i>=0;i--){var s=t[i];r(s)&&(t[i]._destroy=!0)}this.valueHasMutated()},destroyAll:function(e){return e===undefined?this.destroy(function(){return!0}):e?this.destroy(function(t){return n.utils.arrayIndexOf(e,t)>=0}):[]},indexOf:function(e){var t=this();return n.utils.arrayIndexOf(t,e)},replace:function(e,t){var n=this.indexOf(e);n>=0&&(this.valueWillMutate(),this.peek()[n]=t,this.valueHasMutated())}},n.utils.arrayForEach(["pop","push","reverse","shift","sort","splice","unshift"],function(e){n.observableArray.fn[e]=function(){var t=this.peek();this.valueWillMutate(),this.cacheDiffForKnownOperation(t,e,arguments);var n=t[e].apply(t,arguments);return this.valueHasMutated(),n}}),n.utils.arrayForEach(["slice"],function(e){n.observableArray.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),n.utils.canSetPrototype&&n.utils.setPrototypeOf(n.observableArray.fn,n.observable.fn),n.exportSymbol("observableArray",n.observableArray);var c="arrayChange";n.extenders.trackArrayChanges=function(e){function o(){if(t)return;t=!0;var n=e.notifySubscribers;e.notifySubscribers=function(e,t){return(!t||t===a)&&++i,n.apply(this,arguments)};var s=[].concat(e.peek()||[]);r=null,e.subscribe(function(t){t=[].concat(t||[]);if(e.hasSubscriptionsForEvent(c)){var n=u(s,t);n.length&&e.notifySubscribers(n,c)}s=t,r=null,i=0})}function u(e,t){if(!r||i>1)r=n.utils.compareArrays(e,t,{sparse:!0});return r}if(e.cacheDiffForKnownOperation)return;var t=!1,r=null,i=0,s=e.subscribe;e.subscribe=e.subscribe=function(e,t,n){return n===c&&o(),s.apply(this,arguments)},e.cacheDiffForKnownOperation=function(e,s,o){function c(e,t,n){return u[u.length]={status:e,value:t,index:n}}if(!t||i)return;var u=[],a=e.length,f=o.length,l=0;switch(s){case"push":l=a;case"unshift":for(var h=0;h<f;h++)c("added",o[h],l+h);break;case"pop":l=a-1;case"shift":a&&c("deleted",e[l],l);break;case"splice":var p=Math.min(Math.max(0,o[0]<0?a+o[0]:o[0]),a),d=f===1?a:Math.min(p+(o[1]||0),a),v=p+f-2,m=Math.max(d,v),g=[],y=[];for(var h=p,b=2;h<m;++h,++b)h<d&&y.push(c("deleted",e[h],h)),h<v&&g.push(c("added",o[b],h));n.utils.findMovesInArrayComparison(y,g);break;default:return}r=u}},n.computed=n.dependentObservable=function(e,t,r){function h(e,t){N[t]||(N[t]=e.subscribe(v),++C)}function p(){n.utils.objectForEach(N,function(e,t){t.dispose()}),N={}}function d(){p(),C=0,a=!0,s=!1}function v(){var e=g.throttleEvaluation;e&&e>=0?(clearTimeout(k),k=setTimeout(m,e)):g._evalRateLimited?g._evalRateLimited():m()}function m(e){if(o){if(l)throw Error("A 'pure' computed must not be called recursively");return}if(a)return;if(x&&x()){if(!u){T();return}}else u=!1;o=!0;if(c)try{var r={};n.dependencyDetection.begin({callback:function(e,t){r[t]||(r[t]=1,++C)},computed:g,isInitial:undefined}),C=0,i=f.call(t)}finally{n.dependencyDetection.end(),o=!1}else try{var p=N,d=C;n.dependencyDetection.begin({callback:function(e,t){a||(d&&p[t]?(N[t]=p[t],++C,delete p[t],--d):h(e,t))},computed:g,isInitial:l?undefined:!C}),N={},C=0;try{var v=t?f.call(t):f()}finally{n.dependencyDetection.end(),d&&n.utils.objectForEach(p,function(e,t){t.dispose()}),s=!1}g.isDifferent(i,v)&&(g.notifySubscribers(i,"beforeChange"),i=v,DEBUG&&(g._latestValue=i),e!==!0&&g.notifySubscribers(i))}finally{o=!1}C||T()}function g(){if(arguments.length>0){if(typeof w!="function")throw new Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return w.apply(t,arguments),this}return n.dependencyDetection.registerDependency(g),s&&m(!0),i}function y(){return s&&!C&&m(!0),i}function b(){return s||C>0}var i,s=!0,o=!1,u=!1,a=!1,f=e,l=!1,c=!1;f&&typeof f=="object"?(r=f,f=r.read):(r=r||{},f||(f=r.read));if(typeof f!="function")throw new Error("Pass a function that returns the value of the ko.computed");var w=r.write,E=r.disposeWhenNodeIsRemoved||r.disposeWhenNodeIsRemoved||null,S=r.disposeWhen||r.disposeWhen,x=S,T=d,N={},C=0,k=null;t||(t=r.owner),n.subscribable.call(g),n.utils.setPrototypeOfOrExtend(g,n.dependentObservable.fn),g.peek=y,g.getDependenciesCount=function(){return C},g.hasWriteFunction=typeof r.write=="function",g.dispose=function(){T()},g.isActive=b;var L=g.limit;return g.limit=function(e){L.call(g,e),g._evalRateLimited=function(){g._rateLimitedBeforeChange(i),s=!0,g._rateLimitedChange(g)}},r.pure?(l=!0,c=!0,g.beforeSubscriptionAdd=function(){c&&(c=!1,m(!0))},g.afterSubscriptionRemove=function(){g.getSubscriptionsCount()||(p(),c=s=!0)}):r.deferEvaluation&&(g.beforeSubscriptionAdd=function(){y(),delete g.beforeSubscriptionAdd}),n.exportProperty(g,"peek",g.peek),n.exportProperty(g,"dispose",g.dispose),n.exportProperty(g,"isActive",g.isActive),n.exportProperty(g,"getDependenciesCount",g.getDependenciesCount),E&&(u=!0,E.nodeType&&(x=function(){return!n.utils.domNodeIsAttachedToDocument(E)||S&&S()})),!c&&!r.deferEvaluation&&m(),E&&b()&&E.nodeType&&(T=function(){n.utils.domNodeDisposal.removeDisposeCallback(E,T),d()},n.utils.domNodeDisposal.addDisposeCallback(E,T)),g},n.isComputed=function(e){return n.hasPrototype(e,n.dependentObservable)};var h=n.observable.protoProperty;n.dependentObservable[h]=n.observable,n.dependentObservable.fn={equalityComparer:i},n.dependentObservable.fn[h]=n.dependentObservable,n.utils.canSetPrototype&&n.utils.setPrototypeOf(n.dependentObservable.fn,n.subscribable.fn),n.exportSymbol("dependentObservable",n.dependentObservable),n.exportSymbol("computed",n.dependentObservable),n.exportSymbol("isComputed",n.isComputed),n.pureComputed=function(e,t){return typeof e=="function"?n.computed(e,t,{pure:!0}):(e=n.utils.extend({},e),e.pure=!0,n.computed(e,t))},n.exportSymbol("pureComputed",n.pureComputed),function(){function t(e,n,s){s=s||new i,e=n(e);var o=typeof e=="object"&&e!==null&&e!==undefined&&!(e instanceof Date)&&!(e instanceof String)&&!(e instanceof Number)&&!(e instanceof Boolean);if(!o)return e;var u=e instanceof Array?[]:{};return s.save(e,u),r(e,function(r){var i=n(e[r]);switch(typeof i){case"boolean":case"number":case"string":case"function":u[r]=i;break;case"object":case"undefined":var o=s.get(i);u[r]=o!==undefined?o:t(i,n,s)}}),u}function r(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);typeof e["toJSON"]=="function"&&t("toJSON")}else for(var r in e)t(r)}function i(){this.keys=[],this.values=[]}var e=10;n.toJS=function(r){if(arguments.length==0)throw new Error("When calling ko.toJS, pass the object you want to convert.");return t(r,function(t){for(var r=0;n.isObservable(t)&&r<e;r++)t=t();return t})},n.toJSON=function(e,t,r){var i=n.toJS(e);return n.utils.stringifyJson(i,t,r)},i.prototype={constructor:i,save:function(e,t){var r=n.utils.arrayIndexOf(this.keys,e);r>=0?this.values[r]=t:(this.keys.push(e),this.values.push(t))},get:function(e){var t=n.utils.arrayIndexOf(this.keys,e);return t>=0?this.values[t]:undefined}}}(),n.exportSymbol("toJS",n.toJS),n.exportSymbol("toJSON",n.toJSON),function(){var e="__ko__hasDomDataOptionValue__";n.selectExtensions={readValue:function(t){switch(n.utils.tagNameLower(t)){case"option":if(t[e]===!0)return n.utils.domData.get(t,n.bindingHandlers.options.optionValueDomDataKey);return n.utils.ieVersion<=7?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return t.selectedIndex>=0?n.selectExtensions.readValue(t.options[t.selectedIndex]):undefined;default:return t.value}},writeValue:function(t,r,i){switch(n.utils.tagNameLower(t)){case"option":switch(typeof r){case"string":n.utils.domData.set(t,n.bindingHandlers.options.optionValueDomDataKey,undefined),e in t&&delete t[e],t.value=r;break;default:n.utils.domData.set(t,n.bindingHandlers.options.optionValueDomDataKey,r),t[e]=!0,t.value=typeof r=="number"?r:""}break;case"select":if(r===""||r===null)r=undefined;var s=-1;for(var o=0,u=t.options.length,a;o<u;++o){a=n.selectExtensions.readValue(t.options[o]);if(a==r||a==""&&r===undefined){s=o;break}}if(i||s>=0||r===undefined&&t.size>1)t.selectedIndex=s;break;default:if(r===null||r===undefined)r="";t.value=r}}}}(),n.exportSymbol("selectExtensions",n.selectExtensions),n.exportSymbol("selectExtensions.readValue",n.selectExtensions.readValue),n.exportSymbol("selectExtensions.writeValue",n.selectExtensions.writeValue),n.expressionRewriting=function(){function r(r){if(n.utils.arrayIndexOf(e,r)>=0)return!1;var i=r.match(t);return i===null?!1:i[1]?"Object("+i[1]+")"+i[2]:r}function p(e){var t=n.utils.stringTrim(e);t.charCodeAt(0)===123&&(t=t.slice(1,-1));var r=[],i=t.match(l),s,o,u=0;if(i){i.push(",");for(var a=0,f;f=i[a];++a){var p=f.charCodeAt(0);if(p===44){if(u<=0){s&&r.push(o?{key:s,value:o.join("")}:{unknown:s}),s=o=u=0;continue}}else if(p===58){if(!o)continue}else if(p===47&&a&&f.length>1){var d=i[a-1].match(c);d&&!h[d[0]]&&(t=t.substr(t.indexOf(f)+1),i=t.match(l),i.push(","),a=-1,f="/")}else if(p===40||p===123||p===91)++u;else if(p===41||p===125||p===93)--u;else if(!s&&!o){s=p===34||p===39?f.slice(1,-1):f;continue}o?o.push(f):o=[f]}}return r}function v(e,t){function i(e,t){function l(n){return n&&n.preprocess?t=n.preprocess(t,e,i):!0}var f;if(!a){if(!l(n.getBindingHandler(e)))return;d[e]&&(f=r(t))&&o.push("'"+e+"':function(_z){"+f+"=_z}")}u&&(t="function(){return "+t+" }"),s.push("'"+e+"':"+t)}t=t||{};var s=[],o=[],u=t.valueAccessors,a=t.bindingParams,f=typeof e=="string"?p(e):e;return n.utils.arrayForEach(f,function(e){i(e.key||e.unknown,e.value)}),o.length&&i("_ko_property_writers","{"+o.join(",")+" }"),s.join(",")}var e=["true","false","null","undefined"],t=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,i='"(?:[^"\\\\]|\\\\.)*"',s="'(?:[^'\\\\]|\\\\.)*'",o="/(?:[^/\\\\]|\\\\.)*/w*",u=",\"'{}()/:[\\]",a="[^\\s:,/][^"+u+"]*[^\\s"+u+"]",f="[^\\s]",l=RegExp(i+"|"+s+"|"+o+"|"+a+"|"+f,"g"),c=/[\])"'A-Za-z0-9_$]+$/,h={"in":1,"return":1,"typeof":1},d={};return{bindingRewriteValidators:[],twoWayBindings:d,parseObjectLiteral:p,preProcessBindings:v,keyValueArrayContainsKey:function(e,t){for(var n=0;n<e.length;n++)if(e[n]["key"]==t)return!0;return!1},writeValueToProperty:function(e,t,r,i,s){if(!e||!n.isObservable(e)){var o=t.get("_ko_property_writers");o&&o[r]&&o[r](i)}else n.isWriteableObservable(e)&&(!s||e.peek()!==i)&&e(i)}}}(),n.exportSymbol("expressionRewriting",n.expressionRewriting),n.exportSymbol("expressionRewriting.bindingRewriteValidators",n.expressionRewriting.bindingRewriteValidators),n.exportSymbol("expressionRewriting.parseObjectLiteral",n.expressionRewriting.parseObjectLiteral),n.exportSymbol("expressionRewriting.preProcessBindings",n.expressionRewriting.preProcessBindings),n.exportSymbol("expressionRewriting._twoWayBindings",n.expressionRewriting.twoWayBindings),n.exportSymbol("jsonExpressionRewriting",n.expressionRewriting),n.exportSymbol("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",n.expressionRewriting.preProcessBindings),function(){function s(n){return n.nodeType==8&&t.test(e?n.text:n.nodeValue)}function o(t){return t.nodeType==8&&r.test(e?t.text:t.nodeValue)}function u(e,t){var n=e,r=1,i=[];while(n=n.nextSibling){if(o(n)){r--;if(r===0)return i}i.push(n),s(n)&&r++}if(!t)throw new Error("Cannot find closing comment tag to match: "+e.nodeValue);return null}function a(e,t){var n=u(e,t);return n?n.length>0?n[n.length-1].nextSibling:e.nextSibling:null}function f(e){var t=e.firstChild,n=null;if(t)do if(n)n.push(t);else if(s(t)){var r=a(t,!0);r?t=r:n=[t]}else o(t)&&(n=[t]);while(t=t.nextSibling);return n}var e=document&&document.createComment("test").text==="<!--test-->",t=e?/^<!--\s*ko(?:\s+([\s\S]+))?\s*-->$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,r=e?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/,i={ul:!0,ol:!0};n.virtualElements={allowedBindings:{},childNodes:function(e){return s(e)?u(e):e.childNodes},emptyNode:function(e){if(!s(e))n.utils.emptyDomNode(e);else{var t=n.virtualElements.childNodes(e);for(var r=0,i=t.length;r<i;r++)n.removeNode(t[r])}},setDomNodeChildren:function(e,t){if(!s(e))n.utils.setDomNodeChildren(e,t);else{n.virtualElements.emptyNode(e);var r=e.nextSibling;for(var i=0,o=t.length;i<o;i++)r.parentNode.insertBefore(t[i],r)}},prepend:function(e,t){s(e)?e.parentNode.insertBefore(t,e.nextSibling):e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},insertAfter:function(e,t,r){r?s(e)?e.parentNode.insertBefore(t,r.nextSibling):r.nextSibling?e.insertBefore(t,r.nextSibling):e.appendChild(t):n.virtualElements.prepend(e,t)},firstChild:function(e){return s(e)?!e.nextSibling||o(e.nextSibling)?null:e.nextSibling:e.firstChild},nextSibling:function(e){return s(e)&&(e=a(e)),e.nextSibling&&o(e.nextSibling)?null:e.nextSibling},hasBindingValue:s,virtualNodeBindingValue:function(n){var r=(e?n.text:n.nodeValue).match(t);return r?r[1]:null},normaliseVirtualElementDomStructure:function(e){if(!i[n.utils.tagNameLower(e)])return;var t=e.firstChild;if(t)do if(t.nodeType===1){var r=f(t);if(r){var s=t.nextSibling;for(var o=0;o<r.length;o++)s?e.insertBefore(r[o],s):e.appendChild(r[o])}}while(t=t.nextSibling)}}}(),n.exportSymbol("virtualElements",n.virtualElements),n.exportSymbol("virtualElements.allowedBindings",n.virtualElements.allowedBindings),n.exportSymbol("virtualElements.emptyNode",n.virtualElements.emptyNode),n.exportSymbol("virtualElements.insertAfter",n.virtualElements.insertAfter),n.exportSymbol("virtualElements.prepend",n.virtualElements.prepend),n.exportSymbol("virtualElements.setDomNodeChildren",n.virtualElements.setDomNodeChildren),function(){function t(e,t,n){var i=e+(n&&n.valueAccessors||"");return t[i]||(t[i]=r(e,n))}function r(e,t){var r=n.expressionRewriting.preProcessBindings(e,t),i="with($context){with($data||{}){return{"+r+"}}}";return new Function("$context","$element",i)}var e="data-bind";n.bindingProvider=function(){this.bindingCache={}},n.utils.extend(n.bindingProvider.prototype,{nodeHasBindings:function(t){switch(t.nodeType){case 1:return t.getAttribute(e)!=null||n.components.getComponentNameForNode(t);case 8:return n.virtualElements.hasBindingValue(t);default:return!1}},getBindings:function(e,t){var r=this.getBindingsString(e,t),i=r?this.parseBindingsString(r,t,e):null;return n.components.addBindingsForCustomElement(i,e,t,!1)},getBindingAccessors:function(e,t){var r=this.getBindingsString(e,t),i=r?this.parseBindingsString(r,t,e,{valueAccessors:!0}):null;return n.components.addBindingsForCustomElement(i,e,t,!0)},getBindingsString:function(t,r){switch(t.nodeType){case 1:return t.getAttribute(e);case 8:return n.virtualElements.virtualNodeBindingValue(t);default:return null}},parseBindingsString:function(e,n,r,i){try{var s=t(e,this.bindingCache,i);return s(n,r)}catch(o){throw o.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+o.message,o}}}),n.bindingProvider.instance=new n.bindingProvider}(),n.exportSymbol("bindingProvider",n.bindingProvider),function(){function t(e){return function(){return e}}function r(e){return e()}function i(e){return n.utils.objectMap(n.dependencyDetection.ignore(e),function(t,n){return function(){return e()[n]}})}function s(e,r,s){return typeof e=="function"?i(e.bind(null,r,s)):n.utils.objectMap(e,t)}function o(e,t){return i(this.getBindings.bind(this,e,t))}function u(e){var t=n.virtualElements.allowedBindings[e];if(!t)throw new Error("The binding '"+e+"' cannot be used with virtual elements")}function a(e,t,r){var i,s=n.virtualElements.firstChild(t),o=n.bindingProvider.instance,u=o.preprocessNode;if(u){while(i=s)s=n.virtualElements.nextSibling(i),u.call(o,i);s=n.virtualElements.firstChild(t)}while(i=s)s=n.virtualElements.nextSibling(i),f(e,i,r)}function f(t,r,i){var s=!0,o=r.nodeType===1;o&&n.virtualElements.normaliseVirtualElementDomStructure(r);var u=o&&i||n.bindingProvider.instance.nodeHasBindings(r);u&&(s=h(r,null,t,i).shouldBindDescendants),s&&!e[n.utils.tagNameLower(r)]&&a(t,r,!o)}function c(e){var t=[],r={},i=[];return n.utils.objectForEach(e,function s(o){if(!r[o]){var u=n.getBindingHandler(o);u&&(u.after&&(i.push(o),n.utils.arrayForEach(u.after,function(t){if(e[t]){if(n.utils.arrayIndexOf(i,t)!==-1)throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+i.join(", "));s(t)}}),i.length--),t.push({key:o,handler:u})),r[o]=!0}}),t}function h(e,t,i,s){var a=n.utils.domData.get(e,l);if(!t){if(a)throw Error("You cannot apply bindings multiple times to the same element.");n.utils.domData.set(e,l,!0)}!a&&s&&n.storedBindingContextForNode(e,i);var f;if(t&&typeof t!="function")f=t;else{var h=n.bindingProvider.instance,p=h.getBindingAccessors||o,d=n.dependentObservable(function(){return f=t?t(i,e):p.call(h,e,i),f&&i._subscribable&&i._subscribable(),f},null,{disposeWhenNodeIsRemoved:e});if(!f||!d.isActive())d=null}var v;if(f){var m=d?function(e){return function(){return r(d()[e])}}:function(e){return f[e]};function g(){return n.utils.objectMap(d?d():f,r)}g.get=function(e){return f[e]&&r(m(e))},g.has=function(e){return e in f};var y=c(f);n.utils.arrayForEach(y,function(t){var r=t.handler.init,s=t.handler.update,o=t.key;e.nodeType===8&&u(o);try{typeof r=="function"&&n.dependencyDetection.ignore(function(){var t=r(e,m(o),g,i.$data,i);if(t&&t.controlsDescendantBindings){if(v!==undefined)throw new Error("Multiple bindings ("+v+" and "+o+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");v=o}}),typeof s=="function"&&n.dependentObservable(function(){s(e,m(o),g,i.$data,i)},null,{disposeWhenNodeIsRemoved:e})}catch(a){throw a.message='Unable to process binding "'+o+": "+f[o]+'"\nMessage: '+a.message,a}})}return{shouldBindDescendants:v===undefined}}function d(e){return e&&e instanceof n.bindingContext?e:new n.bindingContext(e)}n.bindingHandlers={};var e={script:!0};n.getBindingHandler=function(e){return n.bindingHandlers[e]},n.bindingContext=function(e,t,r,i){function s(){var s=a?e():e,o=n.utils.unwrapObservable(s);return t?(t._subscribable&&t._subscribable(),n.utils.extend(u,t),l&&(u._subscribable=l)):(u.$parents=[],u.$root=o,u.ko=n),u.$rawData=s,u.$data=o,r&&(u[r]=o),i&&i(u,t,o),u.$data}function o(){return f&&!n.utils.anyDomNodeIsAttachedToDocument(f)}var u=this,a=typeof e=="function"&&!n.isObservable(e),f,l=n.dependentObservable(s,null,{disposeWhen:o,disposeWhenNodeIsRemoved:!0});l.isActive()&&(u._subscribable=l,l.equalityComparer=null,f=[],l._addNode=function(e){f.push(e),n.utils.domNodeDisposal.addDisposeCallback(e,function(e){n.utils.arrayRemoveItem(f,e),f.length||(l.dispose(),u._subscribable=l=undefined)})})},n.bindingContext.prototype.createChildContext=function(e,t,r){return new n.bindingContext(e,this,t,function(e,t){e.$parentContext=t,e.$parent=t.$data,e.$parents=(t.$parents||[]).slice(0),e.$parents.unshift(e.$parent),r&&r(e)})},n.bindingContext.prototype.extend=function(e){return new n.bindingContext(this._subscribable||this.$data,this,null,function(t,r){t.$rawData=r.$rawData,n.utils.extend(t,typeof e=="function"?e():e)})};var l=n.utils.domData.nextKey(),p=n.utils.domData.nextKey();n.storedBindingContextForNode=function(e,t){if(arguments.length!=2)return n.utils.domData.get(e,p);n.utils.domData.set(e,p,t),t._subscribable&&t._subscribable._addNode(e)},n.applyBindingAccessorsToNode=function(e,t,r){return e.nodeType===1&&n.virtualElements.normaliseVirtualElementDomStructure(e),h(e,t,d(r),!0)},n.applyBindingsToNode=function(e,t,r){var i=d(r);return n.applyBindingAccessorsToNode(e,s(t,i,e),i)},n.applyBindingsToDescendants=function(e,t){(t.nodeType===1||t.nodeType===8)&&a(d(e),t,!0)},n.applyBindings=function(e,t){!jQueryInstance&&window.jQuery&&(jQueryInstance=window.jQuery);if(t&&t.nodeType!==1&&t.nodeType!==8)throw new Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");t=t||window.document.body,f(d(e),t,!0)},n.contextFor=function(e){switch(e.nodeType){case 1:case 8:var t=n.storedBindingContextForNode(e);if(t)return t;if(e.parentNode)return n.contextFor(e.parentNode)}return undefined},n.dataFor=function(e){var t=n.contextFor(e);return t?t.$data:undefined},n.exportSymbol("bindingHandlers",n.bindingHandlers),n.exportSymbol("applyBindings",n.applyBindings),n.exportSymbol("applyBindingsToDescendants",n.applyBindingsToDescendants),n.exportSymbol("applyBindingAccessorsToNode",n.applyBindingAccessorsToNode),n.exportSymbol("applyBindingsToNode",n.applyBindingsToNode),n.exportSymbol("contextFor",n.contextFor),n.exportSymbol("dataFor",n.dataFor)}(),function(e){function i(t,n){return t.hasOwnProperty(n)?t[n]:e}function s(e,s){var u=i(t,e),a;u||(u=t[e]=new n.subscribable,o(e,function(n){r[e]=n,delete t[e],a?u.notifySubscribers(n):setTimeout(function(){u.notifySubscribers(n)},0)}),a=!0),u.subscribe(s)}function o(e,t){u("getConfig",[e],function(n){n?u("loadComponent",[e,n],function(e){t(e)}):t(null)})}function u(t,r,i,s){s||(s=n.components.loaders.slice(0));var o=s.shift();if(o){var a=o[t];if(a){var f=!1,l=a.apply(o,r.concat(function(e){f?i(null):e!==null?i(e):u(t,r,i,s)}));if(l!==e){f=!0;if(!o.suppressLoaderExceptions)throw new Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}}else u(t,r,i,s)}else i(null)}var t={},r={};n.components={get:function(e,t){var n=i(r,e);n?setTimeout(function(){t(n)},0):s(e,t)},clearCachedDefinition:function(e){delete r[e]},_getFirstResultFromLoaders:u},n.components.loaders=[],n.exportSymbol("components",n.components),n.exportSymbol("components.get",n.components.get),n.exportSymbol("components.clearCachedDefinition",n.components.clearCachedDefinition)}(),function(e){function s(e,t,r,s){var o={},u=2,a=function(){--u===0&&s(o)},f=r.template,l=r.viewModel;f?c(t,f,function(t){n.components._getFirstResultFromLoaders("loadTemplate",[e,t],function(e){o.template=e,a()})}):a(),l?c(t,l,function(t){n.components._getFirstResultFromLoaders("loadViewModel",[e,t],function(e){o[i]=e,a()})}):a()}function o(e,t,r){if(typeof t=="string")r(n.utils.parseHtmlFragment(t));else if(t instanceof Array)r(t);else if(l(t))r(n.utils.makeArray(t.childNodes));else if(t.element){var i=t.element;if(f(i))r(a(i));else if(typeof i=="string"){var s=document.getElementById(i);s?r(a(s)):e("Cannot find element with ID "+i)}else e("Unknown element type: "+i)}else e("Unknown template value: "+t)}function u(e,t,n){if(typeof t=="function")n(function(e){return new t(e)});else if(typeof t[i]=="function")n(t[i]);else if("instance"in t){var r=t.instance;n(function(e,t){return r})}else"viewModel"in t?u(e,t.viewModel,n):e("Unknown viewModel value: "+t)}function a(e){switch(n.utils.tagNameLower(e)){case"script":return n.utils.parseHtmlFragment(e.text);case"textarea":return n.utils.parseHtmlFragment(e.value);case"template":if(l(e.content))return n.utils.cloneNodes(e.content.childNodes)}return n.utils.cloneNodes(e.childNodes)}function f(e){return window.HTMLElement?e instanceof HTMLElement:e&&e.tagName&&e.nodeType===1}function l(e){return window.DocumentFragment?e instanceof DocumentFragment:e&&e.nodeType===11}function c(e,n,r){typeof n["require"]=="string"?t||window.require?(t||window.require)([n.require],r):e("Uses require, but no AMD loader is present"):r(n)}function h(e){return function(t){throw new Error("Component '"+e+"': "+t)}}var r={};n.components.register=function(e,t){if(!t)throw new Error("Invalid configuration for "+e);if(n.components.isRegistered(e))throw new Error("Component "+e+" is already registered");r[e]=t},n.components.isRegistered=function(e){return e in r},n.components.unregister=function(e){delete r[e],n.components.clearCachedDefinition(e)},n.components.defaultLoader={getConfig:function(e,t){var n=r.hasOwnProperty(e)?r[e]:null;t(n)},loadComponent:function(e,t,n){var r=h(e);c(r,t,function(t){s(e,r,t,n)})},loadTemplate:function(e,t,n){o(h(e),t,n)},loadViewModel:function(e,t,n){u(h(e),t,n)}};var i="createViewModel";n.exportSymbol("components.register",n.components.register),n.exportSymbol("components.isRegistered",n.components.isRegistered),n.exportSymbol("components.unregister",n.components.unregister),n.exportSymbol("components.defaultLoader",n.components.defaultLoader),n.components.loaders.push(n.components.defaultLoader),n.components._allRegisteredComponents=r}(),function(e){function r(e,r){var i=e.getAttribute("params");if(i){var s=t.parseBindingsString(i,r,e,{valueAccessors:!0,bindingParams:!0}),o=n.utils.objectMap(s,function(t,r){return n.computed(t,null,{disposeWhenNodeIsRemoved:e})}),u=n.utils.objectMap(o,function(t,r){return t.isActive()?n.computed(function(){return n.utils.unwrapObservable(t())},null,{disposeWhenNodeIsRemoved:e}):t.peek()});return u.hasOwnProperty("$raw")||(u.$raw=o),u}return{$raw:{}}}n.components.getComponentNameForNode=function(e){var t=n.utils.tagNameLower(e);return n.components.isRegistered(t)&&t},n.components.addBindingsForCustomElement=function(e,t,i,s){if(t.nodeType===1){var o=n.components.getComponentNameForNode(t);if(o){e=e||{};if(e.component)throw new Error('Cannot use the "component" binding on a custom element matching a component');var u={name:o,params:r(t,i)};e.component=s?function(){return u}:u}}return e};var t=new n.bindingProvider;n.utils.ieVersion<9&&(n.components.register=function(e){return function(t){return document.createElement(t),e.apply(this,arguments)}}(n.components.register),document.createDocumentFragment=function(e){return function(){var t=e(),r=n.components._allRegisteredComponents;for(var i in r)r.hasOwnProperty(i)&&t.createElement(i);return t}}(document.createDocumentFragment))}(),function(e){function r(e,t,r){var i=t.template;if(!i)throw new Error("Component '"+e+"' has no template");var s=n.utils.cloneNodes(i);n.virtualElements.setDomNodeChildren(r,s)}function i(e,t,n){var r=e.createViewModel;return r?r.call(e,n,{element:t}):n}var t=0;n.bindingHandlers.component={init:function(e,s,o,u,a){var f,l,c=function(){var e=f&&f.dispose;typeof e=="function"&&e.call(f),l=null};return n.utils.domNodeDisposal.addDisposeCallback(e,c),n.computed(function(){var o=n.utils.unwrapObservable(s()),u,h;typeof o=="string"?u=o:(u=n.utils.unwrapObservable(o.name),h=n.utils.unwrapObservable(o.params));if(!u)throw new Error("No component name specified");var p=l=++t;n.components.get(u,function(t){if(l!==p)return;c();if(!t)throw new Error("Unknown component '"+u+"'");r(u,t,e);var s=i(t,e,h),o=a.createChildContext(s);f=s,n.applyBindingsToDescendants(o,e)})},null,{disposeWhenNodeIsRemoved:e}),{controlsDescendantBindings:!0}}},n.virtualElements.allowedBindings.component=!0}();var p={"class":"className","for":"htmlFor"};n.bindingHandlers.attr={update:function(e,t,r){var i=n.utils.unwrapObservable(t())||{};n.utils.objectForEach(i,function(t,r){r=n.utils.unwrapObservable(r);var i=r===!1||r===null||r===undefined;i&&e.removeAttribute(t),n.utils.ieVersion<=8&&t in p?(t=p[t],i?e.removeAttribute(t):e[t]=r):i||e.setAttribute(t,r.toString()),t==="name"&&n.utils.setElementName(e,i?"":r.toString())})}},function(){n.bindingHandlers.checked={after:["value","attr"],init:function(e,t,r){function s(){var s=e.checked,o=c?i():s;if(n.computedContext.isInitial())return;if(a&&!s)return;var u=n.dependencyDetection.ignore(t);f?l!==o?(s&&(n.utils.addOrRemoveItem(u,o,!0),n.utils.addOrRemoveItem(u,l,!1)),l=o):n.utils.addOrRemoveItem(u,o,s):n.expressionRewriting.writeValueToProperty(u,r,"checked",o,!0)}function o(){var r=n.utils.unwrapObservable(t());f?e.checked=n.utils.arrayIndexOf(r,i())>=0:u?e.checked=r:e.checked=i()===r}var i=n.pureComputed(function(){return r.has("checkedValue")?n.utils.unwrapObservable(r.get("checkedValue")):r.has("value")?n.utils.unwrapObservable(r.get("value")):e.value}),u=e.type=="checkbox",a=e.type=="radio";if(!u&&!a)return;var f=u&&n.utils.unwrapObservable(t())instanceof Array,l=f?i():undefined,c=a||f;a&&!e.name&&n.bindingHandlers.uniqueName.init(e,function(){return!0}),n.computed(s,null,{disposeWhenNodeIsRemoved:e}),n.utils.registerEventHandler(e,"click",s),n.computed(o,null,{disposeWhenNodeIsRemoved:e})}},n.expressionRewriting.twoWayBindings.checked=!0,n.bindingHandlers.checkedValue={update:function(e,t){e.value=n.utils.unwrapObservable(t())}}}();var d="__ko__cssValue";n.bindingHandlers.css={update:function(e,t){var r=n.utils.unwrapObservable(t());typeof r=="object"?n.utils.objectForEach(r,function(t,r){r=n.utils.unwrapObservable(r),n.utils.toggleDomNodeCssClass(e,t,r)}):(r=String(r||""),n.utils.toggleDomNodeCssClass(e,e[d],!1),e[d]=r,n.utils.toggleDomNodeCssClass(e,r,!0))}},n.bindingHandlers.enable={update:function(e,t){var r=n.utils.unwrapObservable(t());r&&e.disabled?e.removeAttribute("disabled"):!r&&!e.disabled&&(e.disabled=!0)}},n.bindingHandlers.disable={update:function(e,t){n.bindingHandlers.enable.update(e,function(){return!n.utils.unwrapObservable(t())})}},n.bindingHandlers.event={init:function(e,t,r,i,s){var o=t()||{};n.utils.objectForEach(o,function(o){typeof o=="string"&&n.utils.registerEventHandler(e,o,function(e){var u,a=t()[o];if(!a)return;try{var f=n.utils.makeArray(arguments);i=s.$data,f.unshift(i),u=a.apply(i,f)}finally{u!==!0&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}var l=r.get(o+"Bubble")!==!1;l||(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())})})}},n.bindingHandlers.foreach={makeTemplateValueAccessor:function(e){return function(){var t=e(),r=n.utils.peekObservable(t);return!r||typeof r.length=="number"?{foreach:t,templateEngine:n.nativeTemplateEngine.instance}:(n.utils.unwrapObservable(t),{foreach:r.data,as:r.as,includeDestroyed:r.includeDestroyed,afterAdd:r.afterAdd,beforeRemove:r.beforeRemove,afterRender:r.afterRender,beforeMove:r.beforeMove,afterMove:r.afterMove,templateEngine:n.nativeTemplateEngine.instance})}},init:function(e,t,r,i,s){return n.bindingHandlers.template.init(e,n.bindingHandlers.foreach.makeTemplateValueAccessor(t))},update:function(e,t,r,i,s){return n.bindingHandlers.template.update(e,n.bindingHandlers.foreach.makeTemplateValueAccessor(t),r,i,s)}},n.expressionRewriting.bindingRewriteValidators.foreach=!1,n.virtualElements.allowedBindings.foreach=!0;var m="__ko_hasfocusUpdating",g="__ko_hasfocusLastValue";n.bindingHandlers.hasfocus={init:function(e,t,r){var i=function(i){e[m]=!0;var s=e.ownerDocument;if("activeElement"in s){var o;try{o=s.activeElement}catch(u){o=s.body}i=o===e}var a=t();n.expressionRewriting.writeValueToProperty(a,r,"hasfocus",i,!0),e[g]=i,e[m]=!1},s=i.bind(null,!0),o=i.bind(null,!1);n.utils.registerEventHandler(e,"focus",s),n.utils.registerEventHandler(e,"focusin",s),n.utils.registerEventHandler(e,"blur",o),n.utils.registerEventHandler(e,"focusout",o)},update:function(e,t){var r=!!n.utils.unwrapObservable(t());!e[m]&&e[g]!==r&&(r?e.focus():e.blur(),n.dependencyDetection.ignore(n.utils.triggerEvent,null,[e,r?"focusin":"focusout"]))}},n.expressionRewriting.twoWayBindings.hasfocus=!0,n.bindingHandlers.hasFocus=n.bindingHandlers.hasfocus,n.expressionRewriting.twoWayBindings.hasFocus=!0,n.bindingHandlers.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){n.utils.setHtml(e,t())}},y("if"),y("ifnot",!1,!0),y("with",!0,!1,function(e,t){return e.createChildContext(t)});var b={};n.bindingHandlers.options={init:function(e){if(n.utils.tagNameLower(e)!=="select")throw new Error("options binding applies only to SELECT elements");while(e.length>0)e.remove(0);return{controlsDescendantBindings:!0}},update:function(e,t,r){function i(){return n.utils.arrayFilter(e.options,function(e){return e.selected})}function p(e,t,n){var r=typeof t;return r=="function"?t(e):r=="string"?e[t]:n}function v(t,i,s){s.length&&(h=s[0].selected?[n.selectExtensions.readValue(s[0])]:[],d=!0);var o=e.ownerDocument.createElement("option");if(t===b)n.utils.setTextContent(o,r.get("optionsCaption")),n.selectExtensions.writeValue(o,undefined);else{var u=p(t,r.get("optionsValue"),t);n.selectExtensions.writeValue(o,n.utils.unwrapObservable(u));var a=p(t,r.get("optionsText"),u);n.utils.setTextContent(o,a)}return[o]}function m(t,r){if(h.length){var i=n.utils.arrayIndexOf(h,n.selectExtensions.readValue(r[0]))>=0;n.utils.setOptionNodeSelectionState(r[0],i),d&&!i&&n.dependencyDetection.ignore(n.utils.triggerEvent,null,[e,"change"])}}var s=e.length==0,o=!s&&e.multiple?e.scrollTop:null,u=n.utils.unwrapObservable(t()),a=r.get("optionsIncludeDestroyed"),f={},l,c,h;e.multiple?h=n.utils.arrayMap(i(),n.selectExtensions.readValue):h=e.selectedIndex>=0?[n.selectExtensions.readValue(e.options[e.selectedIndex])]:[],u&&(typeof u.length=="undefined"&&(u=[u]),c=n.utils.arrayFilter(u,function(e){return a||e===undefined||e===null||!n.utils.unwrapObservable(e._destroy)}),r.has("optionsCaption")&&(l=n.utils.unwrapObservable(r.get("optionsCaption")),l!==null&&l!==undefined&&c.unshift(b)));var d=!1;f.beforeRemove=function(t){e.removeChild(t)};var g=m;r.has("optionsAfterRender")&&(g=function(e,t){m(e,t),n.dependencyDetection.ignore(r.get("optionsAfterRender"),null,[t[0],e!==b?e:undefined])}),n.utils.setDomNodeChildrenFromArrayMapping(e,c,v,f,g),n.dependencyDetection.ignore(function(){if(r.get("valueAllowUnset")&&r.has("value"))n.selectExtensions.writeValue(e,n.utils.unwrapObservable(r.get("value")),!0);else{var t;e.multiple?t=h.length&&i().length<h.length:t=h.length&&e.selectedIndex>=0?n.selectExtensions.readValue(e.options[e.selectedIndex])!==h[0]:h.length||e.selectedIndex>=0,t&&n.utils.triggerEvent(e,"change")}}),n.utils.ensureSelectElementIsRenderedCorrectly(e),o&&Math.abs(o-e.scrollTop)>20&&(e.scrollTop=o)}},n.bindingHandlers.options.optionValueDomDataKey=n.utils.domData.nextKey(),n.bindingHandlers.selectedOptions={after:["options","foreach"],init:function(e,t,r){n.utils.registerEventHandler(e,"change",function(){var i=t(),s=[];n.utils.arrayForEach(e.getElementsByTagName("option"),function(e){e.selected&&s.push(n.selectExtensions.readValue(e))}),n.expressionRewriting.writeValueToProperty(i,r,"selectedOptions",s)})},update:function(e,t){if(n.utils.tagNameLower(e)!="select")throw new Error("values binding applies only to SELECT elements");var r=n.utils.unwrapObservable(t());r&&typeof r.length=="number"&&n.utils.arrayForEach(e.getElementsByTagName("option"),function(e){var t=n.utils.arrayIndexOf(r,n.selectExtensions.readValue(e))>=0;n.utils.setOptionNodeSelectionState(e,t)})}},n.expressionRewriting.twoWayBindings.selectedOptions=!0,n.bindingHandlers.style={update:function(e,t){var r=n.utils.unwrapObservable(t()||{});n.utils.objectForEach(r,function(t,r){r=n.utils.unwrapObservable(r);if(r===null||r===undefined||r===!1)r="";e.style[t]=r})}},n.bindingHandlers.submit={init:function(e,t,r,i,s){if(typeof t()!="function")throw new Error("The value for a submit binding must be a function");n.utils.registerEventHandler(e,"submit",function(n){var r,i=t();try{r=i.call(s.$data,e)}finally{r!==!0&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},n.bindingHandlers.text={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){n.utils.setTextContent(e,t())}},n.virtualElements.allowedBindings.text=!0,function(){if(window&&window.navigator)var e=function(e){if(e)return parseFloat(e[1])},t=window.opera&&window.opera.version&&parseInt(window.opera.version()),r=window.navigator.userAgent,i=e(r.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),s=e(r.match(/Firefox\/([^ ]*)/));if(n.utils.ieVersion<10)var o=n.utils.domData.nextKey(),u=n.utils.domData.nextKey(),a=function(e){var t=this.activeElement,r=t&&n.utils.domData.get(t,u);r&&r(e)},f=function(e,t){var r=e.ownerDocument;n.utils.domData.get(r,o)||(n.utils.domData.set(r,o,!0),n.utils.registerEventHandler(r,"selectionchange",a)),n.utils.domData.set(e,u,t)};n.bindingHandlers.textInput={init:function(e,r,o){var u=e.value,a,l,c=function(t){clearTimeout(a),l=a=undefined;var i=e.value;u!==i&&(DEBUG&&t&&(e._ko_textInputProcessedEvent=t.type),u=i,n.expressionRewriting.writeValueToProperty(r(),o,"textInput",i))},h=function(t){if(!a){l=e.value;var n=DEBUG?c.bind(e,{type:t.type}):c;a=setTimeout(n,4)}},p=function(){var t=n.utils.unwrapObservable(r());if(t===null||t===undefined)t="";if(l!==undefined&&t===l){setTimeout(p,4);return}e.value!==t&&(u=t,e.value=t)},d=function(t,r){n.utils.registerEventHandler(e,t,r)};DEBUG&&n.bindingHandlers.textInput._forceUpdateOn?n.utils.arrayForEach(n.bindingHandlers.textInput._forceUpdateOn,function(e){e.slice(0,5)=="after"?d(e.slice(5),h):d(e,c)}):n.utils.ieVersion<10?(d("propertychange",function(e){e.propertyName==="value"&&c(e)}),n.utils.ieVersion==8&&(d("keyup",c),d("keydown",c)),n.utils.ieVersion>=8&&(f(e,c),d("dragend",h))):(d("input",c),i<5&&n.utils.tagNameLower(e)==="textarea"?(d("keydown",h),d("paste",h),d("cut",h)):t<11?d("keydown",h):s<4&&(d("DOMAutoComplete",c),d("dragdrop",c),d("drop",c))),d("change",c),n.computed(p,null,{disposeWhenNodeIsRemoved:e})}},n.expressionRewriting.twoWayBindings.textInput=!0,n.bindingHandlers.textinput={preprocess:function(e,t,n){n("textInput",e)}}}(),n.bindingHandlers.uniqueName={init:function(e,t){if(t()){var r="ko_unique_"+ ++n.bindingHandlers.uniqueName.currentIndex;n.utils.setElementName(e,r)}}},n.bindingHandlers.uniqueName.currentIndex=0,n.bindingHandlers.value={after:["options","foreach"],init:function(e,t,r){if(e.tagName.toLowerCase()=="input"&&(e.type=="checkbox"||e.type=="radio")){n.applyBindingAccessorsToNode(e,{checkedValue:t});return}var i=["change"],s=r.get("valueUpdate"),o=!1,u=null;s&&(typeof s=="string"&&(s=[s]),n.utils.arrayPushAll(i,s),i=n.utils.arrayGetDistinctValues(i));var a=function(){u=null,o=!1;var i=t(),s=n.selectExtensions.readValue(e);n.expressionRewriting.writeValueToProperty(i,r,"value",s)},f=n.utils.ieVersion&&e.tagName.toLowerCase()=="input"&&e.type=="text"&&e.autocomplete!="off"&&(!e.form||e.form.autocomplete!="off");f&&n.utils.arrayIndexOf(i,"propertychange")==-1&&(n.utils.registerEventHandler(e,"propertychange",function(){o=!0}),n.utils.registerEventHandler(e,"focus",function(){o=!1}),n.utils.registerEventHandler(e,"blur",function(){o&&a()})),n.utils.arrayForEach(i,function(t){var r=a;n.utils.stringStartsWith(t,"after")&&(r=function(){u=n.selectExtensions.readValue(e),setTimeout(a,0)},t=t.substring("after".length)),n.utils.registerEventHandler(e,t,r)});var l=function(){var i=n.utils.unwrapObservable(t()),s=n.selectExtensions.readValue(e);if(u!==null&&i===u){setTimeout(l,0);return}var o=i!==s;if(o)if(n.utils.tagNameLower(e)==="select"){var a=r.get("valueAllowUnset"),f=function(){n.selectExtensions.writeValue(e,i,a)};f(),!a&&i!==n.selectExtensions.readValue(e)?n.dependencyDetection.ignore(n.utils.triggerEvent,null,[e,"change"]):setTimeout(f,0)}else n.selectExtensions.writeValue(e,i)};n.computed(l,null,{disposeWhenNodeIsRemoved:e})},update:function(){}},n.expressionRewriting.twoWayBindings.value=!0,n.bindingHandlers.visible={update:function(e,t){var r=n.utils.unwrapObservable(t()),i=e.style.display!="none";r&&!i?e.style.display="":!r&&i&&(e.style.display="none")}},v("click"),n.templateEngine=function(){},n.templateEngine.prototype.renderTemplateSource=function(e,t,n){throw new Error("Override renderTemplateSource")},n.templateEngine.prototype.createJavaScriptEvaluatorBlock=function(e){throw new Error("Override createJavaScriptEvaluatorBlock")},n.templateEngine.prototype.makeTemplateSource=function(e,t){if(typeof e=="string"){t=t||document;var r=t.getElementById(e);if(!r)throw new Error("Cannot find template with ID "+e);return new n.templateSources.domElement(r)}if(e.nodeType==1||e.nodeType==8)return new n.templateSources.anonymousTemplate(e);throw new Error("Unknown template type: "+e)},n.templateEngine.prototype.renderTemplate=function(e,t,n,r){var i=this.makeTemplateSource(e,r);return this.renderTemplateSource(i,t,n)},n.templateEngine.prototype.isTemplateRewritten=function(e,t){return this.allowTemplateRewriting===!1?!0:this.makeTemplateSource(e,t).data("isRewritten")},n.templateEngine.prototype.rewriteTemplate=function(e,t,n){var r=this.makeTemplateSource(e,n),i=t(r.text());r.text(i),r.data("isRewritten",!0)},n.exportSymbol("templateEngine",n.templateEngine),n.templateRewriting=function(){function r(e){var t=n.expressionRewriting.bindingRewriteValidators;for(var r=0;r<e.length;r++){var i=e[r].key;if(t.hasOwnProperty(i)){var s=t[i];if(typeof s=="function"){var o=s(e[r].value);if(o)throw new Error(o)}else if(!s)throw new Error("This template engine does not support the '"+i+"' binding within its templates")}}}function i(e,t,i,s){var o=n.expressionRewriting.parseObjectLiteral(e);r(o);var u=n.expressionRewriting.preProcessBindings(o,{valueAccessors:!0}),a="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+u+" } })()},'"+i.toLowerCase()+"')";return s.createJavaScriptEvaluatorBlock(a)+t}var e=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,t=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;return{ensureTemplateIsRewritten:function(e,t,r){t.isTemplateRewritten(e,r)||t.rewriteTemplate(e,function(e){return n.templateRewriting.memoizeBindingAttributeSyntax(e,t)},r)},memoizeBindingAttributeSyntax:function(n,r){return n.replace(e,function(){return i(arguments[4],arguments[1],arguments[2],r)}).replace(t,function(){return i(arguments[1],"<!-- ko -->","#comment",r)})},applyMemoizedBindingsToNextSibling:function(e,t){return n.memoization.memoize(function(r,i){var s=r.nextSibling;s&&s.nodeName.toLowerCase()===t&&n.applyBindingAccessorsToNode(s,e,i)})}}}(),n.exportSymbol("__tr_ambtns",n.templateRewriting.applyMemoizedBindingsToNextSibling),function(){n.templateSources={},n.templateSources.domElement=function(e){this.domElement=e},n.templateSources.domElement.prototype.text=function(){var e=n.utils.tagNameLower(this.domElement),t=e==="script"?"text":e==="textarea"?"value":"innerHTML";if(arguments.length==0)return this.domElement[t];var r=arguments[0];t==="innerHTML"?n.utils.setHtml(this.domElement,r):this.domElement[t]=r};var e=n.utils.domData.nextKey()+"_";n.templateSources.domElement.prototype.data=function(t){if(arguments.length===1)return n.utils.domData.get(this.domElement,e+t);n.utils.domData.set(this.domElement,e+t,arguments[1])};var t=n.utils.domData.nextKey();n.templateSources.anonymousTemplate=function(e){this.domElement=e},n.templateSources.anonymousTemplate.prototype=new n.templateSources.domElement,n.templateSources.anonymousTemplate.prototype.constructor=n.templateSources.anonymousTemplate,n.templateSources.anonymousTemplate.prototype.text=function(){if(arguments.length==0){var e=n.utils.domData.get(this.domElement,t)||{};return e.textData===undefined&&e.containerData&&(e.textData=e.containerData.innerHTML),e.textData}var r=arguments[0];n.utils.domData.set(this.domElement,t,{textData:r})},n.templateSources.domElement.prototype.nodes=function(){if(arguments.length==0){var e=n.utils.domData.get(this.domElement,t)||{};return e.containerData}var r=arguments[0];n.utils.domData.set(this.domElement,t,{containerData:r})},n.exportSymbol("templateSources",n.templateSources),n.exportSymbol("templateSources.domElement",n.templateSources.domElement),n.exportSymbol("templateSources.anonymousTemplate",n.templateSources.anonymousTemplate)}(),function(){function t(e,t,r){var i,s=e,o=n.virtualElements.nextSibling(t);while(s&&(i=s)!==o)s=n.virtualElements.nextSibling(i),r(i,s)}function r(e,r){if(e.length){var i=e[0],s=e[e.length-1],o=i.parentNode,u=n.bindingProvider.instance,a=u.preprocessNode;if(a){t(i,s,function(e,t){var n=e.previousSibling,r=a.call(u,e);r&&(e===i&&(i=r[0]||t),e===s&&(s=r[r.length-1]||n))}),e.length=0;if(!i)return;i===s?e.push(i):(e.push(i,s),n.utils.fixUpContinuousNodeArray(e,o))}t(i,s,function(e){(e.nodeType===1||e.nodeType===8)&&n.applyBindings(r,e)}),t(i,s,function(e){(e.nodeType===1||e.nodeType===8)&&n.memoization.unmemoizeDomNodeAndDescendants(e,[r])}),n.utils.fixUpContinuousNodeArray(e,o)}}function i(e){return e.nodeType?e:e.length>0?e[0]:null}function s(t,s,o,u,a){a=a||{};var f=t&&i(t),l=f&&f.ownerDocument,c=a.templateEngine||e;n.templateRewriting.ensureTemplateIsRewritten(o,c,l);var h=c.renderTemplate(o,u,a,l);if(typeof h.length!="number"||h.length>0&&typeof h[0].nodeType!="number")throw new Error("Template engine must return an array of DOM nodes");var p=!1;switch(s){case"replaceChildren":n.virtualElements.setDomNodeChildren(t,h),p=!0;break;case"replaceNode":n.utils.replaceDomNodes(t,h),p=!0;break;case"ignoreTargetNode":break;default:throw new Error("Unknown renderMode: "+s)}return p&&(r(h,u),a.afterRender&&n.dependencyDetection.ignore(a.afterRender,null,[h,u.$data])),h}function o(e,t,r){return n.isObservable(e)?e():typeof e=="function"?e(t,r):e}function a(e,t){var r=n.utils.domData.get(e,u);r&&typeof r.dispose=="function"&&r.dispose(),n.utils.domData.set(e,u,t&&t.isActive()?t:undefined)}var e;n.setTemplateEngine=function(t){if(!(t==undefined||t instanceof n.templateEngine))throw new Error("templateEngine must inherit from ko.templateEngine");e=t},n.renderTemplate=function(t,r,u,a,f){u=u||{};if((u["templateEngine"]||e)==undefined)throw new Error("Set a template engine before calling renderTemplate");f=f||"replaceChildren";if(a){var l=i(a),c=function(){return!l||!n.utils.domNodeIsAttachedToDocument(l)},h=l&&f=="replaceNode"?l.parentNode:l;return n.dependentObservable(function(){var e=r&&r instanceof n.bindingContext?r:new n.bindingContext(n.utils.unwrapObservable(r)),c=o(t,e.$data,e),h=s(a,f,c,e,u);f=="replaceNode"&&(a=h,l=i(a))},null,{disposeWhen:c,disposeWhenNodeIsRemoved:h})}return n.memoization.memoize(function(e){n.renderTemplate(t,r,u,e,"replaceNode")})},n.renderTemplateForEach=function(e,t,i,u,a){var f,l=function(t,n){f=a.createChildContext(t,i.as,function(e){e.$index=n});var r=o(e,t,f);return s(null,"ignoreTargetNode",r,f,i)},c=function(e,t,n){r(t,f),i.afterRender&&i.afterRender(t,e)};return n.dependentObservable(function(){var e=n.utils.unwrapObservable(t)||[];typeof e.length=="undefined"&&(e=[e]);var r=n.utils.arrayFilter(e,function(e){return i.includeDestroyed||e===undefined||e===null||!n.utils.unwrapObservable(e._destroy)});n.dependencyDetection.ignore(n.utils.setDomNodeChildrenFromArrayMapping,null,[u,r,l,i,c])},null,{disposeWhenNodeIsRemoved:u})};var u=n.utils.domData.nextKey();n.bindingHandlers.template={init:function(e,t){var r=n.utils.unwrapObservable(t());if(typeof r=="string"||r.name)n.virtualElements.emptyNode(e);else{var i=n.virtualElements.childNodes(e),s=n.utils.moveCleanedNodesToContainerElement(i);(new n.templateSources.anonymousTemplate(e)).nodes(s)}return{controlsDescendantBindings:!0}},update:function(e,t,r,i,s){var o=t(),u,f=n.utils.unwrapObservable(o),l=!0,c=null,h;typeof f=="string"?(h=o,f={}):(h=f.name,"if"in f&&(l=n.utils.unwrapObservable(f["if"])),l&&"ifnot"in f&&(l=!n.utils.unwrapObservable(f.ifnot)),u=n.utils.unwrapObservable(f.data));if("foreach"in f){var p=l&&f.foreach||[];c=n.renderTemplateForEach(h||e,p,f,e,s)}else if(!l)n.virtualElements.emptyNode(e);else{var d="data"in f?s.createChildContext(u,f.as):s;c=n.renderTemplate(h||e,d,f,e)}a(e,c)}},n.expressionRewriting.bindingRewriteValidators.template=function(e){var t=n.expressionRewriting.parseObjectLiteral(e);return t.length==1&&t[0].unknown?null:n.expressionRewriting.keyValueArrayContainsKey(t,"name")?null:"This template engine does not support anonymous templates nested within its templates"},n.virtualElements.allowedBindings.template=!0}(),n.exportSymbol("setTemplateEngine",n.setTemplateEngine),n.exportSymbol("renderTemplate",n.renderTemplate),n.utils.findMovesInArrayComparison=function(e,t,n){if(e.length&&t.length){var r,i,s,o,u;for(r=i=0;(!n||r<n)&&(o=e[i]);++i){for(s=0;u=t[s];++s)if(o.value===u.value){o.moved=u.index,u.moved=o.index,t.splice(s,1),r=s=0;break}r+=s}}},n.utils.compareArrays=function(){function r(n,r,s){return s=typeof s=="boolean"?{dontLimitMoves:s}:s||{},n=n||[],r=r||[],n.length<=r.length?i(n,r,e,t,s):i(r,n,t,e,s)}function i(e,t,r,i,s){var o=Math.min,u=Math.max,a=[],f,l=e.length,c,h=t.length,p=h-l||1,d=l+h+1,v,m,g,y;for(f=0;f<=l;f++){m=v,a.push(v=[]),g=o(h,f+p),y=u(0,f-1);for(c=y;c<=g;c++)if(!c)v[c]=f+1;else if(!f)v[c]=c+1;else if(e[f-1]===t[c-1])v[c]=m[c-1];else{var b=m[c]||d,w=v[c-1]||d;v[c]=o(b,w)+1}}var E=[],S,x=[],T=[];for(f=l,c=h;f||c;)S=a[f][c]-1,c&&S===a[f][c-1]?x.push(E[E.length]={status:r,value:t[--c],index:c}):f&&S===a[f-1][c]?T.push(E[E.length]={status:i,value:e[--f],index:f}):(--c,--f,s.sparse||E.push({status:"retained",value:t[c]}));return n.utils.findMovesInArrayComparison(x,T,l*10),E.reverse()}var e="added",t="deleted";return r}(),n.exportSymbol("utils.compareArrays",n.utils.compareArrays),function(){function e(e,t,r,i,s){var o=[],u=n.dependentObservable(function(){var u=t(r,s,n.utils.fixUpContinuousNodeArray(o,e))||[];o.length>0&&(n.utils.replaceDomNodes(o,u),i&&n.dependencyDetection.ignore(i,null,[r,u,s])),o.length=0,n.utils.arrayPushAll(o,u)},null,{disposeWhenNodeIsRemoved:e,disposeWhen:function(){return!n.utils.anyDomNodeIsAttachedToDocument(o)}});return{mappedNodes:o,dependentObservable:u.isActive()?u:undefined}}var t=n.utils.domData.nextKey();n.utils.setDomNodeChildrenFromArrayMapping=function(r,i,s,o,u){function E(e,t){w=f[t],d!==t&&(y[e]=w),w.indexObservable(d++),n.utils.fixUpContinuousNodeArray(w.mappedNodes,r),h.push(w),m.push(w)}function S(e,t){if(e)for(var r=0,i=t.length;r<i;r++)t[r]&&n.utils.arrayForEach(t[r].mappedNodes,function(n){e(n,r,t[r].arrayEntry)})}i=i||[],o=o||{};var a=n.utils.domData.get(r,t)===undefined,f=n.utils.domData.get(r,t)||[],l=n.utils.arrayMap(f,function(e){return e.arrayEntry}),c=n.utils.compareArrays(l,i,o.dontLimitMoves),h=[],p=0,d=0,v=[],m=[],g=[],y=[],b=[],w;for(var x=0,T,N;T=c[x];x++){N=T.moved;switch(T.status){case"deleted":N===undefined&&(w=f[p],w.dependentObservable&&w.dependentObservable.dispose(),v.push.apply(v,n.utils.fixUpContinuousNodeArray(w.mappedNodes,r)),o.beforeRemove&&(g[x]=w,m.push(w))),p++;break;case"retained":E(x,p++);break;case"added":N!==undefined?E(x,N):(w={arrayEntry:T.value,indexObservable:n.observable(d++)},h.push(w),m.push(w),a||(b[x]=w))}}S(o.beforeMove,y),n.utils.arrayForEach(v,o.beforeRemove?n.cleanNode:n.removeNode);for(var x=0,C=n.virtualElements.firstChild(r),k,L;w=m[x];x++){w.mappedNodes||n.utils.extend(w,e(r,s,w.arrayEntry,u,w.indexObservable));for(var A=0;L=w.mappedNodes[A];C=L.nextSibling,k=L,A++)L!==C&&n.virtualElements.insertAfter(r,L,k);!w.initialized&&u&&(u(w.arrayEntry,w.mappedNodes,w.indexObservable),w.initialized=!0)}S(o.beforeRemove,g),S(o.afterMove,y),S(o.afterAdd,b),n.utils.domData.set(r,t,h)}}(),n.exportSymbol("utils.setDomNodeChildrenFromArrayMapping",n.utils.setDomNodeChildrenFromArrayMapping),n.nativeTemplateEngine=function(){this.allowTemplateRewriting=!1},n.nativeTemplateEngine.prototype=new n.templateEngine,n.nativeTemplateEngine.prototype.constructor=n.nativeTemplateEngine,n.nativeTemplateEngine.prototype.renderTemplateSource=function(e,t,r){var i=!(n.utils.ieVersion<9),s=i?e.nodes:null,o=s?e.nodes():null;if(o)return n.utils.makeArray(o.cloneNode(!0).childNodes);var u=e.text();return n.utils.parseHtmlFragment(u)},n.nativeTemplateEngine.instance=new n.nativeTemplateEngine,n.setTemplateEngine(n.nativeTemplateEngine.instance),n.exportSymbol("nativeTemplateEngine",n.nativeTemplateEngine),function(){n.jqueryTmplTemplateEngine=function(){function t(){if(e<2)throw new Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.")}function n(e,t,n){return jQueryInstance.tmpl(e,t,n)}var e=this.jQueryTmplVersion=function(){if(!jQueryInstance||!jQueryInstance.tmpl)return 0;try{if(jQueryInstance.tmpl.tag.tmpl.open.toString().indexOf("__")>=0)return 2}catch(e){}return 1}();this.renderTemplateSource=function(e,r,i){i=i||{},t();var s=e.data("precompiled");if(!s){var o=e.text()||"";o="{{ko_with $item.koBindingContext}}"+o+"{{/ko_with}}",s=jQueryInstance.template(null,o),e.data("precompiled",s)}var u=[r.$data],a=jQueryInstance.extend({koBindingContext:r},i.templateOptions),f=n(s,u,a);return f.appendTo(document.createElement("div")),jQueryInstance.fragments={},f},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){document.write("<script type='text/html' id='"+e+"'>"+t+"<"+"/script>")},e>0&&(jQueryInstance.tmpl.tag.ko_code={open:"__.push($1 || '');"},jQueryInstance.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},n.jqueryTmplTemplateEngine.prototype=new n.templateEngine,n.jqueryTmplTemplateEngine.prototype.constructor=n.jqueryTmplTemplateEngine;var e=new n.jqueryTmplTemplateEngine;e.jQueryTmplVersion>0&&n.setTemplateEngine(e),n.exportSymbol("jqueryTmplTemplateEngine",n.jqueryTmplTemplateEngine)}()})})()}(),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.6.0";var T=x.each=x.forEach=function(e,t,r){if(e==null)return e;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else{var o=x.keys(e);for(var i=0,s=o.length;i<s;i++)if(t.call(r,e[o[i]],o[i],e)===n)return}return e};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,x.negate(t),n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,x.property(t))},x.where=function(e,t){return x.filter(e,x.matches(t))},x.findWhere=function(e,t){return x.find(e,x.matches(t))},x.max=function(e,t,n){var r=-Infinity,i=-Infinity,s,o;if(!t&&x.isArray(e))for(var u=0,a=e.length;u<a;u++)s=e[u],s>r&&(r=s);else T(e,function(e,s,u){o=t?t.call(n,e,s,u):e,o>i&&(r=e,i=o)});return r},x.min=function(e,t,n){var r=Infinity,i=Infinity,s,o;if(!t&&x.isArray(e))for(var u=0,a=e.length;u<a;u++)s=e[u],s<r&&(r=s);else T(e,function(e,s,u){o=t?t.call(n,e,s,u):e,o<i&&(r=e,i=o)});return r},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r},x.sample=function(e,t,n){return t==null||n?(e.length!==+e.length&&(e=x.values(e)),e[x.random(e.length-1)]):x.shuffle(e).slice(0,Math.max(0,t))};var k=function(e){return e==null?x.identity:x.isFunction(e)?e:x.property(e)};x.sortBy=function(e,t,n){return t=k(t),x.pluck(x.map(e,function(e,r,i){return{value:e,index:r,criteria:t.call(n,e,r,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,n,r){var i={};return n=k(n),T(t,function(s,o){var u=n.call(r,s,o,t);e(i,u,s)}),i}};x.groupBy=L(function(e,t,n){x.has(e,t)?e[t].push(n):e[t]=[n]}),x.indexBy=L(function(e,t,n){e[t]=n}),x.countBy=L(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,r){n=k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:t<0?[]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n,r){if(t&&x.every(e,x.isArray))return a.apply(r,e);for(var i=0,s=e.length;i<s;i++){var u=e[i];!x.isArray(u)&&!x.isArguments(u)?n||r.push(u):t?o.apply(r,u):A(u,t,n,r)}return r};x.flatten=function(e,t){return A(e,t,!1,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.partition=function(e,t,n){t=k(t);var r=[],i=[];return T(e,function(e){(t.call(n,e)?r:i).push(e)}),[r,i]},x.uniq=x.unique=function(e,t,n,r){if(e==null)return[];x.isFunction(t)&&(r=n,n=t,t=!1);var i=[],s=[];for(var o=0,u=e.length;o<u;o++){var a=e[o];n&&(a=n.call(r,a,o,e));if(t?!o||s!==a:!x.contains(s,a))t?s=a:s.push(a),i.push(e[o])}return i},x.union=function(){return x.uniq(A(arguments,!0,!0,[]))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.contains(t,e)})})},x.difference=function(e){var t=A(u.call(arguments,1),!0,!0,[]);return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){var n=0,r=t.slice();for(var i=0,s=r.length;i<s;i++)r[i]===x&&(r[i]=arguments[n++]);while(n<arguments.length)r.push(arguments[n++]);return e.apply(this,r)}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:x.now(),o=null,s=e.apply(r,i),r=i=null};return function(){var f=x.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(clearTimeout(o),o=null,u=f,s=e.apply(r,i),r=i=null):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=x.now()-o;f<t&&f>0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),s=i=null))};return function(){s=this,i=arguments,o=x.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return x.partial(t,e)},x.negate=function(e){return function(){return!e.apply(this,arguments)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},x.keys=function(e){if(!x.isObject(e))return[];if(E)return E(e);var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},x.pairs=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},x.invert=function(e){var t={},n=x.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e,t,n){var i={};if(x.isFunction(t))for(var s in e){var o=e[s];t.call(n,o,s,e)&&(i[s]=o)}else{var f=a.apply(r,u.call(arguments,1));for(var l=0,c=f.length;l<c;l++){var s=f[l];s in e&&(i[s]=e[s])}}return i},x.omit=function(e,t,n){var i;return x.isFunction(t)?t=x.negate(t):(i=a.apply(r,u.call(arguments,1)),t=function(e,t){return!x.contains(i,t)}),x.pick(e,t,n)},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var a=0,l=!0;if(i=="[object Array]"){a=e.length,l=a==t.length;if(l)while(a--)if(!(l=M(e[a],t[a],n,r)))break}else{for(var c in e)if(x.has(e,c)){a++;if(!(l=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.constant=function(e){return function(){return e}},x.noop=function(){},x.property=function(e){return function(t){return t[e]}},x.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},x.now=Date.now||function(){return(new Date).getTime()};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\"+B[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),typeof define=="function"&&define.amd&&define("underscore",[],function(){return x})}.call(this),function(e,t){function n(t,n){var i,s,o,u=t.nodeName.toLowerCase();return"area"===u?(i=t.parentNode,s=i.name,t.href&&s&&"map"===i.nodeName.toLowerCase()?(o=e("img[usemap=#"+s+"]")[0],!!o&&r(o)):!1):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&r(t)}function r(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var i=0,s=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return"number"==typeof n?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var r,i,s=e(this[0]);s.length&&s[0]!==document;){if(r=s.css("position"),("absolute"===r||"relative"===r||"fixed"===r)&&(i=parseInt(s.css("zIndex"),10),!isNaN(i)&&0!==i))return i;s=s.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++i)})},removeUniqueId:function(){return this.each(function(){s.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var r=e.attr(t,"tabindex"),i=isNaN(r);return(i||r>=0)&&n(t,!i)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function i(t,n,r,i){return e.each(s,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),i&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var s="Width"===r?["Left","Right"]:["Top","Bottom"],o=r.toLowerCase(),u={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?u["inner"+r].call(this):this.each(function(){e(this).css(o,i(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return"number"!=typeof t?u["outer"+r].call(this,t):this.each(function(){e(this).css(o,i(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(i&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(r=0;i.length>r;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var r=n&&"left"===n?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})}(jQuery),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n,r=0;null!=(n=t[r]);r++)try{e(n).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(n,r,i){var s,o,u,a,f={},l=n.split(".")[0];n=n.split(".")[1],s=l+"-"+n,i||(i=r,r=e.Widget),e.expr[":"][s.toLowerCase()]=function(t){return!!e.data(t,s)},e[l]=e[l]||{},o=e[l][n],u=e[l][n]=function(e,n){return this._createWidget?(arguments.length&&this._createWidget(e,n),t):new u(e,n)},e.extend(u,o,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new r,a.options=e.widget.extend({},a.options),e.each(i,function(n,i){return e.isFunction(i)?(f[n]=function(){var e=function(){return r.prototype[n].apply(this,arguments)},t=function(e){return r.prototype[n].apply(this,e)};return function(){var n,r=this._super,s=this._superApply;return this._super=e,this._superApply=t,n=i.apply(this,arguments),this._super=r,this._superApply=s,n}}(),t):(f[n]=i,t)}),u.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix:n},f,{constructor:u,namespace:l,widgetName:n,widgetFullName:s}),o?(e.each(o._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,u,n._proto)}),delete o._childConstructors):r._childConstructors.push(u),e.widget.bridge(n,u)},e.widget.extend=function(n){for(var i,o,u=r.call(arguments,1),a=0,f=u.length;f>a;a++)for(i in u[a])o=u[a][i],u[a].hasOwnProperty(i)&&o!==t&&(n[i]=e.isPlainObject(o)?e.isPlainObject(n[i])?e.widget.extend({},n[i],o):e.widget.extend({},o):o);return n},e.widget.bridge=function(n,i){var o=i.prototype.widgetFullName||n;e.fn[n]=function(u){var f="string"==typeof u,l=r.call(arguments,1),c=this;return u=!f&&l.length?e.widget.extend.apply(null,[u].concat(l)):u,f?this.each(function(){var r,i=e.data(this,o);return i?e.isFunction(i[u])&&"_"!==u.charAt(0)?(r=i[u].apply(i,l),r!==i&&r!==t?(c=r&&r.jquery?c.pushStack(r.get()):r,!1):t):e.error("no such method '"+u+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+u+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(u||{})._init():e.data(this,o,new i(u,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i,s,o,u=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(u={},i=n.split("."),n=i.shift(),i.length){for(s=u[n]=e.widget.extend({},this.options[n]),o=0;i.length-1>o;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];if(n=i.pop(),r===t)return s[n]===t?null:s[n];s[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];u[n]=r}return this._setOptions(u),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(n,r,i){var s,o=this;"boolean"!=typeof n&&(i=r,r=n,n=!1),i?(r=s=e(r),this.bindings=this.bindings.add(r)):(i=r,r=this.element,s=this.widget()),e.each(i,function(i,u){function f(){return n||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof u?o[u]:u).apply(o,arguments):t}"string"!=typeof u&&(f.guid=u.guid=u.guid||f.guid||e.guid++);var l=i.match(/^(\w+)\s*(.*)$/),c=l[1]+o.eventNamespace,h=l[2];h?s.delegate(h,c,f):r.bind(c,f)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];if(r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){"string"==typeof i&&(i={effect:i});var o,u=i?i===!0||"number"==typeof i?n:i.effect||n:t;i=i||{},"number"==typeof i&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(jQuery),function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.0",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.document.mouseup(function(e){n=!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(this.document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(this.document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(this.document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseInt(e[0],10)*(p.test(e[0])?t/100:1),parseInt(e[1],10)*(p.test(e[1])?n/100:1)]}function r(t,n){return parseInt(e.css(t,n),10)||0}function i(t){var n=t[0];return n.nodeType===9?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var s,o=Math.max,u=Math.abs,a=Math.round,f=/left|center|right/,l=/top|center|bottom/,c=/[\+\-]\d+%?/,h=/^\w+/,p=/%$/,d=e.fn.position;e.position={scrollbarWidth:function(){if(s!==t)return s;var n,r,i=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=i.children()[0];return e("body").append(i),n=o.offsetWidth,i.css("overflow","scroll"),r=o.offsetWidth,n===r&&(r=i[0].clientWidth),i.remove(),s=n-r},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),r=t.isWindow?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:i?e.position.scrollbarWidth():0,height:s?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]);return{element:n,isWindow:r,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return d.apply(this,arguments);t=e.extend({},t);var s,p,v,m,g,y,b=e(t.of),w=e.position.getWithinInfo(t.within),E=e.position.getScrollInfo(w),S=(t.collision||"flip").split(" "),x={};return y=i(b),b[0].preventDefault&&(t.at="left top"),p=y.width,v=y.height,m=y.offset,g=e.extend({},m),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=f.test(e[0])?e.concat(["center"]):l.test(e[0])?["center"].concat(e):["center","center"]),e[0]=f.test(e[0])?e[0]:"center",e[1]=l.test(e[1])?e[1]:"center",n=c.exec(e[0]),r=c.exec(e[1]),x[this]=[n?n[0]:0,r?r[0]:0],t[this]=[h.exec(e[0])[0],h.exec(e[1])[0]]}),S.length===1&&(S[1]=S[0]),t.at[0]==="right"?g.left+=p:t.at[0]==="center"&&(g.left+=p/2),t.at[1]==="bottom"?g.top+=v:t.at[1]==="center"&&(g.top+=v/2),s=n(x.at,p,v),g.left+=s[0],g.top+=s[1],this.each(function(){var i,f,l=e(this),c=l.outerWidth(),h=l.outerHeight(),d=r(this,"marginLeft"),y=r(this,"marginTop"),T=c+d+r(this,"marginRight")+E.width,N=h+y+r(this,"marginBottom")+E.height,C=e.extend({},g),k=n(x.my,l.outerWidth(),l.outerHeight());t.my[0]==="right"?C.left-=c:t.my[0]==="center"&&(C.left-=c/2),t.my[1]==="bottom"?C.top-=h:t.my[1]==="center"&&(C.top-=h/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=a(C.left),C.top=a(C.top)),i={marginLeft:d,marginTop:y},e.each(["left","top"],function(n,r){e.ui.position[S[n]]&&e.ui.position[S[n]][r](C,{targetWidth:p,targetHeight:v,elemWidth:c,elemHeight:h,collisionPosition:i,collisionWidth:T,collisionHeight:N,offset:[s[0]+k[0],s[1]+k[1]],my:t.my,at:t.at,within:w,elem:l})}),t.using&&(f=function(e){var n=m.left-C.left,r=n+p-c,i=m.top-C.top,s=i+v-h,a={target:{element:b,left:m.left,top:m.top,width:p,height:v},element:{element:l,left:C.left,top:C.top,width:c,height:h},horizontal:r<0?"left":n>0?"right":"center",vertical:s<0?"top":i>0?"bottom":"middle"};p<c&&u(n+r)<p&&(a.horizontal="center"),v<h&&u(i+s)<v&&(a.vertical="middle"),o(u(n),u(r))>o(u(i),u(s))?a.important="horizontal":a.important="vertical",t.using.call(this,e,a)}),l.offset(e.extend(C,{using:f}))})},e.ui.position={fit:{left:function(e,t){var n=t.within,r=n.isWindow?n.scrollLeft:n.offset.left,i=n.width,s=e.left-t.collisionPosition.marginLeft,u=r-s,a=s+t.collisionWidth-i-r,f;t.collisionWidth>i?u>0&&a<=0?(f=e.left+u+t.collisionWidth-i-r,e.left+=u-f):a>0&&u<=0?e.left=r:u>a?e.left=r+i-t.collisionWidth:e.left=r:u>0?e.left+=u:a>0?e.left-=a:e.left=o(e.left-s,e.left)},top:function(e,t){var n=t.within,r=n.isWindow?n.scrollTop:n.offset.top,i=t.within.height,s=e.top-t.collisionPosition.marginTop,u=r-s,a=s+t.collisionHeight-i-r,f;t.collisionHeight>i?u>0&&a<=0?(f=e.top+u+t.collisionHeight-i-r,e.top+=u-f):a>0&&u<=0?e.top=r:u>a?e.top=r+i-t.collisionHeight:e.top=r:u>0?e.top+=u:a>0?e.top-=a:e.top=o(e.top-s,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,i=n.width,s=n.isWindow?n.scrollLeft:n.offset.left,o=e.left-t.collisionPosition.marginLeft,a=o-s,f=o+t.collisionWidth-i-s,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-i-r;if(p<0||p<u(a))e.left+=l+c+h}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-s;if(d>0||u(d)<f)e.left+=l+c+h}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,i=n.height,s=n.isWindow?n.scrollTop:n.offset.top,o=e.top-t.collisionPosition.marginTop,a=o-s,f=o+t.collisionHeight-i-s,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-i-r,e.top+c+h+p>a&&(v<0||v<u(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-s,e.top+c+h+p>f&&(d>0||u(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t)}()}(jQuery),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!=="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!=="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n,r=this,i=!1,s=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(s=e.ui.ddmanager.drop(this,t)),this.dropped&&(s=this.dropped,this.dropped=!1),n=this.element[0];while(n&&(n=n.parentNode))n===this.document.get(0)&&(i=!0);return!i&&this.options.helper==="original"?!1:(this.options.revert==="invalid"&&!s||this.options.revert==="valid"&&s||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){r._trigger("stop",t)!==!1&&r._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper==="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo==="parent"?this.element[0].parentNode:n.appendTo),r[0]!==this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;i.containment==="parent"&&(i.containment=this.helper[0].parentNode);if(i.containment==="document"||i.containment==="window")this.containment=[i.containment==="document"?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,i.containment==="document"?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,(i.containment==="document"?0:e(window).scrollLeft())+e(i.containment==="document"?document:window).width()-this.helperProportions.width-this.margins.left,(i.containment==="document"?0:e(window).scrollTop())+(e(i.containment==="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(i.containment)&&i.containment.constructor!==Array){n=e(i.containment),r=n[0];if(!r)return;t=e(r).css("overflow")!=="hidden",this.containment=[(parseInt(e(r).css("borderLeftWidth"),10)||0)+(parseInt(e(r).css("paddingLeft"),10)||0),(parseInt(e(r).css("borderTopWidth"),10)||0)+(parseInt(e(r).css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(e(r).css("borderRightWidth"),10)||0)-(parseInt(e(r).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(e(r).css("borderBottomWidth"),10)||0)-(parseInt(e(r).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}else i.containment.constructor===Array&&(this.containment=i.containment)},_convertPositionTo:function(t,n){n||(n=this.position);var r=t==="absolute"?1:-1,i=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i,s,o=this.options,u=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName),f=t.pageX,l=t.pageY;return this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),n=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(f=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(l=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(f=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(l=n[3]+this.offset.click.top)),o.grid&&(i=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=n?i-this.offset.click.top>=n[1]||i-this.offset.click.top>n[3]?i:i-this.offset.click.top>=n[1]?i-o.grid[1]:i+o.grid[1]:i,s=o.grid[0]?this.originalPageX+Math.round((f-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,f=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t==="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("ui-draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("ui-draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper==="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("ui-draggable"),i=this;e.each(r.sortables,function(){var s=!1,o=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(s=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(o.instance.element[0],this.instance.element[0])&&(s=!1),s})),s?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&t.scrollParent[0].tagName!=="HTML"&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),r=n.options,i=!1;if(n.scrollParent[0]!==document&&n.scrollParent[0].tagName!=="HTML"){if(!r.axis||r.axis!=="x")n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed);if(!r.axis||r.axis!=="y")n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed)}else{if(!r.axis||r.axis!=="x")t.pageY-e(document).scrollTop()<r.scrollSensitivity?i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed));if(!r.axis||r.axis!=="y")t.pageX-e(document).scrollLeft()<r.scrollSensitivity?i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed))}i!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){var r,i,s,o,u,a,f,l,c,h,p=e(this).data("ui-draggable"),d=p.options,v=d.snapTolerance,m=n.offset.left,g=m+p.helperProportions.width,y=n.offset.top,b=y+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--){u=p.snapElements[c].left,a=u+p.snapElements[c].width,f=p.snapElements[c].top,l=f+p.snapElements[c].height;if(!(u-v<m&&m<a+v&&f-v<y&&y<l+v||u-v<m&&m<a+v&&f-v<b&&b<l+v||u-v<g&&g<a+v&&f-v<y&&y<l+v||u-v<g&&g<a+v&&f-v<b&&b<l+v)){p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1;continue}d.snapMode!=="inner"&&(r=Math.abs(f-b)<=v,i=Math.abs(l-y)<=v,s=Math.abs(u-g)<=v,o=Math.abs(a-m)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f-p.helperProportions.height,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u-p.helperProportions.width}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left)),h=r||i||s||o,d.snapMode!=="outer"&&(r=Math.abs(f-y)<=v,i=Math.abs(l-b)<=v,s=Math.abs(u-m)<=v,o=Math.abs(a-g)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(r||i||s||o||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=r||i||s||o||h}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,r=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!r.length)return;t=parseInt(e(r[0]).css("zIndex"),10)||0,e(r).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+r.length)}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),function(e,t){function n(e,t,n){return e>t&&e<t+n}e.widget("ui.droppable",{version:"1.10.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t=this.options,n=t.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(n)?n:function(e){return e.is(n)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){var t=0,n=e.ui.ddmanager.droppables[this.options.scope];for(;t<n.length;t++)n[t]===this&&n.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,n){t==="accept"&&(this.accept=e.isFunction(n)?n:function(e){return e.is(n)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]===this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;if(!n||(n.currentItem||n.element)[0]===this.element[0])return;this.accept.call(this.element[0],n.currentItem||n.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(n)))},_drop:function(t,n){var r=n||e.ui.ddmanager.current,i=!1;return!r||(r.currentItem||r.element)[0]===this.element[0]?!1:(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var n=e.data(this,"ui-droppable");if(n.options.greedy&&!n.options.disabled&&n.options.scope===r.options.scope&&n.accept.call(n.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(n,{offset:n.element.offset()}),n.options.tolerance,t))return i=!0,!1}),i?!1:this.accept.call(this.element[0],r.currentItem||r.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element):!1)},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,t,r,i){if(!t.offset)return!1;var s,o,u=(e.positionAbs||e.position.absolute).left,a=u+e.helperProportions.width,f=(e.positionAbs||e.position.absolute).top,l=f+e.helperProportions.height,c=t.offset.left,h=c+t.proportions.width,p=t.offset.top,d=p+t.proportions.height;switch(r){case"fit":return c<=u&&a<=h&&p<=f&&l<=d;case"intersect":return c<u+e.helperProportions.width/2&&a-e.helperProportions.width/2<h&&p<f+e.helperProportions.height/2&&l-e.helperProportions.height/2<d;case"pointer":return s=i.pageX,o=i.pageY,n(o,p,t.proportions.height)&&n(s,c,t.proportions.width);case"touch":return(f>=p&&f<=d||l>=p&&l<=d||f<p&&l>d)&&(u>=c&&u<=h||a>=c&&a<=h||u<c&&a>h);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,n){var r,i,s=e.ui.ddmanager.droppables[t.options.scope]||[],o=n?n.type:null,u=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;r<s.length;r++){if(s[r].options.disabled||t&&!s[r].accept.call(s[r].element[0],t.currentItem||t.element))continue;for(i=0;i<u.length;i++)if(u[i]===s[r].element[0]){s[r].proportions.height=0;continue e}s[r].visible=s[r].element.css("display")!=="none";if(!s[r].visible)continue;o==="mousedown"&&s[r]._activate.call(s[r],n),s[r].offset=s[r].element.offset(),s[r].proportions={width:s[r].element[0].offsetWidth,height:s[r].element[0].offsetHeight}}},drop:function(t,n){var r=!1;return e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options)return;!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,n)&&(r=this._drop.call(this,n)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,n))}),r},dragStart:function(t,n){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(t,n){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,n),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(this.options.disabled||this.greedyChild||!this.visible)return;var r,i,s,o=e.ui.intersect(t,this,this.options.tolerance,n),u=!o&&this.isover?"isout":o&&!this.isover?"isover":null;if(!u)return;this.options.greedy&&(i=this.options.scope,s=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===i}),s.length&&(r=e.data(s[0],"ui-droppable"),r.greedyChild=u==="isover")),r&&u==="isover"&&(r.isover=!1,r.isout=!0,r._out.call(r,n)),this[u]=!0,this[u==="isout"?"isover":"isout"]=!1,this[u==="isover"?"_over":"_out"].call(this,n),r&&u==="isout"&&(r.isout=!1,r.isover=!0,r._over.call(r,n))})},dragStop:function(t,n){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}}}(jQuery),function(e,t){function n(e){return parseInt(e,10)||0}function r(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.0",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,r,i,s,o=this,u=this.options;this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!u.aspectRatio,aspectRatio:u.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:u.helper||u.ghost||u.animate?u.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=u.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor===String){this.handles==="all"&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={};for(n=0;n<t.length;n++)r=e.trim(t[n]),s="ui-resizable-"+r,i=e("<div class='ui-resizable-handle "+s+"'></div>"),i.css({zIndex:u.zIndex}),"se"===r&&i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(i)}this._renderAxis=function(t){var n,r,i,s;t=t||this.element;for(n in this.handles){this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),i=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(i,s),this._proportionallyResize());if(!e(this.handles[n]).length)continue}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=i&&i[1]?i[1]:"se")}),u.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(u.disabled)return;e(this).removeClass("ui-resizable-autohide"),o._handles.show()}).mouseleave(function(){if(u.disabled)return;o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,r,i=!1;for(n in this.handles){r=e(this.handles[n])[0];if(r===t.target||e.contains(r,t.target))i=!0}return!this.options.disabled&&i},_mouseStart:function(t){var r,i,s,o=this.options,u=this.element.position(),a=this.element;return this.resizing=!0,/absolute/.test(a.css("position"))?a.css({position:"absolute",top:a.css("top"),left:a.css("left")}):a.is(".ui-draggable")&&a.css({position:"absolute",top:u.top,left:u.left}),this._renderProxy(),r=n(this.helper.css("left")),i=n(this.helper.css("top")),o.containment&&(r+=e(o.containment).scrollLeft()||0,i+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:i},this.size=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:r,top:i},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof o.aspectRatio=="number"?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor",s==="auto"?this.axis+"-resize":s),a.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var n,r=this.helper,i={},s=this.originalMousePosition,o=this.axis,u=this.position.top,a=this.position.left,f=this.size.width,l=this.size.height,c=t.pageX-s.left||0,h=t.pageY-s.top||0,p=this._change[o];if(!p)return!1;n=p.apply(this,[t,c,h]),this._updateVirtualBoundaries(t.shiftKey);if(this._aspectRatio||t.shiftKey)n=this._updateRatio(n,t);return n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==u&&(i.top=this.position.top+"px"),this.position.left!==a&&(i.left=this.position.left+"px"),this.size.width!==f&&(i.width=this.size.width+"px"),this.size.height!==l&&(i.height=this.size.height+"px"),r.css(i),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||this._trigger("resize",t,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var n,r,i,s,o,u,a,f=this.options,l=this;return this._helper&&(n=this._proportionallyResizeElements,r=n.length&&/textarea/i.test(n[0].nodeName),i=r&&e.ui.hasScroll(n[0],"left")?0:l.sizeDiff.height,s=r?0:l.sizeDiff.width,o={width:l.helper.width()-s,height:l.helper.height()-i},u=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null,a=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null,f.animate||this.element.css(e.extend(o,{top:a,left:u})),l.helper.height(l.size.height),l.helper.width(l.size.width),this._helper&&!f.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,i,s,o,u=this.options;o={minWidth:r(u.minWidth)?u.minWidth:0,maxWidth:r(u.maxWidth)?u.maxWidth:Infinity,minHeight:r(u.minHeight)?u.minHeight:0,maxHeight:r(u.maxHeight)?u.maxHeight:Infinity};if(this._aspectRatio||e)t=o.minHeight*this.aspectRatio,i=o.minWidth/this.aspectRatio,n=o.maxHeight*this.aspectRatio,s=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),i>o.minHeight&&(o.minHeight=i),n<o.maxWidth&&(o.maxWidth=n),s<o.maxHeight&&(o.maxHeight=s);this._vBoundaries=o},_updateCache:function(e){this.offset=this.helper.offset(),r(e.left)&&(this.position.left=e.left),r(e.top)&&(this.position.top=e.top),r(e.height)&&(this.size.height=e.height),r(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,i=this.axis;return r(e.height)?e.width=e.height*this.aspectRatio:r(e.width)&&(e.height=e.width/this.aspectRatio),i==="sw"&&(e.left=t.left+(n.width-e.width),e.top=null),i==="nw"&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,i=r(e.width)&&t.maxWidth&&t.maxWidth<e.width,s=r(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=r(e.width)&&t.minWidth&&t.minWidth>e.width,u=r(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,f=this.position.top+this.size.height,l=/sw|nw|w/.test(n),c=/nw|ne|n/.test(n);return o&&(e.width=t.minWidth),u&&(e.height=t.minHeight),i&&(e.width=t.maxWidth),s&&(e.height=t.maxHeight),o&&l&&(e.left=a-t.minWidth),i&&l&&(e.left=a-t.maxWidth),u&&c&&(e.top=f-t.minHeight),s&&c&&(e.top=f-t.maxHeight),!e.width&&!e.height&&!e.left&&e.top?e.top=null:!e.width&&!e.height&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){if(!this._proportionallyResizeElements.length)return;var e,t,n,r,i,s=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){i=this._proportionallyResizeElements[e];if(!this.borderDif){this.borderDif=[],n=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],r=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")];for(t=0;t<n.length;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(r[t],10)||0)}i.css({height:s.height()-this.borderDif[0]-this.borderDif[2]||0,width:s.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:n.width-t}},n:function(e,t,n){var r=this.originalSize,i=this.originalPosition;return{top:i.top+n,height:r.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),t!=="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height,u=s?0:n.sizeDiff.width,a={width:n.size.width-u,height:n.size.height-o},f=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,l=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(a,l&&f?{top:l,left:f}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height}),n._updateCache(r),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,r,i,s,o,u,a,f=e(this).data("ui-resizable"),l=f.options,c=f.element,h=l.containment,p=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;if(!p)return;f.containerElement=e(p),/document/.test(h)||h===document?(f.containerOffset={left:0,top:0},f.containerPosition={left:0,top:0},f.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(p),r=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){r[e]=n(t.css("padding"+i))}),f.containerOffset=t.offset(),f.containerPosition=t.position(),f.containerSize={height:t.innerHeight()-r[3],width:t.innerWidth()-r[1]},i=f.containerOffset,s=f.containerSize.height,o=f.containerSize.width,u=e.ui.hasScroll(p,"left")?p.scrollWidth:o,a=e.ui.hasScroll(p)?p.scrollHeight:s,f.parentData={element:p,left:i.left,top:i.top,width:u,height:a})},resize:function(t){var n,r,i,s,o=e(this).data("ui-resizable"),u=o.options,a=o.containerOffset,f=o.position,l=o._aspectRatio||t.shiftKey,c={top:0,left:0},h=o.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(c=a),f.left<(o._helper?a.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-a.left:o.position.left-c.left),l&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=u.helper?a.left:0),f.top<(o._helper?a.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-a.top:o.position.top),l&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?a.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,n=Math.abs((o._helper?o.offset.left-c.left:o.offset.left-c.left)+o.sizeDiff.width),r=Math.abs((o._helper?o.offset.top-c.top:o.offset.top-a.top)+o.sizeDiff.height),i=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),i&&s&&(n-=o.parentData.left),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,l&&(o.size.height=o.size.width/o.aspectRatio)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,l&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width,f=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};typeof n.alsoResize=="object"&&!n.alsoResize.parentNode?n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):e.each(n.alsoResize,function(e){r(e)}):r(n.alsoResize)},resize:function(t,n){var r=e(this).data("ui-resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)}),t.css(s)})};typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?e.each(i.alsoResize,function(e,t){a(e,t)}):a(i.alsoResize)},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof n.ghost=="string"?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis,u=typeof n.grid=="number"?[n.grid,n.grid]:n.grid,a=u[0]||1,f=u[1]||1,l=Math.round((r.width-i.width)/a)*a,c=Math.round((r.height-i.height)/f)*f,h=i.width+l,p=i.height+c,d=n.maxWidth&&n.maxWidth<h,v=n.maxHeight&&n.maxHeight<p,m=n.minWidth&&n.minWidth>h,g=n.minHeight&&n.minHeight>p;n.grid=u,m&&(h+=a),g&&(p+=f),d&&(h-=a),v&&(p-=f),/^(se|s|e)$/.test(o)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.top=s.top-c):/^(sw)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.left=s.left-l):(t.size.width=h,t.size.height=p,t.position.top=s.top-c,t.position.left=s.left-l)}})}(jQuery),function(e){function t(e,t,n){return e>t&&t+n>e}function n(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.2",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||n(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,n){"disabled"===t?(this.options[t]=n,this.widget().toggleClass("ui-sortable-disabled",!!n)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,n){var r=null,i=!1,s=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,s.widgetName+"-item")===s?(r=e(this),!1):undefined}),e.data(t.target,s.widgetName+"-item")===s&&(r=e(t.target)),r?!this.options.handle||n||(e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(i=!0)}),i)?(this.currentItem=r,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,n,r){var i,s,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(s=this.document.find("body"),this.storedCursor=s.css("cursor"),s.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(s)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,r,i,s,o=this.options,u=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=u=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=u=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?u=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(u=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?u=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(u=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),u!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(r=this.items[n],i=r.item[0],s=this._intersectsWithPointer(r),s&&r.instance===this.currentContainer&&i!==this.currentItem[0]&&this.placeholder[1===s?"next":"prev"]()[0]!==i&&!e.contains(this.placeholder[0],i)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],i):!0)){if(this.direction=1===s?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,i=this.placeholder.offset(),s=this.options.axis,o={};s&&"x"!==s||(o.left=i.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),s&&"y"!==s||(o.top=i.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&r.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},n.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,r=this.positionAbs.top,i=r+this.helperProportions.height,s=e.left,o=s+e.width,u=e.top,a=u+e.height,f=this.offset.click.top,l=this.offset.click.left,c=r+f>u&&a>r+f&&t+l>s&&o>t+l;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?c:t+this.helperProportions.width/2>s&&o>n-this.helperProportions.width/2&&r+this.helperProportions.height/2>u&&a>i-this.helperProportions.height/2},_intersectsWithPointer:function(e){var n="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),r="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),i=n&&r,s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return i?this.floating?o&&"right"===o||"down"===s?2:1:s&&("down"===s?2:1):!1},_intersectsWithSides:function(e){var n=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),r=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return this.floating&&s?"right"===s&&r||"left"===s&&!r:i&&("down"===i&&n||"up"===i&&!n)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var n,r,i,s,o=[],u=[],a=this._connectWith();if(a&&t)for(n=a.length-1;n>=0;n--)for(i=e(a[n]),r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&u.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(u.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),n=u.length-1;n>=0;n--)u[n][0].each(function(){o.push(this)});return e(o)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;t.length>n;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,r,i,s,o,u,a,f,l=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--)for(i=e(h[n]),r=i.length-1;r>=0;r--)s=e.data(i[r],this.widgetFullName),s&&s!==this&&!s.options.disabled&&(c.push([e.isFunction(s.options.items)?s.options.items.call(s.element[0],t,{item:this.currentItem}):e(s.options.items,s.element),s]),this.containers.push(s));for(n=c.length-1;n>=0;n--)for(o=c[n][1],u=c[n][0],r=0,f=u.length;f>r;r++)a=e(u[r]),a.data(this.widgetName+"-item",o),l.push({item:a,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,r,i,s;for(n=this.items.length-1;n>=0;n--)r=this.items[n],r.instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(i=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=i.outerWidth(),r.height=i.outerHeight()),s=i.offset(),r.left=s.left,r.top=s.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)s=this.containers[n].element.offset(),this.containers[n].containerCache.left=s.left,this.containers[n].containerCache.top=s.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,r=t.options;r.placeholder&&r.placeholder.constructor!==String||(n=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),s=e(t.document[0].createElement(r)).addClass(n||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===r?s.append("<td colspan='99'>&#160;</td>"):"img"===r&&s.attr("src",t.currentItem.attr("src")),n||s.css("visibility","hidden"),s},update:function(e,o){(!n||r.forcePlaceholderSize)&&(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_contactContainers:function(r){var s,o,u,a,f,l,c,h,p,d,v=null,m=null;for(s=this.containers.length-1;s>=0;s--)if(!e.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(v&&e.contains(this.containers[s].element[0],v.element[0]))continue;v=this.containers[s],m=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",r,this._uiHash(this)),this.containers[s].containerCache.over=0);if(v)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",r,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(u=1e4,a=null,d=v.floating||n(this.currentItem),f=d?"left":"top",l=d?"width":"height",c=this.positionAbs[f]+this.offset.click[f],o=this.items.length-1;o>=0;o--)e.contains(this.containers[m].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!d||t(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(h=this.items[o].item.offset()[f],p=!1,Math.abs(h-c)>Math.abs(h+this.items[o][l]-c)&&(p=!0,h+=this.items[o][l]),u>Math.abs(h-c)&&(u=Math.abs(h-c),a=this.items[o],this.direction=p?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(r,a,null,!0):this._rearrange(r,null,this.containers[m].element,!0),this._trigger("change",r,this._uiHash()),this.containers[m]._trigger("change",r,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",r,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||n.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||n.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;"parent"===i.containment&&(i.containment=this.helper[0].parentNode),("document"===i.containment||"window"===i.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===i.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===i.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(i.containment)||(t=e(i.containment)[0],n=e(i.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var r="absolute"===t?1:-1,i="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(i[0].tagName);return{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():s?0:i.scrollTop())*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():s?0:i.scrollLeft())*r}},_generatePosition:function(t){var n,r,i=this.options,s=t.pageX,o=t.pageY,u="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(u[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(s=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(s=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),i.grid&&(n=this.originalPageY+Math.round((o-this.originalPageY)/i.grid[1])*i.grid[1],o=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-i.grid[1]:n+i.grid[1]:n,r=this.originalPageX+Math.round((s-this.originalPageX)/i.grid[0])*i.grid[0],s=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-i.grid[0]:r+i.grid[0]:r)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:u.scrollTop()),left:s-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:u.scrollLeft())}},_rearrange:function(e,t,n,r){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var i=this.counter;this._delay(function(){i===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){this.reverting=!1;var n,r=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(n in this._storedCSS)("auto"===this._storedCSS[n]||"static"===this._storedCSS[n])&&(this._storedCSS[n]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&r.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||r.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(r.push(function(e){this._trigger("remove",e,this._uiHash())}),r.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),r.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),n=this.containers.length-1;n>=0;n--)t||r.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over&&(r.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[n])),this.containers[n].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),n=0;r.length>n;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(n=0;r.length>n;n++)r[n].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}(jQuery),function(e,t){function n(){return++i}function r(e){return e.hash.length>1&&decodeURIComponent(e.href.replace(s,""))===decodeURIComponent(location.href.replace(s,""))}var i=0,s=/#.*$/;e.widget("ui.tabs",{version:"1.10.2",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,n=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",n.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),n.active=this._initialActive(),e.isArray(n.disabled)&&(n.disabled=e.unique(n.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(n.active):e(),this._refresh(),this.active.length&&this.load(n.active)},_initialActive:function(){var n=this.options.active,r=this.options.collapsible,i=location.hash.substring(1);return null===n&&(i&&this.tabs.each(function(r,s){return e(s).attr("aria-controls")===i?(n=r,!1):t}),null===n&&(n=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===n||-1===n)&&(n=this.tabs.length?0:!1)),n!==!1&&(n=this.tabs.index(this.tabs.eq(n)),-1===n&&(n=r?!1:0)),!r&&n===!1&&this.anchors.length&&(n=0),n},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(n){var r=e(this.document[0].activeElement).closest("li"),i=this.tabs.index(r),s=!0;if(!this._handlePageNav(n)){switch(n.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:i++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:s=!1,i--;break;case e.ui.keyCode.END:i=this.anchors.length-1;break;case e.ui.keyCode.HOME:i=0;break;case e.ui.keyCode.SPACE:return n.preventDefault(),clearTimeout(this.activating),this._activate(i),t;case e.ui.keyCode.ENTER:return n.preventDefault(),clearTimeout(this.activating),this._activate(i===this.options.active?!1:i),t;default:return}n.preventDefault(),clearTimeout(this.activating),i=this._focusNextTab(i,s),n.ctrlKey||(r.attr("aria-selected","false"),this.tabs.eq(i).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",i)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(n){return n.altKey&&n.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):n.altKey&&n.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):t},_findNextTab:function(t,n){function r(){return t>i&&(t=0),0>t&&(t=i),t}for(var i=this.tabs.length-1;-1!==e.inArray(r(),this.options.disabled);)t=n?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,n){return"active"===e?(this._activate(n),t):"disabled"===e?(this._setupDisabled(n),t):(this._super(e,n),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",n),n||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(n),"heightStyle"===e&&this._setupHeightStyle(n),t)},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+n()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,n=this.tablist.children(":has(a[href])");t.disabled=e.map(n.filter(".ui-state-disabled"),function(e){return n.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(n,i){var s,o,u,a=e(i).uniqueId().attr("id"),f=e(i).closest("li"),l=f.attr("aria-controls");r(i)?(s=i.hash,o=t.element.find(t._sanitizeSelector(s))):(u=t._tabId(f),s="#"+u,o=t.element.find(s),o.length||(o=t._createPanel(u),o.insertAfter(t.panels[n-1]||t.tablist)),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),l&&f.data("ui-tabs-aria-controls",l),f.attr({"aria-controls":s.substring(1),"aria-labelledby":a}),o.attr("aria-labelledby",a)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var n,r=0;n=this.tabs[r];r++)t===!0||-1!==e.inArray(r,t)?e(n).addClass("ui-state-disabled").attr("aria-disabled","true"):e(n).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var n={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,n),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var n,r=this.element.parent();"fill"===t?(n=r.height(),n-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),r=t.css("position");"absolute"!==r&&"fixed"!==r&&(n-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){n-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(n=0,this.panels.each(function(){n=Math.max(n,e(this).height("").height())}).height(n))},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i.closest("li"),o=s[0]===r[0],u=o&&n.collapsible,a=u?e():this._getPanelForTab(s),f=r.length?this._getPanelForTab(r):e(),l={oldTab:r,oldPanel:f,newTab:u?e():s,newPanel:a};t.preventDefault(),s.hasClass("ui-state-disabled")||s.hasClass("ui-tabs-loading")||this.running||o&&!n.collapsible||this._trigger("beforeActivate",t,l)===!1||(n.active=u?!1:this.tabs.index(s),this.active=o?e():s,this.xhr&&this.xhr.abort(),f.length||a.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),a.length&&this.load(this.tabs.index(s),t),this._toggle(t,l))},_toggle:function(t,n){function r(){s.running=!1,s._trigger("activate",t,n)}function i(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),o.length&&s.options.show?s._show(o,s.options.show,r):(o.show(),r())}var s=this,o=n.newPanel,u=n.oldPanel;this.running=!0,u.length&&this.options.hide?this._hide(u,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),i()}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),u.hide(),i()),u.attr({"aria-expanded":"false","aria-hidden":"true"}),n.oldTab.attr("aria-selected","false"),o.length&&u.length?n.oldTab.attr("tabIndex",-1):o.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),o.attr({"aria-expanded":"true","aria-hidden":"false"}),n.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var n,r=this._findActive(t);r[0]!==this.active[0]&&(r.length||(r=this.active),n=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),n=t.data("ui-tabs-aria-controls");n?t.attr("aria-controls",n).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(n){var r=this.options.disabled;r!==!1&&(n===t?r=!1:(n=this._getIndex(n),r=e.isArray(r)?e.map(r,function(e){return e!==n?e:null}):e.map(this.tabs,function(e,t){return t!==n?t:null})),this._setupDisabled(r))},disable:function(n){var r=this.options.disabled;if(r!==!0){if(n===t)r=!0;else{if(n=this._getIndex(n),-1!==e.inArray(n,r))return;r=e.isArray(r)?e.merge([n],r).sort():[n]}this._setupDisabled(r)}},load:function(t,n){t=this._getIndex(t);var i=this,s=this.tabs.eq(t),o=s.find(".ui-tabs-anchor"),u=this._getPanelForTab(s),a={tab:s,panel:u};r(o[0])||(this.xhr=e.ajax(this._ajaxSettings(o,n,a)),this.xhr&&"canceled"!==this.xhr.statusText&&(s.addClass("ui-tabs-loading"),u.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){u.html(e),i._trigger("load",n,a)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&i.panels.stop(!1,!0),s.removeClass("ui-tabs-loading"),u.removeAttr("aria-busy"),e===i.xhr&&delete i.xhr},1)})))},_ajaxSettings:function(t,n,r){var i=this;return{url:t.attr("href"),beforeSend:function(t,s){return i._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:s},r))}}},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}})}(jQuery),function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.0",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){var t,n,r=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this.range=e([]),r.range&&(r.range===!0&&(r.values?r.values.length&&r.values.length!==2?r.values=[r.values[0],r.values[0]]:e.isArray(r.values)&&(r.values=r.values.slice(0)):r.values=[this._valueMin(),this._valueMin()]),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(r.range==="min"||r.range==="max"?" ui-slider-range-"+r.range:""))),n=r.values&&r.values.length||1;for(t=i.length;t<n;t++)o.push(s);this.handles=i.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).mouseenter(function(){r.disabled||e(this).addClass("ui-state-hover")}).mouseleave(function(){e(this).removeClass("ui-state-hover")}).focus(function(){r.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)}),this._setOption("disabled",r.disabled),this._on(this.handles,this._handleEvents),this._refreshValue(),this._animateOff=!1},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));if(i>n||i===n&&(t===l._lastChangedValue||l.values(t)===c.min))i=n,s=e(this),o=t}),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"disabled":n?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.prop("disabled",!0)):this.handles.prop("disabled",!1);break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))},_handleEvents:{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),define("jqueryUI",function(){}),define("modules/layout-selector",["jquery","knockout","underscore","jqueryUI"],function(e,t,n){showLayoutSelector=function(){return e("div#layout-selector-select").addClass("layout-selector-visible"),e("div#layout-selector").css({left:e("div#layout-selector-select-content").offset().left}),e(document).bind("mousedown",hideLayoutSelector),Headway.iframe.contents().bind("mousedown",hideLayoutSelector),e("div#layout-selector-select")},hideLayoutSelector=function(t){if(t&&(e(t.target).is("#layout-selector-select")||e(t.target).parents("#layout-selector-select").length===1))return;return e("div#layout-selector-select").removeClass("layout-selector-visible"),e(document).unbind("mousedown",hideLayoutSelector),Headway.iframe.contents().unbind("mousedown",hideLayoutSelector),e("div#layout-selector-select")},toggleLayoutSelector=function(){e("div#layout-selector-select").hasClass("layout-selector-visible")?hideLayoutSelector(!1):showLayoutSelector()},switchToLayout=function(n,r,i){var s,o,u,a,f;typeof n=="object"&&!n.hasClass("layout")?o=n.find("> span.layout"):o=n,typeof n=="string"&&(isNaN(n)||(n="template-"+n),o=e('div#layout-selector span.layout[data-layout-id="'+n+'"]'));if(typeof n!="string"&&o.length!==1)return!1;changeTitle("Visual Editor: Loading"),startTitleActivityIndicator(),o.length?(s=o,u=s.attr("data-layout-id"),a=Headway.mode=="grid"?Headway.homeURL:s.attr("data-layout-url"),f=s.find("strong").text()):(s=e(),u=n,a=Headway.homeURL,f=i),Headway.viewModels.layoutSelector.currentLayout(u),Headway.viewModels.layoutSelector.currentLayoutName(f),Headway.viewModels.layoutSelector.currentLayoutInUse(null),Headway.viewModels.layoutSelector.currentLayoutInUseName(null),Headway.switchedToLayout=!0,Headway.viewModels.layoutSelector.currentLayoutCustomized(s.parents("li.layout-item").first().hasClass("layout-item-customized")||s.parents("#layout-selector-templates-container").length),Headway.viewModels.layoutSelector.currentLayoutCustomized()?(Headway.viewModels.layoutSelector.currentLayoutInUse(u),Headway.viewModels.layoutSelector.currentLayoutInUseName(f)):(s.parents("li.layout-item").each(function(){var e=t.dataFor(this);if(e.customized())return Headway.viewModels.layoutSelector.currentLayoutInUse(e.id),Headway.viewModels.layoutSelector.currentLayoutInUseName(e.name),!1;if(e.template())return Headway.viewModels.layoutSelector.currentLayoutInUse(e.template()),Headway.viewModels.layoutSelector.currentLayoutInUseName(e.templateName()),!1}),Headway.viewModels.layoutSelector.currentLayoutInUse()||(e("ul#layout-selector-pages-content").children("li.layout-item").each(function(){var e=t.dataFor(this);if(e.customized())return Headway.viewModels.layoutSelector.currentLayoutInUse(e.id),Headway.viewModels.layoutSelector.currentLayoutInUseName(e.name),!1;if(e.template())return Headway.viewModels.layoutSelector.currentLayoutInUse(e.template()),Headway.viewModels.layoutSelector.currentLayoutInUseName(e.templateName()),!1}),Headway.viewModels.layoutSelector.currentLayoutInUse()||(Headway.viewModels.layoutSelector.currentLayoutInUse(u),Headway.viewModels.layoutSelector.currentLayoutInUseName(f))));var l=s.find(".status-template").data("template-id");typeof l!="undefined"&&l!="none"?(Headway.viewModels.layoutSelector.currentLayoutTemplate(l),Headway.viewModels.layoutSelector.currentLayoutTemplateName(e('span.layout[data-layout-id="template-'+l+'"]').find(".template-name").text())):Headway.viewModels.layoutSelector.currentLayoutTemplate(!1),window.history.pushState("","",Headway.homeURL+"/?visual-editor=true&visual-editor-mode="+Headway.mode+"&ve-layout="+encodeURIComponent(Headway.viewModels.layoutSelector.currentLayout()));if(typeof r=="undefined"||r==1)headwayIframeLoadNotification="Switched to <em>"+Headway.viewModels.layoutSelector.currentLayoutName()+"</em>";return loadIframe(Headway.instance.iframeCallback,a),!0},unassignSharedLayout=function(n,r,i){var s;if(typeof r!="undefined"&&r.length)s=t.dataFor(r.get(0)),i=r.find("> span.layout strong").text();else{var r=e('span.layout[data-layout-id="'+n+'"]');r.length&&(s=t.dataFor(r.get(0)))}if(!confirm("Are you sure you want to remove the shared layout from "+i+"?"))return!1;e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"remove_template_from_layout",layout:n},function(e){return typeof e=="undefined"||e=="failure"?(showErrorNotification({id:"error-could-not-remove-template-from-layout",message:"Error: Could not remove shared layout from layout."}),!1):(s&&(s.template(!1),s.templateName(!1)),n==Headway.viewModels.layoutSelector.currentLayout()?(showIframeLoadingOverlay(),changeTitle("Visual Editor: Removing Shared Layout From Layout"),startTitleActivityIndicator(),Headway.viewModels.layoutSelector.currentLayoutTemplate(!1),headwayIframeLoadNotification="Shared Layout removed from layout successfully!",loadIframe(Headway.instance.iframeCallback),!0):(showNotification({id:"shared-layout-removed-from-layout",message:"Shared Layout removed from layout successfully!"}),!0))})};var r={init:function(){r.setupViewModel(),r.bind()},setupViewModel:function(){Headway.viewModels.layoutSelector={currentLayout:t.observable(Headway.currentLayout),currentLayoutName:t.observable(Headway.currentLayoutName),currentLayoutInUse:t.observable(Headway.currentLayoutInUse),currentLayoutInUseName:t.observable(Headway.currentLayoutInUseName),currentLayoutTemplate:t.observable(Headway.currentLayoutTemplate),currentLayoutTemplateName:t.observable(Headway.currentLayoutTemplateName),currentLayoutCustomized:t.observable(Headway.currentLayoutCustomized),pages:r.mapArrayToLayoutModel(Headway.layouts.pages),search:t.observableArray([]),searching:t.observable(!1),shared:r.mapArrayToLayoutModel(Headway.layouts.shared)},e(document).ready(function(){t.applyBindings(Headway.viewModels.layoutSelector,e("#layout-selector-pages-container").get(0)),t.applyBindings(Headway.viewModels.layoutSelector,e("#layout-selector-templates-container").get(0))})},layoutModel:function(e){return this.id=e.id,this.name=e.name,this.url=e.url,this.template=t.observable(e.template),this.templateName=t.observable(e.templateName),this.customized=t.observable(e.customized),this.postStatus=t.observable(e.postStatus),this.ajaxChildren=t.observable(e.ajaxChildren),this.ajaxLoading=t.observable(!1),this.ajaxLoaded=t.observable(!1),this.ajaxShowMore=t.observable(!1),this.ajaxLoadOffset=t.observable(0),this.noEdit=t.observable(typeof e.noEdit!="undefined"?e.noEdit:!1),this.children=r.mapArrayToLayoutModel(e.children),this},mapArrayToLayoutModel:function(n){var i=[];return e.each(n,function(e,t){i.push(new r.layoutModel(t))}),t.observableArray(i)},loadLayouts:function(i,s,o,u){var u=u||!1;if(i.ajaxLoading())return!1;i.ajaxLoading(!0);var a=e('<li class="layout-item layout-loading-children"><span class="dashicons dashicons-update"></span> Loading...</li>');return a.insertAfter(o.parent()),e.ajax(Headway.ajaxURL,{type:"POST",async:!0,data:{action:"headway_visual_editor",method:"get_layout_children",security:Headway.security,layout:i.id,offset:i.ajaxLoadOffset,mode:Headway.mode},success:function(o,f){a.remove(),i.ajaxLoading(!1);if((!n.isArray(o)||!o.length)&&!u)return s.$data.ajaxChildren(!1),s.$data.children([]),e(self).removeClass("layout-open");n.isArray(s.$data.children())?e.each(t.utils.unwrapObservable(r.mapArrayToLayoutModel(o)),function(e,t){s.$data.children.push(t)}):s.$data.children(t.utils.unwrapObservable(r.mapArrayToLayoutModel(o))),s.$data.ajaxLoaded(!0),s.$data.ajaxLoadOffset(s.$data.ajaxLoadOffset()+o.length),o.length==30?s.$data.ajaxShowMore(!0):s.$data.ajaxShowMore(!1)}})},searchLayouts:function(i){return Headway.viewModels.layoutSelector.searching(!0),e.ajax(Headway.ajaxURL,{type:"POST",async:!0,data:{action:"headway_visual_editor",method:"query_layouts",security:Headway.security,query:i},success:function(e,i){Headway.viewModels.layoutSelector.searching(!1);if(!n.isArray(e)||!e.length)return;return Headway.viewModels.layoutSelector.search(t.utils.unwrapObservable(r.mapArrayToLayoutModel(e)))}})},bind:function(){var n=e("div#layout-selector");e("div#layout-selector-select-content").on("click",function(){return toggleLayoutSelector(),!1});var i=e("#layout-search-input-container form"),s=i.find("input#layout-search-input");s.on("search",function(e){i.trigger("submit")}),s.on("keyup",function(t){e(this).val().length===0&&i.trigger("submit")});var o=function(t){var n=e("#layout-search-input").val();if(n.length===0)return Headway.viewModels.layoutSelector.search([]),t.preventDefault(),!1;r.searchLayouts(n),t.preventDefault()};e("#layout-search-submit").on("click",o),i.on("submit",o),n.tabs(),n.delegate("span.edit","click",function(t){return typeof allowVECloseSwitch!="undefined"&&allowVECloseSwitch===!1&&!confirm("You have unsaved changes, are you sure you want to switch layouts?")?!1:(showIframeLoadingOverlay(),switchToLayout(e(this).parents("span.layout")),hideLayoutSelector(),t.preventDefault(),e(this).parents("span.layout"))}),n.delegate("span.revert","click",function(n){if(!confirm("Are you sure you wish to reset this layout?  All blocks and content will be removed from this layout.\n\nPlease note: Any block that is mirroring a block on this layout will also lose its settings."))return!1;var r=e(this).parents("span.layout"),i=r.attr("data-layout-id"),s=r.find("strong").text();showIframeLoadingOverlay(),changeTitle("Visual Editor: Reverting "+s),startTitleActivityIndicator(),r.parent().removeClass("layout-item-customized");var o=e(r.parents(".layout-item-customized:not(.layout-selected)")[0]),u=o.find("> span.layout").attr("data-layout-id"),a=e(e("div#layout-selector-pages > ul > li.layout-item-customized")[0]),f=a.find("> span.layout").attr("data-layout-id"),l=u?o:a,c=u?u:f;if(typeof c=="undefined"||!c)c=Headway.frontPage=="posts"?"index":"front_page",l=e('div#layout-selector-pages > ul > li > span[data-layout-id="'+c+'"]').parent();return switchToLayout(l,!1),e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"revert_layout",layout_to_revert:i},function(e){if(e==="success"){var n=t.dataFor(r.get(0));n.customized(!1),showNotification({id:"layout-reverted",message:"<em>"+s+"</em> successfully reverted!",success:!0})}else showErrorNotification({id:"error-could-not-revert-layout",message:"Error: Could not revert layout."})}),!1}),n.delegate("span#add-template","click",function(t){var n=e("#template-name-input").val();return e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"add_template",layout:Headway.viewModels.layoutSelector.currentLayout(),template_name:n},function(t){if(typeof t=="undefined"||!t)return showErrorNotification({id:"error-could-not-add-template",message:"Error: Could not add shared layout."}),!1;var n=e('<li class="layout-item">						<span data-layout-id="template-'+t.id+'" class="layout layout-template">							<strong class="template-name">'+t.name+'</strong>														<span class="delete-template" title="Delete Shared Layout">Delete</span>														<span class="status status-currently-editing">Currently Editing</span>																					<span class="rename-template button layout-selector-button" title="Rename Shared Layout">Rename</span>							<span class="assign-template button layout-selector-button">Use Layout</span>							<span class="edit button layout-selector-button">Edit</span>						</span>					</li>');n.appendTo("div#layout-selector-templates ul"),e("li#no-templates:visible","div#layout-selector").hide(),showNotification({id:"template-added",message:"Shared layout added!",success:!0}),e("#template-name-input").val("")},"json"),!1}),n.delegate("span.delete-template","click",function(t){var n=e(e(this).parents("li")[0]),r=e(this).parent(),i=r.attr("data-layout-id"),s=i.replace("template-",""),o=r.find("strong").text();return confirm("Are you sure you wish to delete this Shared Layout?")?(e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"delete_template",template_to_delete:s},function(t){if(typeof t=="undefined"||t=="failure"||t!="success")return showErrorNotification({id:"error-could-not-deleted-template",message:"Error: Could not delete shared layout."}),!1;n.remove(),e("span.layout-template","div#layout-selector").length===0&&e("li#no-templates","div#layout-selector").show(),showNotification({id:"template-deleted",message:"Shared Layout: <em>"+o+"</em> successfully deleted!",success:!0});if(i===Headway.viewModels.layoutSelector.currentLayout()){var r=Headway.frontPage=="posts"?"index":"front_page";switchToLayout(e('div#layout-selector span.layout[data-layout-id="'+r+'"]'),!1)}}),!1):!1}),n.delegate("span.assign-template","click",function(n){var r=e(e(this).parents("li")[0]),i=e(this).parent().attr("data-layout-id").replace("template-",""),s=t.dataFor(e("li.layout-selected").get(0));return Headway.viewModels.layoutSelector.currentLayout().indexOf("template-")===0?(alert("You cannot assign a shared layout to another shared layout."),!1):(e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"assign_template",template:i,layout:Headway.viewModels.layoutSelector.currentLayout()},function(t){if(typeof t=="undefined"||t=="failure")return showErrorNotification({id:"error-could-not-assign-template",message:"Error: Could not assign shared layout."}),!1;e("li.layout-selected","div#layout-selector").removeClass("layout-item-customized"),e("li.layout-selected","div#layout-selector").addClass("layout-item-template-used"),e("li.layout-selected > span.status-template","div#layout-selector").text(t),s.template(i),s.templateName(t),showIframeLoadingOverlay(),changeTitle("Visual Editor: Assigning Shared Layout"),startTitleActivityIndicator(),Headway.viewModels.layoutSelector.currentLayoutTemplate("template-"+i),Headway.viewModels.layoutSelector.currentLayoutTemplateName(e('span.layout[data-layout-id="template-'+i+'"]').find(".template-name").text()),headwayIframeLoadNotification="Shared layout assigned successfully!",loadIframe(Headway.instance.iframeCallback)}),!1)}),n.delegate("span.rename-template","click",function(t){var n=e(e(this).parents("li")[0]),r=e(this).parent().attr("data-layout-id"),i=e(this).siblings(".template-name"),s=i.text(),o=prompt("Please enter new Shared Layout name",s);return e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"rename_layout_template",layout:r,newName:o},function(e){return typeof e=="undefined"||e=="failure"?(showErrorNotification({id:"error-could-not-rename-layout-template",message:"Error: Could not rename shared layout."}),!1):(i.text(o),!0)}),!1}),n.delegate("span.remove-template","click",function(n){var r=e(e(this).parents("li")[0]),i=e(this).parent().attr("data-layout-id"),s=t.dataFor(r.get(0));return unassignSharedLayout(i,r)}),n.delegate("span.layout","click",function(n){var i=this,s=t.dataFor(this),o=t.contextFor(this);if(!e(this).parent().hasClass("has-children"))return;e(this).toggleClass("layout-open"),e(this).parent().hasClass("has-ajax-children")&&!o.$data.ajaxLoaded()&&r.loadLayouts(s,o,e(this))}),n.delegate("span.load-more-layouts","click",function(n){var i=this,s=t.dataFor(this),o=t.contextFor(this);e(i).text("Load More...").attr("disabled","disabled"),e.when(r.loadLayouts(s,o,e(this),!0)).done(function(){e(i).text("Load More...").attr("disabled","")})})}};return r}),jQuery.cookie=function(e,t,n){if(arguments.length>1&&String(t)!=="[object Object]"){n=jQuery.extend({},n);if(t===null||t===undefined)n.expires=-1;if(typeof n.expires=="number"){var r=n.expires,i=n.expires=new Date;i.setDate(i.getDate()+r)}return t=String(t),document.cookie=[encodeURIComponent(e),"=",n.raw?t:encodeURIComponent(t),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}n=t||{};var s,o=n.raw?function(e){return e}:decodeURIComponent;return(s=(new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)")).exec(document.cookie))?o(s[1]):null},define("deps/jquery.cookie",function(){}),function(e,t,n){(function(e){"use strict";typeof define=="function"&&define.amd?define("qtip",["jquery"],e):jQuery&&!jQuery.fn.qtip&&e(jQuery)})(function(r){"use strict";function I(e,t,n,i){this.id=n,this.target=e,this.tooltip=o,this.elements={target:e},this._id=T+"-"+n,this.timers={img:{}},this.options=t,this.plugins={},this.cache={event:{},target:r(),disabled:s,attr:i,onTooltip:s,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=s}function q(e){return e===o||r.type(e)!=="object"}function R(e){return!(r.isFunction(e)||e&&e.attr||e.length||r.type(e)==="object"&&(e.jquery||e.then))}function U(e){var t,n,u,a;return q(e)?s:(q(e.metadata)&&(e.metadata={type:e.metadata}),"content"in e&&(t=e.content,q(t)||t.jquery||t.done?t=e.content={text:n=R(t)?s:t}:n=t.text,"ajax"in t&&(u=t.ajax,a=u&&u.once!==s,delete t.ajax,t.text=function(e,t){var i=n||r(this).attr(t.options.content.attr)||"Loading...",s=r.ajax(r.extend({},u,{context:t})).then(u.success,o,u.error).then(function(e){return e&&a&&t.set("content.text",e),e},function(e,n,r){if(t.destroyed||e.status===0)return;t.set("content.text",n+": "+r)});return a?i:(t.set("content.text",i),s)}),"title"in t&&(q(t.title)||(t.button=t.title.button,t.title=t.title.text),R(t.title||s)&&(t.title=s))),"position"in e&&q(e.position)&&(e.position={my:e.position,at:e.position}),"show"in e&&q(e.show)&&(e.show=e.show.jquery?{target:e.show}:e.show===i?{ready:i}:{event:e.show}),"hide"in e&&q(e.hide)&&(e.hide=e.hide.jquery?{target:e.hide}:{event:e.hide}),"style"in e&&q(e.style)&&(e.style={classes:e.style}),r.each(x,function(){this.sanitize&&this.sanitize(e)}),e)}function z(e,t){var n=0,r,i=e,s=t.split(".");while(i=i[s[n++]])n<s.length&&(r=i);return[r||e,s.pop()]}function W(e,t){var n,r,i;for(n in this.checks)for(r in this.checks[n])if(i=(new RegExp(r,"i")).exec(e))t.push(i),(n==="builtin"||this.plugins[n])&&this.checks[n][r].apply(this.plugins[n]||this,t)}function J(e){return k.concat("").join(e?"-"+e+" ":" ")}function K(n){return n&&{type:n.type,pageX:n.pageX,pageY:n.pageY,target:n.target,relatedTarget:n.relatedTarget,scrollX:n.scrollX||e.pageXOffset||t.body.scrollLeft||t.documentElement.scrollLeft,scrollY:n.scrollY||e.pageYOffset||t.body.scrollTop||t.documentElement.scrollTop}||{}}function Q(e,t){if(t>0)return setTimeout(r.proxy(e,this),t);e.call(this)}function G(e){if(this.tooltip.hasClass(P))return s;clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=Q.call(this,function(){this.toggle(i,e)},this.options.show.delay)}function Y(e){if(this.tooltip.hasClass(P))return s;var t=r(e.relatedTarget),n=t.closest(L)[0]===this.tooltip[0],i=t[0]===this.options.show.target[0];clearTimeout(this.timers.show),clearTimeout(this.timers.hide);if(this!==t[0]&&this.options.position.target==="mouse"&&n||this.options.hide.fixed&&/mouse(out|leave|move)/.test(e.type)&&(n||i)){try{e.preventDefault(),e.stopImmediatePropagation()}catch(o){}return}this.timers.hide=Q.call(this,function(){this.toggle(s,e)},this.options.hide.delay,this)}function Z(e){if(this.tooltip.hasClass(P)||!this.options.hide.inactive)return s;clearTimeout(this.timers.inactive),this.timers.inactive=Q.call(this,function(){this.hide(e)},this.options.hide.inactive)}function et(e){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(e)}function nt(e,n,i){r(t.body).delegate(e,(n.split?n:n.join(tt+" "))+tt,function(){var e=b.api[r.attr(this,C)];e&&!e.disabled&&i.apply(e,arguments)})}function rt(e,n,u){var a,f,l,c,h,p=r(t.body),d=e[0]===t?p:e,v=e.metadata?e.metadata(u.metadata):o,m=u.metadata.type==="html5"&&v?v[u.metadata.name]:o,g=e.data(u.metadata.name||"qtipopts");try{g=typeof g=="string"?r.parseJSON(g):g}catch(y){}c=r.extend(i,{},b.defaults,u,typeof g=="object"?U(g):o,U(m||v)),f=c.position,c.id=n;if("boolean"==typeof c.content.text){l=e.attr(c.content.attr);if(c.content.attr===s||!l)return s;c.content.text=l}f.container.length||(f.container=p),f.target===s&&(f.target=d),c.show.target===s&&(c.show.target=d),c.show.solo===i&&(c.show.solo=f.container.closest("body")),c.hide.target===s&&(c.hide.target=d),c.position.viewport===i&&(c.position.viewport=f.container),f.container=f.container.eq(0),f.at=new E(f.at,i),f.my=new E(f.my);if(e.data(T))if(c.overwrite)e.qtip("destroy",!0);else if(c.overwrite===s)return s;return e.attr(N,n),c.suppress&&(h=e.attr("title"))&&e.removeAttr("title").attr(B,h).attr("title",""),a=new I(e,c,n,!!l),e.data(T,a),e.one("remove.qtip-"+n+" removeqtip.qtip-"+n,function(){var e;(e=r(this).data(T))&&e.destroy(!0)}),a}function dt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function gt(e,t){var r=t.charAt(0).toUpperCase()+t.slice(1),i=(t+" "+mt.join(r+" ")+r).split(" "),s,o,u=0;if(vt[t])return e.css(vt[t]);while(s=i[u++])if((o=e.css(s))!==n)return vt[t]=s,o}function yt(e,t){return Math.ceil(parseFloat(gt(e,t)))}function xt(e,t){this._ns="tip",this.options=t,this.offset=t.offset,this.size=[t.width,t.height],this.init(this.qtip=e)}var i=!0,s=!1,o=null,u="x",a="y",f="width",l="height",c="top",h="left",p="bottom",d="right",v="center",m="flip",g="flipinvert",y="shift",b,w,E,S,x={},T="qtip",N="data-hasqtip",C="data-qtip-id",k=["ui-widget","ui-tooltip"],L="."+T,A="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),O=T+"-fixed",M=T+"-default",_=T+"-focus",D=T+"-hover",P=T+"-disabled",H="_replacedByqTip",B="oldtitle",j,F={ie:function(){var e=3,n=t.createElement("div");while(n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")if(!n.getElementsByTagName("i")[0])break;return e>4?e:NaN}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||s};w=I.prototype,w._when=function(e){return r.when.apply(r,e)},w.render=function(e){if(this.rendered||this.destroyed)return this;var t=this,n=this.options,o=this.cache,u=this.elements,a=n.content.text,f=n.content.title,l=n.content.button,c=n.position,h="."+this._id+" ",p=[],d;return r.attr(this.target[0],"aria-describedby",this._id),this.tooltip=u.tooltip=d=r("<div/>",{id:this._id,"class":[T,M,n.style.classes,T+"-pos-"+n.position.my.abbrev()].join(" "),width:n.style.width||"",height:n.style.height||"",tracking:c.target==="mouse"&&c.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":s,"aria-describedby":this._id+"-content","aria-hidden":i}).toggleClass(P,this.disabled).attr(C,this.id).data(T,this).appendTo(c.container).append(u.content=r("<div />",{"class":T+"-content",id:this._id+"-content","aria-atomic":i})),this.rendered=-1,this.positioning=i,f&&(this._createTitle(),r.isFunction(f)||p.push(this._updateTitle(f,s))),l&&this._createButton(),r.isFunction(a)||p.push(this._updateContent(a,s)),this.rendered=i,this._setWidget(),r.each(x,function(e){var n;this.initialize==="render"&&(n=this(t))&&(t.plugins[e]=n)}),this._unassignEvents(),this._assignEvents(),this._when(p).then(function(){t._trigger("render"),t.positioning=s,!t.hiddenDuringWait&&(n.show.ready||e)&&t.toggle(i,o.event,s),t.hiddenDuringWait=s}),b.api[this.id]=this,this},w.destroy=function(e){function t(){if(this.destroyed)return;this.destroyed=i;var e=this.target,t=e.attr(B);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),r.each(this.plugins,function(e){this.destroy&&this.destroy()}),clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this._unassignEvents(),e.removeData(T).removeAttr(C).removeAttr(N).removeAttr("aria-describedby"),this.options.suppress&&t&&e.attr("title",t).removeAttr(B),this._unbind(e),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=o,delete b.api[this.id]}return this.destroyed?this.target:(e===i&&this.triggering!=="hide"||!this.rendered?t.call(this):(this.tooltip.one("tooltiphidden",r.proxy(t,this)),!this.triggering&&this.hide()),this.target)},S=w.checks={builtin:{"^id$":function(e,t,n,o){var u=n===i?b.nextid:n,a=T+"-"+u;u!==s&&u.length>0&&!r("#"+a).length?(this._id=a,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):e[t]=o},"^prerender":function(e,t,n){n&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(e,t,n){this._updateContent(n)},"^content.attr$":function(e,t,n,r){this.options.content.text===this.target.attr(r)&&this._updateContent(this.target.attr(n))},"^content.title$":function(e,t,n){if(!n)return this._removeTitle();n&&!this.elements.title&&this._createTitle(),this._updateTitle(n)},"^content.button$":function(e,t,n){this._updateButton(n)},"^content.title.(text|button)$":function(e,t,n){this.set("content."+t,n)},"^position.(my|at)$":function(e,t,n){"string"==typeof n&&(e[t]=new E(n,t==="at"))},"^position.container$":function(e,t,n){this.rendered&&this.tooltip.appendTo(n)},"^show.ready$":function(e,t,n){n&&(!this.rendered&&this.render(i)||this.toggle(i))},"^style.classes$":function(e,t,n,r){this.rendered&&this.tooltip.removeClass(r).addClass(n)},"^style.(width|height)":function(e,t,n){this.rendered&&this.tooltip.css(t,n)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(e,t,n){this.rendered&&this.tooltip.toggleClass(M,!!n)},"^events.(render|show|move|hide|focus|blur)$":function(e,t,n){this.rendered&&this.tooltip[(r.isFunction(n)?"":"un")+"bind"]("tooltip"+t,n)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(!this.rendered)return;var e=this.options.position;this.tooltip.attr("tracking",e.target==="mouse"&&e.adjust.mouse),this._unassignEvents(),this._assignEvents()}}},w.get=function(e){if(this.destroyed)return this;var t=z(this.options,e.toLowerCase()),n=t[0][t[1]];return n.precedance?n.string():n};var X=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,V=/^prerender|show\.ready/i;w.set=function(e,t){if(this.destroyed)return this;var n=this.rendered,u=s,a=this.options,f=this.checks,l;return"string"==typeof e?(l=e,e={},e[l]=t):e=r.extend({},e),r.each(e,function(t,i){if(n&&V.test(t)){delete e[t];return}var s=z(a,t.toLowerCase()),o;o=s[0][s[1]],s[0][s[1]]=i&&i.nodeType?r(i):i,u=X.test(t)||u,e[t]=[s[0],s[1],i,o]}),U(a),this.positioning=i,r.each(e,r.proxy(W,this)),this.positioning=s,this.rendered&&this.tooltip[0].offsetWidth>0&&u&&this.reposition(a.position.target==="mouse"?o:this.cache.event),this},w._update=function(e,t,n){var u=this,a=this.cache;return!this.rendered||!e?s:(r.isFunction(e)&&(e=e.call(this.elements.target,a.event,this)||""),r.isFunction(e.then)?(a.waiting=i,e.then(function(e){return a.waiting=s,u._update(e,t)},o,function(e){return u._update(e,t)})):e===s||!e&&e!==""?s:(e.jquery&&e.length>0?t.empty().append(e.css({display:"block",visibility:"visible"})):t.html(e),this._waitForContent(t).then(function(e){e.images&&e.images.length&&u.rendered&&u.tooltip[0].offsetWidth>0&&u.reposition(a.event,!e.length)})))},w._waitForContent=function(e){var t=this.cache;return t.waiting=i,(r.fn.imagesLoaded?e.imagesLoaded():r.Deferred().resolve([])).done(function(){t.waiting=s}).promise()},w._updateContent=function(e,t){this._update(e,this.elements.content,t)},w._updateTitle=function(e,t){this._update(e,this.elements.title,t)===s&&this._removeTitle(s)},w._createTitle=function(){var e=this.elements,t=this._id+"-title";e.titlebar&&this._removeTitle(),e.titlebar=r("<div />",{"class":T+"-titlebar "+(this.options.style.widget?J("header"):"")}).append(e.title=r("<div />",{id:t,"class":T+"-title","aria-atomic":i})).insertBefore(e.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(e){r(this).toggleClass("ui-state-active ui-state-focus",e.type.substr(-4)==="down")}).delegate(".qtip-close","mouseover mouseout",function(e){r(this).toggleClass("ui-state-hover",e.type==="mouseover")}),this.options.content.button&&this._createButton()},w._removeTitle=function(e){var t=this.elements;t.title&&(t.titlebar.remove(),t.titlebar=t.title=t.button=o,e!==s&&this.reposition())},w.reposition=function(n,o){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=i;var u=this.cache,a=this.tooltip,f=this.options.position,l=f.target,m=f.my,g=f.at,y=f.viewport,b=f.container,w=f.adjust,E=w.method.split(" "),S=a.outerWidth(s),T=a.outerHeight(s),N=0,C=0,k=a.css("position"),L={left:0,top:0},A=a[0].offsetWidth>0,O=n&&n.type==="scroll",M=r(e),_=b[0].ownerDocument,D=this.mouse,P,H;if(r.isArray(l)&&l.length===2)g={x:h,y:c},L={left:l[0],top:l[1]};else if(l==="mouse"){g={x:h,y:c};if(D&&D.pageX&&(w.mouse||!n||!n.pageX))n=D;else if(!n||!n.pageX)if((!w.mouse||this.options.show.distance)&&u.origin&&u.origin.pageX)n=u.origin;else if(!n||n&&(n.type==="resize"||n.type==="scroll"))n=u.event;k!=="static"&&(L=b.offset()),_.body.offsetWidth!==(e.innerWidth||_.documentElement.clientWidth)&&(H=r(t.body).offset()),L={left:n.pageX-L.left+(H&&H.left||0),top:n.pageY-L.top+(H&&H.top||0)},w.mouse&&O&&D&&(L.left-=(D.scrollX||0)-M.scrollLeft(),L.top-=(D.scrollY||0)-M.scrollTop())}else{l==="event"?n&&n.target&&n.type!=="scroll"&&n.type!=="resize"?u.target=r(n.target):n.target||(u.target=this.elements.target):l!=="event"&&(u.target=r(l.jquery?l:this.elements.target)),l=u.target,l=r(l).eq(0);if(l.length===0)return this;l[0]===t||l[0]===e?(N=F.iOS?e.innerWidth:l.width(),C=F.iOS?e.innerHeight:l.height(),l[0]===e&&(L={top:(y||l).scrollTop(),left:(y||l).scrollLeft()})):x.imagemap&&l.is("area")?P=x.imagemap(this,l,g,x.viewport?E:s):x.svg&&l&&l[0].ownerSVGElement?P=x.svg(this,l,g,x.viewport?E:s):(N=l.outerWidth(s),C=l.outerHeight(s),L=l.offset()),P&&(N=P.width,C=P.height,H=P.offset,L=P.position),L=this.reposition.offset(l,L,b);if(F.iOS>3.1&&F.iOS<4.1||F.iOS>=4.3&&F.iOS<4.33||!F.iOS&&k==="fixed")L.left-=M.scrollLeft(),L.top-=M.scrollTop();if(!P||P&&P.adjustable!==s)L.left+=g.x===d?N:g.x===v?N/2:0,L.top+=g.y===p?C:g.y===v?C/2:0}return L.left+=w.x+(m.x===d?-S:m.x===v?-S/2:0),L.top+=w.y+(m.y===p?-T:m.y===v?-T/2:0),x.viewport?(L.adjusted=x.viewport(this,L,f,N,C,S,T),H&&L.adjusted.left&&(L.left+=H.left),H&&L.adjusted.top&&(L.top+=H.top)):L.adjusted={left:0,top:0},this._trigger("move",[L,y.elem||y],n)?(delete L.adjusted,o===s||!A||isNaN(L.left)||isNaN(L.top)||l==="mouse"||!r.isFunction(f.effect)?a.css(L):r.isFunction(f.effect)&&(f.effect.call(a,this,r.extend({},L)),a.queue(function(e){r(this).css({opacity:"",height:""}),F.ie&&this.style.removeAttribute("filter"),e()})),this.positioning=s,this):this},w.reposition.offset=function(e,n,i){function h(e,t){n.left+=t*e.scrollLeft(),n.top+=t*e.scrollTop()}if(!i[0])return n;var s=r(e[0].ownerDocument),o=!!F.ie&&t.compatMode!=="CSS1Compat",u=i[0],a,f,l,c;do(f=r.css(u,"position"))!=="static"&&(f==="fixed"?(l=u.getBoundingClientRect(),h(s,-1)):(l=r(u).position(),l.left+=parseFloat(r.css(u,"borderLeftWidth"))||0,l.top+=parseFloat(r.css(u,"borderTopWidth"))||0),n.left-=l.left+(parseFloat(r.css(u,"marginLeft"))||0),n.top-=l.top+(parseFloat(r.css(u,"marginTop"))||0),!a&&(c=r.css(u,"overflow"))!=="hidden"&&c!=="visible"&&(a=r(u)));while(u=u.offsetParent);return a&&(a[0]!==s[0]||o)&&h(a,1),n};var $=(E=w.reposition.Corner=function(e,t){e=(""+e).replace(/([A-Z])/," $1").replace(/middle/gi,v).toLowerCase(),this.x=(e.match(/left|right/i)||e.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(e.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!t;var n=e.charAt(0);this.precedance=n==="t"||n==="b"?a:u}).prototype;$.invert=function(e,t){this[e]=this[e]===h?d:this[e]===d?h:t||this[e]},$.string=function(){var e=this.x,t=this.y;return e===t?e:this.precedance===a||this.forceY&&t!=="center"?t+" "+e:e+" "+t},$.abbrev=function(){var e=this.string().split(" ");return e[0].charAt(0)+(e[1]&&e[1].charAt(0)||"")},$.clone=function(){return new E(this.string(),this.forceY)},w.toggle=function(e,n){var u=this.cache,a=this.options,f=this.tooltip;if(n){if(/over|enter/.test(n.type)&&/out|leave/.test(u.event.type)&&a.show.target.add(n.target).length===a.show.target.length&&f.has(n.relatedTarget).length)return this;u.event=K(n)}this.waiting&&!e&&(this.hiddenDuringWait=i);if(!this.rendered)return e?this.render(1):this;if(this.destroyed||this.disabled)return this;var l=e?"show":"hide",c=this.options[l],h=this.options[e?"hide":"show"],p=this.options.position,d=this.options.content,v=this.tooltip.css("width"),m=this.tooltip.is(":visible"),g=e||c.target.length===1,y=!n||c.target.length<2||u.target[0]===n.target,b,w,E,S,x;return(typeof e).search("boolean|number")&&(e=!m),b=!f.is(":animated")&&m===e&&y,w=b?o:!!this._trigger(l,[90]),this.destroyed?this:(w!==s&&e&&this.focus(n),!w||b?this:(r.attr(f[0],"aria-hidden",!e),e?(u.origin=K(this.mouse),r.isFunction(d.text)&&this._updateContent(d.text,s),r.isFunction(d.title)&&this._updateTitle(d.title,s),!j&&p.target==="mouse"&&p.adjust.mouse&&(r(t).bind("mousemove."+T,this._storeMouse),j=i),v||f.css("width",f.outerWidth(s)),this.reposition(n,arguments[2]),v||f.css("width",""),!c.solo||(typeof c.solo=="string"?r(c.solo):r(L,c.solo)).not(f).not(c.target).qtip("hide",r.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete u.origin,j&&!r(L+'[tracking="true"]:visible',c.solo).not(f).length&&(r(t).unbind("mousemove."+T),j=s),this.blur(n)),x=r.proxy(function(){e?(F.ie&&f[0].style.removeAttribute("filter"),f.css("overflow",""),"string"==typeof c.autofocus&&r(this.options.show.autofocus,f).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):f.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(e?"visible":"hidden")},this),c.effect===s||g===s?(f[l](),x()):r.isFunction(c.effect)?(f.stop(1,1),c.effect.call(f,this),f.queue("fx",function(e){x(),e()})):f.fadeTo(90,e?1:0,x),e&&c.target.trigger("qtip-"+this.id+"-inactive"),this))},w.show=function(e){return this.toggle(i,e)},w.hide=function(e){return this.toggle(s,e)},w.focus=function(e){if(!this.rendered||this.destroyed)return this;var t=r(L),n=this.tooltip,i=parseInt(n[0].style.zIndex,10),s=b.zindex+t.length,o;return n.hasClass(_)||this._trigger("focus",[s],e)&&(i!==s&&(t.each(function(){this.style.zIndex>i&&(this.style.zIndex=this.style.zIndex-1)}),t.filter("."+_).qtip("blur",e)),n.addClass(_)[0].style.zIndex=s),this},w.blur=function(e){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(_),this._trigger("blur",[this.tooltip.css("zIndex")],e),this)},w.disable=function(e){return this.destroyed?this:(e==="toggle"?e=this.rendered?!this.tooltip.hasClass(P):!this.disabled:"boolean"!=typeof e&&(e=i),this.rendered&&this.tooltip.toggleClass(P,e).attr("aria-disabled",e),this.disabled=!!e,this)},w.enable=function(){return this.disable(s)},w._createButton=function(){var e=this,t=this.elements,n=t.tooltip,i=this.options.content.button,o=typeof i=="string",u=o?i:"Close tooltip";t.button&&t.button.remove(),i.jquery?t.button=i:t.button=r("<a />",{"class":"qtip-close "+(this.options.style.widget?"":T+"-icon"),title:u,"aria-label":u}).prepend(r("<span />",{"class":"ui-icon ui-icon-close",html:"&times;"})),t.button.appendTo(t.titlebar||n).attr("role","button").click(function(t){return n.hasClass(P)||e.hide(t),s})},w._updateButton=function(e){if(!this.rendered)return s;var t=this.elements.button;e?this._createButton():t.remove()},w._setWidget=function(){var e=this.options.style.widget,t=this.elements,n=t.tooltip,r=n.hasClass(P);n.removeClass(P),P=e?"ui-state-disabled":"qtip-disabled",n.toggleClass(P,r),n.toggleClass("ui-helper-reset "+J(),e).toggleClass(M,this.options.style.def&&!e),t.content&&t.content.toggleClass(J("content"),e),t.titlebar&&t.titlebar.toggleClass(J("header"),e),t.button&&t.button.toggleClass(T+"-icon",!e)},w._storeMouse=function(e){(this.mouse=K(e)).type="mousemove"},w._bind=function(e,t,n,i,s){var o="."+this._id+(i?"-"+i:"");t.length&&r(e).bind((t.split?t:t.join(o+" "))+o,r.proxy(n,s||this))},w._unbind=function(e,t){r(e).unbind("."+this._id+(t?"-"+t:""))};var tt="."+T;r(function(){nt(L,["mouseenter","mouseleave"],function(e){var t=e.type==="mouseenter",n=r(e.currentTarget),i=r(e.relatedTarget||e.target),s=this.options;t?(this.focus(e),n.hasClass(O)&&!n.hasClass(P)&&clearTimeout(this.timers.hide)):s.position.target==="mouse"&&s.hide.event&&s.show.target&&!i.closest(s.show.target[0]).length&&this.hide(e),n.toggleClass(D,t)}),nt("["+C+"]",A,Z)}),w._trigger=function(e,t,n){var i=r.Event("tooltip"+e);return i.originalEvent=n&&r.extend({},n)||this.cache.event||o,this.triggering=e,this.tooltip.trigger(i,[this].concat(t||[])),this.triggering=s,!i.isDefaultPrevented()},w._bindEvents=function(e,t,n,i,s,o){if(i.add(n).length===i.length){var u=[];t=r.map(t,function(t){var n=r.inArray(t,e);if(n>-1){u.push(e.splice(n,1)[0]);return}return t}),u.length&&this._bind(n,u,function(e){var t=this.rendered?this.tooltip[0].offsetWidth>0:!1;(t?o:s).call(this,e)})}this._bind(n,e,s),this._bind(i,t,o)},w._assignInitialEvents=function(e){function l(e){if(this.disabled||this.destroyed)return s;this.cache.event=K(e),this.cache.target=e?r(e.target):[n],clearTimeout(this.timers.show),this.timers.show=Q.call(this,function(){this.render(typeof e=="object"||t.show.ready)},t.show.delay)}var t=this.options,o=t.show.target,u=t.hide.target,a=t.show.event?r.trim(""+t.show.event).split(" "):[],f=t.hide.event?r.trim(""+t.hide.event).split(" "):[];/mouse(over|enter)/i.test(t.show.event)&&!/mouse(out|leave)/i.test(t.hide.event)&&f.push("mouseleave"),this._bind(o,"mousemove",function(e){this._storeMouse(e),this.cache.onTarget=i}),this._bindEvents(a,f,o,u,l,function(){clearTimeout(this.timers.show)}),(t.show.ready||t.prerender)&&l.call(this,e)},w._assignEvents=function(){var n=this,i=this.options,s=i.position,o=this.tooltip,u=i.show.target,a=i.hide.target,f=s.container,l=s.viewport,c=r(t),h=r(t.body),p=r(e),d=i.show.event?r.trim(""+i.show.event).split(" "):[],v=i.hide.event?r.trim(""+i.hide.event).split(" "):[];r.each(i.events,function(e,t){n._bind(o,e==="toggle"?["tooltipshow","tooltiphide"]:["tooltip"+e],t,null,o)}),/mouse(out|leave)/i.test(i.hide.event)&&i.hide.leave==="window"&&this._bind(c,["mouseout","blur"],function(e){!/select|option/.test(e.target.nodeName)&&!e.relatedTarget&&this.hide(e)}),i.hide.fixed?a=a.add(o.addClass(O)):/mouse(over|enter)/i.test(i.show.event)&&this._bind(a,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+i.hide.event).indexOf("unfocus")>-1&&this._bind(f.closest("html"),["mousedown","touchstart"],function(e){var t=r(e.target),n=this.rendered&&!this.tooltip.hasClass(P)&&this.tooltip[0].offsetWidth>0,i=t.parents(L).filter(this.tooltip[0]).length>0;t[0]!==this.target[0]&&t[0]!==this.tooltip[0]&&!i&&!this.target.has(t[0]).length&&n&&this.hide(e)}),"number"==typeof i.hide.inactive&&(this._bind(u,"qtip-"+this.id+"-inactive",Z),this._bind(a.add(o),b.inactiveEvents,Z,"-inactive")),this._bindEvents(d,v,u,a,G,Y),this._bind(u.add(o),"mousemove",function(e){if("number"==typeof i.hide.distance){var t=this.cache.origin||{},n=this.options.hide.distance,r=Math.abs;(r(e.pageX-t.pageX)>=n||r(e.pageY-t.pageY)>=n)&&this.hide(e)}this._storeMouse(e)}),s.target==="mouse"&&s.adjust.mouse&&(i.hide.event&&this._bind(u,["mouseenter","mouseleave"],function(e){this.cache.onTarget=e.type==="mouseenter"}),this._bind(c,"mousemove",function(e){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(P)&&this.tooltip[0].offsetWidth>0&&this.reposition(e)})),(s.adjust.resize||l.length)&&this._bind(r.event.special.resize?l:p,"resize",et),s.adjust.scroll&&this._bind(p.add(s.container),"scroll",et)},w._unassignEvents=function(){var n=[this.options.show.target[0],this.options.hide.target[0],this.rendered&&this.tooltip[0],this.options.position.container[0],this.options.position.viewport[0],this.options.position.container.closest("html")[0],e,t];this._unbind(r([]).pushStack(r.grep(n,function(e){return typeof e=="object"})))},b=r.fn.qtip=function(e,t,u){var a=(""+e).toLowerCase(),f=o,l=r.makeArray(arguments).slice(1),c=l[l.length-1],h=this[0]?r.data(this[0],T):o;if(!arguments.length&&h||a==="api")return h;if("string"==typeof e)return this.each(function(){var e=r.data(this,T);if(!e)return i;c&&c.timeStamp&&(e.cache.event=c);if(!t||a!=="option"&&a!=="options")e[a]&&e[a].apply(e,l);else{if(u===n&&!r.isPlainObject(t))return f=e.get(t),s;e.set(t,u)}}),f!==o?f:this;if("object"==typeof e||!arguments.length)return h=U(r.extend(i,{},e)),this.each(function(e){var t,n;n=r.isArray(h.id)?h.id[e]:h.id,n=!n||n===s||n.length<1||b.api[n]?b.nextid++:n,t=rt(r(this),n,h);if(t===s)return i;b.api[n]=t,r.each(x,function(){this.initialize==="initialize"&&this(t)}),t._assignInitialEvents(c)})},r.qtip=I,b.api={},r.each({attr:function(e,t){if(this.length){var n=this[0],i="title",s=r.data(n,"qtip");if(e===i&&s&&"object"==typeof s&&s.options.suppress)return arguments.length<2?r.attr(n,B):(s&&s.options.content.attr===i&&s.cache.attr&&s.set("content.text",t),this.attr(B,t))}return r.fn["attr"+H].apply(this,arguments)},clone:function(e){var t=r([]),n="title",i=r.fn["clone"+H].apply(this,arguments);return e||i.filter("["+B+"]").attr("title",function(){return r.attr(this,B)}).removeAttr(B),i}},function(e,t){if(!t||r.fn[e+H])return i;var n=r.fn[e+H]=r.fn[e];r.fn[e]=function(){return t.apply(this,arguments)||n.apply(this,arguments)}}),r.ui||(r["cleanData"+H]=r.cleanData,r.cleanData=function(e){for(var t=0,n;(n=r(e[t])).length;t++)if(n.attr(N))try{n.triggerHandler("removeqtip")}catch(i){}r["cleanData"+H].apply(this,arguments)}),b.version="2.2.0",b.nextid=0,b.inactiveEvents=A,b.zindex=15e3,b.defaults={prerender:s,id:s,overwrite:i,suppress:i,content:{text:i,attr:"title",title:s,button:s},position:{my:"top left",at:"bottom right",target:s,container:s,viewport:s,adjust:{x:0,y:0,mouse:i,scroll:i,resize:i,method:"flipinvert flipinvert"},effect:function(e,t,n){r(this).animate(t,{duration:200,queue:s})}},show:{target:s,event:"mouseenter",effect:i,delay:90,solo:s,ready:s,autofocus:s},hide:{target:s,event:"mouseleave",effect:i,delay:0,fixed:s,inactive:s,leave:"window",distance:s},style:{classes:"",widget:s,width:s,height:s,def:i},events:{render:o,move:o,show:o,hide:o,toggle:o,visible:o,hidden:o,focus:o,blur:o}};var it,st=".qtip-tip",ot="margin",ut="border",at="color",ft="background-color",lt="transparent",ct=" !important",ht=!!t.createElement("canvas").getContext,pt=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,vt={},mt=["Webkit","O","Moz","ms"];if(!ht)var bt=function(e,t,n){return"<qtipvml:"+e+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(t||"")+' style="behavior: url(#default#VML); '+(n||"")+'" />'};else var wt=e.devicePixelRatio||1,Et=function(){var e=t.createElement("canvas").getContext("2d");return e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||1}(),St=wt/Et;r.extend(xt.prototype,{init:function(e){var t,n;n=this.element=e.elements.tip=r("<div />",{"class":T+"-tip"}).prependTo(e.tooltip),ht?(t=r("<canvas />").appendTo(this.element)[0].getContext("2d"),t.lineJoin="miter",t.miterLimit=1e5,t.save()):(t=bt("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(t+t),e._bind(r("*",n).add(n),["click","mousedown"],function(e){e.stopPropagation()},this._ns)),e._bind(e.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(e){var t=this.qtip.elements.titlebar;return t&&(e.y===c||e.y===v&&this.element.position().top+this.size[1]/2+this.options.offset<t.outerHeight(i))},_parseCorner:function(e){var t=this.qtip.options.position.my;return e===s||t===s?e=s:e===i?e=new E(t.string()):e.string||(e=new E(e),e.fixed=i),e},_parseWidth:function(e,t,n){var r=this.qtip.elements,i=ut+dt(t)+"Width";return(n?yt(n,i):yt(r.content,i)||yt(this._useTitle(e)&&r.titlebar||r.content,i)||yt(r.tooltip,i))||0},_parseRadius:function(e){var t=this.qtip.elements,n=ut+dt(e.y)+dt(e.x)+"Radius";return F.ie<9?0:yt(this._useTitle(e)&&t.titlebar||t.content,n)||yt(t.tooltip,n)||0},_invalidColour:function(e,t,n){var r=e.css(t);return!r||n&&r===e.css(n)||pt.test(r)?s:r},_parseColours:function(e){var t=this.qtip.elements,n=this.element.css("cssText",""),i=ut+dt(e[e.precedance])+dt(at),s=this._useTitle(e)&&t.titlebar||t.content,o=this._invalidColour,u=[];return u[0]=o(n,ft)||o(s,ft)||o(t.content,ft)||o(t.tooltip,ft)||n.css(ft),u[1]=o(n,i,at)||o(s,i,at)||o(t.content,i,at)||o(t.tooltip,i,at)||t.tooltip.css(i),r("*",n).add(n).css("cssText",ft+":"+lt+ct+";"+ut+":0"+ct+";"),u},_calculateSize:function(e){var t=e.precedance===a,n=this.options.width,r=this.options.height,i=e.abbrev()==="c",s=(t?n:r)*(i?.5:1),o=Math.pow,u=Math.round,f,l,c,h=Math.sqrt(o(s,2)+o(r,2)),p=[this.border/s*h,this.border/r*h];return p[2]=Math.sqrt(o(p[0],2)-o(this.border,2)),p[3]=Math.sqrt(o(p[1],2)-o(this.border,2)),f=h+p[2]+p[3]+(i?0:p[0]),l=f/h,c=[u(l*n),u(l*r)],t?c:c.reverse()},_calculateTip:function(e,t,n){n=n||1,t=t||this.size;var r=t[0]*n,i=t[1]*n,s=Math.ceil(r/2),o=Math.ceil(i/2),u={br:[0,0,r,i,r,0],bl:[0,0,r,0,0,i],tr:[0,i,r,0,r,i],tl:[0,0,0,i,r,i],tc:[0,i,s,0,r,i],bc:[0,0,r,0,s,i],rc:[0,0,r,o,0,i],lc:[r,0,r,i,0,o]};return u.lt=u.br,u.rt=u.bl,u.lb=u.tr,u.rb=u.tl,u[e.abbrev()]},_drawCoords:function(e,t){e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(t[2],t[3]),e.lineTo(t[4],t[5]),e.closePath()},create:function(){var e=this.corner=(ht||F.ie)&&this._parseCorner(this.options.corner);if(this.enabled=!!this.corner&&this.corner.abbrev()!=="c")this.qtip.cache.corner=e.clone(),this.update();return this.element.toggle(this.enabled),this.corner},update:function(t,n){if(!this.enabled)return this;var o=this.qtip.elements,m=this.element,g=m.children(),y=this.options,b=this.size,w=y.mimic,S=Math.round,x,T,N,C,k,L,A,O,M;t||(t=this.qtip.cache.corner||this.corner),w===s?w=t:(w=new E(w),w.precedance=t.precedance,w.x==="inherit"?w.x=t.x:w.y==="inherit"?w.y=t.y:w.x===w.y&&(w[t.precedance]=t[t.precedance])),T=w.precedance,t.precedance===u?this._swapDimensions():this._resetDimensions(),x=this.color=this._parseColours(t),x[1]!==lt?(O=this.border=this._parseWidth(t,t[t.precedance]),y.border&&O<1&&!pt.test(x[1])&&(x[0]=x[1]),this.border=O=y.border!==i?y.border:O):this.border=O=0,A=this.size=this._calculateSize(t),m.css({width:A[0],height:A[1],lineHeight:A[1]+"px"}),t.precedance===a?L=[S(w.x===h?O:w.x===d?A[0]-b[0]-O:(A[0]-b[0])/2),S(w.y===c?A[1]-b[1]:0)]:L=[S(w.x===h?A[0]-b[0]:0),S(w.y===c?O:w.y===p?A[1]-b[1]-O:(A[1]-b[1])/2)],ht?(N=g[0].getContext("2d"),N.restore(),N.save(),N.clearRect(0,0,6e3,6e3),C=this._calculateTip(w,b,St),k=this._calculateTip(w,this.size,St),g.attr(f,A[0]*St).attr(l,A[1]*St),g.css(f,A[0]).css(l,A[1]),this._drawCoords(N,k),N.fillStyle=x[1],N.fill(),N.translate(L[0]*St,L[1]*St),this._drawCoords(N,C),N.fillStyle=x[0],N.fill()):(C=this._calculateTip(w),C="m"+C[0]+","+C[1]+" l"+C[2]+","+C[3]+" "+C[4]+","+C[5]+" xe",L[2]=O&&/^(r|b)/i.test(t.string())?F.ie===8?2:1:0,g.css({coordsize:A[0]+O+" "+(A[1]+O),antialias:""+(w.string().indexOf(v)>-1),left:L[0]-L[2]*Number(T===u),top:L[1]-L[2]*Number(T===a),width:A[0]+O,height:A[1]+O}).each(function(e){var t=r(this);t[t.prop?"prop":"attr"]({coordsize:A[0]+O+" "+(A[1]+O),path:C,fillcolor:x[0],filled:!!e,stroked:!e}).toggle(!!O||!!e),!e&&t.html(bt("stroke",'weight="'+O*2+'px" color="'+x[1]+'" miterlimit="1000" joinstyle="miter"'))})),e.opera&&setTimeout(function(){o.tip.css({display:"inline-block",visibility:"visible"})},1),n!==s&&this.calculate(t,A)},calculate:function(e,t){if(!this.enabled)return s;var n=this,i=this.qtip.elements,o=this.element,f=this.options.offset,l=i.tooltip.hasClass("ui-widget"),p={},d,m;return e=e||this.corner,d=e.precedance,t=t||this._calculateSize(e),m=[e.x,e.y],d===u&&m.reverse(),r.each(m,function(r,s){var o,u,l;s===v?(o=d===a?h:c,p[o]="50%",p[ot+"-"+o]=-Math.round(t[d===a?0:1]/2)+f):(o=n._parseWidth(e,s,i.tooltip),u=n._parseWidth(e,s,i.content),l=n._parseRadius(e),p[s]=Math.max(-n.border,r?u:f+(l>o?l:-o)))}),p[e[d]]-=t[d===u?0:1],o.css({margin:"",top:"",bottom:"",left:"",right:""}).css(p),p},reposition:function(e,t,r,o){function N(e,t,n,r,i){e===y&&l.precedance===t&&m[r]&&l[n]!==v?l.precedance=l.precedance===u?a:u:e!==y&&m[r]&&(l[t]=l[t]===v?m[r]>0?r:i:l[t]===r?i:r)}function C(e,t,i){l[e]===v?x[ot+"-"+t]=E[e]=S[ot+"-"+t]-m[t]:(T=S[i]!==n?[m[t],-S[t]]:[-m[t],S[t]],(E[e]=Math.max(T[0],T[1]))>T[0]&&(r[t]-=m[t],E[t]=s),x[S[i]!==n?i:t]=E[e])}if(!this.enabled)return;var f=t.cache,l=this.corner.clone(),m=r.adjusted,g=t.options.position.adjust.method.split(" "),b=g[0],w=g[1]||g[0],E={left:s,top:s,x:0,y:0},S,x={},T;this.corner.fixed!==i&&(N(b,u,a,h,d),N(w,a,u,c,p),l.string()!==f.corner.string()&&(f.cornerTop!==m.top||f.cornerLeft!==m.left)&&this.update(l,s)),S=this.calculate(l),S.right!==n&&(S.left=-S.right),S.bottom!==n&&(S.top=-S.bottom),S.user=this.offset,(E.left=b===y&&!!m.left)&&C(u,h,d),(E.top=w===y&&!!m.top)&&C(a,c,p),this.element.css(x).toggle(!(E.x&&E.y||l.x===v&&E.y||l.y===v&&E.x)),r.left-=S.left.charAt?S.user:b!==y||E.top||!E.left&&!E.top?S.left+this.border:0,r.top-=S.top.charAt?S.user:w!==y||E.left||!E.left&&!E.top?S.top+this.border:0,f.cornerLeft=m.left,f.cornerTop=m.top,f.corner=l.clone()},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),it=x.tip=function(e){return new xt(e,e.options.style.tip)},it.initialize="render",it.sanitize=function(e){if(e.style&&"tip"in e.style){var t=e.style.tip;typeof t!="object"&&(t=e.style.tip={corner:t}),/string|boolean/i.test(typeof t.corner)||(t.corner=i)}},S.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(e){this.size=[e.width,e.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},r.extend(i,b.defaults,{style:{tip:{corner:i,mimic:s,width:6,height:6,border:i,offset:0}}}),x.viewport=function(n,r,i,o,m,b,w){function z(e,t,n,i,s,o,u,a,l){var c=r[s],h=x[e],p=N[e],d=n===y,m=h===s?l:h===o?-l:-l/2,b=p===s?a:p===o?-a:-a/2,w=R[s]+U[s]-(F?0:j[s]),E=w-c,S=c+l-(u===f?I:q)-w,T=m-(x.precedance===e||h===x[t]?b:0)-(p===v?a/2:0);return d?(T=(h===s?1:-1)*m,r[s]+=E>0?E:S>0?-S:0,r[s]=Math.max(-j[s]+U[s],c-T,Math.min(Math.max(-j[s]+U[s]+(u===f?I:q),c+T),r[s],h==="center"?c-m:1e9))):(i*=n===g?2:0,E>0&&(h!==s||S>0)?(r[s]-=T+i,H.invert(e,s)):S>0&&(h!==o||E>0)&&(r[s]-=(h===v?-T:T)+i,H.invert(e,o)),r[s]<R&&-r[s]>S&&(r[s]=c,H=x.clone())),r[s]-c}var E=i.target,S=n.elements.tooltip,x=i.my,N=i.at,C=i.adjust,k=C.method.split(" "),L=k[0],A=k[1]||k[0],O=i.viewport,M=i.container,_=n.cache,D={left:0,top:0},P,H,B,j,F,I,q,R,U;if(!O.jquery||E[0]===e||E[0]===t.body||C.method==="none")return D;j=M.offset()||D,F=M.css("position")==="static",P=S.css("position")==="fixed",I=O[0]===e?O.width():O.outerWidth(s),q=O[0]===e?O.height():O.outerHeight(s),R={left:P?0:O.scrollLeft(),top:P?0:O.scrollTop()},U=O.offset()||D;if(L!=="shift"||A!=="shift")H=x.clone();return D={left:L!=="none"?z(u,a,L,C.x,h,d,f,o,b):0,top:A!=="none"?z(a,u,A,C.y,c,p,l,m,w):0},H&&_.lastClass!==(B=T+"-pos-"+H.abbrev())&&S.removeClass(n.cache.lastClass).addClass(n.cache.lastClass=B),D}})}(window,document),define("util.tooltips",["jquery","qtip"],function(e){setupTooltips=function(t){typeof t=="undefined"&&(t=!1);if(Headway.disableTooltips==1||Headway.touch)return e("div.tooltip-button").hide(),e("*").removeAttr("title"),!1;var n={style:{classes:"qtip-headway"},show:{delay:10,solo:!0,event:"mouseenter"},position:{my:"bottom left",at:"top center",viewport:e(window),effect:!1},hide:{effect:!1}};if(t=="iframe"){n.position.container=$i("body"),n.position.viewport=$i("#headway-tooltip-container");var r=$i}else var r=e;r("div.tooltip-button:not([data-hasqtip]), .tooltip:not([data-hasqtip])").qtip(n),r(".tooltip-bottom-right:not([data-hasqtip])").qtip(e.extend(!0,{},n,{position:{my:"bottom right",at:"top center"}})),r(".tooltip-top-right:not([data-hasqtip])").qtip(e.extend(!0,{},n,{position:{my:"top right",at:"bottom center"}})),r(".tooltip-top-left:not([data-hasqtip])").qtip(e.extend(!0,{},n,{position:{my:"top left",at:"bottom center"},show:{delay:750}})),r(".tooltip-left:not([data-hasqtip])").qtip(e.extend(!0,{},n,{position:{my:"left center",at:"right center"}})),r(".tooltip-right:not([data-hasqtip])").qtip(e.extend(!0,{},n,{position:{my:"right center",at:"left center"}})),r(".tooltip-top:not([data-hasqtip])").qtip(e.extend(!0,{},n,{position:{my:"top center",at:"bottom center"}}));var i=function(){if($i(".qtip:visible").length===0||typeof iframeScrollTooltipRepositionFloodTimeout!="undefined")return;iframeScrollTooltipRepositionFloodTimeout=setTimeout(function(){$i(".qtip:visible").qtip("reposition"),delete iframeScrollTooltipRepositionFloodTimeout},400)};Headway.iframe.contents().unbind("scroll",i),Headway.iframe.contents().bind("scroll",i)},repositionTooltips=function(){$i(".qtip:visible").qtip("reposition")}}),function(e,t,n){function m(e,t,n){if(e.addEventListener){e.addEventListener(t,n,!1);return}e.attachEvent("on"+t,n)}function g(e){if(e.type=="keypress"){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return r[e.which]?r[e.which]:i[e.which]?i[e.which]:String.fromCharCode(e.which).toLowerCase()}function y(e,t){return e.sort().join(",")===t.sort().join(",")}function b(e){e=e||{};var t=!1,n;for(n in l){if(e[n]){t=!0;continue}l[n]=0}t||(d=!1)}function w(e,t,n,r,i,s){var o,u,f=[],c=n.type;if(!a[e])return[];c=="keyup"&&k(e)&&(t=[e]);for(o=0;o<a[e].length;++o){u=a[e][o];if(!r&&u.seq&&l[u.seq]!=u.level)continue;if(c!=u.action)continue;if(c=="keypress"&&!n.metaKey&&!n.ctrlKey||y(t,u.modifiers)){var h=!r&&u.combo==i,p=r&&u.seq==r&&u.level==s;(h||p)&&a[e].splice(o,1),f.push(u)}}return f}function E(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}function S(e){if(e.preventDefault){e.preventDefault();return}e.returnValue=!1}function x(e){if(e.stopPropagation){e.stopPropagation();return}e.cancelBubble=!0}function T(e,t,n,r){if(B.stopCallback(t,t.target||t.srcElement,n,r))return;e(t,n)===!1&&(S(t),x(t))}function N(e,t,n){var r=w(e,t,n),i,s={},o=0,u=!1;for(i=0;i<r.length;++i)r[i].seq&&(o=Math.max(o,r[i].level));for(i=0;i<r.length;++i){if(r[i].seq){if(r[i].level!=o)continue;u=!0,s[r[i].seq]=1,T(r[i].callback,n,r[i].combo,r[i].seq);continue}u||T(r[i].callback,n,r[i].combo)}var a=n.type=="keypress"&&p;n.type==d&&!k(e)&&!a&&b(s),p=u&&n.type=="keydown"}function C(e){typeof e.which!="number"&&(e.which=e.keyCode);var t=g(e);if(!t)return;if(e.type=="keyup"&&h===t){h=!1;return}B.handleKey(t,E(e),e)}function k(e){return e=="shift"||e=="ctrl"||e=="alt"||e=="meta"}function L(){clearTimeout(c),c=setTimeout(b,1e3)}function A(){if(!u){u={};for(var e in r){if(e>95&&e<112)continue;r.hasOwnProperty(e)&&(u[r[e]]=e)}}return u}function O(e,t,n){return n||(n=A()[e]?"keydown":"keypress"),n=="keypress"&&t.length&&(n="keydown"),n}function M(e,t,n,r){function i(t){return function(){d=t,++l[e],L()}}function s(t){T(n,t,e),r!=="keyup"&&(h=g(t)),setTimeout(b,10)}l[e]=0;for(var o=0;o<t.length;++o){var u=o+1===t.length,a=u?s:i(r||D(t[o+1]).action);P(t[o],a,r,e,o)}}function _(e){return e==="+"?["+"]:e.split("+")}function D(e,t){var n,r,i,u=[];n=_(e);for(i=0;i<n.length;++i)r=n[i],o[r]&&(r=o[r]),t&&t!="keypress"&&s[r]&&(r=s[r],u.push("shift")),k(r)&&u.push(r);return t=O(r,u,t),{key:r,modifiers:u,action:t}}function P(e,t,n,r,i){f[e+":"+n]=t,e=e.replace(/\s+/g," ");var s=e.split(" "),o;if(s.length>1){M(e,s,t,n);return}o=D(e,n),a[o.key]=a[o.key]||[],w(o.key,o.modifiers,{type:o.action},r,e,i),a[o.key][r?"unshift":"push"]({callback:t,modifiers:o.modifiers,action:o.action,seq:r,level:i,combo:e})}function H(e,t,n){for(var r=0;r<e.length;++r)P(e[r],t,n)}var r={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},i={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},o={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},u,a={},f={},l={},c,h=!1,p=!1,d=!1;for(var v=1;v<20;++v)r[111+v]="f"+v;for(v=0;v<=9;++v)r[v+96]=v;m(t,"keypress",C),m(t,"keydown",C),m(t,"keyup",C);var B={bind:function(e,t,n){return e=e instanceof Array?e:[e],H(e,t,n),this},unbind:function(e,t){return B.bind(e,function(){},t)},trigger:function(e,t){return f[e+":"+t]&&f[e+":"+t]({},e),this},reset:function(){return a={},f={},this},stopCallback:function(e,t){return(" "+t.className+" ").indexOf(" mousetrap ")>-1?!1:t.tagName=="INPUT"||t.tagName=="SELECT"||t.tagName=="TEXTAREA"||t.isContentEditable},bindEventsTo:function(e){e==n&&(e=t),m(e,"keypress",C),m(e,"keydown",C),m(e,"keyup",C)},handleKey:N};e.Mousetrap=B,typeof define=="function"&&define.amd&&define("deps/mousetrap",B)}(window,document),Mousetrap=function(e){var t={},n=e.stopCallback;return e.stopCallback=function(e,r,i,s){return t[i]||t[s]?!1:n(e,r,i)},e.bindGlobal=function(n,r,i){e.bind(n,r,i);if(n instanceof Array){for(var s=0;s<n.length;s++)t[n[s]]=!0;return}t[n]=!0},e}(Mousetrap),define("helper.ace",["jquery","deps/mousetrap"],function(e,t){Headway.aceEditors={};var n={init:function(){window.onunload=function(){e.each(Headway.aceEditors,function(e,t){typeof t.window!="undefined"&&!t.window.closed&&t.window.close()})}},showEditor:function(e,t,r,i){if(typeof Headway.aceEditors[e]!="undefined"&&!Headway.aceEditors[e].window.closed)return Headway.aceEditors[e].window.focus(),Headway.aceEditors[e];var s={width:750,height:550};return s.left=screen.width/2-s.width/2,s.top=screen.height/2-s.height/2,Headway.aceEditors[e]={window:window.open(Headway.homeURL+"/?headway-trigger=ace-editor&mode="+t,e,"width="+s.width+",height="+s.height+",top="+s.top+",left="+s.left,!0)},Headway.aceEditors[e].window.focus(),n.bindEditor(e,t,r,i),Headway.aceEditors[e]},bindEditor:function(n,r,i,s){var o=Headway.aceEditors[n].window;return e(o).bind("load",function(){t.bindEventsTo(o.document);var u=o.ace,a=Headway.headwayURL+"/library/visual-editor/"+Headway.scriptFolder+"/deps/ace/";u.config.set("basePath",a),u.config.set("modePath",a),u.config.set("workerPath",a),u.config.set("themePath",a),Headway.aceEditors[n].editor=u.edit(e(o.document).contents().find("#ace-editor").get(0)),Headway.aceEditors[n].editorSession=Headway.aceEditors[n].editor.getSession(),Headway.aceEditors[n].editor.setTheme("ace/theme/textmate"),Headway.aceEditors[n].editorSession.setMode("ace/mode/"+r),Headway.aceEditors[n].editor.setShowPrintMargin(!1),Headway.aceEditors[n].editorSession.setUseWrapMode(!0),Headway.aceEditors[n].editor.setValue(i),Headway.aceEditors[n].editor.gotoLine(0),Headway.aceEditors[n].editor.focus(),Headway.aceEditors[n].editorSession.on("change",function(e){return s(Headway.aceEditors[n].editor)})})}};return n.init(),n}),function(){var e,t,n,r,i,s={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var n in t)s.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=function(){function e(){this.options_index=0,this.parsed=[]}return e.prototype.add_node=function(e){return e.nodeName.toUpperCase()==="OPTGROUP"?this.add_group(e):this.add_option(e)},e.prototype.add_group=function(e){var t,n,r,i,s,o;t=this.parsed.length,this.parsed.push({array_index:t,group:!0,label:this.escapeExpression(e.label),children:0,disabled:e.disabled}),s=e.childNodes,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(this.add_option(n,t,e.disabled));return o},e.prototype.add_option=function(e,t,n){if(e.nodeName.toUpperCase()==="OPTION")return e.text!==""?(t!=null&&(this.parsed[t].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1},e.prototype.escapeExpression=function(e){var t,n;return e==null||e===!1?"":/[\&\<\>\"\'\`]/.test(e)?(t={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},n=/&(?!\w+;)|[\<\>\"\'\`]/g,e.replace(n,function(e){return t[e]||"&amp;"})):e},e}(),r.select_to_array=function(e){var t,n,i,s,o;n=new r,o=e.childNodes;for(i=0,s=o.length;i<s;i++)t=o[i],n.add_node(t);return n.parsed},t=function(){function e(t,n){this.form_field=t,this.options=n!=null?n:{};if(!e.browser_is_supported())return;this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers()}return e.prototype.set_default_values=function(){var e=this;return this.click_test_action=function(t){return e.test_active_click(t)},this.activate_action=function(t){return e.activate_field(t)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=this.options.allow_single_deselect!=null&&this.form_field.options[0]!=null&&this.form_field.options[0].text===""?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:!0,this.group_search=this.options.group_search!=null?this.options.group_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=this.options.single_backstroke_delete!=null?this.options.single_backstroke_delete:!0,this.max_selected_options=this.options.max_selected_options||Infinity,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=this.options.display_selected_options!=null?this.options.display_selected_options:!0,this.display_disabled_options=this.options.display_disabled_options!=null?this.options.display_disabled_options:!0},e.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||e.default_multiple_text:this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||e.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||e.default_no_result_text},e.prototype.mouse_enter=function(){return this.mouse_on_container=!0},e.prototype.mouse_leave=function(){return this.mouse_on_container=!1},e.prototype.input_focus=function(e){var t=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return t.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},e.prototype.input_blur=function(e){var t=this;if(!this.mouse_on_container)return this.active_field=!1,setTimeout(function(){return t.blur_test()},100)},e.prototype.results_option_build=function(e){var t,n,r,i,s;t="",s=this.results_data;for(r=0,i=s.length;r<i;r++){n=s[r],n.group?t+=this.result_add_group(n):t+=this.result_add_option(n);if(e!=null?e.first:void 0)n.selected&&this.is_multiple?this.choice_build(n):n.selected&&!this.is_multiple&&this.single_set_selected_text(n.text)}return t},e.prototype.result_add_option=function(e){var t,n;return e.search_match?this.include_option_in_results(e)?(t=[],!e.disabled&&(!e.selected||!this.is_multiple)&&t.push("active-result"),e.disabled&&(!e.selected||!this.is_multiple)&&t.push("disabled-result"),e.selected&&t.push("result-selected"),e.group_array_index!=null&&t.push("group-option"),e.classes!==""&&t.push(e.classes),n=document.createElement("li"),n.className=t.join(" "),n.style.cssText=e.style,n.setAttribute("data-option-array-index",e.array_index),n.innerHTML=e.search_text,this.outerHTML(n)):"":""},e.prototype.result_add_group=function(e){var t;return!e.search_match&&!e.group_match?"":e.active_options>0?(t=document.createElement("li"),t.className="group-result",t.innerHTML=e.search_text,this.outerHTML(t)):""},e.prototype.results_update_field=function(){this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build();if(this.results_showing)return this.winnow_results()},e.prototype.reset_single_select_options=function(){var e,t,n,r,i;r=this.results_data,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e.selected?i.push(e.selected=!1):i.push(void 0);return i},e.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},e.prototype.results_search=function(e){return this.results_showing?this.winnow_results():this.results_show()},e.prototype.winnow_results=function(){var e,t,n,r,i,s,o,u,a,f,l,c;this.no_results_clear(),r=0,s=this.get_search_text(),e=s.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),a=new RegExp(e,"i"),n=this.get_search_regex(e),c=this.results_data;for(f=0,l=c.length;f<l;f++){t=c[f],t.search_match=!1,i=null;if(this.include_option_in_results(t)){t.group&&(t.group_match=!1,t.active_options=0),t.group_array_index!=null&&this.results_data[t.group_array_index]&&(i=this.results_data[t.group_array_index],i.active_options===0&&i.search_match&&(r+=1),i.active_options+=1);if(!t.group||!!this.group_search)t.search_text=t.group?t.label:t.text,t.search_match=this.search_string_match(t.search_text,n),t.search_match&&!t.group&&(r+=1),t.search_match?(s.length&&(o=t.search_text.search(a),u=t.search_text.substr(0,o+s.length)+"</em>"+t.search_text.substr(o+s.length),t.search_text=u.substr(0,o)+"<em>"+u.substr(o)),i!=null&&(i.group_match=!0)):t.group_array_index!=null&&this.results_data[t.group_array_index].search_match&&(t.search_match=!0)}}return this.result_clear_highlight(),r<1&&s.length?(this.update_results_content(""),this.no_results(s)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight())},e.prototype.get_search_regex=function(e){var t;return t=this.search_contains?"":"^",new RegExp(t+e,"i")},e.prototype.search_string_match=function(e,t){var n,r,i,s;if(t.test(e))return!0;if(this.enable_split_word_search&&(e.indexOf(" ")>=0||e.indexOf("[")===0)){r=e.replace(/\[|\]/g,"").split(" ");if(r.length)for(i=0,s=r.length;i<s;i++){n=r[i];if(t.test(n))return!0}}},e.prototype.choices_count=function(){var e,t,n,r;if(this.selected_option_count!=null)return this.selected_option_count;this.selected_option_count=0,r=this.form_field.options;for(t=0,n=r.length;t<n;t++)e=r[t],e.selected&&(this.selected_option_count+=1);return this.selected_option_count},e.prototype.choices_click=function(e){e.preventDefault();if(!this.results_showing&&!this.is_disabled)return this.results_show()},e.prototype.keyup_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode,this.search_field_scale();switch(t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:e.preventDefault();if(this.results_showing)return this.result_select(e);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},e.prototype.clipboard_event_checker=function(e){var t=this;return setTimeout(function(){return t.results_search()},50)},e.prototype.container_width=function(){return this.options.width!=null?this.options.width:""+this.form_field.offsetWidth+"px"},e.prototype.include_option_in_results=function(e){return this.is_multiple&&!this.display_selected_options&&e.selected?!1:!this.display_disabled_options&&e.disabled?!1:e.empty?!1:!0},e.prototype.search_results_touchstart=function(e){return this.touch_started=!0,this.search_results_mouseover(e)},e.prototype.search_results_touchmove=function(e){return this.touch_started=!1,this.search_results_mouseout(e)},e.prototype.search_results_touchend=function(e){if(this.touch_started)return this.search_results_mouseup(e)},e.prototype.outerHTML=function(e){var t;return e.outerHTML?e.outerHTML:(t=document.createElement("div"),t.appendChild(e),t.innerHTML)},e.browser_is_supported=function(){return window.navigator.appName==="Microsoft Internet Explorer"?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0},e.default_multiple_text="Select Some Options",e.default_single_text="Select an Option",e.default_no_result_text="No results match",e}(),e=jQuery,e.fn.extend({chosen:function(r){return t.browser_is_supported()?this.each(function(t){var i,s;i=e(this),s=i.data("chosen"),r==="destroy"&&s instanceof n?s.destroy():s instanceof n||i.data("chosen",new n(this,r))}):this}}),n=function(t){function n(){return i=n.__super__.constructor.apply(this,arguments),i}return o(n,t),n.prototype.setup=function(){return this.form_field_jq=e(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},n.prototype.set_up_html=function(){var t,n;return t=["chosen-container"],t.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&t.push(this.form_field.className),this.is_rtl&&t.push("chosen-rtl"),n={"class":t.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(n.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=e("<div />",n),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("chosen:ready",{chosen:this})},n.prototype.register_observers=function(){var e=this;return this.container.bind("touchstart.chosen",function(t){e.container_mousedown(t)}),this.container.bind("touchend.chosen",function(t){e.container_mouseup(t)}),this.container.bind("mousedown.chosen",function(t){e.container_mousedown(t)}),this.container.bind("mouseup.chosen",function(t){e.container_mouseup(t)}),this.container.bind("mouseenter.chosen",function(t){e.mouse_enter(t)}),this.container.bind("mouseleave.chosen",function(t){e.mouse_leave(t)}),this.search_results.bind("mouseup.chosen",function(t){e.search_results_mouseup(t)}),this.search_results.bind("mouseover.chosen",function(t){e.search_results_mouseover(t)}),this.search_results.bind("mouseout.chosen",function(t){e.search_results_mouseout(t)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(t){e.search_results_mousewheel(t)}),this.search_results.bind("touchstart.chosen",function(t){e.search_results_touchstart(t)}),this.search_results.bind("touchmove.chosen",function(t){e.search_results_touchmove(t)}),this.search_results.bind("touchend.chosen",function(t){e.search_results_touchend(t)}),this.form_field_jq.bind("chosen:updated.chosen",function(t){e.results_update_field(t)}),this.form_field_jq.bind("chosen:activate.chosen",function(t){e.activate_field(t)}),this.form_field_jq.bind("chosen:open.chosen",function(t){e.container_mousedown(t)}),this.form_field_jq.bind("chosen:close.chosen",function(t){e.input_blur(t)}),this.search_field.bind("blur.chosen",function(t){e.input_blur(t)}),this.search_field.bind("keyup.chosen",function(t){e.keyup_checker(t)}),this.search_field.bind("keydown.chosen",function(t){e.keydown_checker(t)}),this.search_field.bind("focus.chosen",function(t){e.input_focus(t)}),this.search_field.bind("cut.chosen",function(t){e.clipboard_event_checker(t)}),this.search_field.bind("paste.chosen",function(t){e.clipboard_event_checker(t)}),this.is_multiple?this.search_choices.bind("click.chosen",function(t){e.choices_click(t)}):this.container.bind("click.chosen",function(e){e.preventDefault()})},n.prototype.destroy=function(){return e(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},n.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled)return this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field();this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1;if(!this.is_multiple)return this.selected_item.bind("focus.chosen",this.activate_action)},n.prototype.container_mousedown=function(t){if(!this.is_disabled){t&&t.type==="mousedown"&&!this.results_showing&&t.preventDefault();if(t==null||!e(t.target).hasClass("search-choice-close"))return this.active_field?!this.is_multiple&&t&&(e(t.target)[0]===this.selected_item[0]||e(t.target).parents("a.chosen-single").length)&&(t.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),e(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field()}},n.prototype.container_mouseup=function(e){if(e.target.nodeName==="ABBR"&&!this.is_disabled)return this.results_reset(e)},n.prototype.search_results_mousewheel=function(e){var t;e.originalEvent&&(t=e.originalEvent.deltaY||-e.originalEvent.wheelDelta||e.originalEvent.detail);if(t!=null)return e.preventDefault(),e.type==="DOMMouseScroll"&&(t*=40),this.search_results.scrollTop(t+this.search_results.scrollTop())},n.prototype.blur_test=function(e){if(!this.active_field&&this.container.hasClass("chosen-container-active"))return this.close_field()},n.prototype.close_field=function(){return e(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},n.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},n.prototype.test_active_click=function(t){var n;return n=e(t.target).closest(".chosen-container"),n.length&&this.container[0]===n[0]?this.active_field=!0:this.close_field()},n.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=r.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},n.prototype.result_do_highlight=function(e){var t,n,r,i,s;if(e.length){this.result_clear_highlight(),this.result_highlight=e,this.result_highlight.addClass("highlighted"),r=parseInt(this.search_results.css("maxHeight"),10),s=this.search_results.scrollTop(),i=r+s,n=this.result_highlight.position().top+this.search_results.scrollTop(),t=n+this.result_highlight.outerHeight();if(t>=i)return this.search_results.scrollTop(t-r>0?t-r:0);if(n<s)return this.search_results.scrollTop(n)}},n.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},n.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},n.prototype.update_results_content=function(e){return this.search_results.html(e)},n.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},n.prototype.set_tab_index=function(e){var t;if(this.form_field.tabIndex)return t=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=t},n.prototype.set_label_behavior=function(){var t=this;this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=e("label[for='"+this.form_field.id+"']"));if(this.form_field_label.length>0)return this.form_field_label.bind("click.chosen",function(e){return t.is_multiple?t.container_mousedown(e):t.activate_field()})},n.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},n.prototype.search_results_mouseup=function(t){var n;n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first();if(n.length)return this.result_highlight=n,this.result_select(t),this.search_field.focus()},n.prototype.search_results_mouseover=function(t){var n;n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first();if(n)return this.result_do_highlight(n)},n.prototype.search_results_mouseout=function(t){if(e(t.target).hasClass("active-result"))return this.result_clear_highlight()},n.prototype.choice_build=function(t){var n,r,i=this;return n=e("<li />",{"class":"search-choice"}).html("<span>"+t.html+"</span>"),t.disabled?n.addClass("search-choice-disabled"):(r=e("<a />",{"class":"search-choice-close","data-option-array-index":t.array_index}),r.bind("click.chosen",function(e){return i.choice_destroy_link_click(e)}),n.append(r)),this.search_container.before(n)},n.prototype.choice_destroy_link_click=function(t){t.preventDefault(),t.stopPropagation();if(!this.is_disabled)return this.choice_destroy(e(t.target))},n.prototype.choice_destroy=function(e){if(this.result_deselect(e[0].getAttribute("data-option-array-index")))return this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),e.parents("li").first().remove(),this.search_field_scale()},n.prototype.results_reset=function(){this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change");if(this.active_field)return this.results_hide()},n.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},n.prototype.result_select=function(e){var t,n;if(this.result_highlight)return t=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?t.removeClass("active-result"):this.reset_single_select_options(),n=this.results_data[t[0].getAttribute("data-option-array-index")],n.selected=!0,this.form_field.options[n.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(n):this.single_set_selected_text(n.text),(!e.metaKey&&!e.ctrlKey||!this.is_multiple)&&this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[n.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale())},n.prototype.single_set_selected_text=function(e){return e==null&&(e=this.default_text),e===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").text(e)},n.prototype.result_deselect=function(e){var t;return t=this.results_data[e],this.form_field.options[t.options_index].disabled?!1:(t.selected=!1,this.form_field.options[t.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[t.options_index].value}),this.search_field_scale(),!0)},n.prototype.single_deselect_control_build=function(){if(!this.allow_single_deselect)return;return this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")},n.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html()},n.prototype.winnow_results_set_highlight=function(){var e,t;t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),e=t.length?t.first():this.search_results.find(".active-result").first();if(e!=null)return this.result_do_highlight(e)},n.prototype.no_results=function(t){var n;return n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),n.find("span").first().html(t),this.search_results.append(n),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},n.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},n.prototype.keydown_arrow=function(){var e;if(!this.results_showing||!this.result_highlight)return this.results_show();e=this.result_highlight.nextAll("li.active-result").first();if(e)return this.result_do_highlight(e)},n.prototype.keyup_arrow=function(){var e;if(!this.results_showing&&!this.is_multiple)return this.results_show();if(this.result_highlight)return e=this.result_highlight.prevAll("li.active-result"),e.length?this.result_do_highlight(e.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())},n.prototype.keydown_backstroke=function(){var e;if(this.pending_backstroke)return this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke();e=this.search_container.siblings("li.search-choice").last();if(e.length&&!e.hasClass("search-choice-disabled"))return this.pending_backstroke=e,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")},n.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},n.prototype.keydown_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode,this.search_field_scale(),t!==8&&this.pending_backstroke&&this.clear_backstroke();switch(t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(e),this.mouse_on_container=!1;break;case 13:this.results_showing&&e.preventDefault();break;case 32:this.disable_search&&e.preventDefault();break;case 38:e.preventDefault(),this.keyup_arrow();break;case 40:e.preventDefault(),this.keydown_arrow()}},n.prototype.search_field_scale=function(){var t,n,r,i,s,o,u,a,f;if(this.is_multiple){r=0,u=0,s="position:absolute; left: -1000px; top: -1000px; display:none;",o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(a=0,f=o.length;a<f;a++)i=o[a],s+=i+":"+this.search_field.css(i)+";";return t=e("<div />",{style:s}),t.text(this.search_field.val()),e("body").append(t),u=t.width()+25,t.remove(),n=this.container.outerWidth(),u>n-10&&(u=n-10),this.search_field.css({width:u+"px"})}},n}(t)}.call(this),define("deps/chosen.jquery",function(){}),function($){function Colorpicker(){this._mainDivId=mainDivId,this._colorDivClass=colorDivClass,this._defaults={showAnim:!0,duration:200,color:"FFFFFF",allowNull:!1,realtime:!0,invertControls:!0,controlStyle:"simple",swatches:!0,alpha:!1,alphaHex:!1,beforeShow:null,onClose:null,onSelect:null,onAddSwatch:null,onDeleteSwatch:null}}function extendRemove(e,t){$.extend(e,t);for(var n in t)if(t[n]==null||t[n]==undefined)e[n]=t[n];return e}function isset(e){return e!==undefined}var PROP_NAME="css3colorpicker",mainDivId="css3colorpicker-div",colorDivClass="color",cpDiv=$('<div id="'+mainDivId+'"></div>');cpDiv.swatchContainer=$('<div id="'+mainDivId+'-swatchContainer"></div>'),cpDiv.swatches=$('<div id="'+mainDivId+'-swatches"></div>'),cpDiv.addSwatchButton=$('<div id="'+mainDivId+'-add-swatch-button" title="Add Current Color to Swatches" class="tooltip"></div>'),cpDiv.colorDiv=$('<div id="'+mainDivId+'-color" title="Choose Color and Close Color Picker" class="tooltip"></div>'),cpDiv.oldColorDiv=$('<div id="'+mainDivId+'-colorOld" title="Revert to Previous Color" class="tooltip"></div>'),cpDiv.d1Div=$('<div id="'+mainDivId+'-1d"></div>'),cpDiv.d1Div.control=$('<div id="'+mainDivId+'-1dControl"></div>'),cpDiv.d1Div.colorDiv=$('<div id="'+mainDivId+'-1dColor"></div>'),cpDiv.d1Div.gradientDiv=$('<div id="'+mainDivId+'-1dGradient"></div>'),cpDiv.d2Div=$('<div id="'+mainDivId+'-2d"></div>'),cpDiv.d2Div.control=$('<div id="'+mainDivId+'-2dControl"></div>'),cpDiv.d2Div.colorDiv=$('<div id="'+mainDivId+'-2dColor"></div>'),cpDiv.d2Div.gradientDiv=$('<div id="'+mainDivId+'-2dGradient"></div>'),cpDiv.alphaDiv=$('<div id="'+mainDivId+'-alpha"></div>'),cpDiv.alphaDiv.control=$('<div id="'+mainDivId+'-alphaControl"></div>'),cpDiv.inputContainerHSB=$('<ul id="'+mainDivId+'-inputContainer-hsv" class="css3colorpicker-inputContainer"></ul>'),cpDiv.inputContainerRGBA=$('<ul id="'+mainDivId+'-inputContainer-rgba" class="css3colorpicker-inputContainer"></ul>'),cpDiv.inputContainerHex=$('<ul id="'+mainDivId+'-inputContainer-hex" class="css3colorpicker-inputContainer"></ul>'),cpDiv.inputs={h:$('<input type="text" data-mode="h" id="'+mainDivId+'-h"/>'),s:$('<input type="text" data-mode="s" id="'+mainDivId+'-s"/>'),v:$('<input type="text" data-mode="v" id="'+mainDivId+'-v"/>'),r:$('<input type="text" id="'+mainDivId+'-r"/>'),g:$('<input type="text" id="'+mainDivId+'-g"/>'),b:$('<input type="text" id="'+mainDivId+'-b"/>'),a:$('<input type="text" id="'+mainDivId+'-a"/>'),hex:$('<input type="text" id="'+mainDivId+'-hex" maxlength="8" />')},cpDiv.append($('<div id="'+mainDivId+'-container"></div>').append($('<div id="'+mainDivId+'-colorContainer"></div>').append(cpDiv.colorDiv,cpDiv.oldColorDiv),cpDiv.d1Div.append(cpDiv.d1Div.colorDiv,cpDiv.d1Div.gradientDiv,cpDiv.d1Div.control),cpDiv.d2Div.append(cpDiv.d2Div.colorDiv,cpDiv.d2Div.gradientDiv,cpDiv.d2Div.control),cpDiv.alphaDiv.append(cpDiv.alphaDiv.control),cpDiv.inputContainerHSB.append($("<li>H <span>&deg;</span></li>").append(cpDiv.inputs.h),$("<li>S <span>%</span></li>").append(cpDiv.inputs.s),$("<li>B <span>%</span></li>").append(cpDiv.inputs.v)),cpDiv.inputContainerRGBA.append($("<li>R </li>").append(cpDiv.inputs.r),$("<li>G </li>").append(cpDiv.inputs.g),$("<li>B </li>").append(cpDiv.inputs.b),$('<li class="alpha">A <span>%</span></li>').append(cpDiv.inputs.a)),cpDiv.inputContainerHex.append($("<li># </li>").append(cpDiv.inputs.hex))),cpDiv.swatchContainer.append(cpDiv.swatches,cpDiv.addSwatchButton)),$.extend(Colorpicker.prototype,{cpDiv:cpDiv,mode:"h",markerClassName:"hasColorpicker",controlsClassPrefix:"controls-",minLum:50,swatches:[],swatchLimit:15,setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_setMode:function(e){["h","s","v"].indexOf(e)>=0&&(this.cpDiv.removeClass("mode-"+this.mode),this.cpDiv.addClass("mode-"+e),this.mode=e,$.colorpicker._updateMaps(),$.colorpicker._updateControls())},refresh:function(){return this._updateColorpicker(!0),this},color:function(e){this.r=0,this.g=0,this.b=0,this.a=1,this.h=0,this.s=0,this.v=0,this.l=0,this.hex="",this.hexa="",this.rgb="rgb(0,0,0)",this.rgba="rgba(0,0,0,1)",this._a=1,this._h=0,this._s=0,this._v=0,this.setRgb=function(e,t,n,r){this.isNull=!1,this.r=Math.max(0,Math.min(255,Math.round(e))),this.g=Math.max(0,Math.min(255,Math.round(t))),this.b=Math.max(0,Math.min(255,Math.round(n))),this._a=isset(r)?Math.max(0,Math.min(100,parseFloat(r))):this._a||100,this.a=Math.round(this._a);var i=$.colorpicker.rgbToHsv(this);this._h=i.h,this._s=i.s,this._v=i.v,this.h=Math.round(i.h),this.s=Math.round(i.s),this.v=Math.round(i.v),this.l=$.colorpicker.rgbToLum(this),this.hex=$.colorpicker.rgbToHex(this),this.hexa=$.colorpicker.rgbToHex(this),this.rgb="rgb("+this.r+","+this.g+","+this.b+")",this.rgba="rgba("+this.r+","+this.g+","+this.b+","+this.a/100+")"},this.setHsv=function(e,t,n,r){this.isNull=!1,this._h=Math.max(0,Math.min(360,parseFloat(e))),this._s=Math.max(0,Math.min(100,parseFloat(t))),this._v=Math.max(0,Math.min(100,parseFloat(n))),this.h=Math.round(this._h),this.s=Math.round(this._s),this.v=Math.round(this._v),this._a=isset(r)?Math.max(0,Math.min(100,parseFloat(r))):this._a||100,this.a=Math.round(this._a);var i=$.colorpicker.hsvToRgb(this);this.r=Math.round(i.r),this.g=Math.round(i.g),this.b=Math.round(i.b),this.l=$.colorpicker.rgbToLum(this),this.hex=$.colorpicker.rgbToHex(i),this.hexa=$.colorpicker.rgbToHex(i),this.rgb="rgb("+this.r+","+this.g+","+this.b+")",this.rgba="rgba("+this.r+","+this.g+","+this.b+","+this.a/100+")"},this.setHex=function(e){this.isNull=!1,this.hexa=$.colorpicker.validateHex(e),this.hex=$.colorpicker.validateHex(e);var t=$.colorpicker.hexToRgb(this.hexa);this.r=t.r,this.g=t.g,this.b=t.b,this._a=t.a,this.a=Math.round(t.a);var n=$.colorpicker.rgbToHsv(t);this._h=n.h,this._s=n.s,this._v=n.v,this.h=Math.round(n.h),this.s=Math.round(n.s),this.v=Math.round(n.v),this.l=$.colorpicker.rgbToLum(this),this.rgb="rgb("+this.r+","+this.g+","+this.b+")",this.rgba="rgba("+this.r+","+this.g+","+this.b+","+this.a/100+")"};if(e)if("hexa"in e)this.setHex(e.hexa);else if("hex"in e)this.setHex(e.hex);else if("rgb"in e){var t=e.rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(0?\.?\d+))?\)/i);if(t){var n=100;typeof t[4]!="undefined"&&(n*=t[4]),this.setRgb(t[1],t[2],t[3],n)}}else"r"in e?this.setRgb(e.r,e.g,e.b,e.a):"h"in e&&this.setHsv(e.h,e.s,e.v,e.a);return this},_attachColorpicker:function(target,settings){var input=$(target);if(input.hasClass(this.markerClassName))return;input.addClass(this._colorDivClass).addClass(this.markerClassName),target.id||(this.uuid+=1,target.id="cp"+this.uuid);var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("color:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var inst=this._newInst(input);inst.settings=$.extend({},settings||{},inlineSettings||{}),this._get(inst,"alpha")?input.addClass("alpha")[inst.settings.alphaHex?"addClass":"removeClass"]("alphaHex"):input.removeClass("alpha").removeClass("alphaHex"),this._setColor(inst,input.val()||input.data("color")||this._get(inst,"color"),!0);var swatches=this._get(inst,"swatches");swatches&&this.addSwatch(swatches),input.is("input")&&input.focus(function(){$.colorpicker._showColorpicker(target)}).keyup(function(){$.colorpicker._setColor(inst,this.value),$.colorpicker._updateColorpicker()}).bind("setData.colorpicker",function(e,t,n){inst.settings[t]=n}).bind("getData.colorpicker",function(e,t){return $.colorpicker._get(inst,t)}),input.click(function(){$.colorpicker._showColorpicker(target)}).bind("refresh",function(){var e=$(this),t=$.colorpicker._getInst(this);$.colorpicker._setColor(t,input.val()||input.data("color")||$.colorpicker._get(t,"color").hexa,!0),$.colorpicker._updateColorpicker()})},_setColor:function(e,t,n){if(!t||t.isNull)t=new $.colorpicker.color({hex:this._defaults.color}),t.isNull=this._get(e,"allowNull");if(typeof t=="string"||typeof t=="number")t.match(/^rgb/)?t=new $.colorpicker.color({rgb:t}):t=new $.colorpicker.color({hex:t});e.settings.color=new $.colorpicker.color({hex:t.hexa}),this._isDragging||(e.color=new $.colorpicker.color({hex:t.hexa})),e.color.isNull=e.settings.color.isNull=t.isNull,this._updateTarget(e,n);if(!this._isLastColor(t)){e.lastColor=t.isNull?null:t.hexa;var r=this._get(e,"onSelect");typeof r=="function"&&r(t.isNull?null:t,e)}},_newInst:function(e){var t=e[0].id.replace(/([^F-Za-z0-9_-])/g,"\\\\$1"),n={id:t,input:e,cpDiv:cpDiv,color:new $.colorpicker.color,lastColor:null};return e.data(PROP_NAME,n),n},_checkExternalClick:function(e){if(!$.colorpicker._curInst)return;var t=$(e.target);t[0].id!=$.colorpicker._mainDivId&&!t.is('label[for="'+$.colorpicker._curInst.input[0].id+'"]')&&t.parents("#"+$.colorpicker._mainDivId).length==0&&!t.hasClass($.colorpicker.markerClassName)&&$.colorpicker._hideColorpicker()},_optionColorpicker:function(e,t,n){var r=this._getInst(e),i=!1;if(arguments.length==2&&typeof t=="string")return t=="defaults"?$.extend({},$.colorpicker._defaults):r?t=="all"?$.extend({},r.settings):this._get(r,t):null;r&&this._curInst==r&&(this._hideColorpicker(e,!0),i=!0);var s=t||{};if(typeof t=="string"){s={};if(r&&t=="color"&&isset(n)){var o=n?new this.color({hex:n}):new this.color({hex:this._defaults.color});o.isNull=!n&&this._get(r,"allowNull"),n=o,this._setColor(r,n,!0),this.addSwatch(n,!0)}t=="swatches"&&n&&this.addSwatch(n),s[t]=n}r&&extendRemove(r.settings,s),i&&this._showColorpicker(e,!0)},_showColorpicker:function(e,t){e=e.target||e;var n=$(e);if(e.disabled)return;var r=$.colorpicker._getInst(e);this._curInst&&this._curInst!=r&&(this._triggerOnClose(),this.cpDiv.stop(!0,!0)),this._curInst=r,r.lastColor=r.color.isNull?null:r.color.hexa;var i=this._get(r,"alpha");$.colorpicker._updateColorpicker(),r.input.addClass("selected");var s=!t&&this._get(r,"showAnim"),o=this._get(r,"duration"),u=function(){$.colorpicker.cpDiv.addClass("visible")},a=$.colorpicker._get(r,"controlStyle").split(/\s+/);for(var f=0;f<a.length;f++)cpDiv.addClass(this.controlsClassPrefix+a[f]);cpDiv[i?"addClass":"removeClass"]("alphaOn"),cpDiv[this._get(r,"swatches")?"addClass":"removeClass"]("swatchesOn"),this.cpDiv.oldColorDiv.data("color",r.color.isNull?null:r.color.hexa).css("background-color",r.color[i?"rgba":"rgb"]);var l=this._get(r,"beforeShow");typeof l=="function"&&l(r.input,r),this._colorpickerShowing=!0,this.cpDiv[s?"fadeIn":"show"](s?o:null,u),s||u(),this._positionColorpicker()},_positionColorpicker:function(){var e=$.colorpicker._curInst.input,t=this.cpDiv,n=e.offset(),r=t.outerWidth(),i=t.defaultHeight+(this._get(this._getInst(e),"alpha")?t.alphaHeight:0)+(this._get(this._getInst(e),"swatches")?t.swatchHeight:0),s=$(window).width(),o=$(window).height(),u=10;i+=u,n.left+=e.outerWidth()+u,n.top+i>o&&(n.top=o-i),n.left+r>s&&(n.left=s-r),t.css({top:0,left:0}).offset(n)},_hideColorpicker:function(e,t){var n=this._curInst;if(!n||e&&n!=this._getInst(e))return;var r=function(){$.colorpicker._triggerOnClose(),$.colorpicker._curInst=null};if(this._colorpickerShowing){var i=!t&&this._get(n,"showAnim"),s=this._get(n,"duration");this.cpDiv[i?"fadeOut":"hide"](i?s:null,r),i||r(),this.cpDiv.removeClass("visible"),this._colorpickerShowing=!1;var o=this._get(n,"onClose");typeof o=="function"&&o(n.color,n)}else r()},_triggerOnClose:function(){var e=this._curInst;if(!e)return;e.input.removeClass("selected"),$.colorpicker.addSwatch(e.color,!0),this._setColor(e,e.color),cpDiv.removeClass(this.controlsClassPrefix+"invert");var t=$.colorpicker._get(e,"controlStyle").split(/\s+/);for(var n=0;n<t.length;n++)cpDiv.removeClass(this.controlsClassPrefix+t[n])},_updateColorpicker:function(e){var t=this._curInst;if(!t)return;var n=this._get(t,"alpha");this.cpDiv.colorDiv.data("color",t.color.isNull?null:t.color.hexa).css("background-color",t.color[n?"rgba":"rgb"]),cpDiv.d2Div.control.css("background-color",t.color.rgb),$.colorpicker._updateInputs(e),$.colorpicker._updateMaps(),$.colorpicker._updateControls(),this._get(t,"realtime")&&this._setColor(t,t.color,e)},_updateTarget:function(e,t){var n=this._get(e,"alpha"),r=this._get(e,"alphaHex");e.color.isNull?e.input.parent().addClass("color-null"):e.input.css({backgroundColor:e.color[n?"rgba":"rgb"],color:e.color.l<$.colorpicker.minLum?"#fff":"#000"}).parent().removeClass("color-null"),e.input.data("color",e.color.isNull?null:e.color.hexa);if(t||!e.input.is(":focus")){var i=e.input.val()||"";e.color.isNull?e.input.val(""):e.input.val(i.indexOf("#")>=0?"#"+e.color[r?"hexa":"hex"]:e.color[r?"hexa":"hex"]),i!=e.input.val()&&e.input.trigger("change")}},_updateInputs:function(e){var t=this._curInst;if(!t)return;var n=this._get(t,"alphaHex");for(var r in this.cpDiv.inputs)r&&isset(t.color[r])&&(e||!this.cpDiv.inputs[r].is(":focus"))&&(r=="hex"?this.cpDiv.inputs[r].val(t.color.isNull?"":t.color[n?"hexa":r]):this.cpDiv.inputs[r].val(t.color[r]))},_updateMaps:function(){var e=this._curInst;if(!e)return;this.cpDiv.alphaDiv.css("background-color",e.color.rgb);switch(this.mode){case"h":this.cpDiv.d1Div.gradientDiv.css("background",""),this.cpDiv.d2Div.colorDiv.css("background-color",(new this.color({h:e.color.h,s:100,v:100})).rgb),this.cpDiv.d1Div.gradientDiv.css("opacity",1-e.color.v/100),this.cpDiv.d1Div.colorDiv.css("opacity",e.color.s/100),this.cpDiv.d2Div.colorDiv.css("opacity",1),this.cpDiv.d2Div.gradientDiv.css("opacity",1);break;case"s":this.cpDiv.d1Div.colorDiv.css("background-color",(new this.color({h:e.color.h,s:100,v:100})).rgb),this.cpDiv.d1Div.gradientDiv.css("opacity",1-e.color.v/100),this.cpDiv.d1Div.colorDiv.css("opacity",1),this.cpDiv.d2Div.colorDiv.css("opacity",e.color.s/100),this.cpDiv.d2Div.gradientDiv.css("opacity",1);break;case"v":this.cpDiv.d1Div.gradientDiv.css("background",""),this.cpDiv.d1Div.colorDiv.css("background-color",(new this.color({h:e.color.h,s:e.color.s,v:100})).rgb),this.cpDiv.d1Div.gradientDiv.css("opacity",1),this.cpDiv.d1Div.colorDiv.css("opacity",1),this.cpDiv.d2Div.colorDiv.css("opacity",1),this.cpDiv.d2Div.gradientDiv.css("opacity",1-e.color.v/100)}$.colorpicker._updateControl()},_updateControls:function(){if(!this._curInst||this._isDragging)return;var e=this._curInst,t,n,r,i;switch(this.mode){case"h":t=e.color._s*255/100,n=255-e.color._v*255/100,r=255-e.color._h*255/360,i=e.color._a*255/100;break;case"s":t=e.color._h*255/360,n=255-e.color._v*255/100,r=255-e.color._s*255/100,i=e.color._a*255/100;break;case"v":t=e.color._h*255/360,n=255-e.color._s*255/100,r=255-e.color._v*255/100,i=e.color._a*255/100}$.colorpicker._moveControl1d(r,!0),$.colorpicker._moveControl2d(t,n,!0),$.colorpicker._moveControlAlpha(i,!0)},_moveControl1d:function(e,t){if(!$.colorpicker._curInst)return;var n=$.colorpicker._curInst;cpDiv.d1Div.control.css({top:Math.max(0,Math.min(255,Math.round(e)))+"px"});if(!t){switch($.colorpicker.mode){case"h":e=360-e*360/256;break;case"s":case"v":e=100-e*100/256}n.color["_"+$.colorpicker.mode]=e,n.color.setHsv(n.color._h,n.color._s,n.color._v,n.color.a),$.colorpicker._updateColorpicker(!0)}},_moveControl2d:function(e,t,n){if(!$.colorpicker._curInst)return;var r=$.colorpicker._curInst;cpDiv.d2Div.control.css({left:Math.max(0,Math.min(255,Math.round(e)))+"px",top:Math.max(0,Math.min(255,Math.round(t)))+"px"});if(!n){switch($.colorpicker.mode){case"h":e=e*100/256,t=100-t*100/256,r.color._s=e,r.color._v=t;break;case"s":case"v":e=e*360/256,t=100-t*100/256,r.color._h=e,r.color[$.colorpicker.mode=="s"?"_v":"_s"]=t}r.color.setHsv(r.color._h,r.color._s,r.color._v,r.color.a),$.colorpicker._updateColorpicker(!0)}},_moveControlAlpha:function(e,t){if(!$.colorpicker._curInst)return;var n=$.colorpicker._curInst;cpDiv.alphaDiv.control.css({left:Math.max(0,Math.min(255,parseInt(e)))+"px"}),t||(e*=.390625,n.color.a=e,n.color.setHsv(n.color._h,n.color._s,n.color._v,n.color.a),$.colorpicker._updateColorpicker(!0))},_mousemoveControl1d:function(e){return $.colorpicker._moveControl1d(e.pageY-$.colorpicker.cpDiv.d1Div.offset().top),e.preventDefault(),!1},_mousemoveControl2d:function(e){var t=$.colorpicker.cpDiv.d2Div.offset();return $.colorpicker._moveControl2d(e.pageX-t.left,e.pageY-t.top),e.preventDefault(),!1},_mousemoveControlAlpha:function(e){return $.colorpicker._moveControlAlpha(e.pageX-$.colorpicker.cpDiv.alphaDiv.offset().left),e.preventDefault(),!1},_updateControl:function(){if(!this._curInst||!$.colorpicker._get(this._curInst,"invertControls"))return!1;this._curInst.color.l<$.colorpicker.minLum?cpDiv.addClass(this.controlsClassPrefix+"invert"):cpDiv.removeClass(this.controlsClassPrefix+"invert")},_submit:function(e,t){var n=this._curInst;if(!n)return;if(!isset(e))var e=n.color,r=e.isNull&&this._get(n,"allowNull");else if(!e){var r=this._get(n,"allowNull");e=this._defaults.color}typeof e=="string"||typeof e=="number"?(e=new this.color({hex:e}),this._get(n,"alpha")||(e.a=e._a=100)):e=new this.color({hex:e[this._get(n,"alpha")?"hexa":"hex"]}),e.isNull=r,this._isCurrentColor(e)?($.colorpicker._hideColorpicker(),t=!0):($.colorpicker._setColor(n,e,!0),$.colorpicker._updateColorpicker(!0)),$.colorpicker.addSwatch(e,t)},_isCurrentColor:function(e){var t=this._curInst;if(!t)return;if(!e||e.isNull)return t.settings.color.isNull&&t.color.isNull;if(typeof e=="string"||typeof e=="number")e=new this.color({hex:e});return this._get(t,"alpha")?e.hexa==t.settings.color.hexa&&e.hexa==t.color.hexa:e.hex==t.settings.color.hex&&e.hex==t.color.hex},_isLastColor:function(e){var t=this._curInst;if(!t)return;if(!e||e.isNull)return t.lastColor===null;var n=new this.color({hex:t.lastColor});if(typeof e=="string"||typeof e=="number")e=new this.color({hex:e});return this._get(t,"alpha")?e.hexa==n.hexa:e.hex==n.hex},addSwatch:function(e,t){var n=this._curInst;if(n&&!this._get(n,"swatches")||!e||e.isNull)return!1;if(typeof e=="string"||typeof e=="number")e=new this.color({hex:e});if(e.hexa){var r=this.swatches.indexOf(e.hexa);if(r<0){this.swatches.unshift(e.hexa);var i=$("<div/>").addClass("swatch").attr("title","Right-click to delete swatch").data("color",e.hexa).css({backgroundColor:e.rgb,width:0,opacity:0}).append($("<div/>").css("background",e.rgba));window.setTimeout(function(){i.css({width:"",opacity:1})},0),this.cpDiv.swatches.prepend(i)}else{if(t)return!1;this.swatches.splice(r,1),this.swatches.unshift(e.hexa),this.cpDiv.swatches.prepend(this.cpDiv.swatches.children().eq(r))}this.swatchLimit&&(this.swatches=this.swatches.slice(0,this.swatchLimit));var s=n?this._get(n,"onAddSwatch"):this._defaults.onAddSwatch;typeof s=="function"&&s(e,this.swatches)}else if(e.length&&e[0])for(var o=e.length-1;o>=0;o--)this.addSwatch(e[o]);return this},deleteSwatch:function(e){var e=$(e);if(typeof e!="object"||!e||!e.length)return!1;this.swatches.splice(this.swatches.indexOf(e.data("color")),1);var t=this._curInst,n=t?this._get(t,"onDeleteSwatch"):this._defaults.onDeleteSwatch;typeof n=="function"&&n(e.data("color"),this.swatches),e.remove()},clearSwatches:function(){return this.swatches=[],this.cpDiv.swatches.empty(),this},_useSwatch:function(e){return $.colorpicker._setColor($.colorpicker._curInst,$(this).data("color")),$.colorpicker._updateColorpicker(),e.preventDefault(),!1},_get:function(e,t){return isset(e.settings[t])?e.settings[t]:this._defaults[t]},_getInst:function(e){try{return $(e).data(PROP_NAME)}catch(t){throw"Missing instance data for this colorpicker"}},hexToRgb:function(e){e=this.validateHex(e);var t="00",n="00",r="00";return e.length==6&&(a="FF",t=e.substring(0,2),n=e.substring(2,4),r=e.substring(4,6)),e.length==8&&(a=e.substring(0,2),t=e.substring(2,4),n=e.substring(4,6),r=e.substring(6,8)),{r:this.hexToInt(t),g:this.hexToInt(n),b:this.hexToInt(r),a:100*this.hexToInt(a)/255}},_hexRegExp:/[a-f0-9]{0,2}([a-f0-9]{6})|[a-f0-9]?([a-f0-9]{3})/i,_hexaRegExp:/([a-f0-9]{8}|[a-f0-9]{6}|[a-f0-9]{4}|[a-f0-9]{3})/i,validateHex:function(e){return e?(e=(""+e).match(this._hexaRegExp),e=e?e[1]||e[2]:"00000000",e=e.toUpperCase(),e.length==3&&(e=e.split(""),e=[e[0],e[0],e[1],e[1],e[2],e[2]].join("")),e.length==4&&(e=e.split(""),e=[e[0],e[0],e[1],e[1],e[2],e[2],e[3],e[3]].join("")),e.length!=8&&(e="FF"+e),e.substring(0,2)=="FF"&&(e=e.substring(2,8)),e):!1},rgbToHex:function(e){var t=this.intToHex(Math.round(e.a*255/100));t=="FF"&&(t="");var n=this.intToHex(e.r)+this.intToHex(e.g)+this.intToHex(e.b);return t+n},intToHex:function(e){var t=parseInt(e).toString(16);return t.length==1&&(t="0"+t),t.toUpperCase()},hexToInt:function(e){return parseInt(e,16)},rgbToLum:function(e){return Math.abs(Math.round((.2126*e.r+.7152*e.g+.0722*e.b)/2.55))},rgbToHsv:function(e){var t=e.r/255,n=e.g/255,r=e.b/255;hsv={h:0,s:0,v:0,a:isset(e._a)?e._a:e.a};var i=0,s=0;return t>=n&&t>=r?(s=t,i=n>r?r:n):n>=r&&n>=t?(s=n,i=t>r?r:t):(s=r,i=n>t?t:n),hsv.v=s,hsv.s=s?(s-i)/s:0,hsv.s?(delta=s-i,t==s?hsv.h=(n-r)/delta:n==s?hsv.h=2+(r-t)/delta:hsv.h=4+(t-n)/delta,hsv.h=hsv.h*60,hsv.h<0&&(hsv.h+=360)):hsv.h=0,hsv.s=Math.abs(hsv.s*100),hsv.v=Math.abs(hsv.v*100),hsv},hsvToRgb:function(e){rgb={r:0,g:0,b:0,a:isset(e._a)?e._a:e.a};var t=isset(e._h)?e._h:e.h,n=isset(e._s)?e._s:e.s,r=isset(e._v)?e._v:e.v;if(n==0)r==0?rgb.r=rgb.g=rgb.b=0:rgb.r=rgb.g=rgb.b=Math.abs(r*255/100);else{t==360&&(t=0),t/=60,n/=100,r/=100;var i=parseInt(t),s=t-i,o=r*(1-n),u=r*(1-n*s),a=r*(1-n*(1-s));switch(i){case 0:rgb.r=r,rgb.g=a,rgb.b=o;break;case 1:rgb.r=u,rgb.g=r,rgb.b=o;break;case 2:rgb.r=o,rgb.g=r,rgb.b=a;break;case 3:rgb.r=o,rgb.g=u,rgb.b=r;break;case 4:rgb.r=a,rgb.g=o,rgb.b=r;break;case 5:rgb.r=r,rgb.g=o,rgb.b=u}rgb.r=Math.abs(Math.round(rgb.r*255)),rgb.g=Math.abs(Math.round(rgb.g*255)),rgb.b=Math.abs(Math.round(rgb.b*255))}return rgb}}),$.fn.colorpicker=function(e){if(!this.length)return this;if(!$.colorpicker.initialized){$(document).mousedown($.colorpicker._checkExternalClick).find("body").append($.colorpicker.cpDiv.hide()).find("#"+mainDivId+"-"+$.colorpicker.mode).closest("li").addClass("selected");for(var t in cpDiv.inputs)if(t){var n=$(cpDiv.inputs[t]);n.data("mode")&&n.focus(function(){var e=$(this);e.closest("li").addClass("selected").siblings(".selected").removeClass("selected"),$.colorpicker._setMode(e.data("mode"))}).closest("li").click(function(){$(this).find("input").focus()}),n.blur(function(){$.colorpicker._updateInputs()});switch(t){case"h":case"s":case"v":case"a":n.keydown(function(e){if(!$.colorpicker._curInst)return;var t=$(this),n=$.colorpicker._curInst;switch(e.keyCode){case 38:case 40:t.val(parseInt(t.val())+(e.shiftKey?10:1)*(e.keyCode==40?-1:1)),n.color.setHsv(cpDiv.inputs.h.val(),cpDiv.inputs.s.val(),cpDiv.inputs.v.val(),cpDiv.inputs.a.val()),$.colorpicker._updateColorpicker(!0);break;case 13:$.colorpicker._submit();break;default:return}}).keyup(function(){if(!$.colorpicker._curInst)return;$.colorpicker._curInst.color.setHsv(cpDiv.inputs.h.val(),cpDiv.inputs.s.val(),cpDiv.inputs.v.val(),cpDiv.inputs.a.val()),$.colorpicker._updateColorpicker()});break;case"r":case"g":case"b":n.keydown(function(e){if(!$.colorpicker._curInst)return;var t=$(this),n=$.colorpicker._curInst;switch(e.keyCode){case 38:case 40:t.val(parseInt(t.val())+(e.shiftKey?10:1)*(e.keyCode==40?-1:1)),n.color.setRgb(cpDiv.inputs.r.val(),cpDiv.inputs.g.val(),cpDiv.inputs.b.val(),cpDiv.inputs.a.val()),$.colorpicker._updateColorpicker(!0);break;case 13:$.colorpicker._submit();break;default:return}}).keyup(function(){if(!$.colorpicker._curInst)return;$.colorpicker._curInst.color.setRgb(cpDiv.inputs.r.val(),cpDiv.inputs.g.val(),cpDiv.inputs.b.val(),cpDiv.inputs.a.val()),$.colorpicker._updateColorpicker()});break;case"hex":n.keydown(function(e){if(!$.colorpicker._curInst)return;switch(e.keyCode){case 13:$.colorpicker._submit();break;default:return}}).keyup(function(){var e=$.colorpicker._curInst;if(!e)return;cpDiv.inputs.hex.val()?(e.color.setHex(cpDiv.inputs.hex.val()),$.colorpicker._updateColorpicker()):(e.color=new $.colorpicker.color({hex:$.colorpicker._defaults.color}),e.color.isNull=$.colorpicker._get(e,"allowNull"),$.colorpicker._updateColorpicker())})}}cpDiv.addSwatchButton.mousedown(function(e){$.colorpicker.addSwatch($.colorpicker._curInst.color)}),cpDiv.swatches.delegate(".swatch","click",function(e){var t=$.proxy($.colorpicker._useSwatch,this);t(e),e.preventDefault()}),cpDiv.swatches.delegate(".swatch","contextmenu",function(e){return confirm("Are you sure you wish to delete this swatch?")&&$.colorpicker.deleteSwatch(this),e.preventDefault(),!1}),cpDiv.oldColorDiv.mousedown($.colorpicker._useSwatch),cpDiv.colorDiv.mousedown(function(e){return $.colorpicker._submit($(this).data("color")),e.preventDefault(),!1}),cpDiv.defaultHeight=cpDiv.outerHeight(),cpDiv.addClass("swatchesOn"),cpDiv.swatchHeight=cpDiv.outerHeight()-cpDiv.defaultHeight,cpDiv.removeClass("swatchesOn").addClass("alphaOn"),cpDiv.alphaHeight=cpDiv.outerHeight()-cpDiv.defaultHeight,cpDiv.removeClass("alphaOn"),cpDiv.d1Div.mousedown(function(e){return $.colorpicker._isDragging=!0,$.colorpicker._mousemoveControl1d(e),$(document).bind("mousemove",$.colorpicker._mousemoveControl1d),!1}),cpDiv.d2Div.mousedown(function(e){return $.colorpicker._isDragging=!0,$.colorpicker._mousemoveControl2d(e),$(document).bind("mousemove",$.colorpicker._mousemoveControl2d),!1}),cpDiv.alphaDiv.mousedown(function(e){return $.colorpicker._isDragging=!0,$.colorpicker._mousemoveControlAlpha(e),$(document).bind("mousemove",$.colorpicker._mousemoveControlAlpha),!1}),$(document).mouseup(function(){return $(document).unbind("mousemove",$.colorpicker._mousemoveControl1d).unbind("mousemove",$.colorpicker._mousemoveControl2d).unbind("mousemove",$.colorpicker._mousemoveControlAlpha),$.colorpicker._isDragging=!1,!1}),$(window).resize(function(){$.colorpicker._colorpickerShowing&&$.colorpicker._positionColorpicker()}),$.colorpicker._setMode($.colorpicker.mode),$.colorpicker.initialized=!0}var r=Array.prototype.slice.call(arguments,1);return e=="option"&&arguments.length==2&&typeof arguments[1]=="string"?$.colorpicker["_"+e+"Colorpicker"].apply($.colorpicker,[this[0]].concat(r)):this.each(function(){typeof e=="string"?$.colorpicker["_"+e+"Colorpicker"].apply($.colorpicker,[this].concat(r)):$.colorpicker._attachColorpicker(this,e)})},$.colorpicker=new Colorpicker,$.colorpicker.initialized=!1,$.colorpicker.uuid=(new Date).getTime()}(jQuery),define("deps/colorpicker",function(){}),define("util.image-uploader",["jquery","underscore"],function(e,t){openImageUploader=function(t){if(!boxExists("input-image")){isNaN(Headway.viewModels.layoutSelector.currentLayout())&&(iframePostID=0);var n={id:"input-image",title:"Select an image",description:"Upload or select an image",src:Headway.homeURL+"/?headway-trigger=media-uploader",load:function(){initiateImageUploader(t)},width:e(window).width()-200,height:e(window).height()-200,center:!0,draggable:!1,deleteWhenClosed:!0,blackOverlay:!0},r=createBox(n);e("#box-input-image").css({width:"auto",height:"auto",top:"70px",left:"70px",right:"70px",bottom:"70px",margin:0})}openBox("input-image")},initiateImageUploader=function(n){if(!e("#box-input-image iframe").length||typeof e("#box-input-image iframe")[0].contentWindow.wp=="undefined"||typeof e("#box-input-image iframe")[0].contentWindow.wp.media=="undefined"||typeof e("#box-input-image iframe")[0].contentWindow.wp.media()=="undefined")return setTimeout(function(){initiateImageUploader(n)},100);wpMedia=e("#box-input-image iframe")[0].contentWindow.wp.media;var r=Headway.viewModels.layoutSelector.currentLayout().split("-");return t.first(r)=="single"&&!isNaN(t.last(r))&&(wpMedia.model.settings.post.id=t.last(r)),wpMedia.frames={file_frame:wpMedia({title:"",button:{text:"Use Image"},multiple:!1})},wpMedia.frames.file_frame.on("select",function(){attachment=wpMedia.frames.file_frame.state().get("selection").first().toJSON();if(typeof e=="undefined")var e=attachment.url;var t=e.split("/")[e.split("/").length-1];n(e,t),parent.closeBox("input-image",!0)}),wpMedia.frames.file_frame.on("escape",function(){parent.closeBox("input-image",!0)}),wpMedia.frames.file_frame.open()}}),function(e){"use strict";function n(e,t){return new n.prototype.init(e,t)}Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e)}});var t=0;e.fn.redactor=function(t){var r=[],i=Array.prototype.slice.call(arguments,1);return typeof t=="string"?this.each(function(){var n=e.data(this,"redactor"),s;t.search(/\./)!="-1"?(s=t.split("."),typeof n[s[0]]!="undefined"&&(s=n[s[0]][s[1]])):s=n[t];if(typeof n!="undefined"&&e.isFunction(s)){var o=s.apply(n,i);o!==undefined&&o!==n&&r.push(o)}else e.error('No such method "'+t+'" for Redactor')}):this.each(function(){e.data(this,"redactor",{}),e.data(this,"redactor",n(this,t))}),r.length===0?this:r.length===1?r[0]:r},e.Redactor=n,e.Redactor.VERSION="10.2.1",e.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils"],e.Redactor.opts={lang:"en",direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,autosaveFields:!1,linkTooltip:!0,linkProtocol:"http",linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:"10px",imageResizable:!0,imageUpload:null,imageUploadParam:"file",uploadImageField:!1,dragImageUpload:!0,fileUpload:null,fileUploadParam:"file",dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,source:!0,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["script","style"],allowedTags:!1,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],removeComments:!1,replaceTags:[["strike","del"],["b","strong"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],highContrast:!1,observe:{dropdowns:[]},langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}},linkify:{regexps:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/ig,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,image:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/ig,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/ig}},codemirror:!1},n.fn=e.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(n,r){this.$element=e(n),this.uuid=t++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(r),this.loadModules(),this.formatting={},e.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed();if(this.opts.deniedTags!==!1){var i=["html","head","link","body","meta","applet"];for(var s=0;s<i.length;s++)this.opts.deniedTags.push(i[s])}this.lang.load(),e.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(t){this.opts=e.extend({},e.extend(!0,{},e.Redactor.opts),this.$element.data(),t)},getModuleMethods:function(e){return Object.getOwnPropertyNames(e).filter(function(t){return typeof e[t]=="function"})},loadModules:function(){var t=e.Redactor.modules.length;for(var n=0;n<t;n++)this.bindModuleMethods(e.Redactor.modules[n])},bindModuleMethods:function(e){if(typeof this[e]=="undefined")return;this[e]=this[e]();var t=this.getModuleMethods(this[e]),n=t.length;for(var r=0;r<n;r++)this[e][t[r]]=this[e][t[r]].bind(this)},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(e){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save(),this.alignment.blocks=this.selection.getBlocks(),this.alignment.type=e,this.alignment.isLinebreaksOrNoBlocks()?this.alignment.setText():this.alignment.setBlocks(),this.selection.restore(),this.code.sync()},setText:function(){var t=this.selection.wrap("div");e(t).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){e.each(this.alignment.blocks,e.proxy(function(e,t){var n=this.utils.getAlignmentElement(t);if(!n)return;this.alignment.isNeedReplaceElement(n)?this.alignment.replaceElement(n):this.alignment.alignElement(n)},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&this.alignment.blocks[0]===!1},isNeedReplaceElement:function(e){return this.alignment.type===""&&typeof e.data("tagblock")!="undefined"},replaceElement:function(e){e.replaceWith(e.html())},alignElement:function(e){e.css("text-align",this.alignment.type),this.utils.removeEmptyAttr(e,"style")}}},autosave:function(){return{html:!1,enable:function(){if(!this.opts.autosave)return;this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name");if(this.opts.autosaveOnChange)return;this.autosaveInterval=setInterval(this.autosave.load,this.opts.autosaveInterval*1e3)},onChange:function(){if(!this.opts.autosaveOnChange)return;this.autosave.load()},load:function(){this.autosave.source=this.code.get();if(this.autosave.html===this.autosave.source)return;var t={};t.name=this.autosave.name,t[this.autosave.name]=this.autosave.source,t=this.autosave.getHiddenFields(t);var n=e.ajax({url:this.opts.autosave,type:"post",data:t});n.done(this.autosave.success)},getHiddenFields:function(t){return this.opts.autosaveFields===!1||typeof this.opts.autosaveFields!="object"?t:(e.each(this.opts.autosaveFields,e.proxy(function(n,r){r!==null&&r.toString().indexOf("#")===0&&(r=e(r).val()),t[n]=r},this)),t)},success:function(t){var n;try{n=e.parseJSON(t)}catch(r){n=t}var i=typeof n.error=="undefined"?"autosave":"autosaveError";this.core.setCallback(i,this.autosave.name,n),this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(e){this.block.clearStyle=!1;var t,n;typeof this.formatting[e].data!="undefined"?t="data":typeof this.formatting[e].attr!="undefined"?t="attr":typeof this.formatting[e]["class"]!="undefined"&&(t="class"),typeof this.formatting[e].clear!="undefined"&&(this.block.clearStyle=!0),t&&(n=this.formatting[e][t]),this.block.format(this.formatting[e].tag,t,n)},format:function(t,n,r){t=="quote"&&(t="blockquote");var i=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];if(e.inArray(t,i)==-1)return;this.block.isRemoveInline=t=="pre"||t.search(/h[1-6]/i)!=-1,this.utils.browser("msie")||this.$editor.focus();var s=e.trim(this.$editor.html());this.block.isEmpty=this.utils.isEmpty(s);if(this.utils.browser("mozilla")&&!this.focus.isFocused()&&this.block.isEmpty){var o;this.opts.linebreaks||(o=this.$editor.children().first(),this.caret.setEnd(o))}this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=n,this.block.value=r,this.buffer.set(),this.selection.save(),this.block.set(t),this.selection.restore(),this.code.sync()},set:function(e){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(e):this.block.setMultiple(e)},setCollapsed:function(t){if(this.opts.linebreaks&&this.block.isEmpty&&t!="p"){var n=document.createElement(t);this.$editor.html(n),this.caret.setEnd(n);return}var r=this.block.blocks[0];if(r===!1)return;if(r.tagName=="LI"){if(t!="blockquote")return;this.block.formatListToBlockquote();return}var i=this.block.containerTag=="TD"||this.block.containerTag=="TH";if(i&&!this.opts.linebreaks)document.execCommand("formatblock",!1,"<"+t+">"),r=this.selection.getBlock(),this.block.toggle(e(r));else if(r.tagName.toLowerCase()!=t)if(this.opts.linebreaks&&t=="p")e(r).append("<br>"),this.utils.replaceWithContents(r);else{var s=this.utils.replaceToTag(r,t);this.block.toggle(s),t!="p"&&t!="blockquote"&&s.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(s),(t=="p"||this.block.headTag)&&s.find("p").contents().unwrap(),this.block.formatTableWrapping(s)}else if(t=="blockquote"&&r.tagName.toLowerCase()==t)if(this.opts.linebreaks)e(r).append("<br>"),this.utils.replaceWithContents(r);else{var o=this.utils.replaceToTag(r,"p");this.block.toggle(o)}else r.tagName.toLowerCase()==t&&this.block.toggle(e(r));typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"&&e(r).removeAttr("class").removeAttr("style")},setMultiple:function(t){var n=this.block.blocks[0],r=this.block.containerTag=="TD"||this.block.containerTag=="TH";if(n!==!1&&this.block.blocksSize===1)if(n.tagName.toLowerCase()==t&&t=="blockquote")if(this.opts.linebreaks)e(n).append("<br>"),this.utils.replaceWithContents(n);else{var i=this.utils.replaceToTag(n,"p");this.block.toggle(i)}else if(n.tagName=="LI"){if(t!="blockquote")return;this.block.formatListToBlockquote()}else if(this.block.containerTag=="BLOCKQUOTE")this.block.formatBlockquote(t);else if(this.opts.linebreaks&&(r||this.range.commonAncestorContainer!=n))this.block.formatWrap(t);else if(this.opts.linebreaks&&t=="p")e(n).prepend("<br>").append("<br>"),this.utils.replaceWithContents(n);else if(n.tagName==="TD")this.block.formatWrap(t);else{var s=this.utils.replaceToTag(n,t);this.block.toggle(s),this.block.isRemoveInline&&this.utils.removeInlineTags(s),(t=="p"||this.block.headTag)&&s.find("p").contents().unwrap()}else if(this.opts.linebreaks||t!="p"){if(t=="blockquote"){var o=0;for(var u=0;u<this.block.blocksSize;u++)this.block.blocks[u].tagName=="BLOCKQUOTE"&&o++;if(o==this.block.blocksSize){e.each(this.block.blocks,e.proxy(function(t,n){var r=!1;this.opts.linebreaks?(e(n).prepend("<br>").append("<br>"),r=this.utils.replaceWithContents(n)):r=this.utils.replaceToTag(n,"p"),r&&typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"&&r.removeAttr("class").removeAttr("style")},this));return}}this.block.formatWrap(t)}else{var a=0,f=!1;this.block.type=="class"&&(f="toggle",a=e(this.block.blocks).filter("."+this.block.value).length,this.block.blocksSize==a?f="toggle":this.block.blocksSize>a?f="set":a===0&&(f="set"));var l=["ul","ol","li","td","th","dl","dt","dd"];e.each(this.block.blocks,e.proxy(function(n,r){if(e.inArray(r.tagName.toLowerCase(),l)!=-1)return;var i=this.utils.replaceToTag(r,t);f?f=="toggle"?this.block.toggle(i):f=="remove"?this.block.remove(i):f=="set"&&this.block.setForce(i):this.block.toggle(i),t!="p"&&t!="blockquote"&&i.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(i),(t=="p"||this.block.headTag)&&i.find("p").contents().unwrap(),typeof this.block.type=="undefined"&&typeof this.block.value=="undefined"&&i.removeAttr("class").removeAttr("style")},this))}},setForce:function(e){this.block.clearStyle&&e.removeAttr("class").removeAttr("style");if(this.block.type=="class"){e.addClass(this.block.value);return}if(this.block.type=="attr"||this.block.type=="data"){e.attr(this.block.value.name,this.block.value.value);return}},toggle:function(e){this.block.clearStyle&&e.removeAttr("class").removeAttr("style");if(this.block.type=="class"){e.toggleClass(this.block.value);return}if(this.block.type=="attr"||this.block.type=="data"){e.attr(this.block.value.name)==this.block.value.value?e.removeAttr(this.block.value.name):e.attr(this.block.value.name,this.block.value.value);return}e.removeAttr("style class");return},remove:function(e){e.removeClass(this.block.value)},formatListToBlockquote:function(){var t=e(this.block.blocks[0]).closest("ul, ol",this.$editor[0]);e(t).find("ul, ol").contents().unwrap(),e(t).find("li").append(e("<br>")).contents().unwrap();var n=this.utils.replaceToTag(t,"blockquote");this.block.toggle(n)},formatBlockquote:function(t){document.execCommand("outdent"),document.execCommand("formatblock",!1,t),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var n=this.selection.getBlock();t!="p"&&e(n).find("img").remove(),this.opts.linebreaks||this.block.toggle(e(n)),this.$editor.find("ul, ol, tr, blockquote, p").each(e.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&t=="p"&&this.utils.replaceWithContents(n)},formatWrap:function(t){if(this.block.containerTag=="UL"||this.block.containerTag=="OL"){if(t!="blockquote")return;this.block.formatListToBlockquote()}var n=this.selection.wrap(t);if(n===!1)return;var r=e(n);this.block.formatTableWrapping(r);var i=r.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");i.contents().unwrap(),t!="p"&&t!="blockquote"&&r.find("img").remove(),e.each(this.block.blocks,e.proxy(this.utils.removeEmpty,this)),r.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(r),this.$editor.find("ul, ol, tr, blockquote, p").each(e.proxy(this.utils.removeEmpty,this)),r.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(r),this.opts.linebreaks&&t=="p"&&this.utils.replaceWithContents(r);if(this.opts.linebreaks){var s=r.next().next();s.size()!=0&&s[0].tagName==="BR"&&s.remove()}},formatTableWrapping:function(e){if(e.closest("table",this.$editor[0]).length===0)return;e.closest("tr",this.$editor[0]).length===0&&e.wrap("<tr>"),e.closest("td",this.$editor[0]).length===0&&e.closest("th").length===0&&e.wrap("<td>")},removeData:function(t,n){var r=this.selection.getBlocks();e(r).removeAttr("data-"+t),this.code.sync()},setData:function(t,n){var r=this.selection.getBlocks();e(r).attr("data-"+t,n),this.code.sync()},toggleData:function(t,n){var r=this.selection.getBlocks();e.each(r,function(){e(this).attr("data-"+t)?e(this).removeAttr("data-"+t):e(this).attr("data-"+t,n)})},removeAttr:function(t,n){var r=this.selection.getBlocks();e(r).removeAttr(t),this.code.sync()},setAttr:function(t,n){var r=this.selection.getBlocks();e(r).attr(t,n),this.code.sync()},toggleAttr:function(t,n){var r=this.selection.getBlocks();e.each(r,function(){e(this).attr(name)?e(this).removeAttr(name):e(this).attr(name,n)})},removeClass:function(t){var n=this.selection.getBlocks();e(n).removeClass(t),this.utils.removeEmptyAttr(n,"class"),this.code.sync()},setClass:function(t){var n=this.selection.getBlocks();e(n).addClass(t),this.code.sync()},toggleClass:function(t){var n=this.selection.getBlocks();e(n).toggleClass(t),this.code.sync()}}},buffer:function(){return{set:function(e){typeof e=="undefined"||e=="undo"?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){if(this.opts.buffer.length===0)return;this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore(),setTimeout(e.proxy(this.observe.load,this),50)},redo:function(){if(this.opts.rebuffer.length===0)return;this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore(),setTimeout(e.proxy(this.observe.load,this),50)}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadContent(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},isTextarea:function(){return this.$element[0].tagName==="TEXTAREA"},createContainerBox:function(){this.$box=e('<div class="redactor-box" role="application" />')},createTextarea:function(){this.$textarea=e("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return typeof name=="undefined"?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var t=this.build.isTextarea()?"val":"html";this.content=e.trim(this.$element[t]())},enableEditor:function(){this.$editor.attr({contenteditable:!0,dir:this.opts.direction})},loadEditor:function(){var e=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[e]()},fromTextarea:function(){this.$editor=e("<div />"),this.$textarea=this.$element,this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.$element.hide()},fromElement:function(){this.$editor=this.$element,this.build.createTextarea(),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea),this.$editor.addClass("redactor-editor"),this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content),this.build.setOptions(),this.build.callEditor();if(this.opts.visual)return;setTimeout(e.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing(),this.build.disableIeLinks(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.modal.loadTemplates(),this.build.plugins(),setTimeout(e.proxy(this.observe.load,this),4),this.core.setCallback("init")},setOptions:function(){e(this.$textarea).attr("dir",this.opts.direction),this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(e){e.preventDefault();if(!this.opts.dragImageUpload||!this.opts.dragFileUpload)return;var t=e.dataTransfer.files;this.upload.directUpload(t[0],e)},setEventDrop:function(e){this.code.sync(),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",e)},setEvents:function(){this.$editor.on("drop.redactor",e.proxy(function(e){e=e.originalEvent||e;if(window.FormData===undefined||!e.dataTransfer)return!0;if(e.dataTransfer.files.length===0)return this.build.setEventDrop(e);this.build.setEventDropUpload(e),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",e)},this)),this.$editor.on("click.redactor",e.proxy(function(e){var t=this.core.getEvent(),n=t=="click"||t=="arrow"?!1:"click";this.core.addEvent(n),this.utils.disableSelectAll(),this.core.setCallback("click",e)},this)),this.$editor.on("paste.redactor",e.proxy(this.paste.init,this)),this.$editor.on("cut.redactor",e.proxy(this.code.sync,this)),this.$editor.on("keydown.redactor",e.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",e.proxy(this.keyup.init,this)),e.isFunction(this.opts.codeKeydownCallback)&&this.$textarea.on("keydown.redactor-textarea",e.proxy(this.opts.codeKeydownCallback,this)),e.isFunction(this.opts.codeKeyupCallback)&&this.$textarea.on("keyup.redactor-textarea",e.proxy(this.opts.codeKeyupCallback,this)),e.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",e.proxy(this.opts.focusCallback,this)),e(document).on("mousedown.redactor."+this.uuid,e.proxy(function(e){this.blurClickedElement=e.target},this)),this.$editor.on("blur.redactor",e.proxy(function(t){if(this.start)return;if(this.rtePaste)return;if(!this.build.isBlured())return;this.utils.disableSelectAll(),e.isFunction(this.opts.blurCallback)&&this.core.setCallback("blur",t)},this))},isBlured:function(){if(this.blurClickedElement===!0)return!0;var t=e(this.blurClickedElement);return!t.hasClass("redactor-toolbar, redactor-dropdown")&&!t.is("#redactor-modal")&&t.parents(".redactor-toolbar, .redactor-dropdown, #redactor-modal").length===0},setHelpers:function(){this.linkify.isEnabled()&&this.linkify.format(),this.placeholder.enable(),this.opts.focus&&setTimeout(this.focus.setStart,100),this.opts.focusEnd&&setTimeout(this.focus.setEnd,100)},plugins:function(){if(!this.opts.plugins)return;e.each(this.opts.plugins,e.proxy(function(t,r){var i=typeof RedactorPlugins!="undefined"&&typeof RedactorPlugins[r]!="undefined"?RedactorPlugins:n.fn;if(!e.isFunction(i[r]))return;this[r]=i[r]();var s=this.getModuleMethods(this[r]),o=s.length;for(var u=0;u<o;u++)this[r][s[u]]=this[r][s[u]].bind(this);e.isFunction(this[r].init)&&this[r].init()},this))},disableMozillaEditing:function(){if(!this.utils.browser("mozilla"))return;try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}},disableIeLinks:function(){if(!this.utils.browser("msie"))return;document.execCommand("AutoUrlDetect",!1,!1)}}},button:function(){return{build:function(t,n){var r=e('<a href="#" class="re-icon re-'+t+'" rel="'+t+'" />').attr({role:"button","aria-label":n.title,tabindex:"-1"});(n.func||n.command||n.dropdown)&&this.button.setEvent(r,t,n);if(n.dropdown){r.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var i=e('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+t+'" style="display: none;">');r.data("dropdown",i),this.dropdown.build(t,i,n.dropdown)}return this.utils.isDesktop()&&this.button.createTooltip(r,t,n.title),r},setEvent:function(t,n,r){t.on("touchstart click",e.proxy(function(e){if(t.hasClass("redactor-button-disabled"))return!1;var i="func",s=r.func;r.command?(i="command",s=r.command):r.dropdown&&(i="dropdown",s=!1),this.button.onClick(e,n,i,s)},this))},createTooltip:function(t,n,r){var i=e("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+this.uuid+" redactor-toolbar-tooltip-"+n).hide().html(r);i.appendTo("body"),t.on("mouseover",function(){if(e(this).hasClass("redactor-button-disabled"))return;var n=t.offset();i.show(),i.css({top:n.top+t.innerHeight()+"px",left:n.left+t.innerWidth()/2-i.innerWidth()/2+"px"})}),t.on("mouseout",function(){i.hide()})},onClick:function(e,t,n,r){this.button.caretOffset=this.caret.getOffset(),e.preventDefault(),this.utils.browser("msie")&&(e.returnValue=!1),n=="command"?this.inline.format(r):n=="dropdown"?this.dropdown.show(e,t):this.button.onClickCallback(e,r,t)},onClickCallback:function(t,n,r){var i;this.blurClickedElement=!0;if(e.isFunction(n))n.call(this,r);else if(n.search(/\./)!="-1"){i=n.split(".");if(typeof this[i[0]]=="undefined")return;this[i[0]][i[1]](r)}else this[n](r);this.observe.buttons(t,r)},get:function(e){return this.$toolbar.find("a.re-"+e)},setActive:function(e){this.button.get(e).addClass("redactor-act")},setInactive:function(e){this.button.get(e).removeClass("redactor-act")},setInactiveAll:function(e){typeof e=="undefined"?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+e).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor-button-disabled")},changeIcon:function(e,t){this.button.get(e).addClass("re-"+t)},removeIcon:function(e,t){this.button.get(e).removeClass("re-"+t)},setAwesome:function(e,t){var n=this.button.get(e);n.removeClass("redactor-btn-image").addClass("fa-redactor-btn"),n.html('<i class="fa '+t+'"></i>')},addCallback:function(t,n){if(t=="buffer")return;var r=n=="dropdown"?"dropdown":"func",i=t.attr("rel");t.on("touchstart click",e.proxy(function(e){if(t.hasClass("redactor-button-disabled"))return!1;this.button.onClick(e,i,r,n)},this))},addDropdown:function(t,n){t.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var r=t.attr("rel");this.button.addCallback(t,"dropdown");var i=e('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+r+'" style="display: none;">');return t.data("dropdown",i),n&&this.dropdown.build(r,i,n),i},add:function(t,n){if(!this.opts.toolbar)return;if(this.button.isMobileUndoRedo(t))return"buffer";var r=this.button.build(t,{title:n});return r.addClass("redactor-btn-image"),this.$toolbar.append(e("<li>").append(r)),r},addFirst:function(t,n){if(!this.opts.toolbar)return;if(this.button.isMobileUndoRedo(t))return"buffer";var r=this.button.build(t,{title:n});return r.addClass("redactor-btn-image"),this.$toolbar.prepend(e("<li>").append(r)),r},addAfter:function(t,n,r){if(!this.opts.toolbar)return;if(this.button.isMobileUndoRedo(n))return"buffer";var i=this.button.build(n,{title:r});i.addClass("redactor-btn-image");var s=this.button.get(t);return s.length!==0?s.parent().after(e("<li>").append(i)):this.$toolbar.append(e("<li>").append(i)),i},addBefore:function(t,n,r){if(!this.opts.toolbar)return;if(this.button.isMobileUndoRedo(n))return"buffer";var i=this.button.build(n,{title:r});i.addClass("redactor-btn-image");var s=this.button.get(t);return s.length!==0?s.parent().before(e("<li>").append(i)):this.$toolbar.append(e("<li>").append(i)),i},remove:function(e){this.button.get(e).remove()},isMobileUndoRedo:function(e){return(e=="undo"||e=="redo")&&!this.utils.isDesktop()}}},caret:function(){return{setStart:function(t){if(!this.utils.isBlock(t)){var n=this.utils.createSpaceElement();e(t).prepend(n),this.caret.setEnd(n)}else this.caret.set(t,0,t,0)},setEnd:function(e){e=e[0]||e;if(e.lastChild.nodeType==1)return this.caret.setAfter(e.lastChild);this.caret.set(e,1,e,1)},set:function(t,n,r,i){t=t[0]||t,r=r[0]||r,this.utils.isBlockTag(t.tagName)&&t.innerHTML===""&&(t.innerHTML=this.opts.invisibleSpace);if(t.tagName=="BR"&&this.opts.linebreaks===!1){var s=e(this.opts.emptyHtml)[0];e(t).replaceWith(s),t=s,r=t}this.selection.get();try{this.range.setStart(t,n),this.range.setEnd(r,i)}catch(o){}this.selection.addRange()},setAfter:function(t){try{var n=e(t)[0].tagName;if(n!="BR"&&!this.utils.isBlock(t)){var r=this.utils.createSpaceElement();e(t).after(r),this.caret.setEnd(r)}else n!="BR"&&this.utils.browser("msie")?this.caret.setStart(e(t).next()):this.caret.setAfterOrBefore(t,"after")}catch(i){var r=this.utils.createSpaceElement();e(t).after(r),this.caret.setEnd(r)}},setBefore:function(t){this.utils.isBlock(t)?this.caret.setEnd(e(t).prev()):this.caret.setAfterOrBefore(t,"before")},setAfterOrBefore:function(e,t){this.utils.browser("msie")||this.$editor.focus(),e=e[0]||e,this.selection.get();if(t=="after")try{this.range.setStartAfter(e),this.range.setEndAfter(e)}catch(n){}else try{this.range.setStartBefore(e),this.range.setEndBefore(e)}catch(n){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(t){t=t[0]||t,this.selection.get();var n=this.range.cloneRange();return n.selectNodeContents(t),n.setEnd(this.range.endContainer,this.range.endOffset),e.trim(n.toString()).length},getOffset:function(){var e=0,t=window.getSelection();if(t.rangeCount>0){var n=window.getSelection().getRangeAt(0),r=n.cloneRange();r.selectNodeContents(this.$editor[0]),r.setEnd(n.endContainer,n.endOffset),e=r.toString().length}return e},setOffset:function(e,t){typeof t=="undefined"&&(t=e),this.focus.isFocused()||this.focus.setStart();var n=this.selection.get(),r,i=0,s=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);while(r==s.nextNode()){i+=r.nodeValue.length,i>e&&(this.range.setStart(r,r.nodeValue.length+e-i),e=Infinity);if(i>=t){this.range.setEnd(r,r.nodeValue.length+t-i);break}}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(e,t){this.caret.setOffset(e,t)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(t){t=this.clean.savePreCode(t),t=t.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>'),t=t.replace(/\$/g,"&#36;"),t=t.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),this.opts.replaceDivs&&(t=this.clean.replaceDivs(t)),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.clean.saveFormTags(t);var n=e("<div>");n.html(t);var r=n.find("font[style]");return r.length!==0&&(r.replaceWith(function(){var t=e(this),n=e("<span>").attr("style",t.attr("style"));return n.append(t.contents())}),t=n.html()),n.remove(),t=t.replace(/<font(.*?[^<])>/gi,""),t=t.replace(/<\/font>/gi,""),t=this.tidy.load(t),this.opts.paragraphize&&(t=this.paragraphize.load(t)),t=this.clean.setVerified(t),t=this.clean.convertInline(t),t=t.replace(/&amp;/g,"&"),t},onSync:function(t){t=t.replace(/\u200B/g,""),t=t.replace(/&#x200b;/gi,""),this.opts.cleanSpaces&&(t=t.replace(/&nbsp;/gi," "));if(t.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i)!=-1)return"";t=t.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>"),t=this.clean.restoreFormTags(t);var n={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};e.each(n,function(e,n){t=t.replace(new RegExp(e,"g"),n)}),this.utils.browser("mozilla")&&(t=t.replace(/<br\s?\/?>$/gi,"")),t=t.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),t=t.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),t=t.replace(/<(.*?)rel="\s*?"(.*?[^>]?)>/gi,'<$1$2">'),t=t.replace(/<(.*?)style="\s*?"(.*?[^>]?)>/gi,'<$1$2">'),t=t.replace(/="">/gi,">"),t=t.replace(/""">/gi,'">'),t=t.replace(/"">/gi,'">'),t=t.replace(/<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>/gi,"<div$1$2>"),t=t.replace(/<(.*?) data-verified="redactor"(.*?[^>])>/gi,"<$1$2>");var r=e("<div/>").html(e.parseHTML(t,document,!0));return r.find("span").removeAttr("rel"),r.find("pre .redactor-invisible-space").each(function(){e(this).contents().unwrap()}),t=r.html(),t=t.replace(/<img(.*?[^>])rel="(.*?[^>])"(.*?[^>])>/gi,"<img$1$3>"),t=t.replace(/<span class="redactor-invisible-space">(.*?)<\/span>/gi,"$1"),t=t.replace(/ data-save-url="(.*?[^>])"/gi,""),t=t.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),t=t.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),t=t.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),t=t.replace(/<font(.*?[^<])>/gi,""),t=t.replace(/<\/font>/gi,""),t=this.tidy.load(t),this.opts.linkNofollow&&(t=t.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),t=t.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),t=t.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,""),t=t.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),t=t.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>"),t=t.replace(/&amp;/g,"&"),t},onPaste:function(t,n){t=e.trim(t),t=t.replace(/\$/g,"&#36;"),t=t.replace(/<span class="s[0-9]">/gi,"<span>"),t=t.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),t=t.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"	"),t=t.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," ");if(this.opts.pastePlainText)return this.clean.getPlainText(t);if(!this.utils.isSelectAll()&&typeof n=="undefined"){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(t,!1);if(this.utils.isCurrentOrParent("PRE"))return t=t.replace(/”/g,'"'),t=t.replace(/“/g,'"'),t=t.replace(/‘/g,"'"),t=t.replace(/’/g,"'"),this.clean.getPreCode(t);if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){t=this.clean.getOnlyImages(t);if(!this.utils.browser("msie")){var r=this.selection.getBlock();r&&r.tagName=="P"&&(t=t.replace(/<img(.*?)>/gi,"<p><img$1></p>"))}return t}if(this.utils.isCurrentOrParent(["TD"]))return t=this.clean.onPasteTidy(t,"td"),this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),t=this.clean.replaceDivsToBr(t),t;if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(t,"li")}return t=this.clean.isSingleLine(t,n),this.clean.singleLine||(this.opts.linebreaks&&(t=this.clean.replaceParagraphsToBr(t)),this.opts.replaceDivs&&(t=this.clean.replaceDivs(t)),t=this.clean.saveFormTags(t)),t=this.clean.onPasteWord(t),t=this.clean.onPasteExtra(t),t=this.clean.onPasteTidy(t,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(t=this.paragraphize.load(t)),t=this.clean.removeDirtyStyles(t),t=this.clean.onPasteRemoveSpans(t),t=this.clean.onPasteRemoveEmpty(t),t=this.clean.convertInline(t),t},onPasteWord:function(t){t=t.replace(/<!--[\s\S]*?-->/gi,""),t=t.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),t=t.replace(/<o\:p[^>]*>[\s\S]*?<\/o\:p>/gi,"");if(t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)){t=t.replace(/<!--[\s\S]+?-->/gi,""),t=t.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,""),t=t.replace(/<(\/?)s>/gi,"<$1strike>"),t=t.replace(/ /gi," "),t=t.replace(/<span\s+style\s*=\s*"\s*mso-spacerun\s*:\s*yes\s*;?\s*"\s*>([\s\u00a0]*)<\/span>/gi,function(e,t){return t.length>0?t.replace(/./," ").slice(Math.floor(t.length/2)).split("").join(" "):""}),t=this.clean.onPasteIeFixLinks(t),t=t.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),t=t.replace(/src="file\:\/\/(.*?)"/,'src=""');var n=e("<div/>").html(t),r=!1,i=1,s=[];n.find("p[style]").each(function(){var t=e(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(t){var o=parseInt(t[1]),u=parseInt(t[2]),a=e(this).html().match(/^[\w]+\./)?"ol":"ul",f=e("<li/>").html(e(this).html());f.html(f.html().replace(/^([\w\.]+)</,"<")),f.find("span:first").remove();if(u==1&&e.inArray(o,s)==-1){var l=e("<"+a+"/>").attr({"data-level":u,"data-list":o}).html(f);e(this).replaceWith(l),r=o,s.push(o)}else{if(u>i){var c=n.find('[data-level="'+i+'"][data-list="'+r+'"]'),h=c;for(var p=i;p<u;p++)l=e("<"+a+"/>"),l.appendTo(h.find("li").last()),h=l;h.attr({"data-level":u,"data-list":o}).html(f)}else{var c=n.find('[data-level="'+u+'"][data-list="'+o+'"]').last();c.append(f)}i=u,r=o,e(this).remove()}}}),n.find("[data-level][data-list]").removeAttr("data-level data-list"),t=n.html(),t=t.replace(/·/g,""),t=t.replace(/<p class="Mso(.*?)"/gi,"<p"),t=t.replace(/ class=\"(mso[^\"]*)\"/gi,""),t=t.replace(/ class=(mso\w+)/gi,""),t=t.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2"),t=t.replace(/\n/g," "),t=t.replace(/<p>\n?<li>/gi,"<li>")}return t},onPasteExtra:function(e){return e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=e.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),e=e.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),e=e.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),e=e.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),e=e.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),e=e.replace(/<img>/gi,""),e=e.replace(/\n{3,}/gi,"\n"),e=e.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2"),e=e.replace(/<p><p>/gi,"<p>"),e=e.replace(/<\/p><\/p>/gi,"</p>"),e=e.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),e=e.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),e=e.replace(/<\/p>\s<p/gi,"</p><p"),e=e.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),e=e.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.utils.browser("mozilla")&&(e=e.replace(/<br\s?\/?>$/gi,"")),e},onPasteTidy:function(e,t){var n=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],r=!1,i=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];t=="all"?(r=["p","span","h1","h2","h3","h4","h5","h6"],i=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):t=="td"?n=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:t=="li"&&(n=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]);var s={deniedTags:this.opts.deniedTags?this.opts.deniedTags:!1,allowedTags:this.opts.allowedTags?this.opts.allowedTags:n,removeComments:!0,removePhp:!0,removeAttr:this.opts.removeAttr?this.opts.removeAttr:!1,allowedAttr:this.opts.allowedAttr?this.opts.allowedAttr:i,removeEmpty:r};return this.tidy.load(e,s)},onPasteRemoveEmpty:function(e){return e=e.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),this.opts.linebreaks||(e=e.replace(/<br>$/i,"")),e},onPasteRemoveSpans:function(e){return e=e.replace(/<span>(.*?)<\/span>/gi,"$1"),e=e.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," "),e},onPasteIeFixLinks:function(t){if(!this.utils.browser("msie"))return t;var n=e.trim(t);return n.search(/^<a(.*?)>(.*?)<\/a>$/i)===0&&(t=t.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")),t},isSingleLine:function(e,t){this.clean.singleLine=!1;if(!this.utils.isSelectAll()&&typeof t=="undefined"){var n=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),r=e.match(new RegExp("</("+n+")>","gi")),i=e.match(/<\/(p|div)>/gi);if(!r&&(i===null||i&&i.length<=1)){var s=e.match(/<br\s?\/?>/gi);s||(this.clean.singleLine=!0,e=e.replace(/<\/?(p|div)(.*?)>/gi,""))}}return e},stripTags:function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var n=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e.replace(n,function(e,n){return t.indexOf("<"+n.toLowerCase()+">")>-1?e:""})},savePreCode:function(e){return e=this.clean.savePreFormatting(e),e=this.clean.saveCodeFormatting(e),e=this.clean.restoreSelectionMarker(e),e},savePreFormatting:function(t){var n=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return n!==null&&e.each(n,e.proxy(function(e,n){var r=n.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);r[2]=r[2].replace(/<br\s?\/?>/g,"\n"),r[2]=r[2].replace(/&nbsp;/g," "),this.opts.preSpaces&&(r[2]=r[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),t=t.replace(n,"<pre"+r[1]+">"+r[2]+"</pre>")},this)),t},saveCodeFormatting:function(t){var n=t.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return n!==null&&e.each(n,e.proxy(function(e,n){var r=n.match(/<code(.*?)>([\w\W]*?)<\/code>/i);r[2]=r[2].replace(/&nbsp;/g," "),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),t=t.replace(n,"<code"+r[1]+">"+r[2]+"</code>")},this)),t},restoreSelectionMarker:function(e){return e=e.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot; data-verified=&quot;redactor&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker" data-verified="redactor">​</span>'),e},getTextFromHtml:function(t){t=t.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var n=document.createElement("div");return n.innerHTML=t,t=n.textContent||n.innerText,e.trim(t)},getPlainText:function(e,t){return e=this.clean.getTextFromHtml(e),e=e.replace(/\n/g,"<br />"),this.opts.paragraphize&&typeof t=="undefined"&&!this.utils.browser("mozilla")&&(e=this.paragraphize.load(e)),e},getPreCode:function(e){return e=e.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>"),e=e.replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),e=this.clean.getTextFromHtml(e),this.opts.preSpaces&&(e=e.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),e=this.clean.encodeEntities(e),e},getOnlyImages:function(e){return e=e.replace(/<img(.*?)>/gi,"[img$1]"),e=e.replace(/<([Ss]*?)>/gi,""),e=e.replace(/\[img(.*?)\]/gi,"<img$1>"),e},getOnlyLinksAndImages:function(e){return e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),e=e.replace(/<img(.*?)>/gi,"[img$1]"),e=e.replace(/<(.*?)>/gi,""),e=e.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[img(.*?)\]/gi,"<img$1>"),e},encodeEntities:function(e){return e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(t){if(this.utils.browser("msie"))return t;var n=document.createElement("div");return n.innerHTML=t,this.clean.clearUnverifiedRemove(e(n)),t=n.innerHTML,e(n).remove(),t},clearUnverified:function(){if(this.utils.browser("msie"))return;this.clean.clearUnverifiedRemove(this.$editor);var e=this.$editor.find("h1, h2, h3, h4, h5, h6");e.find("span").removeAttr("style"),e.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),this.code.sync()},clearUnverifiedRemove:function(t){t.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),t.find("span").not('[data-verified="redactor"]').removeAttr("style"),t.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(t,n){var r=e(n);r.attr("style",r.attr("rel"))})},cleanEmptyParagraph:function(){},setVerified:function(e){if(this.utils.browser("msie"))return e;e=e.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">'),e=e.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var t=e.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(t){var n=t.length;for(var r=0;r<n;r++)try{var i=t[r].replace(/style="(.*?)"/i,'style="$1" rel="$1"');e=e.replace(t[r],i)}catch(s){}}return e},convertInline:function(t){var n=e("<div />").html(t),r=this.opts.inlineTags;return r.push("span"),n.find(r.join(",")).each(function(){var t=e(this),n=this.tagName.toLowerCase();t.attr("data-redactor-tag",n),n=="span"&&(t.attr("style")?t.attr("data-redactor-style",t.attr("style")):t.attr("class")&&t.attr("data-redactor-class",t.attr("class")))}),t=n.html(),n.remove(),t},normalizeLists:function(){this.$editor.find("li").each(function(t,n){var r=e(n).next();r.length!==0&&(r[0].tagName=="UL"||r[0].tagName=="OL")&&e(n).append(r)})},removeSpaces:function(e){return e=e.replace(/\n/g,""),e=e.replace(/[\t]*/g,""),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/g," "),e=e.replace(/[\s\n]*$/g," "),e=e.replace(/>\s{2,}</g,"> <"),e=e.replace(/\n\n/g,"\n"),e=e.replace(/\u200B/g,""),e},replaceDivs:function(e){return this.opts.linebreaks?(e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br />"),e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")):e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>"),e=e.replace(/<div(.*?[^>])>/gi,""),e=e.replace(/<\/div>/gi,""),e},replaceDivsToBr:function(e){return e=e.replace(/<div\s(.*?)>/gi,"<p>"),e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />"),e=e.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />"),e},replaceParagraphsToBr:function(e){return e=e.replace(/<p\s(.*?)>/gi,"<p>"),e=e.replace(/<p><br\s?\/?><\/p>/gi,"<br />"),e=e.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />"),e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),e},saveFormTags:function(e){return e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(e){return e.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(t){t=e.trim(t.toString()),t=this.clean.onSet(t),this.$editor.html(t),this.code.sync(),t!==""&&this.placeholder.remove(),setTimeout(e.proxy(this.buffer.add,this),15),this.start===!1&&this.observe.load()},get:function(){var e=this.$textarea.val();return this.opts.replaceDivs&&(e=this.clean.replaceDivs(e)),this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),e=this.tabifier.get(e),e},sync:function(){setTimeout(e.proxy(this.code.startSync,this),10)},startSync:function(){var e=this.$editor.html();if(this.code.syncCode&&this.code.syncCode==e)return;this.code.syncCode=e,e=this.core.setCallback("syncBefore",e),e=this.clean.onSync(e),this.$textarea.val(e),this.core.setCallback("sync",e),this.start===!1&&this.core.setCallback("change",e),this.start=!1,this.autosave.html==0&&(this.autosave.html=this.code.get()),this.opts.codemirror&&this.$textarea.next(".CodeMirror").each(function(t,n){n.CodeMirror.setValue(e)}),this.autosave.onChange(),this.autosave.enable()},toggle:function(){this.opts.visual?this.code.showCode():this.code.showVisual()},showCode:function(){this.selection.save(),this.code.offset=this.caret.getOffset();var t=e(window).scrollTop(),n=this.$editor.innerWidth(),r=this.$editor.innerHeight();this.$editor.hide();var i=this.$textarea.val();this.modified=this.clean.removeSpaces(i),i=this.tabifier.get(i);var s=0,o=0,u=e("<div/>").append(e.parseHTML(this.clean.onSync(this.$editor.html()),document,!0)),a=u.find("span.redactor-selection-marker");if(a.length>0){var f=this.tabifier.get(u.html()).replace(/&amp;/g,"&");a.length==1?(s=this.utils.strpos(f,u.find("#selection-marker-1").prop("outerHTML")),o=s):a.length==2&&(s=this.utils.strpos(f,u.find("#selection-marker-1").prop("outerHTML")),o=this.utils.strpos(f,u.find("#selection-marker-2").prop("outerHTML"))-u.find("#selection-marker-1").prop("outerHTML").toString().length)}this.selection.removeMarkers(),this.$textarea.val(i),this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(t,n){e(n).show(),n.CodeMirror.setValue(i),n.CodeMirror.setSize("100%",r),n.CodeMirror.refresh(),s==o?n.CodeMirror.setCursor(n.CodeMirror.posFromIndex(s).line,n.CodeMirror.posFromIndex(o).ch):n.CodeMirror.setSelection({line:n.CodeMirror.posFromIndex(s).line,ch:n.CodeMirror.posFromIndex(s).ch},{line:n.CodeMirror.posFromIndex(o).line,ch:n.CodeMirror.posFromIndex(o).ch}),n.CodeMirror.focus()}):(this.$textarea.height(r).show().focus(),this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting),e(window).scrollTop(t),this.$textarea[0].setSelectionRange&&this.$textarea[0].setSelectionRange(s,o),this.$textarea[0].scrollTop=0),this.opts.visual=!1,this.button.setInactiveInCode(),this.button.setActive("html"),this.core.setCallback("source",i)},showVisual:function(){var e;if(this.opts.visual)return;var t=0,n=0;if(this.opts.codemirror){var r;this.$textarea.next(".CodeMirror").each(function(i,s){r=s.CodeMirror.listSelections(),t=s.CodeMirror.indexFromPos(r[0].anchor),n=s.CodeMirror.indexFromPos(r[0].head),e=s.CodeMirror.getValue()})}else t=this.$textarea.get(0).selectionStart,n=this.$textarea.get(0).selectionEnd,e=this.$textarea.hide().val();if(t>n&&n>0){var i=n,s=t;t=i,n=s}t=this.code.enlargeOffset(e,t),n=this.code.enlargeOffset(e,n),e=e.substr(0,t)+this.selection.getMarkerAsHtml(1)+e.substr(t);if(n>t){var o=this.selection.getMarkerAsHtml(1).toString().length;e=e.substr(0,n+o)+this.selection.getMarkerAsHtml(2)+e.substr(n+o)}this.modified!==this.clean.removeSpaces(e)&&this.code.set(e),this.opts.codemirror&&this.$textarea.next(".CodeMirror").hide(),this.$editor.show(),this.utils.isEmpty(e)||this.placeholder.remove(),this.selection.restore(),this.$textarea.off("keydown.redactor-textarea-indenting"),this.button.setActiveInVisual(),this.button.setInactive("html"),this.observe.load(),this.opts.visual=!0,this.core.setCallback("visual",e)},textareaIndenting:function(e){if(e.keyCode!==9)return!0;var t=this.$textarea,n=t.get(0).selectionStart;return t.val(t.val().substring(0,n)+"	"+t.val().substring(t.get(0).selectionEnd)),t.get(0).selectionStart=t.get(0).selectionEnd=n+1,!1},enlargeOffset:function(e,t){var n=e.length,r=0;if(e[t]==">")r++;else for(var i=t;i<=n;i++){r++;if(e[i]==">")break;if(e[i]=="<"||i==n){r=0;break}}return t+r}}},core:function(){return{getObject:function(){return e.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return this.$toolbar?this.$toolbar:!1},addEvent:function(e){this.core.event=e},getEvent:function(){return this.core.event},setCallback:function(t,n,r){var i=t+"Callback",s="redactor",o=this.opts[i];if(this.$textarea){var u=!1,a=e._data(this.$textarea[0],"events");typeof a!="undefined"&&typeof a[i]!="undefined"&&e.each(a[i],e.proxy(function(e,t){if(t["namespace"]==s){var r=typeof r=="undefined"?[n]:[n,r];u=typeof r=="undefined"?t.handler.call(this,n):t.handler.call(this,n,r)}},this));if(u)return u}return e.isFunction(o)?typeof r=="undefined"?o.call(this,n):o.call(this,n,r):typeof r=="undefined"?n:r},destroy:function(){this.opts.destroyed=!0,this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),e(document).off("mousedown.redactor."+this.uuid),e(document).off("click.redactor-image-delete."+this.uuid),e(document).off("click.redactor-image-resize-hide."+this.uuid),e(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),e("body").off("scroll.redactor."+this.uuid),e(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder"),this.$editor.removeAttr("contenteditable");var t=this.code.get();this.opts.toolbar&&this.$toolbar.find("a").each(function(){var t=e(this);t.data("dropdown")&&(t.data("dropdown").remove(),t.data("dropdown",{}))}),this.build.isTextarea()?(this.$box.after(this.$element),this.$box.remove(),this.$element.val(t).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$element.html(t).show()),this.$pasteBox&&this.$pasteBox.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),e(".redactor-toolbar-tooltip-"+this.uuid).remove(),clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(t,n,r){t=="formatting"&&this.opts.formattingAdd&&e.each(this.opts.formattingAdd,e.proxy(function(e,t){var n=t.tag,i;typeof t["class"]!="undefined"&&(n=n+"-"+t["class"]),t.type=this.utils.isBlockTag(t.tag)?"block":"inline",typeof t.func!="undefined"?i=t.func:i=t.type=="inline"?"inline.formatting":"block.formatting";if(this.opts.linebreaks&&t.type=="block"&&t.tag=="p")return;this.formatting[n]={tag:t.tag,style:t.style,"class":t["class"],attr:t.attr,data:t.data,clear:t.clear},r[n]={func:i,title:t.title}},this)),e.each(r,e.proxy(function(r,i){var s=e('<a href="#" class="redactor-dropdown-'+r+'" role="button">'+i.title+"</a>");t=="formatting"&&s.addClass("redactor-formatting-"+r),s.on("click",e.proxy(function(t){t.preventDefault();var n="func",s=i.func;i.command?(n="command",s=i.command):i.dropdown&&(n="dropdown",s=i.dropdown);if(e(t.target).hasClass("redactor-dropdown-link-inactive"))return;this.button.onClick(t,r,n,s),this.dropdown.hideAll()},this)),this.observe.addDropdown(s,r,i),n.append(s)},this))},show:function(t,n){if(!this.opts.visual)return t.preventDefault(),!1;var r=this.button.get(n),i=r.data("dropdown").appendTo(document.body);this.opts.highContrast&&i.addClass("redactor-dropdown-contrast");if(r.hasClass("dropact"))this.dropdown.hideAll();else{this.dropdown.hideAll(),this.observe.dropdowns(),this.core.setCallback("dropdownShow",{dropdown:i,key:n,button:r}),this.button.setActive(n),r.addClass("dropact");var s=r.offset(),o=i.width();s.left+o>e(document).width()&&(s.left=Math.max(0,s.left-o));var u=s.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var a=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,f="fixed";this.opts.toolbarFixedTarget!==document&&(a=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,f="absolute"),i.css({position:f,left:u,top:a+"px"}).show()}else{var a=r.innerHeight()+s.top+"px";i.css({position:"absolute",left:u,top:a}).show()}this.core.setCallback("dropdownShown",{dropdown:i,key:n,button:r}),this.$dropdown=i}e(document).one("click.redactor-dropdown",e.proxy(this.dropdown.hide,this)),this.$editor.one("click.redactor-dropdown",e.proxy(this.dropdown.hide,this)),e(document).one("keyup.redactor-dropdown",e.proxy(this.dropdown.closeHandler,this)),i.on("mouseover.redactor-dropdown",e.proxy(this.utils.disableBodyScroll,this)).on("mouseout.redactor-dropdown",e.proxy(this.utils.enableBodyScroll,this)),t.stopPropagation()},closeHandler:function(e){if(e.which!=this.keyCode.ESC)return;this.dropdown.hideAll(),this.$editor.focus()},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact"),this.utils.enableBodyScroll(),e(".redactor-dropdown-"+this.uuid).hide(),e(".redactor-dropdown-link-selected").removeClass("redactor-dropdown-link-selected"),this.$dropdown&&(this.$dropdown.off(".redactor-dropdown"),this.core.setCallback("dropdownHide",this.$dropdown),this.$dropdown=!1)},hide:function(t){var n=e(t.target);!n.hasClass("dropact")&&!n.hasClass("redactor-dropdown-link-inactive")&&(n.removeClass("dropact"),n.off("mouseover mouseout"),this.dropdown.hideAll())}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),this.selection.save(),this.selection.get();var t=this.sel.toString();e("#redactor-filename").val(t),this.modal.show()},insert:function(t,n,r){if(typeof t.error!="undefined"){this.modal.close(),this.selection.restore(),this.core.setCallback("fileUploadError",t);return}var i;if(typeof t=="string")i=t;else{var s=e("#redactor-filename").val();if(typeof s=="undefined"||s==="")s=t.filename;i='<a href="'+t.filelink+'" id="filelink-marker">'+s+"</a>"}if(n){this.selection.removeMarkers();var o=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(r,o)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.htmlWithoutClean(i);if(typeof t=="string")return;var u=e(this.$editor.find("a#filelink-marker"));u.length!==0?u.removeAttr("id").removeAttr("style"):u=!1,this.core.setCallback("fileUpload",u,t)}}},focus:function(){return{setStart:function(){this.$editor.focus();var e=this.$editor.children().first();if(e.length===0)return;if(e[0].length===0||e[0].tagName=="BR"||e[0].nodeType==3)return;if(e[0].tagName=="UL"||e[0].tagName=="OL"){var t=e.find("li").first();if(!this.utils.isBlock(t)&&t.text()===""){this.caret.setStart(t);return}}if(this.opts.linebreaks&&!this.utils.isBlockTag(e[0].tagName)){this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),this.selection.addRange();return}this.caret.setStart(e)},setEnd:function(){var e=this.$editor.children().last();this.$editor.focus();if(e.size()===0)return;this.utils.isEmpty(this.$editor.html())?(this.selection.get(),this.range.collapse(!0),this.range.setStartAfter(e[0]),this.range.setEnd(e[0],0),this.selection.addRange()):(this.selection.get(),this.range.selectNodeContents(e[0]),this.range.collapse(!1),this.selection.addRange())},isFocused:function(){var t=document.getSelection().focusNode;return t===null?!1:this.opts.linebreaks&&e(t.parentNode).hasClass("redactor-linebreaks")?!0:this.utils.isRedactorParent(t.parentNode)?this.$editor.is(":focus"):!1}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.selection.save(),this.modal.show()},showEdit:function(t){var n=t.closest("a",this.$editor[0]);this.modal.load("imageEdit",this.lang.get("edit"),705),this.modal.createCancelButton(),this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete")),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.image.buttonDelete.on("click",e.proxy(function(){this.image.remove(t)},this)),this.image.buttonSave.on("click",e.proxy(function(){this.image.update(t)},this)),e(".redactor-link-tooltip").remove(),e("#redactor-image-title").val(t.attr("alt"));if(!this.opts.imageLink)e(".redactor-image-link-option").hide();else{var r=e("#redactor-image-link");r.attr("href",t.attr("src")),n.length!==0&&(r.val(n.attr("href")),n.attr("target")=="_blank"&&e("#redactor-image-link-blank").prop("checked",!0))}if(!this.opts.imagePosition)e(".redactor-image-position-option").hide();else{var i=t.css("display")=="block"&&t.css("float")=="none"?"center":t.css("float");e("#redactor-image-align").val(i)}this.modal.show(),e("#redactor-image-title").focus()},setFloating:function(t){var n=e("#redactor-image-align").val(),r="",i="",s="";switch(n){case"left":r="left",s="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":r="right",s="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":i="block",s="auto"}t.css({"float":r,display:i,margin:s}),t.attr("rel",t.attr("style"))},update:function(t){this.image.hideResize(),this.buffer.set();var n=t.closest("a",this.$editor[0]);t.attr("alt",e("#redactor-image-title").val()),this.image.setFloating(t);var r=e.trim(e("#redactor-image-link").val());if(r!==""){var i="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",s=new RegExp("^(http|ftp|https)://"+i,"i"),o=new RegExp("^"+i,"i");r.search(s)==-1&&r.search(o)===0&&this.opts.linkProtocol&&(r=this.opts.linkProtocol+"://"+r);var u=e("#redactor-image-link-blank").prop("checked")?!0:!1;if(n.length===0){var a=e('<a href="'+r+'">'+this.utils.getOuterHtml(t)+"</a>");u&&a.attr("target","_blank"),t.replaceWith(a)}else n.attr("href",r),u?n.attr("target","_blank"):n.removeAttr("target")}else n.length!==0&&n.replaceWith(this.utils.getOuterHtml(t));this.modal.close(),this.observe.images(),this.code.sync()},setEditable:function(t){this.opts.imageEditable&&t.on("dragstart",e.proxy(this.image.onDrag,this));var n=e.proxy(function(n){this.observe.image=t,this.image.resizer=this.image.loadEditableControls(t),e(document).on("mousedown.redactor-image-resize-hide."+this.uuid,e.proxy(this.image.hideResize,this));if(!this.opts.imageResizable)return;this.image.resizer.on("mousedown.redactor touchstart.redactor",e.proxy(function(e){this.image.setResizable(e,t)},this))},this);t.off("mousedown.redactor").on("mousedown.redactor",e.proxy(this.image.hideResize,this)),t.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",n)},setResizable:function(e,t){e.preventDefault(),this.image.resizeHandle={x:e.pageX,y:e.pageY,el:t,ratio:t.width()/t.height(),h:t.height()},e=e.originalEvent||e,e.targetTouches&&(this.image.resizeHandle.x=e.targetTouches[0].pageX,this.image.resizeHandle.y=e.targetTouches[0].pageY),this.image.startResize()},startResize:function(){e(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",e.proxy(this.image.moveResize,this)),e(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",e.proxy(this.image.stopResize,this))},moveResize:function(e){e.preventDefault(),e=e.originalEvent||e;var t=this.image.resizeHandle.h;e.targetTouches?t+=e.targetTouches[0].pageY-this.image.resizeHandle.y:t+=e.pageY-this.image.resizeHandle.y;var n=Math.round(t*this.image.resizeHandle.ratio);if(t<50||n<100)return;var t=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.image.resizeHandle.el.attr({width:n,height:t}),this.image.resizeHandle.el.width(n),this.image.resizeHandle.el.height(t),this.code.sync()},stopResize:function(){this.handle=!1,e(document).off(".redactor-image-resize"),this.image.hideResize()},onDrag:function(t){if(this.$editor.find("#redactor-image-box").length!==0)return t.preventDefault(),!1;this.$editor.on("drop.redactor-image-inside-drop",e.proxy(function(){setTimeout(e.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop(),this.observe.images(),this.$editor.off("drop.redactor-image-inside-drop"),this.clean.clearUnverified(),this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var t=e(this);t.attr("src",t.attr("data-save-url")),t.removeAttr("data-save-url")})},hideResize:function(t){if(t&&e(t.target).closest("#redactor-image-box",this.$editor[0]).length!==0)return;if(t&&t.target.tagName=="IMG"){var n=e(t.target);n.attr("data-save-url",n.attr("src"))}var r=this.$editor.find("#redactor-image-box");if(r.length===0)return;e("#redactor-image-editter").remove(),e("#redactor-image-resizer").remove(),r.find("img").css({marginTop:r[0].style.marginTop,marginBottom:r[0].style.marginBottom,marginLeft:r[0].style.marginLeft,marginRight:r[0].style.marginRight}),r.css("margin",""),r.find("img").css("opacity",""),r.replaceWith(function(){return e(this).contents()}),e(document).off("mousedown.redactor-image-resize-hide."+this.uuid),typeof this.image.resizeHandle!="undefined"&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")),this.code.sync()},loadResizableControls:function(t,n){if(this.opts.imageResizable&&!this.utils.isMobile()){var r=e('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.utils.isDesktop()||r.css({width:"15px",height:"15px"}),r.attr("contenteditable",!1),n.append(r),n.append(t),r}return n.append(t),!1},loadEditableControls:function(t){var n=e('<span id="redactor-image-box" data-redactor="verified">');n.css("float",t.css("float")).attr("contenteditable",!1),t[0].style.margin!="auto"?(n.css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin","")):n.css({display:"block",margin:"auto"}),t.css("opacity",".5").after(n);if(this.opts.imageEditable){this.image.editter=e('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",e.proxy(function(){this.image.showEdit(t)},this)),n.append(this.image.editter);var r=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+r/2+"px")}return this.image.loadResizableControls(t,n)},remove:function(t){var n=e(t),r=n.closest("a",this.$editor[0]),i=n.closest("figure",this.$editor[0]),s=n.parent();e("#redactor-image-box").length!==0&&(s=e("#redactor-image-box").parent());var o;i.length!==0?(o=i.next(),i.remove()):r.length!==0?(s=r.parent(),r.remove()):n.remove(),e("#redactor-image-box").remove(),i.length!==0?this.caret.setStart(o):this.caret.setStart(s),this.core.setCallback("imageDelete",n[0].src,n),this.modal.close(),this.code.sync()},insert:function(t,n,r){if(typeof t.error!="undefined"){this.modal.close(),this.selection.restore(),this.core.setCallback("imageUploadError",t);return}var i;typeof t=="string"?i=e(t).attr("data-redactor-inserted-image","true"):(i=e("<img>"),i.attr("src",t.filelink).attr("data-redactor-inserted-image","true"));var s=i,o=this.utils.isCurrentOrParent("P");o&&(s=e("<blockquote />").append(i));if(n){this.selection.removeMarkers();var u=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(r,u)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.html(this.utils.getOuterHtml(s),!1);var a=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");o?a.parent().contents().unwrap().wrap("<p />"):this.opts.linebreaks&&(this.utils.isEmpty(this.code.get())||a.before("<br>"),a.after("<br>"));if(typeof t=="string")return;this.core.setCallback("imageUpload",a,t)}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&e.tagName=="LI"?this.indent.increaseLists():e===!1&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),this.selection.restore(),this.code.sync()},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){e.each(this.selection.getBlocks(),e.proxy(function(e,t){if(t.tagName==="TD"||t.tagName==="TH")return;var n=this.utils.getAlignmentElement(t),r=this.utils.normalize(n.css("margin-left"))+this.opts.indentValue;n.css("margin-left",r+"px")},this))},increaseText:function(){var t=this.selection.wrap("div");e(t).attr("data-tagblock","redactor"),e(t).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&e.tagName=="LI"?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore(),this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var t=this.selection.getCurrent(),n=e(t).closest("li",this.$editor[0]);this.indent.fixEmptyIndent(),!this.opts.linebreaks&&n.length===0&&(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each(e.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){e.each(this.selection.getBlocks(),e.proxy(function(e,t){var n=this.utils.getAlignmentElement(t),r=this.utils.normalize(n.css("margin-left"))-this.opts.indentValue;r<=0?this.opts.linebreaks&&typeof n.data("tagblock")!="undefined"?n.replaceWith(n.html()+"<br />"):(n.css("margin-left",""),this.utils.removeEmptyAttr(n,"style")):n.css("margin-left",r+"px")},this))},fixEmptyIndent:function(){var t=this.selection.getBlock();if(this.range.collapsed&&t&&t.tagName=="LI"&&this.utils.isEmpty(e(t).text())){var n=e(t);n.find("span").not(".redactor-selection-marker").contents().unwrap(),n.append("<br>")}}}},inline:function(){return{formatting:function(e){var t,n;typeof this.formatting[e].style!="undefined"?t="style":typeof this.formatting[e]["class"]!="undefined"&&(t="class"),t&&(n=this.formatting[e][t]),this.inline.format(this.formatting[e].tag,t,n)},format:function(t,n,r){var i=this.selection.getCurrent();if(i&&i.tagName==="TR")return;this.blurClickedElement=!0;if(this.utils.isCurrentOrParent("PRE")||this.utils.isCurrentOrParentHeader())return;var s=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],o=["strong","strong","em","em","u","del","del","sup","sub"];for(var u=0;u<s.length;u++)t==s[u]&&(t=o[u]);if(this.opts.allowedTags){if(e.inArray(t,this.opts.allowedTags)==-1)return}else if(e.inArray(t,this.opts.deniedTags)!==-1)return;this.inline.type=n||!1,this.inline.value=r||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(t):this.inline.formatMultiple(t)},formatCollapsed:function(t){var n=this.selection.getCurrent(),r=e(n).closest(t+"[data-redactor-tag="+t+"]",this.$editor[0]);if(r.length!==0&&this.inline.type!="style"&&r[0].tagName!="SPAN"){this.utils.isEmpty(r.text())?(this.caret.setAfter(r[0]),r.remove(),this.code.sync()):this.utils.isEndOfElement(r)&&this.caret.setAfter(r[0]);return}var i=e("<"+t+">").attr("data-verified","redactor").attr("data-redactor-tag",t);i.html(this.opts.invisibleSpace),i=this.inline.setFormat(i);var i=this.insert.node(i);this.caret.setEnd(i),this.code.sync()},formatMultiple:function(t){this.inline.formatConvert(t),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each(e.proxy(function(n,r){var i=e(r);this.inline.formatRemoveSameChildren(i,t);var s;this.inline.type?(s=e("<span>").attr("data-redactor-tag",t).attr("data-verified","redactor"),s=this.inline.setFormat(s)):s=e("<"+t+">").attr("data-redactor-tag",t).attr("data-verified","redactor"),i.replaceWith(s.html(i.contents()));if(t=="span"){var o=s.parent();if(o&&o[0].tagName=="SPAN"&&this.inline.type=="style"){var u=this.inline.value.split(";");for(var a=0;a<u.length;a++){if(u[a]==="")return;var f=u[a].split(":");o.css(f[0],""),this.utils.removeEmptyAttr(o,"style")&&o.replaceWith(o.contents())}}}},this)),t!="span"&&this.$editor.find(this.opts.inlineTags.join(", ")).each(e.proxy(function(t,n){var r=e(n),i=r.css("text-decoration");i=="line-through"&&(r.css("text-decoration",""),this.utils.removeEmptyAttr(r,"style"))},this));if(t!="del"){var n=this;this.$editor.find("inline").each(function(e,t){n.utils.replaceToTag(t,"del")})}this.selection.restore(),this.code.sync()},formatRemoveSameChildren:function(t,n){var r=this;t.children(n).each(function(){var t=e(this);if(!t.hasClass("redactor-selection-marker"))if(r.inline.type=="style"){var n=r.inline.value.split(";");for(var i=0;i<n.length;i++){if(n[i]==="")return;var s=n[i].split(":");t.css(s[0],""),r.utils.removeEmptyAttr(t,"style")&&t.replaceWith(t.contents())}}else t.contents().unwrap()})},formatConvert:function(t){this.selection.save();var n="";this.inline.type=="class"?n="[data-redactor-class="+this.inline.value+"]":this.inline.type=="style"&&(n='[data-redactor-style="'+this.inline.value+'"]');var r=this;t!="del"&&this.$editor.find("del").each(function(e,t){r.utils.replaceToTag(t,"inline")}),t!="span"&&this.$editor.find(t).each(function(){var t=e(this);t.replaceWith(e("<strike />").html(t.contents()))}),this.$editor.find('[data-redactor-tag="'+t+'"]'+n).each(function(){if(n===""&&t=="span"&&this.tagName.toLowerCase()==t)return;var r=e(this);r.replaceWith(e("<strike />").html(r.contents()))}),this.selection.restore()},setFormat:function(e){switch(this.inline.type){case"class":e.hasClass(this.inline.value)?(e.removeClass(this.inline.value),e.removeAttr("data-redactor-class")):(e.addClass(this.inline.value),e.attr("data-redactor-class",this.inline.value));break;case"style":e[0].style.cssText=this.inline.value,e.attr("data-redactor-style",this.inline.value)}return e},removeStyle:function(){this.buffer.set();var t=this.selection.getCurrent(),n=this.selection.getInlines();this.selection.save();if(t&&t.tagName==="SPAN"){var r=e(t);r.removeAttr("style"),r[0].attributes.length===0&&r.replaceWith(r.contents())}e.each(n,e.proxy(function(t,n){var r=e(n);e.inArray(n.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!r.hasClass("redactor-selection-marker")&&(r.removeAttr("style"),r[0].attributes.length===0&&r.replaceWith(r.contents()))},this)),this.selection.restore(),this.code.sync()},removeStyleRule:function(t){this.buffer.set();var n=this.selection.getParent(),r=this.selection.getInlines();this.selection.save();if(n&&n.tagName==="SPAN"){var i=e(n);i.css(t,""),this.utils.removeEmptyAttr(i,"style"),i[0].attributes.length===0&&i.replaceWith(i.contents())}e.each(r,e.proxy(function(n,r){var i=e(r);e.inArray(r.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!i.hasClass("redactor-selection-marker")&&(i.css(t,""),this.utils.removeEmptyAttr(i,"style"),i[0].attributes.length===0&&i.replaceWith(i.contents()))},this)),this.selection.restore(),this.code.sync()},removeFormat:function(){this.buffer.set();var t=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),t&&t.tagName==="SPAN"&&e(t).replaceWith(e(t).contents()),e.each(this.selection.getNodes(),e.proxy(function(t,n){var r=e(n);e.inArray(n.tagName.toLowerCase(),this.opts.inlineTags)!=-1&&!r.hasClass("redactor-selection-marker")&&r.replaceWith(r.contents())},this)),this.selection.restore(),this.code.sync()},toggleClass:function(e){this.inline.format("span","class",e)},toggleStyle:function(e){this.inline.format("span","style",e)}}},insert:function(){return{set:function(t,n){this.placeholder.remove(),t=this.clean.setVerified(t),typeof n=="undefined"&&(t=this.clean.onPaste(t,!1)),this.$editor.html(t),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),this.code.sync(),this.observe.load(),typeof n=="undefined"&&setTimeout(e.proxy(this.clean.clearUnverified,this),10)},text:function(t){this.placeholder.remove(),t=t.toString(),t=e.trim(t),t=this.clean.getPlainText(t,!1),this.$editor.focus();if(this.utils.browser("msie"))this.insert.htmlIe(t);else{this.selection.get(),this.range.deleteContents();var n=document.createElement("div");n.innerHTML=t;var r=document.createDocumentFragment(),i,s;while(i=n.firstChild)s=r.appendChild(i);this.range.insertNode(r);if(s){var o=this.range.cloneRange();o.setStartAfter(s),o.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(o)}}this.code.sync(),this.clean.clearUnverified()},htmlWithoutClean:function(e){this.insert.html(e,!1)},html:function(t,n){this.placeholder.remove(),typeof n=="undefined"&&(n=!0),this.$editor.focus(),t=this.clean.setVerified(t),n&&(t=this.clean.onPaste(t)),this.utils.browser("msie")?this.insert.htmlIe(t):(this.clean.singleLine?this.insert.execHtml(t):document.execCommand("insertHTML",!1,t),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each(e.proxy(this.utils.removeEmpty,this)),this.code.sync(),this.observe.load(),n&&this.clean.clearUnverified()},htmlFixMozilla:function(){if(!this.utils.browser("mozilla"))return;var t=e(this.selection.getBlock()).next();t.length>0&&t[0].tagName=="P"&&t.html()===""&&t.remove()},htmlIe:function(t){if(this.utils.isIe11()){var n=this.utils.isCurrentOrParent("P"),r=e("<div>").append(t),i=r.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");n&&i?this.insert.ie11FixInserting(n,t):this.insert.ie11PasteFrag(t);return}document.selection.createRange().pasteHTML(t)},execHtml:function(e){e=this.clean.setVerified(e),this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;var n=document.createDocumentFragment(),r,i;while(r=t.firstChild)i=n.appendChild(r);this.range.insertNode(n),this.range.collapse(!0),this.caret.setAfter(i)},node:function(t,n){t=t[0]||t;var r=this.utils.getOuterHtml(t);return r=this.clean.setVerified(r),r.match(/</g)!==null&&(t=e(r)[0]),this.selection.get(),n!==!1&&this.range.deleteContents(),this.range.insertNode(t),this.range.collapse(!1),this.selection.addRange(),t},nodeToPoint:function(e,t,n){e=e[0]||e,this.selection.get();var r;if(document.caretPositionFromPoint){var i=document.caretPositionFromPoint(t,n);this.range.setStart(i.offsetNode,i.offset),this.range.collapse(!0),this.range.insertNode(e)}else if(document.caretRangeFromPoint)r=document.caretRangeFromPoint(t,n),r.insertNode(e);else if(typeof document.body.createTextRange!="undefined"){r=document.body.createTextRange(),r.moveToPoint(t,n);var s=r.duplicate();s.moveToPoint(t,n),r.setEndPoint("EndToEnd",s),r.select()}},nodeToCaretPositionFromPoint:function(e,t){t=t[0]||t;var n,r=e.clientX,i=e.clientY;if(document.caretPositionFromPoint){var s=document.caretPositionFromPoint(r,i),o=document.getSelection();n=o.getRangeAt(0),n.setStart(s.offsetNode,s.offset),n.collapse(!0),n.insertNode(t)}else if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(r,i),n.insertNode(t);else if(typeof document.body.createTextRange!="undefined"){n=document.body.createTextRange(),n.moveToPoint(r,i);var u=n.duplicate();u.moveToPoint(r,i),n.setEndPoint("EndToEnd",u),n.select()}},ie11FixInserting:function(t,n){var r=document.createElement("span");r.className="redactor-ie-paste",this.insert.node(r);var i=e(t).html();i="<p>"+i.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+n+"<p>")+"</p>",i=i.replace(/<p><\/p>/gi,""),e(t).replaceWith(i)},ie11PasteFrag:function(e){this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;var n=document.createDocumentFragment(),r,i;while(r=t.firstChild)i=n.appendChild(r);this.range.insertNode(n),this.range.collapse(!1),this.selection.addRange()}}},keydown:function(){return{init:function(t){if(this.rtePaste)return;var n=t.which,r=n>=37&&n<=40;this.keydown.ctrl=t.ctrlKey||t.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(t,n),this.utils.isDesktop()&&(this.keydown.checkEvents(r,n),this.keydown.setupBuffer(t,n)),this.keydown.addArrowsEvent(r),this.keydown.setupSelectAll(t,n);var i=this.core.setCallback("keydown",t);if(i===!1)return t.preventDefault(),!1;if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(n===this.keyCode.DOWN||n===this.keyCode.RIGHT)){var s=!1,o=!1;this.keydown.block&&this.keydown.block.tagName==="TD"&&(o=e(this.keydown.block).closest("table",this.$editor[0])),o&&o.find("td").last()[0]===this.keydown.block&&(s=!0);if(this.utils.isEndOfElement()&&s){var u=e(this.opts.emptyHtml);o.after(u),this.caret.setStart(u)}}this.opts.enterKey&&n===this.keyCode.DOWN&&this.keydown.onArrowDown();if(!this.opts.enterKey&&n===this.keyCode.ENTER){t.preventDefault(),this.range.collapsed||this.range.deleteContents();return}if(n==this.keyCode.ENTER&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey){var a=this.core.setCallback("enter",t);if(a===!1)return t.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(t)===!0)return!1;var f,l;if(this.keydown.pre)return this.keydown.insertNewLine(t);if(this.keydown.blockquote||this.keydown.figcaption)return f=this.selection.getCurrent(),l=e(f).next(),l.length!==0&&l[0].tagName=="BR"?this.keydown.insertBreakLine(t):this.utils.isEndOfElement()&&f&&f!="SPAN"?this.keydown.insertDblBreakLine(t):this.keydown.insertBreakLine(t);if(this.opts.linebreaks&&!this.keydown.block)return f=this.selection.getCurrent(),l=e(this.keydown.current).next(),l.length!==0&&l[0].tagName=="BR"?this.keydown.insertBreakLine(t):f!==!1&&e(f).hasClass("redactor-invisible-space")?(this.caret.setAfter(f),e(f).contents().unwrap(),this.keydown.insertDblBreakLine(t)):this.utils.isEndOfEditor()?this.keydown.insertDblBreakLine(t):l.length===0&&f===!1&&typeof l.context!="undefined"?this.keydown.insertBreakLine(t):this.keydown.insertBreakLine(t);if(this.opts.linebreaks&&this.keydown.block)setTimeout(e.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block){setTimeout(e.proxy(this.keydown.replaceDivToParagraph,this),1);if(this.keydown.block.tagName==="LI"){f=this.selection.getCurrent();var c=e(f).closest("li",this.$editor[0]),h=c.closest("ul,ol",this.$editor[0]);if(c.length!==0&&this.utils.isEmpty(c.html())&&h.next().length===0&&this.utils.isEmpty(h.find("li").last().html())){h.find("li").last().remove();var u=e(this.opts.emptyHtml);return h.after(u),this.caret.setStart(u),!1}}}else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(t)}if(n===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey))return this.keydown.onShiftEnter(t);if(n===this.keyCode.TAB||t.metaKey&&n===221||t.metaKey&&n===219)return this.keydown.onTab(t,n);if(n===this.keyCode.BACKSPACE||n===this.keyCode.DELETE){var p=this.selection.getNodes();if(p){var d=p.length,v;for(var m=0;m<d;m++){var g=e(p[m]).children("img");if(g.length!==0){var y=this;e.each(g,function(t,n){var r=e(n);if(r.css("float")!="none")return;y.core.setCallback("imageDelete",n.src,r),v=n})}else p[m].tagName=="IMG"&&v!=p[m]&&(this.core.setCallback("imageDelete",p[m].src,e(p[m])),v=p[m])}}}if(n===this.keyCode.BACKSPACE){var b=this.selection.getBlock(),w=e(b).css("margin-left")!=="0px";if(b&&w&&this.range.collapsed&&this.utils.isStartOfElement()){this.indent.decrease(),t.preventDefault();return}if(this.utils.browser("mozilla")){var E=this.selection.getPrev(),S=e(E).prev()[0];E&&E.tagName==="HR"&&e(E).remove(),S&&S.tagName==="HR"&&e(S).remove()}this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(t)}this.code.sync()},checkEvents:function(e,t){!e&&(this.core.getEvent()=="click"||this.core.getEvent()=="arrow")&&(this.core.addEvent(!1),this.keydown.checkKeyEvents(t)&&this.buffer.set())},checkKeyEvents:function(t){var n=this.keyCode,r=[n.BACKSPACE,n.DELETE,n.ENTER,n.SPACE,n.ESC,n.TAB,n.CTRL,n.META,n.ALT,n.SHIFT];return e.inArray(t,r)==-1?!0:!1},addArrowsEvent:function(e){if(!e)return;if(this.core.getEvent()=="click"||this.core.getEvent()=="arrow"){this.core.addEvent(!1);return}this.core.addEvent("arrow")},setupBuffer:function(e,t){if(this.keydown.ctrl&&t===90&&!e.shiftKey&&!e.altKey&&this.opts.buffer.length){e.preventDefault(),this.buffer.undo();return}if(this.keydown.ctrl&&t===90&&e.shiftKey&&!e.altKey&&this.opts.rebuffer.length!==0){e.preventDefault(),this.buffer.redo();return}this.keydown.ctrl||(t==this.keyCode.BACKSPACE||t==this.keyCode.DELETE||t==this.keyCode.ENTER&&!e.ctrlKey&&!e.shiftKey||t==this.keyCode.SPACE)&&this.buffer.set()},setupSelectAll:function(e,t){this.keydown.ctrl&&t===65?this.utils.enableSelectAll():t!=this.keyCode.LEFT_WIN&&!this.keydown.ctrl&&this.utils.disableSelectAll()},onArrowDown:function(){var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption];for(var t=0;t<e.length;t++)if(e[t])return this.keydown.insertAfterLastElement(e[t]),!1},onShiftEnter:function(e){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e)},onTab:function(e,t){if(!this.opts.tabKey)return!0;if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===!1)return!0;e.preventDefault();var n;return this.keydown.pre&&!e.shiftKey?(n=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("	"),this.insert.node(n),this.code.sync()):this.opts.tabAsSpaces!==!1?(n=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(n),this.code.sync()):e.metaKey&&t===219?this.indent.decrease():e.metaKey&&t===221?this.indent.increase():e.shiftKey?this.indent.decrease():this.indent.increase(),!1},replaceDivToBreakLine:function(){var t=this.selection.getBlock(),n=t.innerHTML.replace(/<br\s?\/?>/gi,"");if((t.tagName==="DIV"||t.tagName==="P")&&n===""&&!e(t).hasClass("redactor-editor")){var r=document.createElement("br");return e(t).replaceWith(r),this.caret.setBefore(r),this.code.sync(),!1}},replaceDivToParagraph:function(){var t=this.selection.getBlock(),n=t.innerHTML.replace(/<br\s?\/?>/gi,"");if(t.tagName==="DIV"&&this.utils.isEmpty(n)&&!e(t).hasClass("redactor-editor")){var r=document.createElement("p");return r.innerHTML=this.opts.invisibleSpace,e(t).replaceWith(r),this.caret.setStart(r),this.code.sync(),!1}this.opts.cleanStyleOnEnter&&t.tagName=="P"&&e(t).removeAttr("class").removeAttr("style")},insertParagraph:function(e){e.preventDefault(),this.selection.get();var t=document.createElement("p");return t.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(t),this.caret.setStart(t),this.code.sync(),!1},exitFromBlockquote:function(t){if(!this.utils.isEndOfElement())return;var n=e.trim(e(this.keydown.block).html());if(n.search(/(<br\s?\/?>){2}$/i)!=-1){t.preventDefault();if(this.opts.linebreaks){var r=document.createElement("br");e(this.keydown.blockquote).after(r),this.caret.setBefore(r),e(this.keydown.block).html(n.replace(/<br\s?\/?>$/i,""))}else{var i=e(this.opts.emptyHtml);e(this.keydown.blockquote).after(i),this.caret.setStart(i)}return!0}return},insertAfterLastElement:function(t){if(!this.utils.isEndOfElement())return;this.buffer.set();if(this.opts.linebreaks){var n=e("<div>").append(e.trim(this.$editor.html())).contents(),r=n.last()[0];r.tagName=="SPAN"&&r.innerHTML===""&&(r=n.prev()[0]);if(this.utils.getOuterHtml(r)!=this.utils.getOuterHtml(t))return;var i=document.createElement("br");e(t).after(i),this.caret.setAfter(i)}else{if(this.$editor.contents().last()[0]!==t)return;var s=e(this.opts.emptyHtml);e(t).after(s),this.caret.setStart(s)}},insertNewLine:function(e){e.preventDefault();var t=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(t),this.caret.setAfter(t),this.code.sync(),!1},insertBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e,!0)},insertBreakLineProcessing:function(t,n){t.stopPropagation(),this.selection.get();var r=document.createElement("br");this.utils.browser("msie")?(this.range.collapse(!1),this.range.setEnd(this.range.endContainer,this.range.endOffset)):this.range.deleteContents(),this.range.insertNode(r);var i=e(r).parent("a");i.length>0&&(i.find(r).remove(),i.after(r));if(n===!0){var s=e(r).next();if(s.length!==0&&s[0].tagName==="BR"&&this.utils.isEndOfEditor())return this.caret.setAfter(r),this.code.sync(),!1;var o=document.createElement("br");this.range.insertNode(o),this.caret.setAfter(o)}else if(this.utils.browser("msie")){var u=document.createElement("span");u.innerHTML="&#x200b;",e(r).after(u),this.caret.setAfter(u),e(u).remove()}else{var a=document.createRange();a.setStartAfter(r),a.collapse(!0);var f=window.getSelection();f.removeAllRanges(),f.addRange(a)}return this.code.sync(),!1},removeInvisibleSpace:function(){var t=e(this.keydown.current);t.text().search(/^\u200B$/g)===0&&t.remove()},removeEmptyListInTable:function(t){var n=e(this.keydown.current),r=e(this.keydown.parent),i=n.closest("td",this.$editor[0]);if(i.length!==0&&n.closest("li",this.$editor[0])&&r.children("li").length===1){if(!this.utils.isEmpty(n.text()))return;t.preventDefault(),n.remove(),r.remove(),this.caret.setStart(i)}}}},keyup:function(){return{init:function(t){if(this.rtePaste)return;var n=t.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var r=this.utils.isRedactorParent(e(this.keyup.parent).parent()),i=this.core.setCallback("keyup",t);if(i===!1)return t.preventDefault(),!1;!this.opts.linebreaks&&this.keyup.current.nodeType==3&&this.keyup.current.length<=1&&(this.keyup.parent===!1||this.keyup.parent.tagName=="BODY")&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&this.keyup.current.tagName==="DIV"&&this.keyup.replaceToParagraph(!1),!this.opts.linebreaks&&e(this.keyup.parent).hasClass("redactor-invisible-space")&&(r===!1||r[0].tagName=="BODY")&&(e(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),this.linkify.isEnabled()&&this.linkify.isKey(n)&&this.linkify.format();if(n===this.keyCode.DELETE||n===this.keyCode.BACKSPACE){if(this.utils.browser("mozilla")){var s=e(this.keydown.current).closest("td",this.$editor[0]);if(s.size()!==0&&s.text()!=="")return t.preventDefault(),!1}return this.clean.clearUnverified(),this.observe.image?(t.preventDefault(),this.image.hideResize(),this.buffer.set(),this.image.remove(this.observe.image),this.observe.image=!1,!1):(this.$editor.find("p").each(e.proxy(function(t,n){this.utils.removeEmpty(t,e(n).html())},this)),this.opts.linebreaks&&this.keyup.current&&this.keyup.current.tagName=="DIV"&&this.utils.isEmpty(this.keyup.current.innerHTML)&&(e(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),e(this.keyup.current).remove()),this.keyup.formatEmpty(t))}},replaceToParagraph:function(t){var n=e(this.keyup.current),r;t===!1?r=e("<p>").append(n.html()):r=e("<p>").append(n.clone()),n.replaceWith(r);var i=e(r).next();typeof i[0]!="undefined"&&i[0].tagName=="BR"&&i.remove(),this.caret.setEnd(r)},formatEmpty:function(t){var n=e.trim(this.$editor.html());if(!this.utils.isEmpty(n))return;return t.preventDefault(),this.opts.linebreaks?(this.$editor.html(this.selection.getMarkerAsHtml()),this.selection.restore()):(this.$editor.html(this.opts.emptyHtml),this.focus.setStart()),this.code.sync(),!1}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(e){return typeof this.opts.curLang[e]!="undefined"?this.opts.curLang[e]:""}}},line:function(){return{insert:function(){this.buffer.set();var e=this.selection.getBlocks();if(e[0]!==!1&&this.line.isExceptLastOrFirst(e)){this.utils.browser("msie")||this.$editor.focus();return}this.utils.browser("msie")?this.line.insertInIe():this.line.insertInOthersBrowsers()},isExceptLastOrFirst:function(t){var n=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"],r=t[0].tagName.toLowerCase(),i=this.selection.getLastBlock();i=typeof i=="undefined"?r:i.tagName.toLowerCase();var s=e.inArray(r,n)!=-1,o=e.inArray(i,n)!=-1;if(s&&o||s)return!0},insertInIe:function(){this.utils.saveScroll(),this.buffer.set(),this.insert.node(document.createElement("hr")),this.utils.restoreScroll(),this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var e='<p id="redactor-insert-line"><br /></p>';this.opts.linebreaks&&(e='<br id="redactor-insert-line">'),document.execCommand("insertHtml",!1,"<hr>"+e),this.line.setFocus(),this.code.sync()},setFocus:function(){var t=this.$editor.find("#redactor-insert-line"),n=e(t).next()[0],r=n;this.utils.browser("mozilla")&&n&&n.innerHTML===""&&(r=e(n).next()[0],e(n).remove()),r?(t.remove(),this.opts.linebreaks||(this.$editor.focus(),this.line.setStart(r))):(t.removeAttr("id"),this.line.setStart(t[0]))},setStart:function(e){if(typeof e=="undefined")return;var t=document.createTextNode("​");this.selection.get(),this.range.setStart(e,0),this.range.insertNode(t),this.range.collapse(!0),this.selection.addRange()}}},link:function(){return{show:function(t){typeof t!="undefined"&&t.preventDefault&&t.preventDefault(),this.observe.isCurrent("a")?this.modal.load("link",this.lang.get("link_edit"),600):this.modal.load("link",this.lang.get("link_insert"),600),this.modal.createCancelButton();var n=this.observe.isCurrent("a")?this.lang.get("edit"):this.lang.get("insert");this.link.buttonInsert=this.modal.createActionButton(n),this.selection.get(),this.link.getData(),this.link.cleanUrl(),this.link.target=="_blank"&&e("#redactor-link-blank").prop("checked",!0),this.link.$inputUrl=e("#redactor-link-url"),this.link.$inputText=e("#redactor-link-url-text"),this.link.$inputText.val(this.link.text),this.link.$inputUrl.val(this.link.url),this.link.buttonInsert.on("click",e.proxy(this.link.insert,this)),e(".redactor-link-tooltip").remove(),this.selection.save(),this.modal.show(),this.link.$inputUrl.focus()},cleanUrl:function(){var e=self.location.href.replace(/\/$/i,"");if(typeof this.link.url!="undefined"){this.link.url=this.link.url.replace(e,""),this.link.url=this.link.url.replace(/^\/#/,"#"),this.link.url=this.link.url.replace("mailto:","");if(!this.opts.linkProtocol){var t=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(t,"")}}},getData:function(){this.link.$node=!1;var t=e(this.selection.getCurrent()).closest("a",this.$editor[0]);t.length!==0&&t[0].tagName==="A"?(this.link.$node=t,this.link.url=t.attr("href"),this.link.text=t.text(),this.link.target=t.attr("target")):(this.link.text=this.sel.toString(),this.link.url="",this.link.target="")},insert:function(){this.placeholder.remove();var t="",n=this.link.$inputUrl.val(),r=this.link.$inputText.val();if(e.trim(n)===""){this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){e(this).removeClass("redactor-input-error"),e(this).off("keyup")});return}if(n.search("@")!=-1&&/(http|ftp|https):\/\//i.test(n)===!1)n="mailto:"+n;else if(n.search("#")!==0){e("#redactor-link-blank").prop("checked")&&(t="_blank");var i="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",s=new RegExp("^(http|ftp|https)://"+i,"i"),o=new RegExp("^"+i,"i"),u=new RegExp(".(html|php)$","i");n.search(s)==-1&&n.search(u)==-1&&n.search(o)===0&&this.opts.linkProtocol&&(n=this.opts.linkProtocol+"://"+n)}this.link.set(r,n,t),this.modal.close()},set:function(t,n,r){t=e.trim(t.replace(/<|>/g,"")),this.selection.restore();var i=this.selection.getBlocks();this.utils.browser("mozilla")&&!this.focus.isFocused()&&this.focus.setStart();if(t===""&&n==="")return;t===""&&n!==""&&(t=n);if(this.link.$node){this.buffer.set();var s=this.link.$node,o=s.children();if(o.length>0){while(o.length)o=o.children();o=o.end()}else o=s;s.attr("href",n),o.text(t),r!==""?s.attr("target",r):s.removeAttr("target"),this.selection.selectElement(s),this.code.sync()}else{if(this.utils.browser("mozilla")&&this.link.text===""){var u=e("<a />").attr("href",n).text(t);r!==""&&u.attr("target",r),this.insert.node(u),this.selection.selectElement(u)}else{var u;if(this.utils.browser("msie"))u=e('<a href="'+n+'">').text(t),r!==""&&u.attr("target",r),u=e(this.insert.node(u)),this.selection.getText().match(/\s$/)&&u.after(" "),this.selection.selectElement(u);else{document.execCommand("createLink",!1,n),u=e(this.selection.getCurrent()).closest("a",this.$editor[0]),this.utils.browser("mozilla")&&(u=e('a[_moz_dirty=""]')),r!==""&&u.attr("target",r),u.removeAttr("style").removeAttr("_moz_dirty"),this.selection.getText().match(/\s$/)&&u.after(" ");if(this.link.text!==""||this.link.text!=t)!this.opts.linebreaks&&i&&i.length<=1&&u.text(t),this.selection.selectElement(u)}}this.code.sync(),this.core.setCallback("insertedLink",u)}setTimeout(e.proxy(function(){this.observe.links()},this),5)},unlink:function(t){typeof t!="undefined"&&t.preventDefault&&t.preventDefault();var n=this.selection.getNodes();if(!n)return;this.buffer.set();var r=n.length;for(var i=0;i<r;i++){var s=e(n[i]).closest("a",this.$editor[0]);s.replaceWith(s.contents())}e(".redactor-link-tooltip").remove(),this.code.sync()},toggleClass:function(e){this.link.setClass(e,"toggleClass")},addClass:function(e){this.link.setClass(e,"addClass")},removeClass:function(e){this.link.setClass(e,"removeClass")},setClass:function(t,n){var r=this.selection.getInlinesTags(["a"]);if(r===!1)return;e.each(r,function(){e(this)[n](t)})}}},linkify:function(){return{isKey:function(e){return e==this.keyCode.ENTER||e==this.keyCode.SPACE},isEnabled:function(){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&!this.utils.isCurrentOrParent("PRE")},format:function(){var t=this.linkify,n=this.opts;this.$editor.find(":not(iframe,img,a,pre)").addBack().contents().filter(function(){return this.nodeType===3&&e.trim(this.nodeValue)!=""&&!e(this).parent().is("pre")&&(this.nodeValue.match(n.linkify.regexps.youtube)||this.nodeValue.match(n.linkify.regexps.vimeo)||this.nodeValue.match(n.linkify.regexps.image)||this.nodeValue.match(n.linkify.regexps.url))}).each(function(){var r=e(this).text(),i=r;n.convertVideoLinks&&(i.match(n.linkify.regexps.youtube)||i.match(n.linkify.regexps.vimeo))?i=t.convertVideoLinks(i):n.convertImageLinks&&i.match(n.linkify.regexps.image)?i=t.convertImages(i):n.convertUrlLinks&&(i=t.convertLinks(i)),e(this).before(r.replace(r,i)).remove()});var r=this.$editor.find(".redactor-linkify-object").each(function(){var t=e(this);return t.removeClass("redactor-linkify-object"),t.attr("class")===""&&t.removeAttr("class"),t[0]});this.core.setCallback("linkify",r),this.code.sync()},convertVideoLinks:function(e){var t='<iframe class="redactor-linkify-object" width="500" height="281" src="',n='" frameborder="0" allowfullscreen></iframe>';return e.match(this.opts.linkify.regexps.youtube)&&(e=e.replace(this.opts.linkify.regexps.youtube,t+"//www.youtube.com/embed/$1"+n)),e.match(this.opts.linkify.regexps.vimeo)&&(e=e.replace(this.opts.linkify.regexps.vimeo,t+"//player.vimeo.com/video/$2"+n)),e},convertImages:function(e){var t=e.match(this.opts.linkify.regexps.image);return t&&(e=e.replace(e,'<img src="'+t+'" class="redactor-linkify-object" />'),this.opts.linebreaks&&(this.utils.isEmpty(this.code.get())||(e="<br>"+e)),e+="<br>"),e},convertLinks:function(t){var n=t.match(this.opts.linkify.regexps.url);if(n){n=e.grep(n,function(t,r){return e.inArray(t,n)===r});var r=n.length;for(var i=0;i<r;i++){var s=n[i],o=s,u=this.opts.linkProtocol+"://";s.match(/(https?|ftp):\/\//i)!==null&&(u=""),o.length>this.opts.linkSize&&(o=o.substring(0,this.opts.linkSize)+"..."),o=decodeURIComponent(o);var a="\\b";e.inArray(s.slice(-1),["/","&","="])!=-1&&(a="");var f=new RegExp("("+s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+a+")","g");t=t.replace(f,'<a href="'+u+e.trim(s)+'" class="redactor-linkify-object">'+e.trim(o)+"</a>")}}return t}}},list:function(){return{toggle:function(t){this.placeholder.remove(),this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var n=this.selection.getParent(),r=e(n).closest("ol, ul",this.$editor[0]);!this.utils.isRedactorParent(r)&&r.length!==0&&(r=!1);var i,s,o=!1;if(r&&r.length){o=!0;var u=r[0].tagName;i=t==="orderedlist"&&u==="UL",s=t==="unorderedlist"&&u==="OL"}i?this.utils.replaceToTag(r,"ol"):s?this.utils.replaceToTag(r,"ul"):o?this.list.remove(t):this.list.insert(t),this.selection.restore(),this.code.sync()},insert:function(t){var n=this.selection.getParent(),r=this.selection.getCurrent(),i=e(r).closest("td, th",this.$editor[0]);this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(t):document.execCommand("insert"+t);var n=this.selection.getParent(),s=e(n).closest("ol, ul",this.$editor[0]);if(i.length!==0){var o=i.prev(),u=i.html();i.html(""),!o||o.length!==1||o[0].tagName!=="TD"&&o[0].tagName!=="TH"?e(n).prepend(i):e(o).after(i),i.html(u)}if(this.utils.isEmpty(s.find("li").text())){var a=s.children("li");a.find("br").remove(),a.append(this.selection.getMarkerAsHtml()),this.opts.linebreaks&&this.utils.browser("mozilla")&&a.size()==2&&this.utils.isEmpty(a.eq(1).text())&&a.eq(1).remove()}if(s.length){var f=s.parent();this.utils.isRedactorParent(f)&&f[0].tagName!="LI"&&this.utils.isBlock(f[0])&&f.replaceWith(f.contents())}this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(t){var n=this.selection.wrap("div"),r=e(n).html(),i=t=="orderedlist"?e("<ol>"):e("<ul>"),s=e("<li>");if(e.trim(r)==="")s.append(this.selection.getMarkerAsHtml()),i.append(s),this.$editor.find("#selection-marker-1").replaceWith(i);else{var o=r.split(/<br\s?\/?>/gi);if(o)for(var u=0;u<o.length;u++)e.trim(o[u])!==""&&i.append(e("<li>").html(o[u]));else s.append(r),i.append(s);e(n).replaceWith(i)}},remove:function(t){e.inArray("ul",this.selection.getBlocks())&&(t="unorderedlist"),document.execCommand("insert"+t);var n=e(this.selection.getCurrent());this.indent.fixEmptyIndent(),!this.opts.linebreaks&&n.closest("li, th, td",this.$editor[0]).length===0&&(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each(e.proxy(this.utils.removeEmpty,this)));var r=e(this.selection.getCurrent()).closest("table",this.$editor[0]),i=r.prev();!this.opts.linebreaks&&r.length!==0&&i.length!==0&&i[0].tagName=="BR"&&i.remove(),this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit">'+"<label>"+this.lang.get("title")+"</label>"+'<input type="text" id="redactor-image-title" />'+'<label class="redactor-image-link-option">'+this.lang.get("link")+"</label>"+'<input type="text" id="redactor-image-link" class="redactor-image-link-option" aria-label="'+this.lang.get("link")+'" />'+'<label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link_new_tab")+'"> '+this.lang.get("link_new_tab")+"</label>"+'<label class="redactor-image-position-option">'+this.lang.get("image_position")+"</label>"+'<select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image_position")+'">'+'<option value="none">'+this.lang.get("none")+"</option>"+'<option value="left">'+this.lang.get("left")+"</option>"+'<option value="center">'+this.lang.get("center")+"</option>"+'<option value="right">'+this.lang.get("right")+"</option>"+"</select>"+"</section>",image:String()+'<section id="redactor-modal-image-insert">'+'<div id="redactor-modal-image-droparea"></div>'+"</section>",file:String()+'<section id="redactor-modal-file-insert">'+'<div id="redactor-modal-file-upload-box">'+"<label>"+this.lang.get("filename")+"</label>"+'<input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br>'+'<div id="redactor-modal-file-upload"></div>'+"</div>"+"</section>",link:String()+'<section id="redactor-modal-link-insert">'+"<label>URL</label>"+'<input type="url" id="redactor-link-url" aria-label="URL" />'+"<label>"+this.lang.get("text")+"</label>"+'<input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" />'+'<label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link_new_tab")+"</label>"+"</section>"},e.extend(this.opts,this.opts.modal)},addCallback:function(e,t){this.modal.callbacks[e]=t},createTabber:function(t){this.modal.$tabber=e("<div>").attr("id","redactor-modal-tabber"),t.prepend(this.modal.$tabber)},addTab:function(t,n,r){var i=e('<a href="#" rel="tab'+t+'">').text(n);r&&i.addClass("active");var s=this;i.on("click",function(t){t.preventDefault(),e(".redactor-tab").hide(),e(".redactor-"+e(this).attr("rel")).show(),s.modal.$tabber.find("a").removeClass("active"),e(this).addClass("active")}),this.modal.$tabber.append(i)},addTemplate:function(e,t){this.opts.modal[e]=t},getTemplate:function(e){return this.opts.modal[e]},getModal:function(){return this.$modalBody.find("section")},load:function(e,t,n){this.modal.templateName=e,this.modal.width=n,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(t),this.modal.setDraggable(),this.modal.setContent(),typeof this.modal.callbacks[e]!="undefined"&&this.modal.callbacks[e].call(this)},show:function(){this.utils.disableBodyScroll(),this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop(),this.opts.highContrast&&this.$modalBox.addClass("redactor-modal-contrast"),this.$modalOverlay.show(),this.$modalBox.show(),this.$modal.attr("tabindex","-1"),this.$modal.focus(),this.modal.setButtonsWidth(),this.utils.saveScroll(),this.utils.isMobile()||(setTimeout(e.proxy(this.modal.showOnDesktop,this),0),e(window).on("resize.redactor-modal",e.proxy(this.modal.resize,this))),this.core.setCallback("modalOpened",this.modal.templateName,this.$modal),e(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",e.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var t=this.$modal.outerHeight(),n=e(window).height(),r=e(window).width();if(this.modal.width>r){this.$modal.css({width:"96%",marginTop:n/2-t/2+"px"});return}t>n?this.$modal.css({width:this.modal.width+"px",marginTop:"20px"}):this.$modal.css({width:this.modal.width+"px",marginTop:n/2-t/2+"px"})},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop()},setTitle:function(e){this.$modalHeader.html(e)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){if(typeof e.fn.draggable=="undefined")return;this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move")},setEnter:function(e){if(e.which!=13)return;e.preventDefault(),this.$modal.find("button.redactor-modal-action-btn").click()},createCancelButton:function(){var t=e("<button>").addClass("redactor-modal-btn redactor-modal-close-btn").html(this.lang.get("cancel"));t.on("click",e.proxy(this.modal.close,this)),this.$modalFooter.append(t)},createDeleteButton:function(e){return this.modal.createButton(e,"delete")},createActionButton:function(e){return this.modal.createButton(e,"action")},createButton:function(t,n){var r=e("<button>").addClass("redactor-modal-btn").addClass("redactor-modal-"+n+"-btn").html(t);return this.$modalFooter.append(r),r},setButtonsWidth:function(){var e=this.$modalFooter.find("button"),t=e.length;if(t===0)return;e.css("width",100/t+"%")},build:function(){this.modal.buildOverlay(),this.$modalBox=e('<div id="redactor-modal-box"/>').hide(),this.$modal=e('<div id="redactor-modal" role="dialog" aria-labelledby="redactor-modal-header" />'),this.$modalHeader=e('<header id="redactor-modal-header"/>'),this.$modalClose=e('<button type="button" id="redactor-modal-close" tabindex="1" aria-label="Close" />').html("&times;"),this.$modalBody=e('<div id="redactor-modal-body" />'),this.$modalFooter=e("<footer />"),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalClose),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalFooter),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=e('<div id="redactor-modal-overlay">').hide(),e("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("click.redactor-modal",e.proxy(this.modal.close,this)),e(document).on("keyup.redactor-modal",e.proxy(this.modal.closeHandler,this)),this.$editor.on("keyup.redactor-modal",e.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",e.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("click.redactor-modal"),e(document).off("keyup.redactor-modal"),this.$editor.off("keyup.redactor-modal"),this.$modalBox.off("click.redactor-modal"),e(window).off("resize.redactor-modal")},closeHandler:function(e){if(e.which!=this.keyCode.ESC)return;this.modal.close(!1)},close:function(t){if(t){if(!e(t.target).hasClass("redactor-modal-close-btn")&&t.target!=this.$modalClose[0]&&t.target!=this.$modalBox[0])return;t.preventDefault()}if(!this.$modalBox)return;this.modal.disableEvents(),this.utils.enableBodyScroll(),this.$modalOverlay.remove(),this.$modalBox.fadeOut("fast",e.proxy(function(){this.$modalBox.remove(),setTimeout(e.proxy(this.utils.restoreScroll,this),0),t!==undefined&&this.selection.restore(),e(document.body).css("overflow",this.modal.bodyOveflow),this.core.setCallback("modalClosed",this.modal.templateName)},this))}}},observe:function(){return{load:function(){if(typeof this.opts.destroyed!="undefined")return;this.observe.images(),this.observe.links()},toolbar:function(e,t){this.observe.buttons(e,t),this.observe.dropdowns()},isCurrent:function(t,n){if(typeof n=="undefined")var n=e(this.selection.getCurrent());return n.is(t)||n.parents(t).length>0},dropdowns:function(){var t=e(this.selection.getCurrent());e.each(this.opts.observe.dropdowns,e.proxy(function(e,n){var r=n.observe,i=r.element,s=n.item,o=typeof r["in"]!="undefined"?r["in"]:!1,u=typeof r["out"]!="undefined"?r.out:!1;t.closest(i).size()>0?this.observe.setDropdownProperties(s,o,u):this.observe.setDropdownProperties(s,u,o)},this))},setDropdownProperties:function(e,t,n){n&&typeof n["attr"]!="undefined"&&this.observe.setDropdownAttr(e,n.attr,!0),typeof t["attr"]!="undefined"&&this.observe.setDropdownAttr(e,t.attr),typeof t["title"]!="undefined"&&e.text(t.title)},setDropdownAttr:function(t,n,r){e.each(n,function(e,n){e=="class"?r?t.removeClass(n):t.addClass(n):r?t.removeAttr(e):t.attr(e,n)})},addDropdown:function(e,t,n){if(typeof n.observe=="undefined")return;n.item=e,this.opts.observe.dropdowns.push(n)},buttons:function(t,n){var r=this.selection.getCurrent(),i=this.selection.getParent();t!==!1?this.button.setInactiveAll():this.button.setInactiveAll(n);if(t===!1&&n!=="html"){e.inArray(n,this.opts.activeButtons)!=-1&&this.button.toggleActive(n);return}e.each(this.opts.activeButtonsStates,e.proxy(function(t,n){var s=e(i).closest(t,this.$editor[0]),o=e(r).closest(t,this.$editor[0]);if(s.length!==0&&!this.utils.isRedactorParent(s))return;if(!this.utils.isRedactorParent(o))return;(s.length!==0||o.closest(t,this.$editor[0]).length!==0)&&this.button.setActive(n)},this));var s=e(i).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(this.utils.isRedactorParent(i)&&s.length){var o=s.css("text-align")===""?"left":s.css("text-align");this.button.setActive("align"+o)}},addButton:function(e,t){this.opts.activeButtons.push(t),this.opts.activeButtonsStates[e]=t},images:function(){this.$editor.find("img").each(e.proxy(function(t,n){var r=e(n);r.closest("a",this.$editor[0]).on("click",function(e){e.preventDefault()}),this.utils.browser("msie")&&r.attr("unselectable","on"),this.image.setEditable(r)},this)),e(document).on("click.redactor-image-delete."+this.uuid,e.proxy(function(e){this.observe.image=!1,e.target.tagName=="IMG"&&this.utils.isRedactorParent(e.target)&&(this.observe.image=this.observe.image&&this.observe.image==e.target?!1:e.target)},this))},links:function(){if(!this.opts.linkTooltip)return;this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.showTooltip,this)),this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this)),e(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,e.proxy(this.observe.closeTooltip,this))},getTooltipPosition:function(e){return e.offset()},showTooltip:function(t){var n=e(t.target);if(n[0].tagName=="IMG")return;n[0].tagName!=="A"&&(n=n.closest("a",this.$editor[0]));if(n[0].tagName!=="A")return;var r=n,i=this.observe.getTooltipPosition(r),s=e('<span class="redactor-link-tooltip"></span>'),o=r.attr("href");o===undefined&&(o=""),o.length>24&&(o=o.substring(0,24)+"...");var u=e('<a href="'+r.attr("href")+'" target="_blank" />').html(o).addClass("redactor-link-tooltip-action"),a=e('<a href="#" />').html(this.lang.get("edit")).on("click",e.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),f=e('<a href="#" />').html(this.lang.get("unlink")).on("click",e.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");s.append(u).append(" | ").append(a).append(" | ").append(f),s.css({top:i.top+parseInt(r.css("line-height"),10)+"px",left:i.left+"px"}),e(".redactor-link-tooltip").remove(),e("body").append(s)},closeTooltip:function(t){t=t.originalEvent||t;var n=t.target,r=e(n).closest("a",this.$editor[0]);if(r.length!==0&&r[0].tagName==="A"&&n.tagName!=="A")return;if(n.tagName==="A"&&this.utils.isRedactorParent(n)||e(n).hasClass("redactor-link-tooltip-action"))return;e(".redactor-link-tooltip").remove()}}},paragraphize:function(){return{load:function(t){return this.opts.linebreaks?t:t===""||t==="<p></p>"?this.opts.emptyHtml:(t+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,t=t.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),t=this.paragraphize.getSafes(t),t=this.paragraphize.getSafesComments(t),t=this.paragraphize.replaceBreaksToNewLines(t),t=this.paragraphize.replaceBreaksToParagraphs(t),t=this.paragraphize.clear(t),t=this.paragraphize.restoreSafes(t),t=t.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),e.trim(t))},getSafes:function(t){var n=e("<div />").append(t);return n.find("blockquote p").replaceWith(function(){return e(this).append("<br />").contents()}),t=n.html(),n.find(this.opts.paragraphizeBlocks.join(", ")).each(e.proxy(function(e,n){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=n.outerHTML,t=t.replace(n.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),t},getSafesComments:function(t){var n=t.match(/<!--([\w\W]*?)-->/gi);return n?(e.each(n,e.proxy(function(e,n){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=n,t=t.replace(n,"\n{replace"+this.paragraphize.z+"}")},this)),t):t},restoreSafes:function(t){return e.each(this.paragraphize.safes,function(e,n){n=typeof n!="undefined"?n.replace(/\$/g,"&#36;"):n,t=t.replace("{replace"+e+"}",n)}),t},replaceBreaksToParagraphs:function(e){var t=e.split(new RegExp("\n","g"),-1);e="";if(t){var n=t.length;for(var r=0;r<n;r++){if(!t.hasOwnProperty(r))return;t[r].search("{replace")==-1?(t[r]=t[r].replace(/<p>\n\t?<\/p>/gi,""),t[r]=t[r].replace(/<p><\/p>/gi,""),t[r]!==""&&(e+="<p>"+t[r].replace(/^\n+|\n+$/g,"")+"</p>")):e+=t[r]}}return e},replaceBreaksToNewLines:function(e){return e=e.replace(/<br \/>\s*<br \/>/gi,"\n\n"),e=e.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />"),e=e.replace(new RegExp("\r\n","g"),"\n"),e=e.replace(new RegExp("\r","g"),"\n"),e=e.replace(new RegExp("/\n\n+/"),"g","\n\n"),e},clear:function(e){return e=e.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),e=e.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),e=e.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),e=e.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),e=e.replace(new RegExp("<p><p ","gi"),"<p "),e=e.replace(new RegExp("<p><p>","gi"),"<p>"),e=e.replace(new RegExp("</p></p>","gi"),"</p>"),e=e.replace(new RegExp("<p>\\s?</p>","gi"),""),e=e.replace(new RegExp("\n</p>","gi"),"</p>"),e=e.replace(new RegExp("<p>	?	?\n?<p>","gi"),"<p>"),e=e.replace(new RegExp("<p>	*</p>","gi"),""),e}}},paste:function(){return{init:function(t){if(!this.opts.cleanOnPaste){setTimeout(e.proxy(this.code.sync,this),1);return}this.rtePaste=!0,this.buffer.set(),this.selection.save(),this.utils.saveScroll(),this.paste.createPasteBox(),e(window).on("scroll.redactor-freeze",e.proxy(function(){e(window).scrollTop(this.saveBodyScroll)},this)),setTimeout(e.proxy(function(){var t=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(t),e(window).off("scroll.redactor-freeze"),this.linkify.isEnabled()&&this.linkify.format()},this),1)},createPasteBox:function(){this.$pasteBox=e("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.utils.browser("msie")?this.$box.append(this.$pasteBox):e(".modal-body").length>0?e(".modal-body").append(this.$pasteBox):e("body").append(this.$pasteBox),this.$pasteBox.focus()},insert:function(t){t=this.core.setCallback("pasteBefore",t),t=this.utils.isSelectAll()?this.clean.onPaste(t,!1):this.clean.onPaste(t),t=this.core.setCallback("paste",t),this.utils.isSelectAll()?this.insert.set(t,!1):this.insert.html(t,!1),this.utils.disableSelectAll(),this.rtePaste=!1,setTimeout(e.proxy(this.clean.clearUnverified,this),10),setTimeout(e.proxy(function(){var t=this.$editor.find("span");e.each(t,function(t,n){var r=n.innerHTML.replace(/\u200B/,"");r===""&&n.attributes.length===0&&e(n).remove()})},this),10)}}},placeholder:function(){return{enable:function(){if(!this.placeholder.is())return;this.$editor.attr("placeholder",this.$element.attr("placeholder")),this.placeholder.toggle(),this.$editor.on("keydown.redactor-placeholder",e.proxy(this.placeholder.toggle,this))},toggle:function(){setTimeout(e.proxy(function(){var e=this.utils.isEmpty(this.$editor.html(),!1)?"addClass":"removeClass";this.$editor[e]("redactor-placeholder")},this),5)},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){return this.opts.placeholder?this.$element.attr("placeholder",this.opts.placeholder):typeof this.$element.attr("placeholder")!="undefined"&&this.$element.attr("placeholder")!==""}}},progress:function(){return{show:function(){e(document.body).append(e('<div id="redactor-progress"><span></span></div>')),e("#redactor-progress").fadeIn()},hide:function(){e("#redactor-progress").fadeOut(1500,function(){e(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange()},addRange:function(){try{this.sel.removeAllRanges()}catch(e){}this.sel.addRange(this.range)},getCurrent:function(){var e=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(e=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(e)},getParent:function(t){return t=t||this.selection.getCurrent(),t?this.utils.isRedactorParent(e(t).parent()[0]):!1},getPrev:function(){return window.getSelection().anchorNode.previousSibling},getNext:function(){return window.getSelection().anchorNode.nextSibling},getBlock:function(t){t=t||this.selection.getCurrent();while(t){if(this.utils.isBlockTag(t.tagName))return e(t).hasClass("redactor-editor")?!1:t;t=t.parentNode}return!1},getInlines:function(t,n){this.selection.get();if(this.range&&this.range.collapsed)return!1;var r=[];t=typeof t=="undefined"||t===!1?this.selection.getNodes():t;var i=this.opts.inlineTags;i.push("span");if(typeof n!="undefined")for(var s=0;s<n.length;s++)i.push(n[s]);return e.each(t,e.proxy(function(t,n){e.inArray(n.tagName.toLowerCase(),i)!=-1&&r.push(n)},this)),r.length===0?!1:r},getInlinesTags:function(t){this.selection.get();if(this.range&&this.range.collapsed)return!1;var n=[],r=this.selection.getNodes();return e.each(r,e.proxy(function(r,i){e.inArray(i.tagName.toLowerCase(),t)!=-1&&n.push(i)},this)),n.length===0?!1:n},getBlocks:function(t){this.selection.get();if(this.range&&this.range.collapsed)return[this.selection.getBlock()];var n=[];return t=typeof t=="undefined"?this.selection.getNodes():t,e.each(t,e.proxy(function(e,t){this.utils.isBlock(t)&&(this.selection.lastBlock=t,n.push(t))},this)),n.length===0?[this.selection.getBlock()]:n},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var t=this.selection.getNodesMarker(1),n=this.selection.getNodesMarker(2);if(this.range.collapsed===!1){if(window.getSelection){var r=window.getSelection();if(r.rangeCount>0){var i=r.getRangeAt(0),s=i.startContainer,o=i.startOffset,u=i.cloneRange();u.collapse(!1),u.insertNode(n),u.setStart(s,o),u.collapse(!0),u.insertNode(t),i.setStartAfter(t),i.setEndBefore(n),r.removeAllRanges(),r.addRange(i)}}}else this.selection.setNodesMarker(this.range,t,!0),n=t;var a=[],f=0,l=this;this.$editor.find("*").each(function(){if(this==t){var r=e(this).parent();r.length!==0&&r[0].tagName!="BODY"&&l.utils.isRedactorParent(r[0])&&a.push(r[0]),a.push(this),f=1}else f>0&&(a.push(this),f+=1);if(this==n)return!1});var c=[],h=a.length;for(var p=0;p<h;p++)a[p].id!="nodes-marker-1"&&a[p].id!="nodes-marker-2"&&c.push(a[p]);return this.selection.removeNodesMarkers(),c},getNodesMarker:function(t){return e('<span id="nodes-marker-'+t+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(e,t,n){var e=e.cloneRange();try{e.collapse(n),e.insertNode(t)}catch(r){}},removeNodesMarkers:function(){e(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(e,t){this.caret.setOffset(e,t)},wrap:function(e){this.selection.get();if(this.range.collapsed)return!1;var t=document.createElement(e);return t.appendChild(this.range.extractContents()),this.range.insertNode(t),t},selectElement:function(e){this.caret.set(e,0,e,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var e=this.selection.getMarker(1);this.selection.setMarker(this.range,e,!0);if(this.range.collapsed===!1){var t=this.selection.getMarker(2);this.selection.setMarker(this.range,t,!1)}this.savedSel=this.$editor.html()},getMarker:function(t){return typeof t=="undefined"&&(t=1),e('<span id="selection-marker-'+t+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(e){return this.utils.getOuterHtml(this.selection.getMarker(e))},setMarker:function(e,t,n){e=e.cloneRange();try{e.collapse(n),e.insertNode(t)}catch(r){this.focus.setStart()}},restore:function(){var e=this.$editor.find("span#selection-marker-1"),t=this.$editor.find("span#selection-marker-2");e.length!==0&&t.length!==0?this.caret.set(e,0,t,0):e.length!==0?this.caret.set(e,0,e,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(t,n){var r=e(n).text().replace(/\u200B/g,"");r===""?e(n).remove():e(n).replaceWith(function(){return e(this).contents()})})},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var e="";this.selection.get();if(this.sel.rangeCount){var t=document.createElement("div"),n=this.sel.rangeCount;for(var r=0;r<n;++r)t.appendChild(this.sel.getRangeAt(r).cloneContents());e=t.innerHTML}return this.clean.onSync(e)},replaceSelection:function(e){this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;var n=document.createDocumentFragment(),r;while(r=t.firstChild)n.appendChild(r);this.range.insertNode(n)},replaceWithHtml:function(e){e=this.selection.getMarkerAsHtml(1)+e+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt?this.selection.replaceSelection(e):document.selection&&document.selection.createRange&&this.range.pasteHTML(e),this.selection.restore(),this.code.sync()}}},shortcuts:function(){return{init:function(t,n){if(!this.opts.shortcuts)return(t.ctrlKey||t.metaKey)&&(n===66||n===73)&&t.preventDefault(),!1;e.each(this.opts.shortcuts,e.proxy(function(n,r){var i=n.split(","),s=i.length;for(var o=0;o<s;o++)typeof i[o]=="string"&&this.shortcuts.handler(t,e.trim(i[o]),e.proxy(function(){var e;r.func.search(/\./)!="-1"?(e=r.func.split("."),typeof this[e[0]]!="undefined"&&this[e[0]][e[1]].apply(this,r.params)):this[r.func].apply(this,r.params)},this))},this))},handler:function(t,n,r){var i={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};n=n.toLowerCase().split(" ");var o=i[t.keyCode],u=String.fromCharCode(t.which).toLowerCase(),a="",f={};e.each(["alt","ctrl","meta","shift"],function(e,n){t[n+"Key"]&&o!==n&&(a+=n+"+")}),o&&(f[a+o]=!0),u&&(f[a+u]=!0,f[a+s[u]]=!0,a==="shift+"&&(f[s[u]]=!0));for(var l=0,c=n.length;l<c;l++)if(f[n[l]])return t.preventDefault(),r.apply(this,arguments)}}},tabifier:function(){return{get:function(e){if(!this.opts.tabifier)return e;var t=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],n=["li","dt","dt","h[1-6]","option","script"],r=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+t.join("|/?")+"|"+n.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+t.join("|/?")+"|/"+n.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+r.join("|")+")[ >]");var i=0,s=e.length,o=0,u=null,a=null,f="",l="",c="";this.tabifier.cleanlevel=0;for(;i<s;i++){o=i;if(-1==e.substr(i).indexOf("<"))return l+=e.substr(i),this.tabifier.finish(l);while(o<s&&e.charAt(o)!="<")o++;i!=o&&(c=e.substr(i,o-i),c.match(/^\s{2,}$/g)||("\n"==l.charAt(l.length-1)?l+=this.tabifier.getTabs():"\n"==c.charAt(0)&&(l+="\n"+this.tabifier.getTabs(),c=c.replace(/^\s+/,"")),l+=c),c.match(/\n/)&&(l+="\n"+this.tabifier.getTabs())),u=o;while(o<s&&">"!=e.charAt(o))o++;f=e.substr(u,o-u),i=o;var h;if("!--"==f.substr(1,3)){if(!f.match(/--$/)){while("-->"!=e.substr(o,3))o++;o+=2,f=e.substr(u,o-u),i=o}"\n"!=l.charAt(l.length-1)&&(l+="\n"),l+=this.tabifier.getTabs(),l+=f+">\n"}else"!"==f[1]?l=this.tabifier.placeTag(f+">",l):"?"==f[1]?l+=f+">\n":(h=f.match(/^<(script|style|pre)/i))?(h[1]=h[1].toLowerCase(),f=this.tabifier.cleanTag(f),l=this.tabifier.placeTag(f,l),a=String(e.substr(i+1)).toLowerCase().indexOf("</"+h[1]),a&&(c=e.substr(i+1,a),i+=a,l+=c)):(f=this.tabifier.cleanTag(f),l=this.tabifier.placeTag(f,l))}return this.tabifier.finish(l)},getTabs:function(){var e="";for(var t=0;t<this.tabifier.cleanlevel;t++)e+="	";return e},finish:function(e){return e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/,""),e=e.replace(/[\s\n]*$/,""),e=e.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.tabifier.cleanlevel=0,e},cleanTag:function(e){var t="";e=e.replace(/\n/g," "),e=e.replace(/\s{2,}/g," "),e=e.replace(/^\s+|\s+$/g," ");var n="";e.match(/\/$/)&&(n="/",e=e.replace(/\/+$/,""));var r;while(r=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(e))r[2]?t+=r[1].toLowerCase()+"="+r[2]:r[1]&&(t+=r[1].toLowerCase()),t+=" ",e=e.substr(r[0].length);return t.replace(/\s*$/,"")+n+">"},placeTag:function(e,t){var n=e.match(this.tabifier.newLevel);if(e.match(this.tabifier.lineBefore)||n)t=t.replace(/\s*$/,""),t+="\n";n&&"/"==e.charAt(1)&&this.tabifier.cleanlevel--,"\n"==t.charAt(t.length-1)&&(t+=this.tabifier.getTabs()),n&&"/"!=e.charAt(1)&&this.tabifier.cleanlevel++,t+=e;if(e.match(this.tabifier.lineAfter)||e.match(this.tabifier.newLevel))t=t.replace(/ *$/,"");return t}}},tidy:function(){return{setupAllowed:function(){this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1);if(this.opts.linebreaks)return;var e=["p","section"];this.opts.allowedTags&&this.tidy.addToAllowed(e),this.opts.deniedTags&&this.tidy.removeFromDenied(e)},addToAllowed:function(t){var n=t.length;for(var r=0;r<n;r++)e.inArray(t[r],this.opts.allowedTags)==-1&&this.opts.allowedTags.push(t[r])},removeFromDenied:function(t){var n=t.length;for(var r=0;r<n;r++){var i=e.inArray(t[r],this.opts.deniedTags);i!=-1&&this.opts.deniedTags.splice(i,1)}},load:function(t,n){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},e.extend(this.tidy.settings,n),t=this.tidy.removeComments(t),this.tidy.$div=e("<div />").append(t),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),t=this.tidy.$div.html(),this.tidy.$div.remove(),t},removeComments:function(e){return this.tidy.settings.removeComments?e.replace(/<!--[\s\S]*?-->/gi,""):e},replaceTags:function(t){if(!this.tidy.settings.replaceTags)return t;var n=this.tidy.settings.replaceTags.length,r=[],i=[];for(var s=0;s<n;s++)i.push(this.tidy.settings.replaceTags[s][1]),r.push(this.tidy.settings.replaceTags[s][0]);e.each(r,e.proxy(function(t,n){this.tidy.$div.find(n).replaceWith(function(){return e("<"+i[t]+" />",{html:e(this).html()})})},this))},replaceStyles:function(){if(!this.tidy.settings.replaceStyles)return;var t=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each(e.proxy(function(n,r){var i=e(r),s=i.attr("style");for(var o=0;o<t;o++)if(s&&s.match(new RegExp("^"+this.tidy.settings.replaceStyles[o][0],"i"))){var u=this.tidy.settings.replaceStyles[o][1];i.replaceWith(function(){var t=document.createElement(u);return e(t).append(e(this).contents())})}},this))},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(t,n){n.innerHTML===""?e(n).remove():e(n).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(t,n){if(e(n).hasClass("redactor-script-tag"))return;n.innerHTML===""?e(n).remove():e(n).contents().unwrap()})},removeAttr:function(){var t;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var n=[],r=[];t=this.tidy.settings.allowedAttr.length;for(var i=0;i<t;i++)n.push(this.tidy.settings.allowedAttr[i][0]),r.push(this.tidy.settings.allowedAttr[i][1]);this.tidy.$div.find("*").each(e.proxy(function(t,i){var s=e(i),o=e.inArray(s[0].tagName.toLowerCase(),n),u=this.tidy.removeAttrGetRemoves(o,r,s);u&&e.each(u,function(e,t){s.removeAttr(t)})},this))}if(this.tidy.settings.removeAttr){t=this.tidy.settings.removeAttr.length;for(var i=0;i<t;i++){var s=this.tidy.settings.removeAttr[i][1];e.isArray(s)&&(s=s.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[i][0]).removeAttr(s)}}},removeAttrGetRemoves:function(t,n,r){var i=[];return t==-1?e.each(r[0].attributes,function(e,t){i.push(t.name)}):n[t]=="*"?i=[]:e.each(r[0].attributes,function(r,s){e.isArray(n[t])?e.inArray(s.name,n[t])==-1&&i.push(s.name):n[t]!=s.name&&i.push(s.name)}),i},removeAttrs:function(t,n){return n=new RegExp(n,"g"),t.each(function(){var t=e(this),r=this.attributes.length-1;for(var i=r;i>=0;i--){var s=this.attributes[i];s&&s.specified&&s.name.search(n)>=0&&t.removeAttr(s.name)}})},removeEmpty:function(){if(!this.tidy.settings.removeEmpty)return;this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var t=e(this),n=t.text();n=n.replace(/\u200B/g,""),n=n.replace(/&nbsp;/gi,""),n=n.replace(/\s/g,""),n===""&&t.children().length===0&&t.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(!this.tidy.settings.removeDataAttr)return;var t=this.tidy.settings.removeDataAttr;e.isArray(this.tidy.settings.removeDataAttr)&&(t=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(t),"^(data-)")},removeWithoutAttr:function(){if(!this.tidy.settings.removeWithoutAttr)return;this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){this.attributes.length===0&&e(this).contents().unwrap()})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show",observe:{element:"a","in":{title:this.lang.get("link_edit")},out:{title:this.lang.get("link_insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{"class":"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons(),this.toolbar.hideButtonsOnMobile(),this.toolbar.isButtonSourceNeeded();if(this.opts.buttons.length===0)return;this.$toolbar=this.toolbar.createContainer(),this.toolbar.setOverflow(),this.toolbar.append(),this.toolbar.setFormattingTags(),this.toolbar.loadButtons(),this.toolbar.setFixed(),this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",e.proxy(this.observe.toolbar,this))},createContainer:function(){return e("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},setFormattingTags:function(){e.each(this.opts.toolbar.formatting.dropdown,e.proxy(function(t,n){e.inArray(t,this.opts.formatting)==-1&&delete this.opts.toolbar.formatting.dropdown[t]},this))},loadButtons:function(){e.each(this.opts.buttons,e.proxy(function(t,n){if(!this.opts.toolbar[n])return;if(n==="file"){if(this.opts.fileUpload===!1)return;if(!this.opts.fileUpload&&this.opts.s3===!1)return}if(n==="image"){if(this.opts.imageUpload===!1)return;if(!this.opts.imageUpload&&this.opts.s3===!1)return}var r=this.opts.toolbar[n];this.$toolbar.append(e("<li>").append(this.button.build(n,r)))},this))},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),e(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar)},setFixed:function(){if(!this.utils.isDesktop())return;if(this.opts.toolbarExternal)return;if(!this.opts.toolbarFixed)return;this.toolbar.observeScroll(),e(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,e.proxy(this.toolbar.observeScroll,this))},setOverflow:function(){this.utils.isMobile()&&this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},isButtonSourceNeeded:function(){if(this.opts.source)return;var e=this.opts.buttons.indexOf("html");e!==-1&&this.opts.buttons.splice(e,1)},hideButtons:function(){if(this.opts.buttonsHide.length===0)return;e.each(this.opts.buttonsHide,e.proxy(function(e,t){var n=this.opts.buttons.indexOf(t);this.opts.buttons.splice(n,1)},this))},hideButtonsOnMobile:function(){if(!this.utils.isMobile()||this.opts.buttonsHideOnMobile.length===0)return;e.each(this.opts.buttonsHideOnMobile,e.proxy(function(e,t){var n=this.opts.buttons.indexOf(t);this.opts.buttons.splice(n,1)},this))},observeScroll:function(){var t=e(this.opts.toolbarFixedTarget).scrollTop(),n=1;this.opts.toolbarFixedTarget===document&&(n=this.$box.offset().top),t>n?this.toolbar.observeScrollEnable(t,n):this.toolbar.observeScrollDisable()},observeScrollEnable:function(t,n){var r=this.opts.toolbarFixedTopOffset+t-n,i=0,s=n+this.$box.height()-32,o=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:"absolute",width:o,top:r+"px",left:i}),t>s&&e(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",t<s?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var t=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,n="fixed";this.opts.toolbarFixedTarget!==document&&(t=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,n="absolute"),e(".redactor-dropdown-"+this.uuid).each(function(){e(this).css({position:n,top:t+"px"})})},unsetDropdownsFixed:function(){var t=this.$toolbar.innerHeight()+this.$toolbar.offset().top;e(".redactor-dropdown-"+this.uuid).each(function(){e(this).css({position:"absolute",top:t+"px"})})}}},upload:function(){return{init:function(t,n,r){this.upload.direct=!1,this.upload.callback=r,this.upload.url=n,this.upload.$el=e(t),this.upload.$droparea=e('<div id="redactor-droparea" />'),this.upload.$placeholdler=e('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label")),this.upload.$input=e('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",e.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",e.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",e.proxy(function(e){e=e.originalEvent||e,this.upload.traverseFile(this.upload.$input[0].files[0],e)},this)),this.upload.$droparea.on("drop.redactor.upload",e.proxy(function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(e)},this))},directUpload:function(e,t){this.upload.direct=!0,this.upload.traverseFile(e,t)},onDrop:function(e){e=e.originalEvent||e;var t=e.dataTransfer.files;this.upload.traverseFile(t[0],e)},traverseFile:function(e,t){if(this.opts.s3){this.upload.setConfig(e),this.upload.s3uploadFile(e);return}var n=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(e);var r=this.upload.type=="image"?this.opts.imageUploadParam:this.opts.fileUploadParam;n.append(r,e)}this.progress.show(),this.core.setCallback("uploadStart",t,n),this.upload.sendData(n,t)},setConfig:function(e){this.upload.getType(e),this.upload.direct&&(this.upload.url=this.upload.type=="image"?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback=this.upload.type=="image"?this.image.insert:this.file.insert)},getType:function(e){this.upload.type="image",this.opts.imageTypes.indexOf(e.type)==-1&&(this.upload.type="file")},getHiddenFields:function(t,n){return t===!1||typeof t!="object"?n:(e.each(t,e.proxy(function(t,r){r!==null&&r.toString().indexOf("#")===0&&(r=e(r).val()),n.append(t,r)},this)),n)},sendData:function(t,n){this.upload.type=="image"?(t=this.upload.getHiddenFields(this.opts.uploadImageFields,t),t=this.upload.getHiddenFields(this.upload.imageFields,t)):(t=this.upload.getHiddenFields(this.opts.uploadFileFields,t),t=this.upload.getHiddenFields(this.upload.fileFields,t));var r=new XMLHttpRequest;r.open("POST",this.upload.url),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.onreadystatechange=e.proxy(function(){if(r.readyState==4){var t=r.responseText;t=t.replace(/^\[/,""),t=t.replace(/\]$/,"");var i;try{i=typeof t=="string"?e.parseJSON(t):t}catch(s){i={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(i,this.upload.direct,n)}},this),r.send(t)},onDrag:function(e){e.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(e,t){this.upload.imageFields[e]=t},removeImageFields:function(e){delete this.upload.imageFields[e]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(e,t){this.upload.fileFields[e]=t},removeFileFields:function(e){delete this.upload.fileFields[e]},s3uploadFile:function(t){this.upload.s3executeOnSignedUrl(t,e.proxy(function(e){this.upload.s3uploadToS3(t,e)},this))},s3executeOnSignedUrl:function(e,t){var n=new XMLHttpRequest,r="?";this.opts.s3.search(/\?/)!="-1"&&(r="&"),n.open("GET",this.opts.s3+r+"name="+e.name+"&type="+e.type,!0),n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined");var i=this;n.onreadystatechange=function(e){this.readyState==4&&this.status==200?(i.progress.show(),t(decodeURIComponent(this.responseText))):this.readyState==4&&this.status!=200},n.send()},s3createCORSRequest:function(e,t){var n=new XMLHttpRequest;return"withCredentials"in n?n.open(e,t,!0):typeof XDomainRequest!="undefined"?(n=new XDomainRequest,n.open(e,t)):n=null,n},s3uploadToS3:function(t,n){var r=this.upload.s3createCORSRequest("PUT",n);!r||(r.onload=e.proxy(function(){if(r.status==200){this.progress.hide();var e=n.split("?");if(!e[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop");var t={filelink:e[0]};if(this.upload.type=="file"){var i=e[0].split("/");t.filename=i[i.length-1]}this.upload.callback(t,this.upload.direct,!1)}},this),r.onerror=function(){},r.upload.onprogress=function(e){},r.setRequestHeader("Content-Type",t.type),r.setRequestHeader("x-amz-acl","public-read"),r.send(t))}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(e){return Object.prototype.toString.call(e)=="[object String]"},isEmpty:function(t,n){return t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/&nbsp;/gi,""),t=t.replace(/<\/?br\s?\/?>/g,""),t=t.replace(/\s/g,""),t=t.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),t=t.replace(/<iframe(.*?[^>])>$/i,"iframe"),t=t.replace(/<source(.*?[^>])>$/i,"source"),n!==!1&&(t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),t=e.trim(t),t===""},normalize:function(e){return typeof e=="undefined"?0:parseInt(e.replace("px",""),10)},hexToRgb:function(e){if(typeof e=="undefined")return;if(e.search(/^#/)==-1)return e;var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,n,r){return t+t+n+n+r+r});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgb("+parseInt(n[1],16)+", "+parseInt(n[2],16)+", "+parseInt(n[3],16)+")"},getOuterHtml:function(t){return e("<div>").append(e(t).eq(0).clone()).html()},getAlignmentElement:function(t){return e.inArray(t.tagName,this.opts.alignmentTags)!==-1?e(t):e(t).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(t,n){var r=e(t);return typeof r.attr(n)=="undefined"?!0:r.attr(n)===""?(r.removeAttr(n),!0):!1},removeEmpty:function(t,n){var r=e(e.parseHTML(n));r.find(".redactor-invisible-space").removeAttr("style").removeAttr("class");if(r.find("hr, br, img, iframe, source").length!==0)return;var i=e.trim(r.text());this.utils.isEmpty(i,!1)&&r.remove()},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=e(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=e(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){if(typeof this.saveScroll=="undefined"&&typeof this.saveBodyScroll=="undefined")return;e(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&e(this.opts.scrollTarget).scrollTop(this.saveTargetScroll)},createSpaceElement:function(){var e=document.createElement("span");return e.className="redactor-invisible-space",e.innerHTML=this.opts.invisibleSpace,e},removeInlineTags:function(t){var n=this.opts.inlineTags;n.push("span"),t.tagName=="PRE"&&n.push("a"),e(t).find(n.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(t,n){var r=this;return e(t).replaceWith(function(){return n===!0&&r.utils.removeInlineTags(this),e(this).contents()}),e(t)},replaceToTag:function(t,n,r){var i,s=this;return e(t).replaceWith(function(){i=e("<"+n+" />").append(e(this).contents());for(var t=0;t<this.attributes.length;t++)i.attr(this.attributes[t].name,this.attributes[t].value);return r===!0&&s.utils.removeInlineTags(i),i}),i},isStartOfElement:function(){var e=this.selection.getBlock();if(!e)return!1;var t=this.caret.getOffsetOfElement(e);return t===0?!0:!1},isEndOfElement:function(t){if(typeof t=="undefined"){var t=this.selection.getBlock();if(!t)return!1}var n=this.caret.getOffsetOfElement(t),r=e.trim(e(t).text()).replace(/\n\r\n/g,"");return n==r.length?!0:!1},isEndOfEditor:function(){var t=this.$editor[0],n=this.caret.getOffsetOfElement(t),r=e.trim(e(t).html().replace(/(<([^>]+)>)/gi,""));return n==r.length?!0:!1},isBlock:function(e){return e=e[0]||e,e&&this.utils.isBlockTag(e.tagName)},isBlockTag:function(e){return typeof e=="undefined"?!1:this.reIsBlock.test(e)},isTag:function(t,n){var r=e(t).closest(n,this.$editor[0]);return r.length==1?r[0]:!1},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},isRedactorParent:function(t){return t?e(t).parents(".redactor-editor").length===0||e(t).hasClass("redactor-editor")?!1:t:!1},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(t){var n=this.selection.getParent(),r=this.selection.getCurrent();if(e.isArray(t)){var i=0;return e.each(t,e.proxy(function(e,t){this.utils.isCurrentOrParentOne(r,n,t)&&i++},this)),i===0?!1:!0}return this.utils.isCurrentOrParentOne(r,n,t)},isCurrentOrParentOne:function(e,t,n){return n=n.toUpperCase(),t&&t.tagName===n?t:e&&e.tagName===n?e:!1},isOldIe:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9?!0:!1},isLessIe10:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10?!0:!1},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(e){var t=navigator.userAgent.toLowerCase(),n=/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return e=="safari"?typeof n[3]!="undefined"?n[3]=="safari":!1:e=="version"?n[2]:e=="webkit"?n[1]=="chrome"||n[1]=="opr"||n[1]=="webkit":n[1]=="rv"?e=="msie":n[1]=="opr"?e=="webkit":e==n[1]},strpos:function(e,t,n){var r=e.indexOf(t,n);return r>=0?r:!1},disableBodyScroll:function(){var t=e("html"),n=window.innerWidth;if(!n){var r=document.documentElement.getBoundingClientRect();n=r.right-Math.abs(r.left)}var i=document.body.clientWidth<n,s=this.utils.measureScrollbar();t.css("overflow","hidden"),i&&t.css("padding-right",s)},measureScrollbar:function(){var t=e("body"),n=document.createElement("div");n.className="redactor-scrollbar-measure",t.append(n);var r=n.offsetWidth-n.clientWidth;return t[0].removeChild(n),r},enableBodyScroll:function(){e("html").css({overflow:"","padding-right":""}),e("body").remove("redactor-scrollbar-measure")}}}},e(window).on("load.tools.redactor",function(){e('[data-tools="redactor"]').redactor()}),n.prototype.init.prototype=n.prototype}(jQuery),define("deps/redactor/redactor",function(){});if(!RedactorPlugins)var RedactorPlugins={};(function(e){RedactorPlugins.fontcolor=function(){return{init:function(){var e=["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],t=["fontcolor","backcolor"];for(var n=0;n<2;n++){var r=t[n],i=this.button.add(r,this.lang.get(r)),s=this.button.addDropdown(i);s.width(242),this.fontcolor.buildPicker(s,r,e)}},buildPicker:function(t,n,r){var i=n=="backcolor"?"background-color":"color",s=r.length,o=this,u=function(t){t.preventDefault(),o.fontcolor.set(e(this).data("rule"),e(this).attr("rel"))};for(var a=0;a<s;a++){var f=r[a],l=e('<a rel="'+f+'" data-rule="'+i+'" href="#" style="float: left; font-size: 0; border: 2px solid #fff; padding: 0; margin: 0; width: 22px; height: 22px;"></a>');l.css("background-color",f),l.on("click",u),t.append(l)}var c=e('<a href="#" style="display: block; clear: both; padding: 5px; font-size: 12px; line-height: 1;"></a>').html(this.lang.get("none"));c.on("click",e.proxy(function(e){e.preventDefault(),this.fontcolor.remove(i)},this)),t.append(c)},set:function(e,t){this.inline.format("span","style",e+": "+t+";")},remove:function(e){this.inline.removeStyleRule(e)}}}})(jQuery),define("deps/redactor/fontcolor",function(){});if(!RedactorPlugins)var RedactorPlugins={};(function(e){RedactorPlugins.fontsize=function(){return{init:function(){var t=[10,11,12,14,16,18,20,24,28,30],n=this,r={};e.each(t,function(e,t){r["s"+e]={title:t+"px",func:function(){n.fontsize.set(t)}}}),r.remove={title:"Remove Font Size",func:n.fontsize.reset};var i=this.button.add("fontsize","Change Font Size");this.button.addDropdown(i,r)},set:function(e){this.inline.format("span","style","font-size: "+e+"px;")},reset:function(){this.inline.removeStyleRule("font-size")}}}})(jQuery),define("deps/redactor/fontsize",function(){}),define("modules/panel.inputs",["jquery","helper.ace","deps/chosen.jquery","deps/colorpicker","util.image-uploader"],function($,aceHelper,chosen){handleInputTogglesInContainer=function(e){e.each(function(){$(this).find('[id*="input-"]').reverse().each(function(){handleInputToggle($(this))})})},handleInputToggle=function(e,t){if(!e||!e.length||typeof e.attr("data-toggle")=="undefined")return;var n=$.parseJSON(e.attr("data-toggle")),r=".panel";if(e.parents(".repeater-group").length)var r=".repeater-group";if(typeof t=="undefined")var t=e.val().toString();e.attr("type")=="checkbox"&&(e.is(":checked")?t="true":t="false");if(t&&n&&typeof n=="object"&&n.hasOwnProperty(t)){if(typeof n[t].show=="string"){var i=e.parents(r).find(n[t].show);i.show(),i.find("*[data-toggle]").not(e).each(function(){handleInputToggle($(this))})}else typeof n[t].show=="object"&&$.each(n[t].show,function(t,n){var i=e.parents(r).find(n).show();i.show(),i.find("*[data-toggle]").not(e).each(function(){handleInputToggle($(this))})});if(typeof n[t].hide=="string"){var s=e.parents(r).find(n[t].hide);s.find("*[data-toggle]").not(e).each(function(){handleInputToggleHideAll($(this))}),s.hide()}else typeof n[t].hide=="object"&&$.each(n[t].hide,function(t,n){var i=e.parents(r).find(n);i.find("*[data-toggle]").not(e).each(function(){handleInputToggleHideAll($(this))}),i.hide()})}},handleInputToggleHideAll=function(e){if(!e||!e.length||typeof e.attr("data-toggle")=="undefined")return;var t=$.parseJSON(e.attr("data-toggle")),n=".panel";if(e.parents(".input").parent().attr("class")==="repeater-group")var n=".repeater-group";$.each(t,function(t,r){if(typeof r.hide=="undefined"||!r.hide||!r.hide.length)return;if(typeof r.hide=="string"){var i=e.parents(n).find(r.hide);i.hide()}else typeof r.hide=="object"&&$.each(r.hide,function(t,r){var i=e.parents(n).find(r);i.hide()})})};var panelInputs={delegate:function(){var context="div#panel";$(context).delegate("div.input-select select","change",function(){dataHandleInput($(this));var e=$(this),t=$(this).val();handleInputToggle(e,t)}),$(context).delegate("div.input-text input","keyup blur",function(){dataHandleInput($(this))}),$(context).delegate("div.input-textarea textarea","keyup blur",function(){dataHandleInput($(this))}),$(context).delegate("div.input-textarea span.textarea-open","click",function(){var e=$(this).siblings(".textarea-container"),t=e.find("textarea"),n=$(this).parents(".input").offset();e.css({top:n.top-e.outerHeight(!0),left:n.left}),$("div.sub-tabs-content-container").css("overflow-y","hidden"),e.data("visible")!==!0?(e.show(),e.data("visible",!0),t.trigger("focus"),$(document).bind("mousedown",{textareaContainer:e},textareaClose),Headway.iframe.contents().bind("mousedown",{textareaContainer:e},textareaClose),$(window).bind("resize",{textareaContainer:e},textareaClose)):(e.hide(),e.data("visible",!1),$("div.sub-tabs-content-container").css("overflow-y","auto"),$(document).unbind("mousedown",textareaClose),Headway.iframe.contents().unbind("mousedown",textareaClose),$(window).unbind("resize",textareaClose))}),textareaClose=function(e){if($(e.target).parents("div.input-textarea div.input-right").length===1)return;var t=e.data.textareaContainer;t.hide(),t.data("visible",!1),$("div.sub-tabs-content-container").css("overflow-y","auto"),$(document).unbind("mousedown",textareaClose),Headway.iframe.contents().unbind("mousedown",textareaClose),$(window).unbind("resize",textareaClose)},$(context).delegate("div.input-code span.code-editor-open","click",function(){var e=$(this).siblings("textarea");aceHelper.showEditor(e.attr("id"),$(this).data("editor-mode"),e.val(),function(t){e.val(t.getValue()),dataHandleInput(e)})}),inputWYSIWYGChange=function(e){dataHandleInput(this.$element,this.code.get())},inputWYSIWYGTextareaChange=function(){dataHandleInput($(this))},$(context).delegate("div.input-wysiwyg span.wysiwyg-open","click",function(){var e=$(this).siblings(".wysiwyg-container"),t=$(this).parents(".input").offset(),n=t.top-e.outerHeight(!0);n<50&&(n=50),e.css({top:n,left:t.left}),$("div.sub-tabs-content-container").css("overflow-y","hidden");if(e.data("visible")!==!0){e.show(),e.css("marginLeft",""),e.data("visible",!0);if($("div#side-panel-container").length)var r=$("div#side-panel-container").outerWidth()-$("div#side-panel-container").css("right").replace("px","");else var r=0;var i=$(document).width()-r-(e.offset().left+e.width());i<0&&e.css("marginLeft",i-30);var s=function(){var t=e.find("textarea").redactor({path:Headway.headwayURL+"/library/resources/redactor/",plugins:["fontcolor","fontsize"],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","table","link","|","image","|","alignleft","aligncenter","alignright","|","horizontalrule"],allowedTags:["inline","code","span","div","label","a","br","p","b","i","del","strike","u","img","video","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6","frame","frameset","script","hgroup","form","label","input","textarea","select","fieldset","legend"],changeCallback:inputWYSIWYGChange,blurCallback:inputWYSIWYGChange,imageUpload:Headway.ajaxURL+"?action=headway_visual_editor&method=redactor_upload_image&security="+Headway.security,convertDivs:!1,focus:!0,focusEnd:!0});e.find("textarea").bind("keyup",inputWYSIWYGTextareaChange),e.data("setupRedactor",!0),e.resizable({start:showIframeOverlay,stop:hideIframeOverlay})};require(["deps/redactor/redactor","deps/redactor/fontcolor","deps/redactor/fontsize"],function(){e.data("setupRedactor")!==!0&&s()}),$(document).bind("mousedown",{wysiwygContainer:e},wysiwygClose),Headway.iframe.contents().bind("mousedown",{wysiwygContainer:e},wysiwygClose),$(window).bind("resize",{wysiwygContainer:e},wysiwygClose)}else e.hide(),e.data("visible",!1),$("div.sub-tabs-content-container").css("overflow-y","auto"),$(document).unbind("mousedown",wysiwygClose),Headway.iframe.contents().unbind("mousedown",wysiwygClose),$(window).unbind("resize",wysiwygClose)}),wysiwygClose=function(e){if($(e.target).parents("div.input-wysiwyg div.input-right").length===1||$(e.target).parents(".redactor-dropdown").length===1||$(e.target).parents("#redactor-modal-box").length===1)return;var t=e.data.wysiwygContainer;t.hide(),t.data("visible",!1),$("div.sub-tabs-content-container").css("overflow-y","auto"),$(document).unbind("mousedown",wysiwygClose),Headway.iframe.contents().unbind("mousedown",wysiwygClose),$(window).unbind("resize",wysiwygClose)},$(context).delegate("div.input-integer input","focus",function(){typeof originalValues!="undefined"&&delete originalValues,originalValues=new Object,originalValues[$(this).attr("name")]=$(this).val()}),$(context).delegate("div.input-integer input","keyup blur",function(e){t=$(this).val();if(e.type=="keyup"&&t=="-")return;if(isNaN(t)){t=t.replace(/[^0-9]*/ig,"");if(t==="")var t=originalValues[$(this).attr("name")];$(this).val(t)}t.length>1&&t[0]==0&&(t=t.replace(/^[0]+/g,""),$(this).val(t)),dataHandleInput($(this),t)}),$(context).delegate("div.input-checkbox input","change",function(e){var t=$(this).parents(".input-checkbox").first(),n=t.find("input"),r=t.find("label"),i=n.is(":checked");return Headway.history.add({up:function(){n.val(i),n.prop("checked",i),dataHandleInput(n,i),handleInputToggle(n,i),n.trigger("blur")},down:function(){var e=!e;n.val(e),n.prop("checked",e),dataHandleInput(n,e),handleInputToggle(n,e),n.trigger("blur")}}),allowSaving(),e.preventDefault(),e.stopPropagation(),!1}),$(context).delegate("div.input-multi-select select","click",function(){dataHandleInput($(this))}),$(context).delegate("div.input-multi-select span.multi-select-open","click",function(){var e=$(this).siblings(".multi-select-container"),t=e.find("select"),n=$(this).parents(".input").offset();e.css({top:n.top-e.outerHeight(!0),left:n.left}),$("div.sub-tabs-content-container").css("overflow-y","hidden"),e.data("visible")!==!0?(e.show(),e.data("visible",!0),$(document).bind("mousedown",{multiSelectContainer:e},multiSelectClose),Headway.iframe.contents().bind("mousedown",{multiSelectContainer:e},multiSelectClose),$(window).bind("resize",{multiSelectContainer:e},multiSelectClose)):(e.hide(),e.data("visible",!1),$("div.sub-tabs-content-container").css("overflow-y","auto"),$(document).unbind("mousedown",multiSelectClose),Headway.iframe.contents().unbind("mousedown",multiSelectClose),$(window).unbind("resize",multiSelectClose))}),multiSelectClose=function(e){if($(e.target).parents("div.input-multi-select div.input-right").length===1)return;var t=e.data.multiSelectContainer;t.hide(),t.data("visible",!1),$("div.sub-tabs-content-container").css("overflow-y","auto"),$(document).unbind("mousedown",multiSelectClose),Headway.iframe.contents().unbind("mousedown",multiSelectClose),$(window).unbind("resize",multiSelectClose)},$(context).delegate("div.input-image span.button","click",function(){var e=this;openImageUploader(function(t,n){$(e).siblings("input").val(t),$(e).siblings("span.src").show().text(n),$(e).siblings("span.delete-image").show(),dataHandleInput($(e).siblings("input"),t,{action:"add"})})}),$(context).delegate("div.input-image span.delete-image","click",function(){if(!confirm("Are you sure you wish to remove this image?"))return!1;$(this).siblings(".src").hide(),$(this).hide(),$(this).siblings("input").val(""),dataHandleInput($(this).siblings("input"),"",{action:"delete"})}),updateRepeaterValues=function(e){var t={};return e.find("div.repeater-group:visible").each(function(e){var n={};$(this).find("select, input, textarea").each(function(){var e=$(this).val();$(this).is('[type="checkbox"]')&&!$(this).is(":checked")&&(e=!1),n[$(this).attr("name")]=e}),t[e]=n}),dataHandleInput(e.find("input.repeater-group-input"),t)},$(context).delegate("div.repeater .add-group","click",function(){var e=$(this).parents("div.repeater"),t=$(this).parents("div.repeater-group"),n=e.find(".repeater-group-template");if(e.hasClass("limit-met"))return;var r=n.clone().hide().removeClass("repeater-group-template");r.insertAfter(t).fadeIn(300),e.find(".repeater-group-single").removeClass("repeater-group-single");var i=e.data("repeater-limit");!isNaN(i)&&i>=1&&e.find("div.repeater-group:not(.repeater-group-template):visible").length==i&&e.addClass("limit-met"),updateRepeaterValues(e)}),$(context).delegate("div.repeater .remove-group","click",function(){if(!confirm("Are you sure?"))return;var e=$(this).parents("div.repeater"),t=$(this).parents("div.repeater-group");t.fadeOut(300,function(){e.find("div.repeater-group:visible").length===1&&e.find("div.repeater-group:visible").addClass("repeater-group-single");var t=e.data("repeater-limit");!isNaN(t)&&t>=1&&e.find("div.repeater-group:not(.repeater-group-template):visible").length<t&&e.removeClass("limit-met"),updateRepeaterValues(e)})}),$(context).delegate("div.input-colorpicker div.colorpicker-box","click",function(){$("div.sub-tabs-content-container").css("overflow-y","hidden");var input=$(this).parent().siblings("input"),inputVal=input.val();inputVal=="transparent"&&(inputVal="00FFFFFF");var colorpickerHandleVal=function(color,inst){var colorValue="#"+color.hex;if(color.a!=100)var colorValue=color.rgba;input.val(colorValue),dataHandleInput(input,colorValue);var callback=eval(input.attr("data-callback"));typeof callback=="function"&&callback({input:input,value:color.rgba,colorObj:color})};$(this).colorpicker({realtime:!0,alpha:!0,alphaHex:!0,allowNull:!1,swatches:typeof Headway.colorpickerSwatches=="object"&&Headway.colorpickerSwatches.length?Headway.colorpickerSwatches:!0,color:inputVal,showAnim:!1,beforeShow:function(e,t){showIframeOverlay()},onClose:function(e,t){colorpickerHandleVal(e,t),hideIframeOverlay(),$("div.sub-tabs-content-container").css("overflow-y","auto")},onSelect:function(e,t){colorpickerHandleVal(e,t)},onAddSwatch:function(e,t){dataSetOption("general","colorpicker-swatches",t)},onDeleteSwatch:function(e,t){dataSetOption("general","colorpicker-swatches",t)}}),$.colorpicker._showColorpicker($(this)),setupTooltips()}),$(context).delegate("div.input-button span.button","click",function(){dataHandleInput($(this))}),$(context).delegate("div.input-import-file span.button","click",function(){$(this).siblings('input[type="file"]').trigger("click")}),$(context).delegate('div.input-import-file input[type="file"]',"change",function(e){if(e.target.files[0].name.split(".").slice(-1)[0]!="json")return $(this).val(null),alert("Invalid Headway import file.  Please be sure that the Headway import file is a valid JSON formatted file.");$(this).siblings("span.src").show().text($(this).val().split(/(\\|\/)/g).pop()),$(this).siblings("span.delete-file").show(),dataHandleInput($(this))}),$(context).delegate("div.input-import-file .delete-file","click",function(){if(!confirm("Are you sure?"))return;$(this).fadeOut(100),$(this).siblings("span.src").fadeOut(100);var fileInput=$(this).siblings('input[type="file"]'),callback=eval(fileInput.attr("data-callback"));fileInput.val(null),dataHandleInput(fileInput)})},bind:function(e){if(typeof t=="undefined")var t="div#panel";$("div.input-slider div.input-slider-bar",t).each(function(){var e=this,t=parseInt($(this).parents(".input-slider").find("input.input-slider-bar-hidden").val()),n=parseInt($(this).attr("slider_min")),r=parseInt($(this).attr("slider_max")),i=parseInt($(this).attr("slider_interval")),s=$(this).siblings("div.input-slider-bar-text").find(".input-slider-bar-input"),o=function(e,t){Headway.history.add({up:function(){$(e).val(t),$(e).prev().text(t),$(e).parents(".input-slider").find(".input-slider-bar").slider("value",t),dataHandleInput($(e).parents(".input-slider").find("input.input-slider-bar-hidden"),t)},down:function(){var t=$(e).parents(".input-slider").find("input.input-slider-bar-hidden").data("value-original");$(e).val(t),$(e).prev().text(t),$(e).parents(".input-slider").find(".input-slider-bar").slider("value",t),dataHandleInput($(e).parents(".input-slider").find("input.input-slider-bar-hidden"),t)}})};$(this).slider({range:"min",value:t,min:n,max:r,step:i,start:function(e,t){$(this).parents(".input-slider").find("input.input-slider-bar-hidden").data("value-original",t.value)},slide:function(e,t){$(this).siblings("div.input-slider-bar-text").find(".input-slider-bar-input").val(t.value),$(this).parents(".input-slider").find("input.input-slider-bar-hidden").val(t.value),dataHandleInput($(this).parents(".input-slider").find("input.input-slider-bar-hidden"),t.value)},stop:function(e,t){o(s,t.value)}}),s.on("keydown",function(e){var t=e.charCode||e.keyCode||0;return t==8||t==9||t==46||t==110||t>=35&&t<=40||t>=48&&t<=57||t>=96&&t<=105}),s.on("focus",function(e){$(this).parents(".input-slider").find("input.input-slider-bar-hidden").data("value-original",$(this).val())}),s.on("keyup change",function(e){if(e.which===13)return;if(this.value<=r&&this.value>=n){var t=this;o(this,this.value)}}),s.on("blur",function(e){var t=this.value;this.value>r?t=r:this.value<n&&(t=n),o(this,t)})}),$(".select-chosen select",t).chosen({width:"200px"}),$(".select-chosen select",t).on("chosen:showing_dropdown",function(e,t){var n=$(t.chosen.dropdown),r=n.get(0).getBoundingClientRect(),i=$(window).height()-r.bottom;i<0&&(n.css("height","-="+(Math.abs(i)+10)),n.find(".chosen-results").css("height","-="+(Math.abs(i)+10)))}),$(".repeater-sortable",t).sortable({items:".repeater-group",containment:"parent",forcePlaceholderSize:!0,handle:".sortable-handle",stop:function(){updateRepeaterValues($(this))}}),$(".repeater",t).each(function(){var e=$(this).data("repeater-limit");!isNaN(e)&&e>=1&&$(this).find("div.repeater-group:not(.repeater-group-template):visible").length>=e&&$(this).addClass("limit-met")})}};return panelInputs}),define("modules/panel",["jquery","jqueryUI","deps/jquery.cookie","util.tooltips","modules/panel.inputs"],function(e,t,n,r,i){selectTab=function(e,t){var n=t.find(".ui-tabs-nav"),r=n.find('li[aria-controls="'+e+'"] a').length?n.find('li[aria-controls="'+e+'"] a'):n.find('li[aria-controls="'+e+'-content"] a');return r.trigger("click")},addPanelTab=function(t,n,r,i,s,o){if(e('ul#panel-top li a[href="#'+t+'-tab"]').length!==0)return!1;if(typeof i=="undefined")var i=!1;if(typeof s=="undefined")var s=!1;if(typeof o=="undefined")var o=!1;var u=e('<li><a href="#'+t+'-tab">'+n+"</a></li>").appendTo("div#panel #panel-top"),a=e('<div id="'+t+'-tab"></div>').appendTo("div#panel"),f=u.find("a");e("div#panel").tabs("refresh"),e(f).bind("click",showPanel),showPanel(),e("body").removeClass("panel-empty"),a.addClass("panel");if(typeof r=="string")a.html(r);else{var l=r.url,c=r.data||!1,h=function(){typeof r.callback=="function"&&r.callback.call()};createCog(a,!0),c.mode=Headway.mode,e("div#panel div#"+t+"-tab").load(l,c,h)}return o&&a.addClass("panel-"+o),i&&f.parent().append('<span class="close">X</span>'),f.parent().addClass("tab-close-on-layout-switch"),u},removePanelTab=function(t){var t=t.replace("-tab","");return e("#"+t+"-tab").length===0?!1:(e("#panel").find("#"+t+"-tab").remove(),e("#panel-top").find('a[href="#'+t+'-tab"]').parent().remove(),e("#panel-top").find("li").length||e("body").addClass("panel-empty"),e("div#panel").tabs("refresh"))},removeLayoutSwitchPanels=function(){e("li.tab-close-on-layout-switch").each(function(){var t=e(this).find("a").attr("href").replace("#","");removePanelTab(t)})},togglePanel=function(){return e("div#panel").hasClass("panel-hidden")?showPanel():hidePanel()},hidePanel=function(){if(e("div#panel").hasClass("panel-hidden"))return!1;var t={bottom:-e("div#panel").height()},n={bottom:e("ul#panel-top").outerHeight()};return e("div#panel").css(t).addClass("panel-hidden"),e("div#iframe-container").css(n),setTimeout(repositionTooltips,400),e("body").addClass("panel-hidden"),e("ul#panel-top-right li#minimize span").text("^"),typeof $i=="function"&&$i(".block-selected").removeClass("block-selected block-hover"),e.cookie("hide-panel",!0),!0},showPanel=function(){if(!e("div#panel").hasClass("panel-hidden"))return!1;var t={bottom:0},n={bottom:e("div#panel").outerHeight()};return e("div#panel").css(t).removeClass("panel-hidden"),e("div#iframe-container").css(n),setTimeout(repositionTooltips,400),e("body").removeClass("panel-hidden"),e("ul#panel-top-right li#minimize span").text("g"),e("ul#panel-top > li.ui-state-active a").length&&$i("#"+e("ul#panel-top > li.ui-state-active a").attr("href").replace("#","").replace("-tab","")).addClass("block-selected block-hover"),e.cookie("hide-panel",!1),!0};var s={init:function(){i.delegate(),i.bind()},getPanelMaxHeight:function(){return e(window).height()-275},resizePanel:function(t,n){var r=e("div#panel"),i=r.find("ul#panel-top");if(typeof t=="undefined"||t==0)t=e("div#panel").height();t>s.getPanelMaxHeight()&&(t=s.getPanelMaxHeight()>o?s.getPanelMaxHeight():o),t<o&&(t=o);if(typeof n!="undefined"&&n&&t<s.getPanelMaxHeight())return;r.height(t);var u=r.hasClass("panel-hidden")?i.outerHeight():r.outerHeight(),a=r.hasClass("panel-hidden")?i.outerHeight()+e("div#layout-selector-tabs").height():r.outerHeight()+e("div#layout-selector-tabs").height();e("div#iframe-container").css({bottom:u}),r.hasClass("panel-hidden")&&e("div#panel").css({bottom:-e("div#panel").height()}),e.cookie("panel-height",r.height())}};e("ul#panel-top").find("li").length||e("body").addClass("panel-empty"),e("ul#panel-top").delegate("span.close","click",function(){var t=e(this).siblings("a").attr("href").replace("#","").replace("-tab","");return removePanelTab(t)}),e("div#panel").tabs({tabTemplate:"<li><a href='#{href}'>#{label}</a></li>",add:function(t,n,r){e(n.panel).append(r)},activate:function(t,n){var r=e(n.newTab).children("a").attr("href").replace("#","").replace("-tab","");$i(".block-selected").removeClass("block-selected block-hover"),r.indexOf("block-")===0&&$i("#"+r).addClass("block-selected block-hover")}}),e("ul#panel-top li a").on("click",showPanel),e("div.sub-tab").tabs();var o=120;return e(document).ready(function(){e.cookie("panel-height")&&s.resizePanel(e.cookie("panel-height"))}),e("div#panel").resizable({maxHeight:s.getPanelMaxHeight(),minHeight:120,handles:"n",resize:function(t,n){e(this).css({width:"100%",position:"fixed",bottom:0,top:""}),e("div#iframe-container").css({bottom:e("div#panel").outerHeight()}),showIframeOverlay()},start:function(){showIframeOverlay()},stop:function(){e.cookie("panel-height",e(this).height()),hideIframeOverlay()}}),e(window).bind("resize",function(t){if(t.target!=window)return;e("div#panel").resizable("option",{maxHeight:s.getPanelMaxHeight()}),s.resizePanel(!1,!0)}),e("div#panel-top-container").bind("dblclick",function(e){if(e.target.id!="panel-top-container")return!1;togglePanel()}),e("ul#panel-top-right li#minimize").bind("click",function(e){return togglePanel(),!1}),e.cookie("hide-panel")==="true"&&hidePanel(!0),s}),define("deps/itstylesheet",function(){}),typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;typeof JSON.stringify!="function"&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("deps/json2",function(){}),define("util.saving",["jquery","util.loader","knockout","deps/json2"],function(e,t,n){save=function(){if(typeof isSavingAllowed=="undefined"||isSavingAllowed===!1)return!1;if(typeof currentlySaving!="undefined"&&currentlySaving===!0)return!1;currentlySaving=!0,savedTitle=e("title").text(),saveButton=e("span#save-button"),saveButton.text("Saving...").addClass("active").css("cursor","wait"),changeTitle("Visual Editor: Saving"),startTitleActivityIndicator(),e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"save_options",options:JSON.stringify(GLOBALunsavedValues),layout:Headway.viewModels.layoutSelector.currentLayout(),mode:Headway.mode},function(t){delete currentlySaving;if(t==="0")return saveButton.stop(!0),saveButton.text("Save"),saveButton.removeClass("active"),saveButton.css("cursor","pointer"),showErrorNotification({id:"error-wordpress-authentication",message:'<strong>Notice!</strong><br /><br />Your WordPress authentication has expired and you must log in before you can save.<br /><br /><a href="'+Headway.adminURL+'" target="_blank">Click Here to log in</a>, then switch back to the window/tab the Visual Editor is in.',closeTimer:!1,closable:!0});if(typeof t.errors!="undefined"||typeof t!="object"&&t!="success"){saveButton.stop(!0),saveButton.text("Save"),saveButton.removeClass("active"),saveButton.css("cursor","pointer");var r="There was an error while saving.  Please try again";return typeof t.errors!="undefined"&&(r+="<br /><ul>",e.each(t.errors,function(e,t){r+="<li>"+t+"</li>"}),r+="</ul>"),showErrorNotification({id:"error-invalid-save-response",message:r,closeTimer:!1,closable:!0})}hideNotification("error-wordpress-authentication"),hideNotification("error-invalid-save-response"),saveButton.animate({boxShadow:"0 0 0 #7dd1e2"},350),setTimeout(function(){saveButton.css("boxShadow",""),saveButton.stop(!0),saveButton.text("Save"),saveButton.removeClass("active"),saveButton.css("cursor","pointer"),typeof t["block-id-mapping"]!="undefined"&&e.each(t["block-id-mapping"],function(t,n){var r=$i('.block[data-temp-id="'+t+'"]');r.attr("id","block-"+n).data("id",n).attr("data-id",n).removeAttr("data-temp-id").removeAttr("data-desired-id").removeData("duplicateOf").removeData("temp-id").removeData("desired-id"),updateBlockContentCover(r);if(e("#block-"+t+"-tab").length){var i=e("#block-"+t+"-tab").find(".sub-tabs .ui-tabs-active").attr("aria-controls");removePanelTab("block-"+t),openBlockOptions(r,i)}}),typeof t["wrapper-id-mapping"]!="undefined"&&e.each(t["wrapper-id-mapping"],function(t,n){var r=$i('.wrapper[data-temp-id="'+t+'"]');r.attr("id","wrapper-"+n).data("id",n).attr("data-id",n).removeData("temp-id").removeData("desired-id"),e("#wrapper-"+t+"-tab").length&&(removePanelTab("wrapper-"+t),openWrapperOptions(n))}),clearUnsavedValues(),typeof t.snapshot!="undefined"&&typeof t.snapshot.timestamp!="undefined"&&(showNotification({id:"snapshot-saved",message:"Snapshot automatically saved.",success:!0}),Headway.viewModels.snapshots.snapshots.unshift({id:t.snapshot.id,timestamp:t.snapshot.timestamp,comments:t.snapshot.comments})),e("li.layout-selected").length&&n.dataFor(e("li.layout-selected").get(0)).customized(!0),disallowSaving(),setTimeout(function(){stopTitleActivityIndicator(),changeTitle(savedTitle),showNotification({id:"saving-complete",message:"Saving Complete!",closeTimer:3500,success:!0})},150)},350),allowVEClose()})},clearUnsavedValues=function(){delete GLOBALunsavedValues},allowSaving=function(){if(Headway.mode=="grid"&&$i(".block").length===0||typeof Headway.overlappingBlocks!="undefined"&&Headway.overlappingBlocks)return disallowSaving();if(typeof isSavingAllowed!="undefined"&&isSavingAllowed===!0)return;return e("body").addClass("allow-saving"),isSavingAllowed=!0,prohibitVEClose(),!0},disallowSaving=function(){return isSavingAllowed=!1,e("body").removeClass("allow-saving"),(typeof Headway.overlappingBlocks=="undefined"||!Headway.overlappingBlocks)&&allowVEClose(),!0}}),function(e){typeof define=="function"&&define.amd?define("deps/jquery.ui.touchpunch",["jquery"],e):e(jQuery)}(function(e){function s(e){var t=window.pageXOffset,n=window.pageYOffset,r=e.clientX,i=e.clientY;if(e.pageY===0&&Math.floor(i)>Math.floor(e.pageY)||e.pageX===0&&Math.floor(r)>Math.floor(e.pageX))r-=t,i-=n;else if(i<e.pageY-n||r<e.pageX-t)r=e.pageX-t,i=e.pageY-n;return{clientX:r,clientY:i}}function o(e,n){if(!t&&e.originalEvent.touches&&e.originalEvent.touches.length>1||t&&!e.isPrimary)return;e.preventDefault();var r;t?r=e.originalEvent:e.originalEvent.changedTouches?r=e.originalEvent.changedTouches[0]:r=e,simulatedEvent=document.createEvent("MouseEvents"),coord=s(r),simulatedEvent.initMouseEvent(n,!0,!0,window,1,r.screenX,r.screenY,coord.clientX,coord.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(simulatedEvent)}var t=window.navigator.pointerEnabled||window.navigator.msPointerEnabled;e.support.touch=e.support.touch||(typeof Modernizr!="undefined"?Modernizr.touch:"ontouchend"in document||"createTouch"in document||t);if(!e.support.touch&&!navigator.msPointerEnabled)return;var n=e.ui.mouse.prototype,r=n._mouseInit,i;n._touchStart=function(e){var n=this;if(i||!t&&!n._mouseCapture(e.originalEvent.changedTouches[0]))return;i=!0,n._touchMoved=!1,o(e,"mouseover"),o(e,"mousemove"),o(e,"mousedown")},n._touchMove=function(e){if(!i)return;this._touchMoved=!0,o(e,"mousemove")},n._touchEnd=function(e){if(!i)return;o(e,"mouseup"),o(e,"mouseout"),this._touchMoved||o(e,"click"),i=!1},n._mouseInit=function(){var n=this;n.element.off("touchstart").off("touchmove").off("touchend"),t?n.element.on("pointerDown",e.proxy(n,"_touchStart")).on("pointerMove",e.proxy(n,"_touchMove")).on("pointerUp",e.proxy(n,"_touchEnd")).on("MSPointerDown",e.proxy(n,"_touchStart")).on("MSPointerMove",e.proxy(n,"_touchMove")).on("MSPointerUp",e.proxy(n,"_touchEnd")):(n.element.on(navigator.msPointerEnabled?"MSPointerDown":"touchstart",e.proxy(n,"_touchStart")).on(navigator.msPointerEnabled?"MSPointerMove":"touchmove",e.proxy(n,"_touchMove")).on(navigator.msPointerEnabled?"MSPointerUp":"touchend",e.proxy(n,"_touchEnd")),n.element.css({msTouchAction:"none"})),r.call(n)}}),function(e){function n(e){var n=jQuery(this);settings=jQuery.extend({},t,e.data);if(typeof n.data("events")!="undefined"&&typeof n.data("events").click!="undefined"){for(var r in n.data("events").click)if(n.data("events").click[r].namespace==""){var i=n.data("events").click[r].handler;n.data("taphold_click_handler",i),n.unbind("click",i);break}}else typeof settings.clickHandler=="function"&&n.data("taphold_click_handler",settings.clickHandler);n.data("taphold_triggered",!1),n.data("taphold_clicked",!1),n.data("taphold_cancelled",!1),n.data("taphold_timer",setTimeout(function(){!n.data("taphold_cancelled")&&!n.data("taphold_clicked")&&(n.trigger(jQuery.extend(e,jQuery.Event("taphold"))),n.data("taphold_triggered",!0))},settings.duration))}function r(e){var t=jQuery(this);if(t.data("taphold_cancelled"))return;clearTimeout(t.data("taphold_timer")),!t.data("taphold_triggered")&&!t.data("taphold_clicked")&&(typeof t.data("taphold_click_handler")=="function"&&t.data("taphold_click_handler")(jQuery.extend(e,jQuery.Event("click"))),t.data("taphold_clicked",!0))}function i(t){e(this).data("taphold_cancelled",!0)}var t={duration:1e3,clickHandler:null},s="ontouchstart"in window||"onmsgesturechange"in window,o=e.event.special.taphold={setup:function(t){e(this).bind(s?"touchstart":"mousedown",t,n).bind(s?"touchend":"mouseup",r).bind(s?"touchmove":"mouseleave",i)},teardown:function(t){e(this).unbind(s?"touchstart":"mousedown",n).unbind(s?"touchend":"mouseup",r).unbind(s?"touchmove":"mouseleave",i)}}}(jQuery),define("deps/jquery.taphold",function(){}),define("util.usability",["jquery","deps/mousetrap"],function(e,t){prohibitVEClose=function(){window.onbeforeunload=function(){return"You have unsaved changes.  Are you sure you wish to leave the Visual Editor?"},allowVECloseSwitch=!1},allowVEClose=function(){window.onbeforeunload=function(){return null},allowVECloseSwitch=!0},disableBadKeys=function(){var t=function(t){var n=e(t.target);if(t.which===8&&!n.is("input")&&!n.is("textarea")&&!n.hasClass("allow-backspace-key")&&!n.parents(".wysiwyg-container").length)return t.preventDefault(),!1;if(t.which===9&&!n.is("input")&&!n.is("textarea")&&!n.hasClass("allow-tab-key")&&!n.parents(".wysiwyg-container").length)return t.preventDefault(),!1;if(t.which==13&&!n.is("textarea")&&!n.hasClass("allow-enter-key")&&!n.parents(".wysiwyg-container").length)return t.preventDefault(),!1};e(document).bind("keypress",t),e(document).bind("keydown",t),$i("html").bind("keypress",t),$i("html").bind("keydown",t)},bindKeyShortcuts=function(){t.bindEventsTo($i("body").get(0));var n=function(t){if(!e(".qtip-tour").is(":visible"))return;e(document.body).qtip("hide")};t.bind("esc",n),t.bindGlobal(["ctrl+s","command+s"],function(e){return save(),!1}),t.bind(["ctrl+p","command+p"],function(e){return togglePanel(),!1}),t.bind("ctrl+l",toggleLayoutSelector),typeof designEditor!="undefined"&&typeof designEditor.processElementCopy=="function"&&(t.bind(["ctrl+c","command+c"],designEditor.processElementCopy),t.bind(["ctrl+v","command+v"],designEditor.processElementPaste),t.bind("ctrl+e",function(){boxOpen("live-css")?closeBox("live-css"):e("#open-live-css").trigger("click")}),t.bind("ctrl+i",toggleInspector),t.bind("tab",toggleDesignEditor))},Headway.touch&&require(["deps/jquery.ui.touchpunch","deps/jquery.taphold"],function(){})}),define("modules/iframe",["jquery","deps/itstylesheet","util.saving","util.usability","util.tooltips"],function(e,t,n){$i=function(t){return typeof Headway.iframe=="undefined"||typeof Headway.iframe.contents()=="undefined"?e():Headway.iframe.contents().find(t)},$iDocument=function(){return e(Headway.iframe.contents())},loadIframe=function(e,t){if(typeof t=="undefined"||!t)var t=Headway.homeURL;var n=Headway.iframe;startTitleActivityIndicator(),showIframeLoadingOverlay(),closeBox("grid-wizard"),iframeURL=t,iframeURL=updateQueryStringParameter(iframeURL,"ve-iframe","true"),iframeURL=updateQueryStringParameter(iframeURL,"ve-layout",encodeURIComponent(Headway.viewModels.layoutSelector.currentLayout())),iframeURL=updateQueryStringParameter(iframeURL,"ve-layout-customized",Headway.viewModels.layoutSelector.currentLayoutCustomized()),iframeURL=updateQueryStringParameter(iframeURL,"ve-iframe-mode",Headway.mode),iframeURL=updateQueryStringParameter(iframeURL,"rand",Math.floor(Math.random()*100000001)),n.contents().find(".ui-headway-grid").length&&typeof n.contents().find(".ui-headway-grid").headwayGrid!="undefined"&&n.contents().find(".ui-headway-grid").headwayGrid("destroy"),n.contents().find("*").unbind().remove(),n[0].src=iframeURL,waitForIframeLoad(e,n)},waitForIframeLoad=function(e,t){if(typeof t=="undefined"||!t)var t=Headway.iframe;return typeof iframeTimeout=="undefined"&&(iframeTimeout=setTimeout(r.loadTimeout,4e4)),typeof t=="undefined"||t.contents().find("body.iframe-loaded").length!=1?setTimeout(function(){waitForIframeLoad(e,t)},100):(clearTimeout(iframeTimeout),r.loadCallback(e))},showIframeOverlay=function(){var t=e("div#iframe-overlay");t.show()},hideIframeOverlay=function(t){if(typeof t!="undefined"&&t==0)return e("div#iframe-overlay").hide();setTimeout(function(){e("div#iframe-overlay").hide()},250)},showIframeLoadingOverlay=function(){return e("div#iframe-container").css("overflow","hidden"),e("div#iframe-loading-overlay").css({top:e("div#iframe-container").scrollTop()}),e("div#iframe-loading-overlay").is(":visible")||(createCog(e("div#iframe-loading-overlay"),!0),e("div#iframe-loading-overlay").show()),e("div#iframe-loading-overlay")},hideIframeLoadingOverlay=function(){e("div#iframe-container").css("overflow","auto"),e("div#iframe-loading-overlay").hide().html("")};var r={init:function(){e(document).ready(function(){Headway.iframe=e("iframe#content"),r.bindFocusBlur()})},bindFocusBlur:function(){Headway.iframe.on("mouseleave",function(){e(this).trigger("blur"),$i("[data-hasqtip]").qtip("disable",!0)}),Headway.iframe.on("mouseenter mousedown",function(){if(e("textarea:focus, input:focus").length===1)return;$i("[data-hasqtip]").qtip("enable"),e(this).trigger("focus")})},loadCallback:function(t){return clearUnsavedValues(),typeof t=="function"&&t(),r.defaultLoadCallback(),r.stopFirefoxLoadingIndicator(),e("body").triggerHandler("headwayIframeLoad"),!0},defaultLoadCallback:function(){stopTitleActivityIndicator(),changeTitle("Visual Editor: "+Headway.viewModels.layoutSelector.currentLayoutName()),e("span#current-layout").text(Headway.viewModels.layoutSelector.currentLayoutName()),setupTooltips(),setupTooltips("iframe"),stylesheet=new ITStylesheet({document:Headway.iframe.contents()[0],href:Headway.homeURL+"/?headway-trigger=compiler&file=general-design-editor"},"find"),css=new ITStylesheet({document:Headway.iframe.contents()[0]},"load"),hideIframeOverlay(!1),e("#iframe-notice").remove();if(Headway.viewModels.layoutSelector.currentLayoutTemplate()&&Headway.mode=="grid"){showIframeOverlay();var t=e('<div id="iframe-notice"><div><h1>This layout currently has a Shared Layout assigned to it.</h1><h3>The shared layout assigned is <strong>'+Headway.viewModels.layoutSelector.currentLayoutTemplateName()+"</strong></h3>"+'<p><span class="button button-blue" id="iframe-notice-switch-to-shared-layout">Switch To Shared Layout</span><span class="button button-blue" id="iframe-notice-unassign-shared-layout">Unassign Shared Layout</span></p>'+"</div>"+"</div>");t.appendTo(e("#iframe-container")),t.on("click","#iframe-notice-unassign-shared-layout",function(){return unassignSharedLayout(Headway.viewModels.layoutSelector.currentLayout(),!1,Headway.viewModels.layoutSelector.currentLayoutName())}),t.on("click","#iframe-notice-switch-to-shared-layout",function(){switchToLayout("template-"+Headway.viewModels.layoutSelector.currentLayoutTemplate().replace("template-",""),!0,Headway.viewModels.layoutSelector.currentLayoutTemplateName())})}disableBadKeys(),bindKeyShortcuts(),$i("html, body").bind("keydown",function(t){e(document).trigger(t),t.stopPropagation()}),$i("html, body").bind("keypress",function(t){e(document).trigger(t),t.stopPropagation()}),$i("html, body").bind("keyup",function(t){e(document).trigger(t),t.stopPropagation()}),Headway.touch&&Headway.iframe.contents().find("body").css("-webkit-touch-callout","none"),Headway.iframe.contents().find("body").delegate('a, input[type="submit"], button',"click",function(t){if(e(this).hasClass("allow-click"))return;return t.preventDefault(),!1}),typeof headwayIframeLoadNotification!="undefined"&&(showNotification({id:"iframe-load-notification",message:headwayIframeLoadNotification,overwriteExisting:!0}),delete headwayIframeLoadNotification),removeLayoutSwitchPanels();var n=e('div#layout-selector span.layout[data-layout-id="'+Headway.viewModels.layoutSelector.currentLayout()+'"]'),r=n.parent();if(!$i(".block").length&&(!Headway.viewModels.layoutSelector.currentLayoutCustomized()||Headway.viewModels.layoutSelector.currentLayout().indexOf("template-")===0)&&!Headway.viewModels.layoutSelector.currentLayoutTemplate()&&Headway.mode=="grid"&&Headway.viewModels.layoutSelector.currentLayoutInUse()!=Headway.viewModels.layoutSelector.currentLayout()&&Headway.viewModels.layoutSelector.currentLayout().indexOf("template-")===-1){hidePanel(),showIframeOverlay();var t=e('<div id="iframe-notice"><div><h1>This layout is inheriting from another layout.</h1><h3>The inherited layout is <strong>'+Headway.viewModels.layoutSelector.currentLayoutInUseName()+"</strong></h3>"+'<p><span class="button button-blue" id="iframe-notice-customize-current">Customize Current Layout</span><span class="button button-blue" id="iframe-notice-switch-to-inherited">Switch To Inherited Layout</span></p>'+"	</div>"+"</div>");t.appendTo("#iframe-container"),t.on("click","#iframe-notice-customize-current",function(){e("#iframe-notice").remove(),hideIframeOverlay(),openBox("grid-wizard")}),t.on("click","#iframe-notice-switch-to-inherited",function(){switchToLayout(Headway.viewModels.layoutSelector.currentLayoutInUse(),!0,Headway.viewModels.layoutSelector.currentLayoutInUseName())})}else Headway.viewModels.layoutSelector.currentLayoutCustomized()||Headway.viewModels.layoutSelector.currentLayoutTemplate()?closeBox("grid-wizard"):openBox("grid-wizard");hideIframeLoadingOverlay()},loadTimeout:function(){iframeTimeout=!0,stopTitleActivityIndicator(),changeTitle("Visual Editor: Error!"),e("#iframe-container, #menu, #panel, #layout-selector-offset").hide(),alert("ERROR: There was a problem while loading the visual editor.\n\nYour browser will automatically refresh to attempt loading again."),document.location.reload(!0)},stopFirefoxLoadingIndicator:function(){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var e;e==null&&(e=document.createElement("iframe"),e.style.display="none"),document.body.appendChild(e),document.body.removeChild(e)}}};return r}),function(e,t,n){"use strict";function s(t,n){this.name=r,this.el=t,this.$el=e(t),this.options=e.extend({},i,n),this.$document=e(this.$el[0].ownerDocument),this.$body=this.$document.find("body"),this.moveTrigger="MSPointerMove touchmove mousemove",this.startTrigger="MSPointerDown touchstart mousedown",this.stopTrigger="MSPointerUp touchend mouseup",this.startTriggerArray=this.startTrigger.split(" "),this.moveTriggerArray=this.moveTrigger.split(" "),this.stopTriggerArray=this.stopTrigger.split(" "),this.stopEvents=[this.stopTrigger,this.options.stopEvents].join(" "),this.options.constrainTo==="window"?this.$container=this.$document:this.options.constrainTo&&this.options.constrainTo!=="parent"?this.$container=e(this.options.constrainTo):this.$container=this.$el.parent(),this.isPointerEventCompatible()&&this.applyMSDefaults(),this.CSSEaseHash=this.getCSSEaseHash(),this.scale=1,this.started=!1,this.disabled=!1,this.resetVelocityQueue(),this.init()}var r="pep",i={initiate:function(){},start:function(){},drag:function(){},stop:function(){},rest:function(){},moveTo:!1,callIfNotStarted:["stop","rest"],startThreshold:[0,0],grid:[1,1],debug:!1,activeClass:"pep-active",multiplier:1,velocityMultiplier:2.5,shouldPreventDefault:!0,allowDragEventPropagation:!0,stopEvents:"",hardwareAccelerate:!0,useCSSTranslation:!0,disableSelect:!0,cssEaseString:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",cssEaseDuration:1e3,shouldEase:!0,droppable:!1,droppableActiveClass:"pep-dpa",overlapFunction:!1,constrainTo:!1,removeMargins:!0,place:!0,deferPlacement:!1,axis:null,forceNonCSS3Movement:!1,elementsWithInteraction:"input",revert:!1,revertAfter:"stop",revertIf:function(){return!0}};s.prototype.init=function(){this.options.debug&&this.buildDebugDiv(),this.options.disableSelect&&this.disableSelect(),this.options.place&&!this.options.deferPlacement&&(this.positionParent(),this.placeObject()),this.ev={},this.pos={},this.subscribe()},s.prototype.subscribe=function(){var e=this;this.$el.on(this.startTrigger,function(t){e.handleStart(t)}),this.$el.on(this.startTrigger,this.options.elementsWithInteraction,function(e){e.stopPropagation()}),this.$document.on(this.stopEvents,function(t){e.handleStop(t)}),this.$document.on(this.moveTrigger,function(t){e.moveEvent=t})},s.prototype.handleStart=function(t){var n=this;if(this.isValidMoveEvent(t)&&!this.disabled){this.isPointerEventCompatible()&&t.preventManipulation&&t.preventManipulation(),t=this.normalizeEvent(t),this.options.place&&this.options.deferPlacement&&(this.positionParent(),this.placeObject()),this.log({type:"event",event:t.type}),this.options.hardwareAccelerate&&!this.hardwareAccelerated&&(this.hardwareAccelerate(),this.hardwareAccelerated=!0);var r=this.options.initiate.call(this,t,this);if(r===!1)return;clearTimeout(this.restTimeout),this.$el.addClass(this.options.activeClass),this.removeCSSEasing(),this.startX=this.ev.x=t.pep.x,this.startY=this.ev.y=t.pep.y,this.initialPosition=this.initialPosition||this.$el.position(),this.startEvent=this.moveEvent=t,this.active=!0,this.options.shouldPreventDefault&&t.preventDefault(),this.options.allowDragEventPropagation||t.stopPropagation(),function i(){if(!n.active)return;n.handleMove(),n.requestAnimationFrame(i)}(e,n)}},s.prototype.handleMove=function(){if(typeof this.moveEvent=="undefined")return;var n=this.normalizeEvent(this.moveEvent),r=t.parseInt(n.pep.x/this.options.grid[0])*this.options.grid[0],i=t.parseInt(n.pep.y/this.options.grid[1])*this.options.grid[1];this.addToLIFO({time:n.timeStamp,x:r,y:i});var s,o;e.inArray(n.type,this.startTriggerArray)>-1?(s=0,o=0):(s=r-this.ev.x,o=i-this.ev.y),this.dx=s,this.dy=o,this.ev.x=r,this.ev.y=i;if(s===0&&o===0){this.log({type:"event",event:"** stopped **"});return}var u=Math.abs(this.startX-r),a=Math.abs(this.startY-i);!this.started&&(u>this.options.startThreshold[0]||a>this.options.startThreshold[1])&&(this.started=!0,this.$el.addClass("pep-start"),this.options.start.call(this,this.startEvent,this)),this.options.droppable&&this.calculateActiveDropRegions();var f=this.options.drag.call(this,n,this);if(f===!1){this.resetVelocityQueue();return}this.log({type:"event",event:n.type}),this.log({type:"event-coords",x:this.ev.x,y:this.ev.y}),this.log({type:"velocity"});var l=this.handleConstraint(s,o),c,h;typeof this.options.moveTo=="function"?(c=s>=0?"+="+Math.abs(s/this.scale)*this.options.multiplier:"-="+Math.abs(s/this.scale)*this.options.multiplier,h=o>=0?"+="+Math.abs(o/this.scale)*this.options.multiplier:"-="+Math.abs(o/this.scale)*this.options.multiplier,this.options.constrainTo&&(c=l.x!==!1?l.x:c,h=l.y!==!1?l.y:h),this.options.axis==="x"&&(h=l.y),this.options.axis==="y"&&(c=l.x),this.options.moveTo.call(this,c,h)):this.shouldUseCSSTranslation()?(s=s/this.scale*this.options.multiplier,o=o/this.scale*this.options.multiplier,this.options.constrainTo&&(s=l.x===!1?s:0,o=l.y===!1?o:0),this.options.axis==="x"&&(o=0),this.options.axis==="y"&&(s=0),this.moveToUsingTransforms(s,o)):(c=s>=0?"+="+Math.abs(s/this.scale)*this.options.multiplier:"-="+Math.abs(s/this.scale)*this.options.multiplier,h=o>=0?"+="+Math.abs(o/this.scale)*this.options.multiplier:"-="+Math.abs(o/this.scale)*this.options.multiplier,this.options.constrainTo&&(c=l.x!==!1?l.x:c,h=l.y!==!1?l.y:h),this.options.axis==="x"&&(h=l.y),this.options.axis==="y"&&(c=l.x),this.moveTo(c,h))},s.prototype.handleStop=function(t){if(!this.active)return;this.log({type:"event",event:t.type}),this.active=!1,this.$el.removeClass("pep-start").addClass("pep-ease"),this.options.droppable&&this.calculateActiveDropRegions(),(this.started||!this.started&&e.inArray("stop",this.options.callIfNotStarted)>-1)&&this.options.stop.call(this,t,this),this.options.shouldEase?this.ease(t,this.started):this.removeActiveClass(),this.options.revert&&(this.options.revertAfter==="stop"||!this.options.shouldEase)&&this.options.revertIf&&this.options.revertIf()&&this.revert(),this.started=!1,this.resetVelocityQueue()},s.prototype.ease=function(t,n){var r=this.$el.position(),i=this.velocity(),s=this.dt,o=i.x/this.scale*this.options.multiplier,u=i.y/this.scale*this.options.multiplier,a=this.handleConstraint(o,u,!0);this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash());var f=i.x>0?"+="+o:"-="+Math.abs(o),l=i.y>0?"+="+u:"-="+Math.abs(u);this.options.constrainTo&&(f=a.x!==!1?a.x:f,l=a.y!==!1?a.y:l),this.options.axis==="x"&&(l="+=0"),this.options.axis==="y"&&(f="+=0");var c=!this.cssAnimationsSupported()||this.options.forceNonCSS3Movement;typeof this.options.moveTo=="function"?this.options.moveTo.call(this,f,l):this.moveTo(f,l,c);var h=this;this.restTimeout=setTimeout(function(){h.options.droppable&&h.calculateActiveDropRegions(),(n||!n&&e.inArray("rest",h.options.callIfNotStarted)>-1)&&h.options.rest.call(h,t,h),h.options.revert&&h.options.revertAfter==="ease"&&h.options.shouldEase&&h.options.revertIf&&h.options.revertIf()&&h.revert(),h.removeActiveClass()},this.options.cssEaseDuration)},s.prototype.normalizeEvent=function(e){return e.pep={},this.isPointerEventCompatible()||!this.isTouch(e)?(e.pageX?(e.pep.x=e.pageX,e.pep.y=e.pageY):(e.pep.x=e.originalEvent.pageX,e.pep.y=e.originalEvent.pageY),e.pep.type=e.type):(e.pep.x=e.originalEvent.touches[0].pageX,e.pep.y=e.originalEvent.touches[0].pageY,e.pep.type=e.type),e},s.prototype.resetVelocityQueue=function(){this.velocityQueue=new Array(5)},s.prototype.moveTo=function(e,t,n){this.log({type:"delta",x:e,y:t}),n?this.$el.animate({top:t,left:e},this.options.cssEaseDuration/2,"easeOutQuad",{queue:!1}):this.$el.stop(!0,!1).css({top:t,left:e})},s.prototype.moveToUsingTransforms=function(e,t){var n=this.matrixToArray(this.matrixString());this.cssX||(this.cssX=this.xTranslation(n)),this.cssY||(this.cssY=this.yTranslation(n)),this.cssX=this.cssX+e,this.cssY=this.cssY+t,this.log({type:"delta",x:e,y:t}),n[4]=this.cssX,n[5]=this.cssY,this.translation=this.arrayToMatrix(n),this.transform(this.translation)},s.prototype.transform=function(e){this.$el.css({"-webkit-transform":e,"-moz-transform":e,"-ms-transform":e,"-o-transform":e,transform:e})},s.prototype.xTranslation=function(e){return e=e||this.matrixToArray(this.matrixString()),parseInt(e[4],10)},s.prototype.yTranslation=function(e){return e=e||this.matrixToArray(this.matrixString()),parseInt(e[5],10)},s.prototype.matrixString=function(){var e=function(e){return!(!e||e==="none"||e.indexOf("matrix")<0)},t="matrix(1, 0, 0, 1, 0, 0)";return e(this.$el.css("-webkit-transform"))&&(t=this.$el.css("-webkit-transform")),e(this.$el.css("-moz-transform"))&&(t=this.$el.css("-moz-transform")),e(this.$el.css("-ms-transform"))&&(t=this.$el.css("-ms-transform")),e(this.$el.css("-o-transform"))&&(t=this.$el.css("-o-transform")),e(this.$el.css("transform"))&&(t=this.$el.css("transform")),t},s.prototype.matrixToArray=function(e){return e.split("(")[1].split(")")[0].split(",")},s.prototype.arrayToMatrix=function(e){return"matrix("+e.join(",")+")"},s.prototype.addToLIFO=function(e){var t=this.velocityQueue;t=t.slice(1,t.length),t.push(e),this.velocityQueue=t},s.prototype.velocity=function(){var e=0,t=0;for(var n=0;n<this.velocityQueue.length-1;n++)this.velocityQueue[n]&&(e+=this.velocityQueue[n+1].x-this.velocityQueue[n].x,t+=this.velocityQueue[n+1].y-this.velocityQueue[n].y,this.dt=this.velocityQueue[n+1].time-this.velocityQueue[n].time);return{x:e*this.options.velocityMultiplier,y:t*this.options.velocityMultiplier}},s.prototype.revert=function(){this.shouldUseCSSTranslation()&&this.moveToUsingTransforms(-this.xTranslation(),-this.yTranslation()),this.moveTo(this.initialPosition.left,this.initialPosition.top)},s.prototype.requestAnimationFrame=function(e){return t.requestAnimationFrame&&t.requestAnimationFrame(e)||t.webkitRequestAnimationFrame&&t.webkitRequestAnimationFrame(e)||t.mozRequestAnimationFrame&&t.mozRequestAnimationFrame(e)||t.oRequestAnimationFrame&&t.mozRequestAnimationFrame(e)||t.msRequestAnimationFrame&&t.msRequestAnimationFrame(e)||t.setTimeout(e,1e3/60)},s.prototype.positionParent=function(){if(!this.options.constrainTo||this.parentPositioned)return;this.parentPositioned=!0,this.options.constrainTo==="parent"?this.$container.css({position:"relative"}):this.options.constrainTo==="window"&&this.$container.get(0).nodeName!=="#document"&&this.$container.css("position")!=="static"&&this.$container.css({position:"static"})},s.prototype.placeObject=function(){if(this.objectPlaced)return;this.objectPlaced=!0,this.offset=this.options.constrainTo==="parent"||this.hasNonBodyRelative()?this.$el.position():this.$el.offset(),parseInt(this.$el.css("left"),10)&&(this.offset.left=this.$el.css("left")),parseInt(this.$el.css("top"),10)&&(this.offset.top=this.$el.css("top")),this.options.removeMargins&&this.$el.css({margin:0}),this.$el.css({position:"absolute",top:this.offset.top,left:this.offset.left})},s.prototype.hasNonBodyRelative=function(){return this.$el.parents().filter(function(){var t=e(this);return t.is("body")||t.css("position")==="relative"}).length>1},s.prototype.setScale=function(e){this.scale=e},s.prototype.setMultiplier=function(e){this.options.multiplier=e},s.prototype.removeCSSEasing=function(){this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash(!0))},s.prototype.disableSelect=function(){this.$el.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"})},s.prototype.removeActiveClass=function(){this.$el.removeClass([this.options.activeClass,"pep-ease"].join(" "))},s.prototype.handleConstraint=function(t,r,i){var s=this,o=this.$el.position();this.pos.x=o.left,this.pos.y=o.top;var u={x:!1,y:!1},a,f,l,c;this.log({type:"pos-coords",x:this.pos.x,y:this.pos.y});if(e.isArray(this.options.constrainTo))this.options.constrainTo[3]!==n&&this.options.constrainTo[1]!==n&&(f=this.options.constrainTo[1]===!1?Infinity:this.options.constrainTo[1],l=this.options.constrainTo[3]===!1?-Infinity:this.options.constrainTo[3]),this.options.constrainTo[0]!==!1&&this.options.constrainTo[2]!==!1&&(a=this.options.constrainTo[2]===!1?Infinity:this.options.constrainTo[2],c=this.options.constrainTo[0]===!1?-Infinity:this.options.constrainTo[0]),this.pos.x+t<l&&(u.x=l),this.pos.y+r<c&&(u.y=c);else if(typeof this.options.constrainTo=="string"){l=0,c=0,f=this.$container.width()-this.$el.outerWidth(),a=this.$container.height()-this.$el.outerHeight(),this.$el.each(function(){e(this).position().left+t<0&&(u.x=0),e(this).position().top+r<0&&(u.y=0)});var h=this.$container[0].getBoundingClientRect(),p=this.ev.x>h.left&&this.ev.x<h.right&&this.ev.y>h.top+e(this.$el[0].ownerDocument).scrollTop()&&this.ev.y<h.bottom+e(this.$el[0].ownerDocument).scrollTop();p||(u.x=l,u.y=c)}return this.$el.each(function(){f=s.$container.width()-e(this).outerWidth(),a=s.$container.height()-e(this).outerHeight(),e(this).position().left+t>f&&(u.x=f),e(this).position().top+r>a&&(u.y=a)}),this.shouldUseCSSTranslation()&&i&&(u.x===l&&this.xTranslation()&&(u.x=l-this.xTranslation()),u.x===f&&this.xTranslation()&&(u.x=f-this.xTranslation()),u.y===c&&this.yTranslation()&&(u.y=c-this.yTranslation()),u.y===a&&this.yTranslation()&&(u.y=a-this.yTranslation())),u},s.prototype.getCSSEaseHash=function(e){typeof e=="undefined"&&(e=!1);var t;if(e)t="";else{if(this.CSSEaseHash)return this.CSSEaseHash;t=["all",this.options.cssEaseDuration+"ms",this.options.cssEaseString].join(" ")}return{"-webkit-transition":t,"-moz-transition":t,"-ms-transition":t,"-o-transition":t,transition:t}},s.prototype.calculateActiveDropRegions=function(){var t=this;this.activeDropRegions=[],e.each(e(this.options.droppable),function(n,r){var i=e(r);t.isOverlapping(i,t.$el)?(i.addClass(t.options.droppableActiveClass),t.activeDropRegions.push(i)):i.removeClass(t.options.droppableActiveClass)})},s.prototype.isOverlapping=function(e,t){if(this.options.overlapFunction)return this.options.overlapFunction(e,t);var n=e[0].getBoundingClientRect(),r=t[0].getBoundingClientRect();return!(n.right<r.left||n.left>r.right||n.bottom<r.top||n.top>r.bottom)},s.prototype.isTouch=function(e){return e.type.search("touch")>-1},s.prototype.isPointerEventCompatible=function(){return"MSPointerEvent"in t},s.prototype.applyMSDefaults=function(e){this.$el.css({"-ms-touch-action":"none","touch-action":"none","-ms-scroll-chaining":"none","-ms-scroll-limit":"0 0 0 0"})},s.prototype.isValidMoveEvent=function(e){return!this.isTouch(e)||this.isTouch(e)&&e.originalEvent.touches&&e.originalEvent.touches.length===1},s.prototype.shouldUseCSSTranslation=function(){if(typeof this.useCSSTranslation!="undefined")return this.useCSSTranslation;var e=!1;return!this.options.useCSSTranslation||typeof Modernizr!="undefined"&&!Modernizr.csstransforms?e=!1:e=!0,this.useCSSTranslation=e,e},s.prototype.cssAnimationsSupported=function(){if(typeof this.cssAnimationsSupport!="undefined")return this.cssAnimationsSupport;if(typeof Modernizr!="undefined"&&Modernizr.cssanimations)return this.cssAnimationsSupport=!0,!0;var e=!1,t=document.createElement("div"),r="animation",i="",s="Webkit Moz O ms Khtml".split(" "),o="";t.style.animationName&&(e=!0);if(e===!1)for(var u=0;u<s.length;u++)if(t.style[s[u]+"AnimationName"]!==n){o=s[u],r=o+"Animation",i="-"+o.toLowerCase()+"-",e=!0;break}return this.cssAnimationsSupport=e,e},s.prototype.hardwareAccelerate=function(){this.$el.css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})},s.prototype.getMovementValues=function(){return{ev:this.ev,pos:this.pos,velocity:this.velocity()}},s.prototype.buildDebugDiv=function(){var t;e("#pep-debug").length===0&&(t=e("<div></div>"),t.attr("id","pep-debug").append("<div style='font-weight:bold; background: red; color: white;'>DEBUG MODE</div>").append("<div id='pep-debug-event'>no event</div>").append("<div id='pep-debug-ev-coords'>event coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-pos-coords'>position coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-velocity'>velocity: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-delta'>&Delta; movement: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").css({position:"fixed",bottom:5,right:5,zIndex:99999,textAlign:"right",fontFamily:"Arial, sans",fontSize:10,border:"1px solid #DDD",padding:"3px",background:"white",color:"#333"}));var n=this;setTimeout(function(){n.debugElements={$event:e("#pep-debug-event"),$velocityX:e("#pep-debug-velocity .pep-x"),$velocityY:e("#pep-debug-velocity .pep-y"),$dX:e("#pep-debug-delta .pep-x"),$dY:e("#pep-debug-delta .pep-y"),$evCoordsX:e("#pep-debug-ev-coords .pep-x"),$evCoordsY:e("#pep-debug-ev-coords .pep-y"),$posCoordsX:e("#pep-debug-pos-coords .pep-x"),$posCoordsY:e("#pep-debug-pos-coords .pep-y")}},0),e("body").append(t)},s.prototype.log=function(e){if(!this.options.debug)return;switch(e.type){case"event":this.debugElements.$event.text(e.event);break;case"pos-coords":this.debugElements.$posCoordsX.text(e.x),this.debugElements.$posCoordsY.text(e.y);break;case"event-coords":this.debugElements.$evCoordsX.text(e.x),this.debugElements.$evCoordsY.text(e.y);break;case"delta":this.debugElements.$dX.text(e.x),this.debugElements.$dY.text(e.y);break;case"velocity":var t=this.velocity();this.debugElements.$velocityX.text(Math.round(t.x)),this.debugElements.$velocityY.text(Math.round(t.y))}},s.prototype.toggle=function(e){typeof e=="undefined"?this.disabled=!this.disabled:this.disabled=!e},e.extend(e.easing,{easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeOutExpo:function(e,t,n,r,i){return t===i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n}}),e.fn[r]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+r)){var n=new s(this,t);e.data(this,"plugin_"+r,n),e.pep.peps.push(n)}})},e.pep={},e.pep.peps=[],e.pep.toggleAll=function(t){e.each(this.peps,function(e,n){n.toggle(t)})},e.pep.unbind=function(e){var t=e.data("plugin_"+r);if(typeof t=="undefined")return;t.toggle(!1),e.removeData("plugin_"+r)}}(jQuery,window),define("deps/jquery.pep",function(){}),define("helper.boxes",["modules/iframe","deps/jquery.pep"],function(iframe){createBox=function(e){var t={},n={id:null,title:null,description:null,content:null,src:null,load:null,width:500,height:300,center:!0,closable:!0,resizable:!1,draggable:!0,deleteWhenClosed:!1,blackOverlay:!1,blackOverlayOpacity:.6,blackOverlayIframe:!1};$.extend(t,n,e);var r=$('<div class="box" id="box-'+t.id+'"><div class="box-top"></div><div class="box-content-bg"><div class="box-content"></div></div></div>');return r.attr("black_overlay",t.blackOverlay),r.attr("black_overlay_opacity",t.blackOverlayOpacity),r.attr("black_overlay_iframe",t.blackOverlayIframe),r.attr("load_with_ajax",!1),r.appendTo("div#boxes"),typeof t.src!="string"?r.find(".box-content").html(t.content):(r.find(".box-content").addClass("box-content-with-iframe"),r.find(".box-content").html('<iframe src="'+t.src+'"></iframe>'),typeof t.load=="function"&&r.find(".box-content iframe").bind("load",t.load)),r.find(".box-top").append("<strong>"+t.title+"</strong>"),typeof t.description=="string"&&r.find(".box-top").append("<span>"+t.description+"</span>"),setupBox(t.id,t),r},setupBox=function(e,t){var n={},r={width:600,height:300,center:!0,closable:!0,deleteWhenClosed:!1,draggable:!1,resizable:!1};$.extend(n,r,t);var i=$("div#box-"+e);n.draggable&&(i.draggable({handle:i.find(".box-top"),start:showIframeOverlay,stop:hideIframeOverlay,shouldEase:!1}),i.find(".box-top").css("cursor","move")),n.closable&&(i.find(".box-top").append('<span class="box-close">X</span>'),i.find(".box-close").bind("click",function(){closeBox(e,n.deleteWhenClosed)})),n.resizable&&i.resizable({start:showIframeOverlay,stop:hideIframeOverlay,handles:"n, e, s, w, ne, se, sw, nw",minWidth:n.minWidth,minHeight:n.minHeight}),i.css({width:n.width,height:n.height});if(n.center){var s=-(i.width()/2),o=-(i.height()/2);i.css({top:"50%",left:"50%",marginLeft:s,marginTop:o})}},setupStaticBoxes=function(){$("div.box").each(function(){var e=hwBoolean($(this).attr("draggable")),t=hwBoolean($(this).attr("closable")),n=hwBoolean($(this).attr("resizable")),r=hwBoolean($(this).attr("center")),i=$(this).attr("width"),s=$(this).attr("height"),o=$(this).attr("min_width"),u=$(this).attr("min_height"),a=$(this).attr("id").replace("box-","");setupBox(a,{draggable:e,closable:t,resizable:n,center:r,width:i,height:s,minWidth:o,minHeight:u}),$(this).attr("draggable",null),$(this).attr("closable",null),$(this).attr("resizable",null),$(this).attr("center",null),$(this).attr("width",null),$(this).attr("height",null),$(this).attr("min_width",null),$(this).attr("min_height",null)})},openBox=function(id){var id=id.replace("box-",""),box=$("div#box-"+id);if(box.length===0)return!1;var blackOverlay=hwBoolean(box.attr("black_overlay")),blackOverlayOpacity=box.attr("black_overlay_opacity"),blackOverlayIframe=hwBoolean(box.attr("black_overlay_iframe")),loadWithAjax=hwBoolean(box.attr("load_with_ajax"));if(blackOverlay&&!boxOpen(id)){var overlay=$('<div class="black-overlay"></div>').hide().attr("id","black-overlay-box-"+id).appendTo("#boxes");blackOverlayIframe===!0&&overlay.css("zIndex",4),isNaN(blackOverlayOpacity)||overlay.css("background","rgba(0, 0, 0, "+blackOverlayOpacity+")"),overlay.show()}return loadWithAjax&&!box.data("currently-ajax-loading")&&(box.find("*").removeData(),box.find(".box-content *").remove(),createCog(box.find(".box-content"),!0),box.data("currently-ajax-loading",!0),box.find(".box-content").load(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"load_box_ajax_content",box_id:id,layout:Headway.viewModels.layoutSelector.currentLayout()},function(){var loadWithAjaxCallback=eval(box.attr("load_with_ajax_callback"));loadWithAjaxCallback.call(),box.removeData("currently-ajax-loading")})),box.show()},closeBox=function(e,t){var e=e.replace("box-",""),n=$("div#box-"+e);return n.hide(),typeof t!="undefined"&&t==1&&n.remove(),$("div#black-overlay-box-"+e).remove(),!0},boxOpen=function(e){return $("div#box-"+e).is(":visible")},boxExists=function(e){return $("div#box-"+e).length===1?!0:!1},toggleBox=function(e){boxOpen(e)?closeBox(e):openBox(e)},setupStaticBoxes(),$("#boxes").on("click","div.black-overlay",function(){var e=$(this).attr("id").replace("black-overlay-","");if($("#"+e).length===0)return;if($(".qtip-tour").is(":visible"))return;closeBox(e)})}),define("helper.history",["jquery","modules/iframe","deps/mousetrap"],function(e,t,n){var r=function(e){this.settings={limit:20,call:!0},this.set(e),this.clear()};r.prototype.set=function(e){for(var t in e)this.settings[t]=e[t];return this},r.prototype.add=function(e){return this.redos=[],!e instanceof r.Occurence&&(e=new r.Occurence(e)),this.undos.unshift(e),(e.call===!0||typeof e.call=="undefined"&&this.settings.call===!0)&&e.up(),this.settings.limit&&this.undos.splice(this.settings.limit),typeof this.settings.onAdd=="function"&&this.settings.onAdd(e),this},r.prototype.clear=function(){return this.redos=[],this.undos=[],typeof this.settings.onClear=="function"&&this.settings.onClear(),this},r.prototype.revert=function(){var e;while(e=this.undos.shift())e.down();return this.clear()},r.prototype.undo=function(){var e;if(e=this.undos.shift())this.redos.unshift(e),e.down(),typeof this.settings.onUndo=="function"&&this.settings.onUndo(e),this.undos.length==0&&typeof this.settings.onBegin=="function"&&this.settings.onBegin(e);return this},r.prototype.redo=function(){var e;if(e=this.redos.shift())this.undos.unshift(e),e.up(),typeof this.settings.onRedo=="function"&&this.settings.onRedo(e),this.redos.length==0&&typeof this.settings.onEnd=="function"&&this.settings.onEnd(e);return this},r.Occurence=function(e){e=e||{},this.up=e.up||function(){},this.down=e.down||function(){}};var i={init:function(){Headway.history=new r({limit:0}),i.bind()},bind:function(){n.bind(["ctrl+z","command+z"],function(e){return Headway.history.undo(),!1}),n.bind(["ctrl+y","command+y"],function(e){return Headway.history.redo(),!1})}};return i}),define("helper.blocks",["modules/panel.inputs","helper.history"],function(panelInputs,history){getBlockByID=function(e){var e=e.toString().replace("block-","");return $i('.block[data-id="'+e+'"]')},getBlock=function(e){return $(e).length===0?$():($(e).hasClass("block")?block=$(e):$(e).parents(".block").length===1?block=$(e).parents(".block"):block=!1,block)},getBlockID=function(e){var t=getBlock(e);return t?t.data("id"):!1},getBlockWrapper=function(e){var t=getBlock(e);return t.closest(".wrapper")},getBlockType=function(e){var t=getBlock(e);return t?t.data("type"):!1},getBlockTypeNice=function(e){return typeof e!="string"?!1:getBlockTypeObject(e).name},getBlockTypeIcon=function(e,t){return typeof t=="undefined"&&(t=!1),typeof Headway.allBlockTypes[e]!="object"?null:t===!0?Headway.blockTypeURLs[e]+"/icon-white.png":Headway.blockTypeURLs[e]+"/icon.png"},getBlockTypeObject=function(e){var t=Headway.allBlockTypes;return typeof t[e]=="undefined"?{"fixed-height":!1}:t[e]},getBlockGridWidth=function(e){var t=getBlock(e);return t?t.attr("data-width"):!1},setBlockGridWidth=function(e,t){var n=getBlock(e);if(!n)return!1;var r=n.attr("data-width");return r&&n.removeClass("grid-width-"+r),n.css("width",""),n.addClass("grid-width-"+t),n.attr("data-width",String(t).replace("grid-width-","")),n},getBlockGridLeft=function(e){var t=getBlock(e);return t?t.attr("data-grid-left"):!1},setBlockGridLeft=function(e,t){var n=getBlock(e);if(!n)return!1;var r=getBlockGridLeft(n);return r&&n.removeClass("grid-left-"+r),n.addClass("grid-left-"+t),n.attr("data-grid-left",String(t).replace("grid-left-","")),n},getBlockDimensions=function(e){var t=getBlock(e);return t?{width:getBlockGridWidth(t),height:t.attr("data-height")}:!1},getBlockDimensionsPixels=function(e){var t=getBlock(e);return t?{width:t.width(),height:t.height()}:!1},getBlockPosition=function(e){var t=getBlock(e);return t?{left:getBlockGridLeft(t),top:t.attr("data-grid-top")}:!1},getBlockPositionPixels=function(e){var t=getBlock(e);return t?{left:t.position().left,top:t.position().top}:!1},isBlockMirrored=function(e){var t=getBlock(e);return t.hasClass("block-mirrored")},getBlockMirrorOrigin=function(e){var t=getBlock(e);return isBlockMirrored(t)?t.data("block-mirror"):!1},getBlockMirrorLayoutName=function(e){var t=getBlock(e);return isBlockMirrored(t)?t.data("block-mirror-layout-name"):!1},updateBlockContentCover=function(e){if(Headway.mode!="grid")return!1;e.children(".block-content-cover").remove();var t=getBlockType(e),n=getBlockTypeNice(t),r="";return e.data("temp-id")&&(r=" <span>Unsaved</span>"),n||(n="Select Block Type"),e.data("alias")&&(n=e.data("alias")+" - "+n),e.append('				<div class="block-content-cover">					<svg xmlns="http://www.w3.org/2000/svg" version="1.1">						<line class="x-line" x1="0" y1="0" x2="100%" y2="100%" />						<line class="x-line" x1="0" y1="100%" x2="100%" y2="0" />					</svg>										<span class="block-type-and-id">'+n+r+"</span>				</div>			"),e.find("div.block-content-cover")},loadBlockContent=function(e){var t={},n={blockElement:!1,blockSettings:{},blockOrigin:!1,blockDefault:!1,callback:function(e){},callbackArgs:null};$.extend(t,n,e);var r=t.blockElement.find("div.block-content"),i=getBlockType(t.blockElement);return Headway.gridSafeMode==1?r.html('<div class="alert alert-red block-safe-mode"><p>Grid Safe mode enabled.  Block content not outputted.</p></div>'):Headway.mode=="grid"&&!getBlockTypeObject(i)["show-content-in-grid"]?(typeof t.callback=="function"&&t.callback(t.callbackArgs),r.html("")):(createCog(r,!0,!0,Headway.iframe.contents(),1),$.ajax({url:Headway.ajaxURL,cache:!1,type:"POST",dataType:"text",data:{security:Headway.security,action:"headway_visual_editor",method:"load_block_content",unsaved_block_settings:t.blockSettings,block_origin:t.blockOrigin,block_default:t.blockDefault,layout:Headway.viewModels.layoutSelector.currentLayout(),mode:Headway.mode,wpQueryVars:typeof Headway.iframe[0].contentWindow.HW_WP_Query_Vars!="undefined"?Headway.iframe[0].contentWindow.HW_WP_Query_Vars:null}}).done(function(e){typeof t.callback=="function"&&t.callback(t.callbackArgs);if(Headway.mode=="grid"){var e=e.replace(/script/g,"SCRIPTTOCHECK"),n=$($.parseHTML(e));n.find("SCRIPTTOCHECK").remove()}else var n=$(e);return typeof window.frames["content"].jQuery!="undefined"&&window.frames.content.jQuery("#block-"+getBlockID(t.blockElement)).html(n).length?(Headway.mode=="design"&&refreshInspector(),window.frames.content.jQuery("#block-"+getBlockID(t.blockElement))):(r.html(n),Headway.mode=="design"&&refreshInspector(),r)}))},refreshBlockContent=function(e,t,n,r){if(typeof e=="undefined"||!e)return!1;if(typeof r=="undefined")var r=!0;var i=function(){var r=$i('.block[data-id="'+e+'"]'),i=GLOBALunsavedValues.blocks[e].settings,s=r.data("duplicateOf")?r.data("duplicateOf"):e;loadBlockContent({blockElement:r,blockSettings:{settings:i,dimensions:getBlockDimensions(r),position:getBlockPosition(r)},blockOrigin:s,blockDefault:{type:getBlockType(r),id:0,layout:Headway.viewModels.layoutSelector.currentLayout()},callback:t,callbackArgs:n})};if(!r)return i();typeof updateBlockContentFloodTimeoutAfter!="undefined"&&clearTimeout(updateBlockContentFloodTimeoutAfter),typeof updateBlockContentFloodTimeout=="undefined"?(i.call(),updateBlockContentFloodTimeout=setTimeout(function(){delete updateBlockContentFloodTimeout},500)):updateBlockContentFloodTimeoutAfter=setTimeout(function(){i.call(),delete updateBlockContentFloodTimeoutAfter},600)},setupBlockContextMenu=function(e){if(typeof e=="undefined")var e=!0;setupContextMenu({id:"block",elements:".block:visible",title:function(e){var t=getBlock(e.currentTarget),n=getBlockID(t),r=getBlockType(t),i=r?getBlockTypeNice(r)+" ":"",s=getBlockTypeIcon(r,!0),o=s?' style="background-image:url('+s+');"':null;return'<span class="type type-'+r+'" '+o+"></span>"+i+"Block"},contentsCallback:function(e){var t=$(this),n=getBlock(e.currentTarget),r=getBlockID(n),i=getBlockType(n),s=getBlockTypeNice(i),o=Headway.touch?"tap":"click";$('<li class="context-menu-block-options"><span>Open Block Options</span></li>').appendTo(t).on(o,function(){openBlockOptions(n)}),Headway.mode=="grid"&&$('<li class="context-menu-block-switch-type"><span>Switch Block Type</span></li>').appendTo(t).on(o,function(){openBlockTypeSelector(n)}),Headway.mode=="grid"&&$('<li class="context-menu-block-duplicate"><span>Duplicate Block</span></li>').appendTo(t).on(o,function(){duplicateBlock(n)}),$('<li class="context-menu-set-alias"><span>Set Block Alias</span></li>').appendTo(t).on(o,function(){var e=prompt("Please enter the desired block alias.",n.data("alias"));if(!e)return;dataSetBlockOption(getBlockID(n),"alias",e),n.data("alias",e),updateBlockContentCover(n)}),isBlockMirrored(n)&&$('<li class="context-menu-block-unmirror"><span>Unmirror Block</span></li>').appendTo(t).on(o,function(){if(!confirm("Are you sure you want to unmirror this block?\n\nIt will no longer copy the options and styling from the block it is currently mirroring."))return;updateBlockMirrorStatus(!1,n,""),dataSetBlockOption(getBlockID(n),"mirror-block",""),reloadBlockOptions(getBlockID(n))}),Headway.mode=="grid"&&$('<li class="context-menu-block-delete"><span>Delete Block</span></li>').appendTo(t).on(o,function(e){if(!confirm("Are you sure you want to delete this block?"))return!1;deleteBlock(n)})}})},bindBlockDimensionsTooltip=function(){if(Headway.touch)return!1;$i("body").delegate(".block","mouseenter",function(e){var t=this,n=typeof $(this).data("qtip")=="undefined"?!0:!1;if(typeof Headway.disableBlockDimensions!="undefined"&&Headway.disableBlockDimensions)return!1;n&&(addBlockDimensionsTooltip($(this)),$(this).data("hoverWaitTimeout",setTimeout(function(){$(t).qtip("reposition"),$(t).qtip("show"),typeof $(t).data("qtip")!="undefined"&&$i("#qtip-"+$(t).data("qtip").id).show()},300)))}),$i("body").delegate(".block","mouseleave",function(e){clearTimeout($(this).data("hoverWaitTimeout"))})},addBlockDimensionsTooltip=function(e){return Headway.touch?!1:($(e).qtip({style:{classes:"qtip-headway qtip-block-dimensions"},position:{my:"top center",at:"bottom center",container:$i("body"),viewport:$i("#headway-tooltip-container"),effect:!1},show:{delay:300,solo:!0,effect:!1},hide:{delay:25,effect:!1},content:{text:blockDimensionsTooltipContent}}),$(e).qtip("api"))},blockDimensionsTooltipContent=function(e){var t=getBlock(this),n=getBlockID(t),r=getBlockDimensionsPixels(t).width,i=getBlockDimensionsPixels(t).height,s=getBlockType(t);if(typeof s!="undefined")var o=getBlockTypeNice(s),u=getBlockTypeIcon(s,!0),a=u?' style="background-image:url('+u+');"':null,f=t.data("alias")?": "+t.data("alias"):"",l=getBlockMirrorLayoutName(t)?" from "+getBlockMirrorLayoutName(t):"",c=isBlockMirrored(t)?'<span class="block-info-mirroring">Mirroring'+l+"</span>":"",h=isBlockMirrored(t)?"main-block-info main-block-info-mirrored":"main-block-info",p='<div class="block-info"><span class="block-info-type" '+a+"></span>"+'<span class="'+h+'">'+o+" "+f+"</span>"+c+"</div>";else var p="";if(getBlockTypeObject(s)["fixed-height"])var i=i,d="Height";else var i=Headway.mode=="grid"?i:t.css("minHeight").replace("px",""),d="Min. Height";var v='<span class="block-height"><strong>'+d+":</strong> "+i+"<small>px</small></span>",m='<span class="block-width"><strong>Width:</strong> '+r+"<small>px</small></span>";if($("#input-enable-responsive-grid label.checkbox-checked").length==1||Headway.mode!="grid"&&Headway.responsiveGrid)var m='<span class="block-width"><strong>Max Width:</strong> <small>~</small>'+r+"<small>px</small></span>";var g=getBlockTypeObject(s)["fixed-height"]?"":'<span class="block-fluid-height-message">Height will auto-expand</span>';return p+m+' <span class="block-dimensions-separator">&#9747;</span> '+v+g+'<span class="right-click-message">Right-click to open block options</span>'},openBlockOptions=function(block,subTab){if(typeof block.target!="undefined"||!block)var block=getBlock(this);if(typeof subTab=="undefined")var subTab=null;if(!block||block.hasClass("block-type-unknown"))return!1;var blockID=getBlockID(block),blockType=getBlockType(block),blockTypeName=getBlockTypeNice(blockType),readyTabs=function(){var tab=$("div#block-"+blockID+"-tab");tab.tabs(),panelInputs.bind("div#block-"+blockID+"-tab"),setupTooltips();var callback=eval(tab.find("ul.sub-tabs").attr("data-open-js-callback"));typeof callback=="function"&&callback({block:block,blockID:blockID,blockType:blockType}),handleInputTogglesInContainer(tab.find("div.sub-tabs-content")),subTab&&selectTab(subTab,$("div#block-"+blockID+"-tab")),$("div#block-"+blockID+"-tab").find("select#input-"+blockID+"-mirror-block").val()!=""&&($("div#block-"+blockID+"-tab ul.sub-tabs li:not(#sub-tab-config)").hide(),selectTab("sub-tab-config",$("div#block-"+blockID+"-tab")))},blockTypeIconURL=getBlockTypeIcon(blockType,!0),blockTypeIconStyle=blockTypeIconURL?"background-image:url("+blockTypeIconURL+");":null,blockTabName=blockTypeName+" Block";block.data("alias")&&block.data("alias").length&&(blockTabName=block.data("alias")),addPanelTab("block-"+blockID,'<span class="block-type-icon" style="'+blockTypeIconStyle+'"></span>'+blockTabName,{url:Headway.ajaxURL,data:{security:Headway.security,action:"headway_visual_editor",method:"load_block_options",block_type:blockType,block_id:blockID,duplicate_of:block.data("duplicateOf"),unsaved_block_options:getUnsavedBlockOptionValues(blockID),layout:Headway.viewModels.layoutSelector.currentLayout()},callback:readyTabs},!0,!0,"block-type-"+blockType),$("div#panel").tabs("option","active",$("#panel-top").children('li[role="tab"]').index($('[aria-controls="block-'+blockID+'-tab"]')))},reloadBlockOptions=function(e,t){if(!$("ul#panel-top").find('[aria-controls="block-'+e+'-tab"]').length)return;if(typeof e=="undefined"||!e)var e=$("ul#panel-top > li.ui-state-active").attr("aria-controls").replace("block-","").replace("-tab","");if($("ul#panel-top > li.ui-state-active").attr("aria-controls").indexOf("block-")!==0)return!1;if(typeof t=="undefined"||!t)var t=$("div#block-"+e+"-tab ul.sub-tabs .ui-state-active a").attr("href").replace("#","");return removePanelTab("block-"+e),openBlockOptions(getBlockByID(e),t)},getUnsavedBlockOptionValues=function(e){if(typeof GLOBALunsavedValues=="object"&&typeof GLOBALunsavedValues["blocks"]=="object"&&typeof GLOBALunsavedValues["blocks"][e]=="object"&&typeof GLOBALunsavedValues["blocks"][e]["settings"]=="object")var t=GLOBALunsavedValues.blocks[e].settings;return typeof t=="object"&&Object.keys(t).length>0?t:null},openBlockTypeSelector=function(e){var t=getBlockID(e);removePanelTab("block-"+t),addPanelTab("block-"+t,"Select Block Type","",!0,!0);var n=$("#block-"+t+"-tab"),r=$(".block-type-selector-original").clone().removeClass("block-type-selector-original").appendTo(n).show();r.find("div.block-type").addClass("tooltip"),setupTooltips(),r.find("div.block-type").bind("click",function(n){var r=$(this).attr("id").replace("block-type-","");if(e.hasClass("blank-block"))e.parents(".wrapper").headwayGrid("setupBlankBlock",r);else if(confirm("Are you sure you wish to switch block types?  All settings for this block will be lost.")){var i=switchBlockType(e,r);t=i}$(".qtip").qtip("hide"),removePanelTab("block-"+t),openBlockOptions(getBlockByID(t))}),e.hasClass("blank-block")&&($(".wrapper").bind("mousedown",{block:e},hideBlankBlockTypeSelector),$(document).bind("keyup.esc",{block:e},hideBlankBlockTypeSelector),$i("html").bind("keyup.esc",{block:e},hideBlankBlockTypeSelector),$('ul#panel-top li a[href="#block-'+t+'-tab"]').siblings("span.close").bind("mouseup",{block:e},hideBlankBlockTypeSelector)),$("div#panel").tabs("option","active",$("#panel-top").children('li[role="tab"]').index($('[aria-controls="block-'+t+'-tab"]')));return},hideBlankBlockTypeSelector=function(e){var t=e.data.block;return t.hasClass("blank-block")&&$(e.target).parents(".block").first().get(0)!=$(t).get(0)&&(removePanelTab("block-"+getBlockID(t)),t.remove(),$(".wrapper").unbind("mousedown",hideBlankBlockTypeSelector),$(document).unbind("keyup.esc",hideBlankBlockTypeSelector),$i("html").unbind("keyup.esc",hideBlankBlockTypeSelector)),!0},switchBlockType=function(e,t,n){var r=getBlockTypeIcon(t,!0),i=getBlockType(e),s=getBlockID(e);e.removeClass("block-type-"+i),e.addClass("block-type-"+t),e.data("type",t),(typeof n=="undefined"||n)&&loadBlockContent({blockElement:e,blockOrigin:{type:t,id:0,layout:Headway.viewModels.layoutSelector.currentLayout()},blockSettings:{dimensions:getBlockDimensions(e),position:getBlockPosition(e)}}),getBlockTypeObject(t)["fixed-height"]===!0?(e.removeClass("block-fluid-height"),e.addClass("block-fixed-height"),e.css("min-height").replace("px","")!="0"&&e.css({height:e.css("min-height")})):(e.removeClass("block-fixed-height"),e.addClass("block-fluid-height"),e.css("height").replace("px","")!="auto"&&e.css({height:e.css("height")})),getBlockTypeObject(t)["show-content-in-grid"]?e.removeClass("hide-content-in-grid"):e.addClass("hide-content-in-grid"),e.removeClass("block-type-unknown"),oldBlockID=s;var o=Math.ceil(Math.random()*1e9);return e.attr("id","block-"+o).attr("data-id",o).attr("data-temp-id",o).data("id",o).data("temp-id",o),removePanelTab("block-"+oldBlockID),dataDeleteBlock(oldBlockID),dataAddBlock(e),dataSetBlockPosition(o,getBlockPosition(e)),dataSetBlockDimensions(o,getBlockDimensions(e)),dataSetBlockWrapper(o,getBlockWrapper(e).attr("id")),updateBlockContentCover(e),updateBlockMirrorStatus(!1,e,"",!1),allowSaving(),$(".qtip").qtip("hide"),o},duplicateBlock=function(e){if(!$(e).length)return!1;var t=getBlockWrapper(e),n=getBlockPosition(e),r=getBlockDimensions(e),i=e.data("alias")?e.data("alias")+" Copy":"",s=e.data("duplicateOf")?e.data("duplicateOf"):getBlockID(e),o={type:getBlockType(e),top:parseInt(n.top)+20,left:n.left,width:r.width,height:r.height,settings:{duplicateOf:s,alias:i}},u=t.data("ui-headwayGrid").addBlock(o);return t.data("ui-headwayGrid").sendBlockToTop(u),i&&(u.data("alias",i),updateBlockContentCover(u)),u},blockIntersectCheck=function(e,t){if(typeof t=="undefined"||!t)var t=block.parents(".grid-container").first();var n=blockIntersectCheckCallback(e,t.find(".block"));if(n.length>1){n.addClass("block-error");var r=!1}else{var i=0;t.find(".block-error").each(function(){var e=blockIntersectCheckCallback(this,t.find(".block"));e.length===1||!e?$(this).removeClass("block-error"):i++});var r=i===0?!0:!1}return r?(Headway.overlappingBlocks=!1,hideNotification("overlapping-blocks")):(Headway.overlappingBlocks=!0,showErrorNotification({id:"overlapping-blocks",message:"There are <strong>overlapping blocks</strong>.<br />Please separate them before saving.",closeTimer:!1})),r},blockIntersectCheckCallback=function(e,t){if(e==0||t==0||!$(e).is(":visible"))return!1;var n=[],r=5,i=$(e),s=i.offset(),o=[s.left,s.left+i.outerWidth()],u=[s.top,s.top+i.outerHeight()];return $(t).each(function(){var e=$(this);if(!e.is(":visible"))return;var t=e.offset(),i=[t.left,t.left+e.outerWidth()],s=[t.top,t.top+e.outerHeight()];o[0]+r<i[1]&&o[1]-r>i[0]&&u[0]<s[1]&&u[1]>s[0]&&n.push(this)}),$(n)},deleteBlock=function(e){if(typeof e!="object")var e=$i('.block[data-id="'+e+'"]');var t=getBlockID(e),n=getBlock(e),r=n.parents(".grid-container");Headway.history.add({description:"Deleted block",up:function(){n.hide(),removePanelTab("block-"+t),dataDeleteBlock(t),blockIntersectCheck(!1,r)},down:function(){n.show(),typeof GLOBALunsavedValues["blocks"][getBlockID(n)]["delete"]!="undefined"&&delete GLOBALunsavedValues.blocks[getBlockID(n)]["delete"],blockIntersectCheck(n,r)}}),allowSaving()},exportBlockSettingsButtonCallback=function(e){var t={security:Headway.security,action:"headway_visual_editor",method:"export_block_settings","block-id":e.blockID},n=Headway.ajaxURL+"?"+$.param(t);return window.open(n)},initiateBlockSettingsImport=function(e){var t=e.input,n=e.blockID,r=$(t).parents(".ui-tabs-panel").first().find('input[name="block-import-settings-file"]'),i=hwBoolean($(t).parents(".ui-tabs-panel").first().find('input[name="block-import-settings-include-options"]').val()),s=hwBoolean($(t).parents(".ui-tabs-panel").first().find('input[name="block-import-settings-include-design"]').val());if(!r.val())return alert("You must select a block settings export file before importing.");if(!i&&!s)return alert("You must import at least the options or design when importing block settings.");var o=r.get(0).files[0];if(o&&typeof o.name!="undefined"&&typeof o.type!="undefined"){var u=new FileReader;u.onload=function(e){var t=e.target.result,r=JSON.parse(t);if(r["data-type"]!="block-settings")return alert("Cannot load block settings.  Please insure that the block settings are a proper Headway block settings export.");if(getBlockType(getBlockByID(n))!=r["type"])return alert("Block type mismatch.  Be sure that the block settings export is the same type of block type that you're importing to.");typeof r["image-definitions"]!="undefined"&&Object.keys(r["image-definitions"]).length?(showNotification({id:"importing-images",message:"Currently importing images.",closeTimer:1e4}),$.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"import_images",importFile:r},function(e){var t=e;if(typeof t["error"]!="undefined")return alert("Error while importing images for block: "+t.error);importBlockSettingsAJAXCallback(n,t,i,s)})):importBlockSettingsAJAXCallback(n,r,i,s)},u.readAsText(o)}else alert("Cannot load block settings.  Please insure that the block settings are a proper Headway block settings export.")},importBlockSettingsAJAXCallback=function(e,t,n,r){if(n){var e=switchBlockType(getBlockByID(e),getBlockType(getBlockByID(e)));importBlockSettings(t.settings,e),removePanelTab("block-"+e),openBlockOptions(getBlockByID(e))}r&&typeof t["styling"]!="undefined"&&typeof t["id"]!="undefined"&&(dataPrepareDesignEditor(),$.each(t.styling,function(n,r){var i=t.id,s=e,n=n.replace("block-"+i,"block-"+s);$.each(r.properties,function(e,t){dataSetDesignEditorProperty({element:r.element,property:e,value:t!==null?t.toString():null,specialElementType:"instance",specialElementMeta:n})})}),showNotification({id:"block-design-imported-"+e,message:"Block design successfully imported",closeTimer:6e3,success:!0})),allowSaving()},importBlockSettings=function(e,t){dataPrepareBlock(t),GLOBALunsavedValues.blocks[t].settings=e,refreshBlockContent(t),showNotification({id:"block-settings-imported-"+t,message:"Block settings successfully imported",closeTimer:6e3,success:!0})},updateBlockMirrorStatus=function(e,t,n,r){if(typeof e=="undefined"||e==0)e=$();typeof r=="undefined"&&(r=!0);if(typeof t!="object")var t=getBlock($i('.block[data-id="'+t+'"]'));typeof n=="undefined"||n==""?(e.parents(".panel").find("ul.sub-tabs li:not(#sub-tab-config)").show(),t.attr("id","block-"+t.data("id")),t.data("block-mirror",!1),t.removeClass("block-mirrored")):(e.parents(".panel").find("ul.sub-tabs li:not(#sub-tab-config)").hide(),t.attr("id","block-"+n),t.data("block-mirror",n),t.addClass("block-mirrored"))},updateBlockCustomClasses=function(e,t,n){return Headway.mode!="design"?!1:(typeof t!="object"&&(t=getBlock($i('.block[data-id="'+t+'"]'))),t.length?(t.removeClass(t.data("custom-classes")),t.data("custom-classes",n),t.addClass(n),t):!1)}}),define("util.custommouse",["jquery","jqueryUI"],function(e){e.widget("ui.custommouse",e.ui.mouse,{options:{mouseStart:function(e){},mouseDrag:function(e){},mouseStop:function(e){},mouseCapture:function(e){return!0}},_mouseStart:function(e){return this.options.mouseStart(e)},_mouseDrag:function(e){return this.options.mouseDrag(e)},_mouseStop:function(e){return this.options.mouseStop(e)},_mouseCapture:function(e){return this.options.mouseCapture(e)},widgetEventPrefix:"custommouse",_init:function(){return this._mouseInit()},_create:function(){return this.element.addClass("ui-custommouse")},_destroy:function(){return this._mouseDestroy(),this.element.removeClass("ui-custommouse")}})}),define("helper.data",["underscore"],function(_){dataHandleInput=function(input,value,additionalCallbackArgs){var input=$(input);if(!input.length)return!1;if(typeof value=="undefined")var value=input.val();var optionID=input.attr("name").toLowerCase(),optionGroup=input.attr("data-group").toLowerCase(),callback=eval(input.attr("data-callback")),dataHandlerOverrideCallback=eval(input.attr("data-data-handler-callback"))||null,panelArgs=input.parents(".sub-tabs-content-container").first().data("panel-args")||{},callbackArgs=$.extend({},{input:input,value:value},panelArgs);typeof additionalCallbackArgs=="object"&&(callbackArgs=$.extend({},callbackArgs,additionalCallbackArgs)),allowSaving();if(!input.hasClass("repeater-group-input")&&input.parents(".repeater-group").length)return updateRepeaterValues(input.parents(".repeater")),typeof callback=="function"&&callback(callbackArgs),input.parents(".repeater-group");if(input.attr("data-no-save"))return typeof callback=="function"&&callback(callbackArgs),input;if(typeof dataHandlerOverrideCallback=="function")dataHandlerOverrideCallback(callbackArgs);else{if(typeof panelArgs.block!="undefined"&&panelArgs.block){var blockID=panelArgs.blockID;return dataSetBlockOption(blockID,optionID,value),refreshBlockContent(blockID,callback,callbackArgs),input}typeof panelArgs.wrapper!="undefined"&&panelArgs.wrapper?dataSetWrapperOption(panelArgs.wrapper.id,optionID,value):dataSetOption(optionGroup,optionID,value)}return typeof callback=="function"&&callback(callbackArgs),input},dataSetOption=function(e,t,n){return dataPrepareOptionGroup(e),GLOBALunsavedValues.options[e][t]=n,allowSaving(),GLOBALunsavedValues.options[e]},dataPrepareOptionGroup=function(e){return typeof GLOBALunsavedValues!="object"&&(GLOBALunsavedValues={}),typeof GLOBALunsavedValues["options"]!="object"&&(GLOBALunsavedValues.options={}),typeof GLOBALunsavedValues["options"][e]!="object"&&(GLOBALunsavedValues.options[e]={}),GLOBALunsavedValues.options[e]},dataSetBlockOption=function(e,t,n){return dataPrepareBlock(e),GLOBALunsavedValues.blocks[e].settings[t]=n,allowSaving(),GLOBALunsavedValues.blocks[e]},dataSetBlockPosition=function(e,t){if(typeof e=="string"&&e.indexOf("block-")!==-1)var e=e.replace("block-","");var t=t.left+","+t.top;return dataPrepareBlock(e),GLOBALunsavedValues.blocks[e].position=t,allowSaving(),GLOBALunsavedValues.blocks[e]},dataSetBlockDimensions=function(e,t){if(typeof e=="string"&&e.indexOf("block-")!==-1)var e=e.replace("block-","");var t=t.width+","+t.height;return dataPrepareBlock(e),GLOBALunsavedValues.blocks[e].dimensions=t,allowSaving(),GLOBALunsavedValues.blocks[e]},dataSetBlockWrapper=function(e,t){return dataPrepareBlock(e),GLOBALunsavedValues.blocks[e].wrapper=t.toString().replace("wrapper-",""),allowSaving(),GLOBALunsavedValues.blocks[e]},dataDeleteBlock=function(e){if(typeof e=="string"&&e.indexOf("block-")!==-1)var e=e.replace("block-","");return dataPrepareBlock(e),GLOBALunsavedValues.blocks[e]["delete"]=!0,allowSaving(),GLOBALunsavedValues.blocks[e]},dataAddBlock=function(e){var t,n;return typeof e=="string"&&t.indexOf("block-")!==-1?t=e.replace("block-",""):t=getBlockID(e),n=getBlockType(e),dataPrepareBlock(t),GLOBALunsavedValues.blocks[t]["new"]=n,GLOBALunsavedValues.blocks[t].insert_id=e.data("desired-id"),delete GLOBALunsavedValues.blocks[t]["delete"],allowSaving(),GLOBALunsavedValues.blocks[t]},dataPrepareBlock=function(e){return typeof GLOBALunsavedValues!="object"&&(GLOBALunsavedValues={}),typeof GLOBALunsavedValues["blocks"]!="object"&&(GLOBALunsavedValues.blocks={}),typeof GLOBALunsavedValues["blocks"][e]!="object"&&(GLOBALunsavedValues.blocks[e]={}),typeof GLOBALunsavedValues["blocks"][e]["settings"]!="object"&&(GLOBALunsavedValues.blocks[e].settings={}),GLOBALunsavedValues.blocks[e]},dataSetWrapperOption=function(e,t,n){return e=String(e).replace("wrapper-",""),dataPrepareWrapper(e),GLOBALunsavedValues.wrappers[e].settings[t]=n,allowSaving(),GLOBALunsavedValues.wrappers[e]},dataAddWrapper=function(e,t,n){return wrapperID=String(e.attr("id")).replace("wrapper-",""),dataPrepareWrapper(wrapperID),GLOBALunsavedValues.wrappers[wrapperID]={"new":!0,insert_id:e.data("desired-id"),position:n,settings:jQuery.extend({},{columns:Headway.defaultGridColumnCount,"column-width":Headway.globalGridColumnWidth,"gutter-width":Headway.globalGridGutterWidth},t)},dataSortWrappers(),allowSaving(),GLOBALunsavedValues.wrappers[wrapperID]},dataDeleteWrapper=function(e){return e=String(e).replace("wrapper-",""),dataPrepareWrapper(e),GLOBALunsavedValues.wrappers[e]["delete"]=!0,allowSaving(),GLOBALunsavedValues.wrappers[e]},dataSetWrapperWidth=function(e,t){var n=t=="fluid";return dataSetWrapperOption(e,"fluid",n)},dataSetWrapperGridWidth=function(e,t){var n=t=="fluid";return dataSetWrapperOption(e,"fluid-grid",n)},dataSortWrappers=function(){$i(".wrapper:visible").each(function(){var e=$(this).data("id");dataPrepareWrapper(e),GLOBALunsavedValues.wrappers[e].position=$i(".wrapper").index(this)})},dataPrepareWrapper=function(e){e=String(e).replace("wrapper-",""),typeof GLOBALunsavedValues!="object"&&(GLOBALunsavedValues={}),typeof GLOBALunsavedValues["wrappers"]=="undefined"&&(GLOBALunsavedValues.wrappers={}),typeof GLOBALunsavedValues["wrappers"][e]=="undefined"&&(GLOBALunsavedValues.wrappers[e]={}),typeof GLOBALunsavedValues["wrappers"][e]["settings"]=="undefined"&&(GLOBALunsavedValues.wrappers[e].settings={})},dataHandleDesignEditorInput=function(e){var t=$(e.hiddenInput),n=e.value;if(!t.length)return!1;if(t.parents("li.uncustomized-property").length==1)return!1;var r=t.attr("element").toLowerCase(),i=t.attr("property").toLowerCase(),s=t.attr("element_selector")||!1,o=t.attr("special_element_type").toLowerCase()||!1,u=t.attr("special_element_meta").toLowerCase()||!1;e.unit=t.siblings(".property-unit-select").find("select").val(),dataSetDesignEditorProperty({element:r,property:i,value:n,specialElementType:o,specialElementMeta:u,unit:e.unit});if(n==="null"||n=="DELETE")n=null;return t.val(n),$("#design-editor-element-selector-container").find("li#element-"+r).addClass("customized-element").attr("title","You have customized a property in this property group."),$("#design-editor-main-elements").find(".ui-state-active").length&&$("#design-editor-sub-elements").find(".ui-state-active").length&&$("#design-editor-main-elements").find(".ui-state-active").addClass("has-customized-children"),t.parents(".design-editor-box").first().addClass("design-editor-box-customized"),t.parents(".design-editor-box").first().find(".design-editor-box-title").attr("title","You have customized a property in this property group."),dataDesignEditorPropertyFeedback({element:r,property:i,value:n,specialElementType:o,specialElementMeta:u,unit:e.unit})},dataDesignEditorPropertyFeedback=function(args){var element=args.element.toLowerCase(),property=args.property.toLowerCase(),value=args.value,specialElementType=args.specialElementType||!1,specialElementMeta=args.specialElementMeta||!1,selector;if(value==="null"||value=="DELETE")args.value=null,value=null;if(!specialElementType)selector=Headway.elements[element].selector;else if(specialElementType=="layout"){var originalSelector=Headway.elements[element].selector.replace("body","");originalSelector.length?selector="body.layout-"+specialElementMeta.replace(/\|\|/g,"-")+" "+originalSelector:selector="body.layout-"+specialElementMeta.replace(/\|\|/g,"-")}else selector=Headway.elements[element][specialElementType+"s"][specialElementMeta].selector;if(Headway.designEditorProperties.hasOwnProperty(property)){var callback=eval("(function(params){"+Headway.designEditorProperties[property]["js-callback"]+"})");args.selector=selector,args.element=$i(selector),typeof args["unit"]=="undefined"&&(args.unit=""),callback(args)}return value==null&&selector&&property&&stylesheet.delete_rule_property(selector,property),selector},dataSetDesignEditorProperty=function(e){var t=e.element.toLowerCase(),n=e.property.toLowerCase(),r=e.value,i=e.unit,s=e.specialElementType||!1,o=e.specialElementMeta||!1;i&&i.length&&r!="null"&&r!="DELETE"&&(r+=i),dataPrepareDesignEditor(),typeof GLOBALunsavedValues["design-editor"][t]!="object"&&(GLOBALunsavedValues["design-editor"][t]={});if(s==0||o==0)typeof GLOBALunsavedValues["design-editor"][t]["properties"]!="object"&&(GLOBALunsavedValues["design-editor"][t].properties=new Object),GLOBALunsavedValues["design-editor"][t].properties[n]=r,typeof Headway.elementData!="object"&&(Headway.elementData=new Object),typeof Headway.elementData[t]=="undefined"&&(Headway.elementData[t]={properties:{}}),typeof Headway.elementData[t]["properties"]=="undefined"&&(Headway.elementData[t].properties={}),Headway.elementData[t].properties[n]=r;else{typeof GLOBALunsavedValues["design-editor"][t]["special-element-"+s]!="object"&&(GLOBALunsavedValues["design-editor"][t]["special-element-"+s]=new Object),typeof GLOBALunsavedValues["design-editor"][t]["special-element-"+s][o]!="object"&&(GLOBALunsavedValues["design-editor"][t]["special-element-"+s][o]=new Object),GLOBALunsavedValues["design-editor"][t]["special-element-"+s][o][n]=r,typeof Headway.elementData!="object"&&(Headway.elementData=new Object),typeof Headway.elementData[t]!="object"&&(Headway.elementData[t]=new Object),typeof Headway.elementData[t]["special-element-"+s]!="object"&&(Headway.elementData[t]["special-element-"+s]=new Object);if(!_.isObject(Headway.elementData[t]["special-element-"+s][o])||_.isArray(Headway.elementData[t]["special-element-"+s][o]))Headway.elementData[t]["special-element-"+s][o]=new Object;Headway.elementData[t]["special-element-"+s][o][n]=r}if(typeof designEditor!="undefined"){var u=$('ul#design-editor-element-selector li.element[data-element-id="'+t+'"]');s=="instance"?u=u.filter('[data-instance-id="'+o+'"]'):s=="state"&&(u=u.filter('[data-state-id="'+o+'"]')),designEditor.showElementPropertiesThrottled(u)}return allowSaving(),!0},dataPrepareDesignEditor=function(){return typeof GLOBALunsavedValues!="object"&&(GLOBALunsavedValues={}),typeof GLOBALunsavedValues["design-editor"]!="object"&&(GLOBALunsavedValues["design-editor"]={}),GLOBALunsavedValues["design-editor"]}}),wrapperOptionCallbackIndependentGrid=function(e,t){var n=e.parents("[data-panel-args]").data("panel-args").wrapper.id.replace("wrapper-",""),r=$i('.wrapper[data-id="'+n+'"]');if(typeof r=="undefined"||!r.length)return!1;var i=r.data("ui-headwayGrid");i.options.useIndependentGrid=t,i.updateGridCSS()},wrapperOptionCallbackColumnCount=function(e,t){var n=e.parents("[data-panel-args]").data("panel-args").wrapper.id.replace("wrapper-",""),r=$i('.wrapper[data-id="'+n+'"]');if(typeof r=="undefined"||!r.length)return!1;if(r.find(".block:visible").length)return alert("This wrapper must be empty of blocks before you can change the number of columns.\n\nEither drag the blocks to another wrapper or delete them if they are no longer needed."),!1;var i=r.data("ui-headwayGrid");i.options.columns=t,i.addColumnGuides(),i.updateGridCSS()},wrapperOptionCallbackColumnWidth=function(e,t){var n=e.parents("[data-panel-args]").data("panel-args").wrapper.id.replace("wrapper-",""),r=$i('.wrapper[data-id="'+n+'"]');if(typeof r=="undefined"||!r.length)return!1;var i=r.data("ui-headwayGrid");i.options.columnWidth=t,i.updateGridCSS()},wrapperOptionCallbackGutterWidth=function(e,t){var n=e.parents("[data-panel-args]").data("panel-args").wrapper.id.replace("wrapper-",""),r=$i('.wrapper[data-id="'+n+'"]');if(typeof r=="undefined"||!r.length)return!1;var i=r.data("ui-headwayGrid");i.options.gutterWidth=t,i.updateGridCSS()},wrapperOptionCallbackMarginTop=function(e,t){var n=e.parents("[data-panel-args]").data("panel-args").wrapper.id.replace("wrapper-",""),r=$i('.wrapper[data-id="'+n+'"]');if(typeof r=="undefined"||!r.length)return!1;r.css({marginTop:t}),wrapperMarginFeedbackCreator(r,"top")},wrapperOptionCallbackMarginBottom=function(e,t){var n=e.parents("[data-panel-args]").data("panel-args").wrapper.id.replace("wrapper-",""),r=$i('.wrapper[data-id="'+n+'"]');if(typeof r=="undefined"||!r.length)return!1;r.css({marginBottom:t}),wrapperMarginFeedbackCreator(r,"bottom")},wrapperMarginFeedbackCreator=function(e,t){e.find(".wrapper-margin-feedback").length&&(clearTimeout(e.find(".wrapper-margin-feedback").data("fadeout-timeout")),e.find(".wrapper-margin-feedback").remove());var n=$('<div class="wrapper-margin-feedback"></div>').prependTo(e),r=parseInt(e.css("margin"+t.capitalize()).replace("px","")),i={position:"absolute",width:e.outerWidth(),left:0,height:r,backgroundColor:"rgba(255, 127, 0, .35)"};return i[t]="-"+r+"px",n.css(i),n.data("fadeout-timeout",setTimeout(function(){n.fadeOut(200)},400)),n},updateGridWidthInput=function(e){var t=$(e).find('input[name="columns"]').val(),n=$(e).find('input[name="column-width"]').val(),r=$(e).find('input[name="gutter-width"]').val(),i=n*t+(t-1)*r;return $(e).find('input[name="grid-width"]').val(i)},define("modules/grid/wrapper-inputs",function(){}),define("modules/grid/wrappers",["util.custommouse","qtip","helper.data","modules/grid/wrapper-inputs"],function(){setupWrapperSortables=function(){return $i("#whitewrap").sortable({items:"div.wrapper",handle:"div.wrapper-drag-handle",axis:"y",tolerance:"intersect",placeholder:"wrapper-sortable-placeholder",start:function(e,t){$i(".wrapper").each(function(){$(this).data("current-height",$(this).height())}),$(t.item).hasClass("wrapper-fixed-grid")&&$(t.item).css({left:"50%",marginLeft:"-"+$(t.item).outerWidth()/2+"px"}),t.placeholder.css({width:t.item.outerWidth(),height:t.item.outerHeight(),marginTop:t.item.css("marginTop"),marginBottom:t.item.css("marginBottom")}),Headway.iframe.data("maximumScrollTop",Headway.iframe.contents().height()),$(this).sortable("refreshPositions")},sort:function(e,t){e.clientY<100?(typeof wrapperDraggableScrollDownInterval=="number"&&(clearInterval(wrapperDraggableScrollDownInterval),delete wrapperDraggableScrollDownInterval),typeof wrapperDraggableScrollUpInterval=="undefined"&&(wrapperDraggableScrollUpInterval=setInterval(function(){Headway.iframe.contents().scrollTop(Headway.iframe.contents().scrollTop()-8)},5))):Headway.iframe.height()-e.clientY<100?(typeof wrapperDraggableScrollUpInterval=="number"&&(clearInterval(wrapperDraggableScrollUpInterval),delete wrapperDraggableScrollUpInterval),typeof wrapperDraggableScrollDownInterval=="undefined"&&(wrapperDraggableScrollDownInterval=setInterval(function(){var e=Headway.iframe.contents().scrollTop()+8;Headway.iframe.height()+e>=Headway.iframe.data("maximumScrollTop")&&(e=Headway.iframe.data("maximumScrollTop")-Headway.iframe.height()),Headway.iframe.contents().scrollTop(e)},5))):(typeof wrapperDraggableScrollDownInterval=="number"&&(clearInterval(wrapperDraggableScrollDownInterval),delete wrapperDraggableScrollDownInterval),typeof wrapperDraggableScrollUpInterval=="number"&&(clearInterval(wrapperDraggableScrollUpInterval),delete wrapperDraggableScrollUpInterval))},stop:function(e,t){$i(".wrapper").css({marginLeft:"",left:""}),$i(".wrapper").each(function(){$(this).headwayGrid("updateGridContainerHeight")}),typeof wrapperDraggableScrollDownInterval=="number"&&(clearInterval(wrapperDraggableScrollDownInterval),delete wrapperDraggableScrollDownInterval),typeof wrapperDraggableScrollUpInterval=="number"&&(clearInterval(wrapperDraggableScrollUpInterval),delete wrapperDraggableScrollUpInterval),dataSortWrappers()}})},setupWrapperResizable=function(e){if(typeof e=="undefined")var e=$i(".wrapper");e.each(function(){var e=parseInt($(this).css("minHeight").replace("px",""));$(this).resizable({handles:"n, s",grid:5,minHeight:e,start:function(t,n){$(t.toElement).hasClass("ui-resizable-n")?$(this).data("resizing-position","n"):$(this).data("resizing-position","s");if($(this).find(".block").length){var r=0,i=null;$(this).find(".block:visible").each(function(){var e=$(this).position().top,t=$(this).outerHeight()+e;t>r&&(r=t);if(e<i||i===null)i=e;$(this).data("resize-original-block-top",$(this).position().top)});if($(this).data("resizing-position")=="n")var s=r-i;else var s=r}else var s=e;$(this).resizable("option","minHeight",s)},resize:function(e,t){var n=t.originalSize.height-t.size.height,r=t.size.height;$(this).find(".grid-container").height(r),$(this).css({top:"",height:""});if($(this).data("resizing-position")=="n"){var i=!1;$(this).find(".block").each(function(){if($(this).data("resize-original-block-top")-n<0)return i=!0,!1}),i||$(this).find(".block").each(function(){$(this).css({top:$(this).data("resize-original-block-top")-n})})}},stop:function(){$(this).find(".block").each(function(){var e=$(this),t=getBlockID(e);e.attr("data-grid-top",e.position().top),dataSetBlockPosition(t,getBlockPosition(e))}),$(this).data("resizing-position",null)}})})},stopWrapperResizable=function(e){if(!e.length||!e.resizable)return!1;e.resizable("destroy"),setupWrapperResizable(e)},addEdgeInsertWrapperButtons=function(){var e='<div class="add-wrapper-button-fixed tooltip" title="Add Wrapper">+</div>';$('<div class="add-wrapper-buttons add-wrapper-buttons-top">'+e+"</div>").data("position","top").prependTo($i("body")),$('<div class="add-wrapper-buttons add-wrapper-buttons-bottom">'+e+"</div>").data("position","bottom").appendTo($i("body"))},setupWrapperContextMenu=function(){setupContextMenu({id:"wrapper",elements:".wrapper",title:function(e){var t=$(e.currentTarget),n=getWrapperID(t);return"Wrapper"},contentsCallback:function(e){var t=$(this),n=$(e.currentTarget),r=getWrapperID(n);$('<li class="context-menu-wrapper-options"><span>Open Wrapper Options</span></li>').appendTo(t).on("click",function(){openWrapperOptions(r)}),n.hasClass("wrapper-fluid")&&Headway.mode=="grid"?($('<li class="context-menu-wrapper-to-fixed"><span>Change Wrapper to Fixed</span></li>').appendTo(t).find("span").on("click",function(){n.removeClass("wrapper-fluid"),n.removeClass("wrapper-fluid-grid"),n.addClass("wrapper-fixed"),n.addClass("wrapper-fixed-grid"),dataSetWrapperWidth(getWrapperID(n),"fixed"),dataSetWrapperGridWidth(getWrapperID(n),"fixed"),n.data("ui-headwayGrid").resetGridCalculations(),n.data("ui-headwayGrid").alignAllBlocksWithGuides(),n.data("ui-headwayGrid").updateGridContainerHeight()}),n.hasClass("wrapper-fixed-grid")?$('<li class="context-menu-wrapper-grid-to-fluid"><span>Change Grid to Fluid</span></li>').appendTo(t).find("span").on("click",function(){n.removeClass("wrapper-fixed-grid"),n.addClass("wrapper-fluid-grid"),dataSetWrapperWidth(getWrapperID(n),"fluid"),dataSetWrapperGridWidth(getWrapperID(n),"fluid"),n.data("ui-headwayGrid").resetGridCalculations(),n.data("ui-headwayGrid").alignAllBlocksWithGuides(),n.data("ui-headwayGrid").updateGridContainerHeight()}):n.hasClass("wrapper-fluid-grid")&&$('<li class="context-menu-wrapper-grid-to-fixed"><span>Change Grid to Fixed</span></li>').appendTo(t).find("span").on("click",function(){n.removeClass("wrapper-fluid-grid"),n.addClass("wrapper-fixed-grid"),dataSetWrapperWidth(getWrapperID(n),"fluid"),dataSetWrapperGridWidth(getWrapperID(n),"fixed"),n.data("ui-headwayGrid").resetGridCalculations(),n.data("ui-headwayGrid").alignAllBlocksWithGuides(),n.data("ui-headwayGrid").updateGridContainerHeight()})):n.hasClass("wrapper-fixed")&&Headway.mode=="grid"&&$('<li class="context-menu-wrapper-to-fluid"><span>Change Wrapper to Fluid</span></li>').appendTo(t).on("click",function(){n.removeClass("wrapper-fixed"),n.addClass("wrapper-fluid"),n.addClass("wrapper-fixed-grid"),dataSetWrapperWidth(getWrapperID(n),"fluid"),dataSetWrapperGridWidth(getWrapperID(n),"fixed"),n.data("ui-headwayGrid").resetGridCalculations(),n.data("ui-headwayGrid").alignAllBlocksWithGuides(),n.data("ui-headwayGrid").updateGridContainerHeight()}),$('<li class="context-menu-set-alias"><span>Set Wrapper Alias</span></li>').appendTo(t).on("click",function(){var e=prompt("Please enter the desired wrapper alias.",n.data("alias"));if(!e)return;dataSetWrapperOption(getWrapperID(n),"alias",e),n.data("alias",e)}),$i(".wrapper:visible").length>=2&&Headway.mode=="grid"&&$('<li class="context-menu-wrapper-delete"><span>Delete Wrapper</span></li>').appendTo(t).on("click",function(){deleteWrapper(r)})}})},bindWrapperButtons=function(){$i("body").delegate(".add-wrapper-button-fixed","click",function(){return addWrapper($(this).parents(".add-wrapper-buttons").data("position"),{fluid:!1})}),$i("body").delegate(".add-wrapper-fluid-fixed-grid","click",function(){return addWrapper($(this).parents(".add-wrapper-buttons").data("position"),{fluid:!0})}),$i("body").delegate(".add-wrapper-fluid-fluid-grid","click",function(){return addWrapper($(this).parents(".add-wrapper-buttons").data("position"),{fluid:!0,"fluid-grid":!0})}),$i("body").delegate(".wrapper-buttons .wrapper-options","click",function(){return openWrapperOptions(getWrapperID($(this).closest(".wrapper")))}),bindWrapperMarginButtons($i(".wrapper-buttons .wrapper-margin-handle"))},addWrapper=function(e,t,n){typeof t.id!="undefined"&&delete t.id;var t=$.extend({},{fluid:!1,"fluid-grid":!1,"use-independent-grid":!1},t);typeof t["fluid"]!="boolean"&&(t.fluid=hwBoolean(t.fluid)),typeof t["fluid-grid"]!="boolean"&&(t["fluid-grid"]=hwBoolean(t["fluid-grid"])),typeof t["enable-sticky-positioning"]!="boolean"&&(t["enable-sticky-positioning"]=hwBoolean(t["enable-sticky-positioning"]));var r=Math.ceil(Math.random()*1e9),i=$('<div class="wrapper"><div class="grid-container"></div></div>');i.attr("id","wrapper-"+r).attr("data-id",r).attr("data-temp-id",r).attr("data-desired-id",t.id?t.id:null).data("id",r).data("temp-id",r).data("desired-id",t.id?t.id:null),i.prepend('<div class="wrapper-mirror-overlay"></div>'),i.find(".grid-container").append('						<div class="wrapper-mirror-notice">							<div>							<h2>Wrapper Mirrored</h2>							<p>This wrapper is mirroring blocks from another wrapper.</p>							<small>Mirroring can be disabled via Wrapper Options in the right-click menu</small>							</div>						</div><!-- .wrapper-mirror-notice -->					'),addWrapperButtons(i),t.fluid?i.addClass("wrapper-fluid"):i.addClass("wrapper-fixed"),t["fluid-grid"]?i.addClass("wrapper-fluid-grid"):i.addClass("wrapper-fixed-grid");switch(e){case"top":i.prependTo($i("#whitewrap"));break;case"bottom":i.insertBefore($i("#wrapper-buttons-template"))}t.fluid&&(i.css("margin"+e.capitalize(),0),dataSetDesignEditorProperty({element:"wrapper",property:"margin-"+e,value:0,specialElementType:"instance",specialElementMeta:"wrapper-"+r})),dataAddWrapper(i,t,$i(".wrapper").index(i)),allowSaving(),i.find(".grid-container").height(100),i.data("wrapper-settings",t),i.headwayGrid(),setupWrapperResizable(i),bindWrapperMarginButtons(i.find(".wrapper-margin-handle"));var s=t.fluid?"Fluid":"Fixed";return(typeof n=="undefined"||!n)&&showNotification({id:"wrapper-created-"+r,message:s+" wrapper created.",closable:!0,closeTimer:5e3}),setupTooltips("iframe"),i},deleteWrapper=function(e,t){var n=$i('.wrapper[data-id="'+e+'"]');return n.length&&(t||confirm("Are you sure you want to remove this wrapper?  All blocks inside the wrapper will be deleted as well."))?(dataDeleteWrapper(e),n.find(".block").each(function(){deleteBlock($(this))}),n.remove()):!1},addWrapperButtons=function(e){e.each(function(){if($(this).find(".wrapper-buttons").length)return;var e=$i("#wrapper-buttons-template").first().clone().attr("id","").addClass("wrapper-buttons");return e.prependTo($(this))})},bindWrapperMarginButtons=function(e){var t=function(e){var t=$(e.target);t.length||(t=$i(".wrapper-handle[data-dragging]").first());var n=t.closest(".wrapper"),r=t.hasClass("wrapper-top-margin-handle")?"Top":"Bottom",i='<span style="opacity: .8;">'+r+" Margin:</span> "+n.css("margin"+r),s=t.data("dragging")?"":"Drag to change wrapper's <strong>"+r.toLowerCase()+" margin</strong><br />";return s+i};e.qtip({content:{text:t},style:{classes:"qtip-headway"},show:{delay:10,event:"mouseenter"},position:{my:"right center",at:"left center",container:Headway.iframe.contents().find("body"),viewport:$("#iframe-container"),effect:!1}}),e.custommouse({mouseStart:function(e){this.handle=$(e.currentTarget).hasClass("wrapper-margin-handle")?$(e.currentTarget):$(e.currentTarget).parents(".wrapper-margin-handle").first(),this.dragStart={left:e.pageX,top:e.pageY},this.marginToChange=this.handle.hasClass("wrapper-top-margin-handle")?"marginTop":"marginBottom",this.wrapper=$(e.currentTarget).closest(".wrapper"),this.originalWrapperMargin=parseInt(this.wrapper.css(this.marginToChange).replace("px","")),this.handle.siblings(".wrapper-handle[data-hasqtip], .wrapper-options[data-hasqtip]").each(function(){var e=$(this).qtip("api");typeof e!="undefined"&&e.rendered&&(e.disable(),e.hide())}),this.wrapper.addClass("wrapper-handle-in-use")},mouseDrag:function(e){var n=e.pageY-this.dragStart.top,r=2,i=Math.round(n/r),s=this.originalWrapperMargin+i;s<0&&(s=0),this.handle.attr("data-dragging",!0),this.handle.qtip("show"),this.handle.qtip("reposition"),this.handle.qtip("option","content.text",t),this.wrapper.css(this.marginToChange,s),dataSetDesignEditorProperty({element:"wrapper",property:"margin-"+this.marginToChange.replace("margin","").toLowerCase(),value:s.toString(),specialElementType:"instance",specialElementMeta:"wrapper-"+getWrapperID(this.wrapper)})},mouseStop:function(e){this.handle.removeAttr("data-dragging"),this.handle.data("dragging",!1);var t=this.handle.qtip("api");t.hide(),$i("#qtip-"+t.id).hide(),this.handle.siblings(".wrapper-handle, .wrapper-options").qtip("enable"),this.wrapper.removeClass("wrapper-handle-in-use")}})},populateWrapperMirrorNotice=function(e){var t=getWrapperMirror(getWrapperID(e));if(!t)return;e.find(".wrapper-mirror-notice-id").text(t.replace("wrapper-","")),e.find(".wrapper-mirror-notice-layout").hide()},assignDefaultWrapperID=function(){if($i("#wrapper-default").length){var e=Math.ceil(Math.random()*1e9),t=$i("#wrapper-default");t.attr("id","wrapper-"+e).attr("data-id",e).attr("data-temp-id",e).attr("data-desired-id",null).data("id",e).data("temp-id",e).data("desired-id",null),dataAddWrapper(t,{fluid:!1,"fluid-grid":!1},$i(".wrapper").index(t)),t.find(".block").each(function(){dataSetBlockWrapper(getBlockID($(this)),e)})}}}),define("modules/design/mode-design",["jquery","underscore","deps/colorpicker","helper.blocks","modules/grid/wrappers"],function(e,t){designEditorRequestElements=function(t){return Headway.elementsRequest&&(!t||typeof t=="undefined")?Headway.elementsRequest:(Headway.elementsRequest=e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"get_design_editor_elements",layout:Headway.viewModels.layoutSelector.currentLayout()},function(t){Headway.elementGroups=e.extend({},t.groups),delete t.groups,Headway.elements=t},"json"),Headway.elementsRequest)},designEditorRequestElementData=function(t){return Headway.elementDataRequest&&(!t||typeof t=="undefined")?Headway.elementDataRequest:(Headway.elementDataRequest=e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"get_design_editor_element_data",layout:Headway.viewModels.layoutSelector.currentLayout()},function(e){Headway.elementData=e},"json"),Headway.elementDataRequest)},designEditorTabEditor=function(){var n=this;this._init=function(){createCog(e("#side-panel"),!0,!0),e.when(designEditorRequestElements(),designEditorRequestElementData()).then(this.setupElementSelector),this.bindElementSelector(),this.setupTabs(),this.setupBoxes(),this.bindDesignEditorInfo()},this.setupTabs=function(){e("#side-panel-top").tabs()},this.setupBoxes=function(){designEditorBindPropertyBoxToggle()},this.setupElementSelector=function(){e("#side-panel").addClass("side-panel-loaded"),e("#side-panel").find("> .cog-container").remove(),e("#design-editor-element-selector").empty(),e.each(Headway.elementGroups,function(t,n){var r=e('<li id="element-group-'+t+'" class="element-group has-children">											<span class="element-group-name">'+n.name+'</span>											<span class="element-expander"></span>											<ul class="group-elements"></ul>										</li>');typeof n.description!="undefined"&&n.description&&r.find(".element-group-name").after('<small class="description">'+n.description+"</small>"),r.appendTo("#design-editor-element-selector")}),e.each(Headway.elements,designEditor.addElementToSelector),e("#design-editor-element-selector li.element").each(function(){var t=e(this).data("parent");if(!t)return;var n=e("#design-editor-element-selector li#element-"+t);n.hasClass("has-children")||(n.addClass("has-children"),n.prepend('<span class="element-expander"></span>'),n.append('<ul class="children-elements"></ul>')),e(this).appendTo(n.find("> ul.children-elements")),e(this).hasClass("customized-element")&&n.addClass("had-customized-children")}),e("#design-editor-element-selector li.element").each(function(){designEditor.addElementStates(e(this)),designEditor.addElementInstances(e(this))}),designEditor.showOnlyLayoutElements()},this.showAllElements=function(t){e("#design-editor-element-selector-container").removeClass("show-only-layout-elements")},this.showOnlyLayoutElements=function(){e("#design-editor-element-selector-container").addClass("show-only-layout-elements");var t=function(n){if(n.hasClass("element-instances-container"))return n.find("> ul > li.element").each(function(){t(e(this))});if(!n.data("selector"))return;$i(n.data("selector")).length?(n.addClass("element-in-layout"),n.find("> ul > li.element").each(function(){t(e(this))}),n.find("> ul > li.element-states-container > ul.children-elements > li.element-state").addClass("element-in-layout")):(n.removeClass("element-in-layout"),n.find("> ul > li.element-states-container > ul.children-elements > li.element-state").removeClass("element-in-layout"))};e("#design-editor-element-selector > .element-group > ul.group-elements > li.element").each(function(){t(e(this))})},this.bindElementSelector=function(){var t=e("ul#design-editor-element-selector"),n=e("ul#design-editor-styles");t.on("click",designEditor.processNoElementClick),t.on("mouseenter","li span.element-name",designEditor.processElementMouseEnter),t.on("mouseleave","li span.element-name",designEditor.processElementMouseLeave),t.on("click","li span.element-name",designEditor.processElementClick),t.on("click","li span.element-expander",designEditor.processElementExpanderClick),t.on("click","li span.element-name span.element-name-button-layout-specific",designEditor.processElementNameLayoutSpecific),t.on("click","li span.element-name span.element-name-button-live-css",designEditor.processElementNameLiveCSS),n.on("click","li.property .property-value",designEditor.processPropertyValueClick),n.on("click","li.property .property-delete",designEditor.processPropertyDeleteClick),e("#side-panel-collapse-arrow").on("click",toggleDesignEditor),e("#element-selector-show-current-layout-elements").on("click",designEditor.showOnlyLayoutElements),e("#element-selector-show-all-elements").on("click",designEditor.showAllElements)},this.addElementToSelector=function(t,n){var r=n.description?'<small class="description">'+n.description+"</small>":"",i=e('<li id="element-'+t+'" data-element-id="'+t+'" class="element" data-selector="'+n.selector+'">												<span class="element-name">'+n.name+"</span>												"+r+"											</li>");i.data({group:n.group,parent:n.parent,selector:n.selector,id:t}),n.customized&&i.addClass("customized-element"),i.appendTo(e("li#element-group-"+n.group+" ul.group-elements"))},this.addElementInstances=function(n){var r=n.data("element-id"),i=designEditorGetElementObject(r,!1).instances;if(t.isEmpty(i))return!1;var s=e.map(i,function(e,t){return[e]});s.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),n.hasClass("has-children")||(n.addClass("has-children"),n.prepend('<span class="element-expander"></span>'),n.append('<ul class="children-elements"></ul>')),n.children(".children-elements").prepend('							<li id="element-'+r+'-instances" class="element element-instances-container has-children">								<span class="element-expander"></span>								<span class="element-name">Instances</span>								<ul class="children-elements"></ul>							</li>						'),n.addClass("instances-visible"),e.each(s,function(t,i){var s=i.id,o=i.name;typeof i["state-of"]!="undefined"&&i["state-of"]&&(o="  -- "+i["state-name"]);var u=e('<li id="element-instance-'+s+'" data-element-id="'+r+'" data-instance-id="'+s+'" data-selector="'+i.selector+'" class="element element-instance">										<span class="element-name">'+o+'</span>										<small class="description">'+i["layout-name"]+"</small>									</li>").appendTo(n.find("> ul.children-elements > li.element-instances-container > ul.children-elements"));u.data({selector:i.selector}),typeof i["customized"]!="undefined"&&i.customized&&u.addClass("customized-element")})},this.addElementStates=function(n){var r=n.data("element-id"),i=designEditorGetElementObject(r).states;if(t.isEmpty(i))return!1;n.hasClass("has-children")||(n.addClass("has-children"),n.prepend('<span class="element-expander"></span>'),n.append('<ul class="children-elements"></ul>')),n.children(".children-elements").prepend('							<li id="element-'+r+'-states" class="element element-states-container has-children">								<span class="element-expander"></span>								<span class="element-name">States</span>								<ul class="children-elements"></ul>							</li>						'),n.addClass("states-visible"),e.each(i,function(t,i){var s=e('<li id="element-state-'+t+"-for-"+r+'" data-element-id="'+r+'" data-state-id="'+t+'" data-selector="'+i.selector+'" class="element element-state">										<span class="element-name">'+i.name+"</span>									</li>").appendTo(n.find("> ul.children-elements > li.element-states-container > ul.children-elements"));s.data({selector:i.selector})})},this.showElementProperties=function(r){if(typeof r!="object")var r=e(this);var i=r.data("element-id");e("ul#design-editor-styles").empty().show(),e(".design-editor-styles-message").hide();if(t.isEmpty(Headway.elementData[i])){e("ul#design-editor-styles").empty(),e("#design-editor-styles-no-styles").show(),e("#design-editor-styles-nothing-selected").hide();return}e("ul#design-editor-styles").prepend("<h2>"+r.children(".element-name").first().text()+"</h2>");var s=Headway.elementData[i],o=e('<li class="properties"><ul></ul></li>'),u=e("ul#design-editor-styles");t.isEmpty(Headway.elementData[i].properties)||e.each(Headway.elementData[i].properties,function(e,t){n.addElementProperty(u,e,t)});var a=["instance","state","layout"];return e.each(a,function(r,s){t.isEmpty(Headway.elementData[i]["special-element-"+s])||e.each(Headway.elementData[i]["special-element-"+s],function(r,o){if(s=="layout")var a=e('#layout-selector span[data-layout-id="'+r+'"] strong').text(),f="";else{if(!!t.isUndefined(designEditorGetElementObject(i,!1)[s+"s"][r]))return;var a=designEditorGetElementObject(i,!1)[s+"s"][r].name;if(typeof designEditorGetElementObject(i,false)[s+"s"][r]["layout-name"]!="undefined")var f=" &ndash; Layout: "+designEditorGetElementObject(i,!1)[s+"s"][r]["layout-name"];else var f=""}e.each(o,function(e,t){n.addElementProperty(u,e,t,{type:s,id:r,name:a,layoutName:f})})})}),setupTooltips(),o},this.showElementPropertiesThrottled=t.throttle(this.showElementProperties,300),this.addElementProperty=function(n,r,i,s){if(i=="DELETE")return!1;if(typeof Headway.designEditorProperties[r]=="undefined")return!1;var o,u=Headway.designEditorProperties[r],a=u.group.toLowerCase().replace(" ","-");n.find('.property-value-group-name[data-property-group-id="'+a+'"]').length||(n.append('<li class="property-value-group-name" data-property-group-id="'+a+'">'+u.group+"</strong></li>"),n.append('<ul data-property-group-id="'+a+'"></ul>'));if(t.isEmpty(i))o="Inheriting";else if(u["type"]=="color"){var f=i.replace("#","");f.length==6&&(f="#"+f),o='									<div class="colorpicker-box-container">										<div style="background-color: '+f+'" class="colorpicker-box"></div>									</div>',i.replace("#","").toUpperCase().length==6&&(o+='<span style="font-family:monospace;">#'+i.replace("#","").toUpperCase()+"</span>")}else if(u["type"]=="image")o='									<span class="tooltip tooltip-left" title="&lt;img src=\''+i+"' style='max-width:300px;height:auto;' /&gt;\" >Preview</span>								";else if(u.unit&&i){if(typeof u["unit"]!="object")var l=u.unit;else{var l=i.replace(/^[+-]?\d+(\.\d+)?/g,"");l||(u.unit["default"]||(u.unit["default"]="px"),l=u.unit["default"]),i=i.replace(l,"")}o=i+'<span class="unit">'+l+"</span>"}else if(u["type"]=="font-family-select"){var c=i.split("|"),h=t.first(c)=="google"?!0:!1;if(h){var p=c[1];webFontQuickLoad(i)}else var p=i;o='<span style="font-family:'+p+';">'+p.capitalize()+"</span>"}else t.isString(i)&&(o=i.capitalize());if(typeof s=="undefined"){var d=e('										<li class="property" data-property-id="'+r+'" data-property-group-id="'+a+'">											<strong title="'+u.name+'">'+u.name+'</strong> 											<span class="property-delete"></span>											<span class="property-value" title="Click to Edit">'+o+"</span>										</li>									");d.appendTo(n.find('ul[data-property-group-id="'+a+'"]'))}else{n.find('[data-property-id="'+r+'"]:not([data-special-element-type])').length||n.find('ul[data-property-group-id="'+a+'"]').append('												<li class="property" data-property-id="'+r+'" data-property-group-id="'+a+'">													<strong>'+u.name+"</strong> 												</li>											");var d=e('										<li class="property" data-property-id="'+r+'" data-property-group-id="'+a+'" data-special-element-type="'+s.type+'" data-special-element-id="'+s.id+'">											<strong title="'+s.name.split(" &ndash; ")[0]+s.layoutName+'">'+s.name.split(" &ndash; ")[0]+'</strong> 											<span class="property-delete"></span>											<span class="property-value" title="Click to Edit">'+o+"</span>										</li>									");n.find('[data-property-id="'+r+'"]').not("[data-special-element-type]").last().addClass("has-special-element-properties"),d.insertAfter(n.find('[data-property-id="'+r+'"]').last())}},this.processPropertyValueClick=function(){var n=e("ul#design-editor-element-selector li.ui-state-active").first(),r=n.data("element-id"),i=e(this).parents("li.property").first(),s=i.data("special-element-type"),o=i.data("special-element-id");return t.isEmpty(s)?n.children("span.element-name").trigger("click",[i.data("property-group-id")]):designEditor.selectSpecialElement(r,s,o,i.data("property-group-id"))},this.processPropertyDeleteClick=function(){var n=e("ul#design-editor-element-selector li.ui-state-active").first(),r=designEditorGetElementObject(n.data("element-id"),!1),i=e(this).parents("li.property").first(),s=i.data("property-id"),o=i.data("special-element-type"),u=i.data("special-element-id");if(t.isEmpty(o))var a=r.selector;else if(o=="layout")var a=("body.layout-using-"+u+" "+r.selector).replace(" body","");else var a=r[o+"s"][u].selector;stylesheet.delete_rule_property(a,s),i.remove(),n.find("> .children-elements > .properties ul li").length||(n.find("> .children-elements > .properties").remove(),n.removeClass("properties-visible"),n.find("> .children-elements li").length||(n.find("> .children-elements, > .element-expander").remove(),n.removeClass("has-children").removeClass("children-visible"))),dataSetDesignEditorProperty({element:r.id,property:s,value:"DELETE",specialElementType:o,specialElementMeta:u})},this.processNoElementClick=function(t){if(e(t.target).is("span"))return;e("body").removeClass("design-editor-element-selected"),e("ul#design-editor-element-selector").find(".ui-state-active").addClass("element-just-selected").removeClass("ui-state-active"),removeInspectorVisibleBoxModal(),setSelectedElement({}),$i(".inspector-element-selected").removeClass("inspector-element-selected"),e("#design-editor-styles-no-styles").hide(),e("#design-editor-styles-nothing-selected").show(),e("ul#design-editor-styles").empty().hide()},this.processElementExpanderClick=function(t){e(this).parent().toggleClass("children-visible")},this.processElementMouseEnter=function(t){var n=e(this).parent();if(n.hasClass("element-group")||n.hasClass("element-instances-container")||n.hasClass("element-states-container"))return;var r=n.data("element-id"),i=designEditorGetElementObject(r,!1);e(".element-just-selected").removeClass("element-just-selected"),$i(".inspector-element-hover").removeClass("inspector-element-hover"),$i(n.data("selector")).addClass("inspector-element-hover");if(!n.hasClass("element-name-has-buttons")){var s=n.children(".element-name");!n.hasClass("element-instance")&&!n.hasClass("element-state")&&s.append('<span class="element-name-button element-name-button-layout-specific tooltip" title="Edit Element Only On This Layout"></span>'),s.append('<span class="element-name-button element-name-button-live-css tooltip" title="Edit in Live CSS"></span>'),s.find(".tooltip").qtip({style:{classes:"qtip-headway qtip-headway-element-selector",tip:!1},position:{my:"bottom left",at:"top center",viewport:e(window),adjust:{y:-5,method:"flipinvert"}}}),n.addClass("element-name-has-buttons")}},this.processElementMouseLeave=function(t){var n=e(this).parent();if(n.hasClass("element-group")||n.hasClass("ui-state-active")||n.hasClass("element-instances-container"))return;var r=n.data("element-id"),i=designEditorGetElementObject(r);$i(n.data("selector")).removeClass("inspector-element-hover"),n.children(".element-name").find(".element-name-button").each(function(){e(this).qtip("api").destroy(!0),e(this).remove()}),n.removeClass("element-name-has-buttons")},this.processElementClick=function(t,n){var r=e(this).parent();if(e(t.target).hasClass("element-name-button")||r.hasClass("element-instances-container"))return;if(r.hasClass("element-group"))return;if(r.hasClass("element-instance"))return designEditor.selectSpecialElement(r.data("element-id"),"instance",r.data("instance-id"),n);if(r.hasClass("element-state"))return designEditor.selectSpecialElement(r.data("element-id"),"state",r.data("state-id"),n);var i=getElementNodeName(r),s=r.data("element-id"),o=designEditorGetElementObject(s,!1);e("body").addClass("design-editor-element-selected"),r.hasClass("has-children")&&r.addClass("children-visible"),e(this).parents("li.has-children").addClass("children-visible"),e("div#design-editor-element-selector-container").animate({scrollTop:r.offset().top-(150-e("div#design-editor-element-selector-container").scrollTop())},300),e("div.design-editor-info span.customize-for-regular-element").hide(),e("div.design-editor-info span.customize-element-for-layout").show(),inspectorSelectElement(o.selector),setSelectedElement({id:s,name:i,object:o}),designEditorShowCog(),e.when(designEditor.loadElementInputs(s)).then(function(){designEditorShowContent(n)}),e("ul#design-editor-element-selector").find(".ui-state-active").removeClass("ui-state-active"),r.addClass("ui-state-active"),designEditor.showElementProperties(r)},this.processElementNameLayoutSpecific=function(){var t=e(this).parents("li.element").first(),n=t.data("element-id");designEditor.selectSpecialElement(n,"layout",Headway.viewModels.layoutSelector.currentLayout())},this.processElementNameLiveCSS=function(){var t=e(this).parents("li.element").first(),n=t.data("selector"),r=typeof Headway.aceEditors["live-css"]=="undefined"||!Headway.aceEditors["live-css"]?e("textarea#live-css").val():Headway.aceEditors["live-css"].editor.getValue(),i=r?"\n\n":"";e("textarea#live-css").val(r+i+n+" {\n\n}"),e("#open-live-css").trigger("click");if(typeof Headway.aceEditors["live-css"]!="undefined"){Headway.aceEditors["live-css"].editor.setValue(e("textarea#live-css").val());var s=Headway.aceEditors["live-css"].editorSession.getLength();Headway.aceEditors["live-css"].editor.gotoLine(s-1),Headway.aceEditors["live-css"].editor.focus()}},this.processElementCopy=function(n){var r=getSelectedElement();if(!r)return;var i=typeof r.specialElementName!="undefined"?r.specialElementName:r.name;if(!t.isEmpty(Headway.elementData[r.id]))if(r.specialElementType&&!t.isEmpty(Headway.elementData[r.id]["special-element-"+r.specialElementType])){if(!t.isEmpty(Headway.elementData[r.id]["special-element-"+r.specialElementType][r.specialElementID]))var s=Headway.elementData[r.id]["special-element-"+r.specialElementType][r.specialElementID]}else if(!t.isEmpty(Headway.elementData[r.id].properties))var s=Headway.elementData[r.id].properties;if(typeof s=="undefined"||t.isEmpty(s))return!1;showNotification({id:"copied-design-properties",message:"Copied properties from <strong>"+i+"</strong>",closeTimer:2e3,overwriteExisting:!0}),Headway.designEditorClipboard=e.extend({},s)},this.processElementPaste=function(n){var r=getSelectedElement();if(!r||typeof Headway.designEditorClipboard=="undefined")return;var i=typeof r.specialElementName!="undefined"?r.specialElementName:r.name;if(!t.isEmpty(Headway.elementData[r.id]))if(r.specialElementType&&!t.isEmpty(Headway.elementData[r.id]["special-element-"+r.specialElementType])){if(!t.isEmpty(Headway.elementData[r.id]["special-element-"+r.specialElementType][r.specialElementID]))var s=Headway.elementData[r.id]["special-element-"+r.specialElementType][r.specialElementID]}else if(!t.isEmpty(Headway.elementData[r.id].properties))var s=Headway.elementData[r.id].properties;if(typeof s=="undefined")var s={};e.each(s,function(e,t){dataSetDesignEditorProperty({element:r.id,property:e,value:"DELETE",specialElementType:r.specialElementType,specialElementMeta:r.specialElementID})}),e.each(Headway.designEditorClipboard,function(e,t){typeof Headway.designEditorProperties[e]["unit"]!="undefined"&&!isNaN(t)&&(typeof Headway.designEditorProperties[e]["unit"]=="string"?t+=Headway.designEditorProperties[e].unit:typeof Headway.designEditorProperties[e]["unit"]["default"]!="undefined"&&(t+=Headway.designEditorProperties[e].unit["default"])),dataSetDesignEditorProperty({element:r.id,property:e,value:t,specialElementType:r.specialElementType,specialElementMeta:r.specialElementID})});if(r.specialElementType)var s=Headway.elementData[r.id]["special-element-"+r.specialElementType][r.specialElementID];else var s=Headway.elementData[r.id].properties;e.each(s,function(e,t){dataDesignEditorPropertyFeedback({element:r.id,property:e,value:t,specialElementType:r.specialElementType,specialElementMeta:r.specialElementID})}),showNotification({id:"copied-design-properties",message:"Pasted properties onto <strong>"+i+"</strong>",closeTimer:2e3,overwriteExisting:!0,success:!0})},this.loadElementInputs=function(t,n){var r={security:Headway.security,action:"headway_visual_editor",method:"get_element_inputs",unsavedValues:designEditorGetUnsavedValues(t),element:designEditorGetElementObject(t)};if(typeof n=="object"){var i=Object.keys(n)[0],s=n[i];r.specialElementType=i,r.specialElementMeta=s,r.unsavedValues=designEditorGetUnsavedValues(t,i,s),i=="instance"&&(r.element=designEditorGetElementObject(t,!0,s))}return e.post(Headway.ajaxURL,r).success(function(n){var r=e("div.design-editor-options");r.html(n),e("div.design-editor-options").data({element:t,specialElementType:!1,specialElementMeta:!1}),e("div.design-editor-options").find(".property-font-family-select").each(function(){webFontQuickLoad(e(this).find("span.font-name").data("webfont-value"))}),Headway.iframe.focus()})},this.bindDesignEditorInfo=function(){e("span.customize-element-for-layout").bind("click",function(){var e=designEditor.getCurrentElement(),t=e.data("element-id");designEditor.selectSpecialElement(t,"layout",Headway.viewModels.layoutSelector.currentLayout())}),e("span.customize-for-regular-element").bind("click",function(){designEditor.getCurrentElement().find("> span.element-name").trigger("click")})},this.selectSpecialElement=function(t,n,r,i){var s=e("ul#design-editor-element-selector li.element-"+n).filter("[data-"+n+'-id="'+r+'"]').filter('[data-element-id="'+t+'"]');s.length||(s=e('ul#design-editor-element-selector li.element[data-element-id="'+t+'"]').first());var o=designEditorGetElementObject(t,!1),u=n!="layout"?o[n+"s"][r].name:Headway.viewModels.layoutSelector.currentLayoutName(),a=n!="layout"?o[n+"s"][r].selector:o.selector;e("body").addClass("design-editor-element-selected"),s.parents("li").addClass("children-visible"),e("div#design-editor-element-selector-container").animate({scrollTop:s.offset().top-(e("div#design-editor-element-selector-container").height()/1.5-e("div#design-editor-element-selector-container").scrollTop())},300),designEditor.showElementProperties(s),n=="layout"?(e("div.design-editor-info span.customize-for-regular-element").show(),e("div.design-editor-info span.customize-element-for-layout").hide()):(e("div.design-editor-info span.customize-for-regular-element").hide(),e("div.design-editor-info span.customize-element-for-layout").hide()),inspectorSelectElement(a);var f={},l={};f[n]=u,l[n]=r,setSelectedElement({id:t,selector:a,name:o.name,specialElementType:n,specialElementID:r,specialElementName:u,object:o});if(typeof loadInputs=="undefined"||loadInputs)designEditorShowCog(),e.when(designEditor.loadElementInputs(t,l)).then(function(){designEditorShowContent(i)});e("ul#design-editor-element-selector").find(".ui-state-active").removeClass("ui-state-active"),s.addClass("ui-state-active")},this.getCurrentElement=function(){return e("ul#design-editor-element-selector li.ui-state-active")},this.switchLayout=function(){if(typeof Headway.switchedToLayout=="undefined"||!Headway.switchedToLayout)return;e.when(designEditorRequestElements(!0)).then(function(){designEditor.setupElementSelector.apply(designEditor),e("div.design-editor-options").hide()})}},toggleDesignEditor=function(){return e("body").hasClass("side-panel-hidden")?showDesignEditor():hideDesignEditor()},hideDesignEditor=function(){return e("body").hasClass("side-panel-hidden")?!1:(e("body").addClass("side-panel-hidden"),setTimeout(repositionTooltips,400),e("#design-editor-toggle span").text("eee"),e.cookie("hide-design-editor",!0),!0)},showDesignEditor=function(){return e("body").hasClass("side-panel-hidden")?(e("body").removeClass("side-panel-hidden"),setTimeout(repositionTooltips,400),e("#design-editor-toggle span").text("iii"),e.cookie("hide-design-editor",!1),!0):!1},designEditorShowCog=function(){e("div#side-panel").addClass("properties-loading"),e("div.design-editor-info").hide(),e("div.design-editor-options").hide(),createCog(e("div#side-panel-bottom"),!0,!0)},designEditorShowContent=function(n){e("div#side-panel-bottom").find(".cog-container").remove(),e("div.design-editor-info").show(),e("div.design-editor-options").show(),e("div#side-panel").removeClass("properties-loading"),t.isEmpty(n)||e(".design-editor-box-"+n).find(".design-editor-box-title").trigger("click"),setupTooltips()},designEditorGetElementObject=function(t,n,r){var i=e("ul#design-editor-element-selector").find("#element-"+t),s=i.data("group"),o=i.data("parent");if(typeof n=="undefined")var n=!0;var t=jQuery.extend(!0,{},Headway.elements[t]);return n&&(typeof r!="undefined"&&r?e.each(t.instances,function(e,n){e!=r&&delete t.instances[e]}):delete t.instances),t},designEditorGetUnsavedValues=function(e,n,r){if(typeof n=="undefined")var n=!1;if(typeof r=="undefined")var r=!1;if(typeof GLOBALunsavedValues=="undefined"||typeof GLOBALunsavedValues["design-editor"]=="undefined"||typeof GLOBALunsavedValues["design-editor"][e]=="undefined")return null;if(!n||!r){if(typeof GLOBALunsavedValues["design-editor"][e]["properties"]=="undefined")return null;var i=GLOBALunsavedValues["design-editor"][e].properties}else{if(typeof GLOBALunsavedValues["design-editor"][e]["special-element-"+n]=="undefined")return null;if(typeof GLOBALunsavedValues["design-editor"][e]["special-element-"+n][r]=="undefined")return null;var i=GLOBALunsavedValues["design-editor"][e]["special-element-"+n][r]}return t.isEmpty(i)?null:i},designEditorBindPropertyBoxToggle=function(){e("div.design-editor-options").delegate("span.design-editor-box-title","click",function(){var t=e(this).parents("div.design-editor-box"),n=t.hasClass("design-editor-box-open");e("div.design-editor-options div.design-editor-box-open").removeClass("design-editor-box-open"),!t.hasClass("design-editor-box-open")&&!n&&t.addClass("design-editor-box-open")})},designEditorBindPropertyInputs=function(){e(".design-editor-options-container").delegate("div.customize-property","click",function(){var t=e(this).parents("li").first();if(t.hasClass("lockable-property")&&t.parents(".box-model-inputs").hasClass("box-model-inputs-locked"))var t=e(this).parents(".box-model-inputs").find("> li.lockable-property");t.each(function(){e(this).find(".customize-property").fadeOut(150),e(this).removeClass("uncustomized-property"),e(this).addClass("customized-property-by-user"),e(this).attr("title","You have customized this property.");var t=e(this).find("input.property-hidden-input"),n=t.parent().find("select, input:not(.property-hidden-input)").first();!t.val()&&n.length&&t.val(n.val()),dataHandleDesignEditorInput({hiddenInput:t,value:t.val()})})}),e(".design-editor-options-container").delegate("span.uncustomize-property","click",function(){if(!confirm("Are you sure you wish to delete this customization?"))return!1;var t=e(this).parents("li").first();if(t.hasClass("lockable-property")&&t.parents(".box-model-inputs").hasClass("box-model-inputs-locked"))var t=e(this).parents(".box-model-inputs").find("> li.lockable-property");t.each(function(){var t=e(this).find("input.property-hidden-input");e(this).find("div.customize-property").fadeIn(150),dataHandleDesignEditorInput({hiddenInput:t,value:"DELETE",unit:""}),e(this).addClass("uncustomized-property",150),e(this).removeClass("customized-property-by-user"),e(this).attr("title","You have set this property to inherit.")})}),e(".design-editor-options-container").delegate(".design-editor-property-font-family span.open-font-browser","click",function(){typeof fontBrowserOpen=="function"&&fontBrowserOpen.apply(this)}),e(".design-editor-options-container").delegate("span.design-editor-lock-sides","click",function(){e(this).parent().hasClass("box-model-inputs-locked")?e(this).attr("data-locked",!1).attr("title","Unlock sides").parent().removeClass("box-model-inputs-locked"):e(this).attr("data-locked",!0).attr("title","Lock sides").parent().addClass("box-model-inputs-locked")}),e(".design-editor-options-container").delegate('.box-model-inputs-locked li.lockable-property input[type="number"]',"keyup blur change",function(t,n){if(typeof n!="undefined"&&n)return;e(this).parents(".box-model-inputs-locked").find(".lockable-property").removeClass("uncustomized-property"),e(this).parents(".box-model-inputs-locked").find('li.lockable-property input[type="number"]').not(e(this)).val(e(this).val()).trigger("change",[!0])}),e(".design-editor-options-container").delegate(".box-model-inputs-locked li.lockable-property select","change",function(t,n){if(typeof n!="undefined"&&n)return;e(this).parents(".box-model-inputs-locked").find(".lockable-property").removeClass("uncustomized-property"),e(this).parents(".box-model-inputs-locked").find("li.lockable-property select").not(e(this)).val(e(this).val()).trigger("change",[!0])}),e(".design-editor-options-container").delegate("div.property-select select","change",designEditorInputSelect),e(".design-editor-options-container").delegate("div.property-integer input","focus",designEditorInputIntegerFocus),e(".design-editor-options-container").delegate("div.property-integer input","keyup blur change",designEditorInputIntegerChange),e(".design-editor-options-container").delegate("div.property-integer .property-unit-select select","change",designEditorInputIntegerUnitChange),e(".design-editor-options-container").delegate("div.property-image span.button","click",designEditorInputImageUpload),e(".design-editor-options-container").delegate("div.property-image span.delete-image","click",designEditorInputImageUploadDelete),e(".design-editor-options-container").delegate("div.property-color div.colorpicker-box","click",designEditorInputColor)},designEditorInputSelect=function(t){var n=e(this).parent().siblings("input.property-hidden-input");dataHandleDesignEditorInput({hiddenInput:n,value:e(this).val()})},designEditorInputIntegerFocus=function(t){typeof originalValues!="undefined"&&delete originalValues,originalValues=new Object;var n=e(this).siblings("input.property-hidden-input"),r=n.attr("selector")+"-"+n.attr("property");originalValues[r]=e(this).val()},designEditorInputIntegerUnitChange=function(t){e(this).parents(".property-integer").find('input[type="number"]').trigger("change")},designEditorInputIntegerChange=function(t){var n=e(this).siblings("input.property-hidden-input"),r=e(this).val();if(t.type=="keyup"&&r=="-")return;if(isNaN(r)){r=r.replace(/[^0-9]*/ig,"");if(r==="")var i=n.attr("selector")+"-"+n.attr("property"),r=originalValues[i];e(this).val(r)}r.length>1&&r[0]==0&&(r=r.replace(/^[0]+/g,""),e(this).val(r)),dataHandleDesignEditorInput({hiddenInput:n,value:e(this).val()})},designEditorInputImageUpload=function(t){var n=this;openImageUploader(function(t,r){var i=e(n).siblings("input");e(n).siblings(".image-input-controls-container").find("span.src").text(r),e(n).siblings(".image-input-controls-container").show(),dataHandleDesignEditorInput({hiddenInput:i,value:t})})},designEditorInputImageUploadDelete=function(t){if(!confirm("Are you sure you wish to remove this image?"))return!1;e(this).parent(".image-input-controls-container").hide(),e(this).hide();var n=e(this).parent().siblings("input");dataHandleDesignEditorInput({hiddenInput:n,value:"none"})},designEditorInputColor=function(t){e("div.design-editor-options-container").css("overflow-y","hidden");var n=e(this).parent().siblings("input"),r=n.val();r=="transparent"&&(r="00FFFFFF");var i=function(e,t){var r="#"+e.hex;if(e.a!=100)var r=e.rgba;dataHandleDesignEditorInput({hiddenInput:n,value:r})};e(this).colorpicker({realtime:!0,alpha:!0,alphaHex:!0,allowNull:!1,showAnim:!1,swatches:typeof Headway.colorpickerSwatches=="object"&&Headway.colorpickerSwatches.length?Headway.colorpickerSwatches:!0,color:r,beforeShow:function(e,t){showIframeOverlay()},onClose:function(t,n){i(t,n),hideIframeOverlay(),e("div.design-editor-options-container").css("overflow-y","auto")},onSelect:function(e,t){i(e,t)},onAddSwatch:function(e,t){dataSetOption("general","colorpicker-swatches",t)},onDeleteSwatch:function(e,t){dataSetOption("general","colorpicker-swatches",t)}}),e.colorpicker._showColorpicker(e(this)),setupTooltips()},propertyInputCallbackFontFamily=function(t){var n=t.selector,r=t.value,i=t.element,s=t.stack?t.stack:t.value;if(!r){stylesheet.delete_rule_property(n,"font-family");return}if(!r.match(/\|/g)){stylesheet.update_rule(n,{"font-family":s});return}var o=r.split("|"),u={},a="";typeof o[2]!="undefined"&&o[2]&&(a=":"+o[2]),u[o[0]]={families:[o[1]+a]};var s=o[1];stylesheet.update_rule(n,{"font-family":s}),typeof e("iframe#content").get(0).contentWindow.WebFont=="object"&&e("iframe#content").get(0).contentWindow.WebFont.load(u)},propertyInputCallbackBackgroundImage=function(e){var t=e.selector,n=e.value,r=e.element;n!="none"?stylesheet.update_rule(t,{"background-image":"url("+n+")"}):n=="none"&&stylesheet.update_rule(t,{"background-image":"none"})},propertyInputCallbackFontStyling=function(e){var t=e.selector,n=e.value,r=e.element;n==="normal"?stylesheet.update_rule(t,{"font-style":"normal","font-weight":"normal"}):n==="bold"?stylesheet.update_rule(t,{"font-style":"normal","font-weight":"bold"}):n==="light"?stylesheet.update_rule(t,{"font-style":"normal","font-weight":"lighter"}):n==="italic"?stylesheet.update_rule(t,{"font-style":"italic","font-weight":"normal"}):n==="bold-italic"?stylesheet.update_rule(t,{"font-style":"italic","font-weight":"bold"}):n===null&&(stylesheet.delete_rule_property(t,"font-style"),stylesheet.delete_rule_property(t,"font-weight"))},propertyInputCallbackCapitalization=function(e){var t=e.selector,n=e.value,r=e.element;n==="none"||n==null?stylesheet.update_rule(t,{"text-transform":"none","font-variant":"normal"}):n==="small-caps"?stylesheet.update_rule(t,{"text-transform":"none","font-variant":"small-caps"}):stylesheet.update_rule(t,{"text-transform":n,"font-variant":"normal"})},propertyInputCallbackShadow=function(t){var n=t.selector,r=t.value,i=t.element,s=t.property,o=s.indexOf("box-shadow")===0?"box-shadow":"text-shadow",u=$i(n).css(o)||!1;if(u==0||u=="none")u="rgba(0, 0, 0, 0) 0 0 0";var a=u.replace(/, /g,",").replace(/px/g,"").split(" "),f=e('li[data-property-id="'+o+"-color"+'"] input').val()||a[0],l=e('li[data-property-id="'+o+"-horizontal-offset"+'"] input').val()||a[1],c=e('li[data-property-id="'+o+"-vertical-offset"+'"] input').val()||a[2],h=e('li[data-property-id="'+o+"-blur"+'"] input').val()||a[3],p=e('li[data-property-id="'+o+"-position"+'"] input').val()||a[4];switch(s){case o+"-horizontal-offset":l=r||0;break;case o+"-vertical-offset":c=r||0;break;case o+"-blur":h=r||0;break;case o+"-inset":p=r;break;case o+"-color":f=r}if(!f)return stylesheet.delete_rule_property(n,o);p=="inset"?p=" inset":p="";var d=f+" "+l+"px "+c+"px "+h+"px"+p,v={};v[o]=d,stylesheet.update_rule(n,v),updateInspectorVisibleBoxModal()},addInspector=function(t){if(typeof Headway.elements=="undefined")return e.when(designEditorRequestElements()).then(addInspector);e.each(Headway.elements,function(e,t){if(!t.inspectable)return;addInspectorProcessElement(t)}),(typeof t=="undefined"||t!==!0)&&$i("body").qtip({id:"",style:{classes:"qtip-headway qtip-inspector-tooltip"},position:{target:[-9999,-9999],my:"bottom left",at:"top right",container:$i("body"),viewport:$i("#headway-tooltip-container"),effect:!1,adjust:{x:0,y:0,method:"flipinvert"}},content:{text:"Hover over an element."},show:{event:!1,ready:!0},hide:!1,events:{render:function(t,n){delete inspectorElement,delete inspectorTooltip,delete inspectorElementOptions,inspectorTooltip=n,e("#toggle-inspector").hasClass("inspector-disabled")?disableInspector():enableInspector()}}})},refreshInspector=function(){return addInspector(!0)},addInspectorProcessElement=function(t){if(t["group"]=="default-elements")return;if(!$i(t.selector).length)return;t["selector"].indexOf(":")==-1&&($i(t.selector).data({inspectorElementOptions:t}),$i(t.selector).addClass("inspector-element")),e.each(t.instances,function(n,r){if(r["selector"].indexOf(":")!=-1)return;if(!$i(r.selector).length)return;var i=jQuery.extend(!0,{},t);i.parentName=t.name,i.instance=r.id,i.name=r.name,i.selector=r.selector,i.instances={},e.each(t.instances,function(e,t){t["state-of"]==n&&(i.instances[e]=t)}),e.each(i.selector.split(","),function(e,t){if(t.indexOf(":")!=-1)return;$i(t).data({inspectorElementOptions:i}),$i(t).addClass("inspector-element")})})},enableInspector=function(){if(Headway.mode!="design"||!Headway.designEditorSupport)return!1;Headway.inspectorDisabled=!1,Headway.disableBlockDimensions=!0,$i("body").addClass("disable-block-hover").removeClass("inspector-disabled"),$i(".block[data-hasqtip]").each(function(){var t=e(this).qtip("api");t.destroy()}),inspectorTooltip.show();var t=Headway.touch?"tap":"mousemove";$i("html").bind(t,inspectorMouseMove),setupInspectorContextMenu(),deactivateContextMenu("block"),deactivateContextMenu("wrapper"),Headway.iframe.contents().find("body").bind("keydown",inspectorNudging),Headway.iframe.bind("keydown",inspectorNudging),Headway.iframe.bind("mouseover",function(){Headway.iframe.focus()}),showNotification({id:"inspector",message:"<strong>Right-click</strong> highlighted elements to style them.<br /><br />Once an element is selected, you may nudge it using your arrow keys.<br /><br />The faded orange and purple are the margins and padding.  These colors are only visible when the inspector is active.",closeConfirmMessage:"Please be sure you understand how the Design Editor inspector works before hiding this message.",closeTimer:!1,closable:!0,doNotShowAgain:!0}),updateInspectorVisibleBoxModal(),e("#toggle-inspector").removeClass("inspector-disabled")},disableInspector=function(){if(Headway.mode!="design"||!Headway.designEditorSupport)return!1;Headway.inspectorDisabled=!0,delete Headway.disableBlockDimensions,delete inspectorElement,$i(".inspector-element-hover").removeClass("inspector-element-hover"),$i("body").removeClass("disable-block-hover").addClass("inspector-disabled"),$i(".block").qtip("enable"),e(inspectorTooltip.elements.tooltip).hide(),hideNotification("inspector"),$i("html").unbind("mousemove",inspectorMouseMove),deactivateContextMenu("inspector"),setupBlockContextMenu(),setupWrapperContextMenu(),Headway.iframe.contents().find("body").unbind("keydown",inspectorNudging),Headway.iframe.unbind("keydown",inspectorNudging),removeInspectorVisibleBoxModal(),e("#toggle-inspector").addClass("inspector-disabled")},toggleInspector=function(){if(Headway.mode!="design"||!Headway.designEditorSupport)return!1;if(e("#toggle-inspector").hasClass("inspector-disabled"))return enableInspector();disableInspector()},inspectorSelectElement=function(t){$i(".inspector-element-selected").each(function(){e(this).removeClass("inspector-element-selected"),removeInspectorVisibleBoxModal(e(this))}),$i(t).addClass("inspector-element-selected"),updateInspectorVisibleBoxModal()},removeInspectorVisibleBoxModal=function(t){if(typeof t=="undefined")var t=$i(".inspector-element-selected");return e(t).data("previousBoxShadow")?(e(t).data("previousBoxShadow",null),e(t).css("boxShadow","")):!1},updateInspectorVisibleBoxModal=function(){if(typeof Headway.inspectorDisabled!="undefined"&&Headway.inspectorDisabled)return;$i(".inspector-element-selected").each(function(){removeInspectorVisibleBoxModal(e(this));var t=this,n=e(this).css("box-shadow"),r=n!="none"?n.split(","):[];e(this).data("previousBoxShadow",n),e.each(["paddingTop","paddingRight","paddingBottom","paddingLeft","marginTop","marginRight","marginBottom","marginLeft"],function(n,i){var s=e(t).css(i).replace(/^[+-]?\d+(\.\d+)?/g,""),o=e(t).css(i).replace(s,"");if(o=="auto")return;var u=i.indexOf("padding")!==-1?"rgba(0, 0, 255, .15)":"rgba(255, 127, 0, .15)",a="",f="";if(i=="paddingRight"||i=="paddingBottom"||i=="marginLeft"||i=="marginTop")a="-";var l=a+o+s;if(i.toLowerCase().indexOf("left")!==-1||i.toLowerCase().indexOf("right")!==-1)var c=l+" 0";else var c="0 "+l;i.indexOf("padding")!==-1&&(f="inset "),r.push(f+c+" 0 0 "+u)}),e(this).css({boxShadow:r.join(",")})})},inspectorMouseMove=function(t){if(Headway.inspectorDisabled)return;var n=e(t.target);n.hasClass("inspector-element")||(n=n.parents(".inspector-element").first());if(typeof inspectorElement=="undefined"||!n.is(inspectorElement)){inspectorElement=e(t.target),inspectorElement.hasClass("inspector-element")||(inspectorElement=inspectorElement.parents(".inspector-element").first());var r=inspectorElement.data("inspectorElementOptions");if(typeof r=="object"){$i(".inspector-element-hover").removeClass("inspector-element-hover"),$i(r.selector).addClass("inspector-element-hover");var i=e("#design-editor-element-selector").find("li#element-"+r.id),s=i.children(".element-name").text(),o='<span class="inspector-tooltip-element-path">',u=[];i.parents("li").reverse().each(function(){u.push(e(this).children(".element-group-name, .element-name").first().text())});var a="";typeof r.instance!="undefined"&&(r.name.indexOf(" &ndash; ")!==-1?a='<span class="inspector-tooltip-instance">Inside <strong>'+r.name.split(" &ndash; ")[0]+"</strong></span>":s=r.name);if(u.join(" > ").length+s.length>40)while(u.join(" > ").length+s.length>40&&s.length<40)u.shift(),tooltipElementPathStr='<span class="ellipsis">...</span> '+u.join(" &rsaquo; ");else tooltipElementPathStr=u.join(" &rsaquo; ");o+=tooltipElementPathStr,o+=" &rsaquo; <strong>"+s+"</strong></span>",o+=a,o+='<small class="right-click-message">Right-click to style</small>',inspectorTooltip.set("content.text",o)}}inspectorTooltip.show(),inspectorTooltip.set("position.target","mouse")},setupInspectorContextMenu=function(){return setupContextMenu({id:"inspector",elements:"body",title:function(e){return inspectorElement.data("inspectorElementOptions").name},onShow:inspectorContextMenuOnShow,onHide:function(){inspectorTooltip.show(),Headway.inspectorDisabled=!1},onItemClick:inspectorContextMenuItemClick,contentsCallback:inspectorContextMenuContents})},inspectorContextMenuOnShow=function(t){e(this).data("element-options",inspectorElement.data("inspectorElementOptions")),e(inspectorTooltip.elements.tooltip).hide(),Headway.inspectorDisabled=!0},inspectorContextMenuItemClick=function(t,n){if(e(this).hasClass("group-title")&&!e(this).hasClass("group-title-clickable"))return;if(e(this).parents("li").first().hasClass("inspector-context-menu-block-options"))openBlockOptions(getBlock(e(inspectorElement)));else{var r=t.data("element-options"),i=e(this).parents("li").first().data("instance-id"),s=e(this).parents("li").first().data("state-id");inspectorTooltip.show(),Headway.inspectorDisabled=!1,e("#design-editor-element-selector-container .ui-state-active").removeClass("ui-state-active"),typeof i!="undefined"?designEditor.selectSpecialElement(r.id,"instance",i):typeof s!="undefined"?designEditor.selectSpecialElement(r.id,"state",s):e(this).parents("li").first().hasClass("inspector-context-menu-parent")||e("ul#design-editor-element-selector li#element-"+r.id).find("> span").trigger("click"),e(this).parents("li").first().hasClass("inspector-context-menu-edit-for-layout")&&designEditor.selectSpecialElement(r.id,"layout",Headway.viewModels.layoutSelector.currentLayout())}},inspectorContextMenuContents=function(n){var r=e(this),i=r.data("element-options"),s=typeof i.instance!="undefined"&&i.instance,o=r;if(s){r.append('<li class="inspector-context-menu-edit-instance" data-instance-id="'+i.instance+'"><span>Edit This Instance</span></li>');var o=e('<li class="inspector-context-menu-edit-normal"><span class="group-title group-title-clickable">Edit Regular Element<small>'+i.parentName+"</small></span><ul></ul></li>").appendTo(r);o=o.find("ul").first()}else o.append('<li class="inspector-context-menu-edit-normal"><span>Edit</span></li>');o.append('<li class="inspector-context-menu-edit-for-layout"><span>Edit For This Layout</span></li>');if(!t.isEmpty(i.states)){var u=e('<li class="inspector-context-menu-states"><span class="group-title">States</span><ul></ul></li>').appendTo(o);e.each(i.states,function(e,t){u.find("ul").append('<li data-state-id="'+e+'"><span>Edit '+t.name+"</span></li>")})}if(!t.isEmpty(i.instances)){if(typeof i.instance=="undefined"||!i.instance)var a=e('<li class="inspector-context-menu-instances"><span class="group-title">Instances</span><ul></ul></li>').appendTo(r);else var a=!1;e.each(i.instances,function(t,n){n["state-of"]==i.instance&&(r.find("> li.inspector-context-menu-instance-states").length||e('<li class="inspector-context-menu-instance-states"><span class="group-title">Instance States</span><ul></ul></li>').insertAfter(r.find("li.inspector-context-menu-edit-instance")),r.find("> li.inspector-context-menu-instance-states ul").append('<li data-instance-id="'+t+'"><span>Edit '+n["state-name"]+"</span></li>"))}),a&&!a.find("ul li").length&&a.remove()}if(inspectorElement.parents(".inspector-element").length){var f=e('<li class="inspector-context-menu-parents"><span class="group-title">Parents</span><ul></ul></li>').appendTo(r);inspectorElement.parents(".inspector-element").each(function(){var t=e(this);e('<li class="inspector-context-menu-parent" data-parent-id="'+e(this).data("inspectorElementOptions").id+'"><span>'+e(this).data("inspectorElementOptions").name+"</span></li>").appendTo(f.find("ul")).bind("click",function(){inspectorElement=t;var e=typeof n.data!="undefined"?n.data.x:n.originalEvent.clientX,r=typeof n.data!="undefined"?n.data.y:n.originalEvent.clientY;t.trigger("contextmenu",{x:e,y:r})})})}if(getBlock(inspectorElement))var l=getBlock(inspectorElement),c=getBlockID(l),h=getBlockTypeNice(getBlockType(l)),p=e('<li class="inspector-context-menu-block-options"><span>Open Block Options</span></li>').appendTo(r)},inspectorNudging=function(t){var n=t.keyCode;if(n<37||n>40||!$i(".inspector-element-selected").length||$i(".inspector-element-selected").is("body"))return;var r=t.shiftKey?5:1,i=e(".design-editor-box-nudging .design-editor-property-position select",".design-editor-options-container"),s=i.parents(".design-editor-property-position").find('input[type="hidden"]'),o=s.attr("element_selector");e(".design-editor-box-nudging .uncustomized-property .customize-property span",".design-editor-options-container").trigger("click");if($i(".inspector-element-selected").css("position")!="static"){var u=$i(".inspector-element-selected").css("position");$i(".inspector-element-selected").css({position:u}),i.val(u).trigger("change")}else{var u="relative";$i(".inspector-element-selected").css({position:u}),i.val(u).trigger("change")}switch(n){case 37:var a=parseInt($i(".inspector-element-selected").css("left"));if(isNaN(a))var a=0;stylesheet.update_rule(o,{left:a-r+"px"});var f=$i(".inspector-element-selected").css("left").replace("px","");e('.design-editor-box-nudging .design-editor-property-left input[type="number"]',".design-editor-options-container").val(f).trigger("change");break;case 38:var l=parseInt($i(".inspector-element-selected").css("top"));isNaN(l)&&(l=0),stylesheet.update_rule(o,{top:l-r+"px"});var c=$i(".inspector-element-selected").css("top").replace("px","");e('.design-editor-box-nudging .design-editor-property-top input[type="number"]',".design-editor-options-container").val(c).trigger("change");break;case 39:var a=parseInt($i(".inspector-element-selected").css("left"));if(isNaN(a))var a=0;stylesheet.update_rule(o,{left:a+r+"px"});var f=$i(".inspector-element-selected").css("left").replace("px","");e('.design-editor-box-nudging .design-editor-property-left input[type="number"]',".design-editor-options-container").val(f).trigger("change");break;case 40:var l=parseInt($i(".inspector-element-selected").css("top"));isNaN(l)&&(l=0),stylesheet.update_rule(o,{top:l+r+"px"});var c=$i(".inspector-element-selected").css("top").replace("px","");e('.design-editor-box-nudging .design-editor-property-top input[type="number"]',".design-editor-options-container").val(c).trigger("change")}return t.preventDefault(),!1},getElementNodeName=function(e){var t=e.clone();return t.find("> span").children().remove().end().text()},getSelectedElement=function(){return typeof Headway.designEditorCurrentElement!="undefined"?Headway.designEditorCurrentElement:null},setSelectedElement=function(e){Headway.designEditorCurrentElement=e;if(t.isEmpty(e))return;var n={};typeof e.specialElementType!="undefined"&&(n[e.specialElementType]=e.specialElementName),setSelectedElementDetails(n,e.object)},setSelectedElementDetails=function(n,r){var n=e.extend({},{instance:r.name,layout:"all layouts",state:"all states"},n),i=e("span.design-editor-selection-details");i.find(".design-editor-selected-element").html(n.instance),i.find("strong.design-editor-selection-details-layout").html(n.layout),typeof r.states=="undefined"||t.isEmpty(r.states)?i.find("span.design-editor-selection-details-state-container").hide():(i.find("span.design-editor-selection-details-state-container").show(),n.state=="all states"?i.find(".design-editor-selection-details-state-before").text("and"):i.find(".design-editor-selection-details-state-before").text("when"),n.state=="Hover"&&(n.state="hovered"),i.find("strong.design-editor-selection-details-state").html(n.state.toLowerCase()));var s=e(".design-editor-info").outerHeight();return e(".design-editor-info").css("marginTop","-"+s+"px"),e("#side-panel-bottom").css("paddingTop",s+"px"),e("span.design-editor-selection-details")},sanitizeElementName=function(t){return e.trim(t.escapeHTML())};var n={init:function(){designEditor=new designEditorTabEditor,designEditor._init(),n.bind(),designEditorBindPropertyInputs();try{e.getScript(Headway.headwayURL+"/library/visual-editor/"+Headway.scriptFolder+"/util.fonts-browser.js"),e.getScript("//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js")}catch(t){}e.cookie("hide-design-editor")==="true"&&hideDesignEditor()},bind:function(){e("#toggle-inspector").bind("click",toggleInspector)},iframeCallback:function(){bindBlockDimensionsTooltip(),addInspector(),designEditor.switchLayout()}};return n}),define("util.tour",["jquery","util.tooltips","helper.boxes","modules/panel"],function(e,t,n){return tourStepsGrid=[{beginning:!0,title:"Welcome to the Headway Visual Editor!",content:"<p>If this is your first time in the Headway Visual Editor, <strong>we recommend following this tour so you can get the most out of Headway</strong>.</p><p>Or, if you're experienced or want to dive in right away, just click the close button in the top right at any time.</p>"},{target:e("li#mode-grid"),title:"Mode Selector",content:"<p>The Headway Visual Editor is split up into 2 modes.</p><p><ul><li><strong>Grid</strong> &ndash; Build your layouts</li><li><strong>Design</strong> &ndash; Add colors, customize fonts, and more!</li></ul></p>",position:{my:"top left",at:"bottom center"}},{target:e("#layout-selector-select-content"),title:"Layout Selector",content:'<p style="font-size:12px;">Since you may not want every page to be the same, you may use the Layout Selector to select which page, post, or archive to edit.</p><p style="font-size:12px;">The Layout Selector is based off of inheritance.  For example, you can customize the "Page" layout and all pages will follow that layout.  Plus, you can customize a specific page and it\'ll be different than all other pages.</p><p style="font-size:12px;">The layout selector will allow you to be as precise or broad as you wish.  It\'s completely up to you!</p>',position:{my:"top center",at:"bottom center"}},{target:e("div#box-grid-wizard"),title:"The Headway Grid",content:'<p>Now we\'re ready to get started with the Headway Grid.  In other words, the good stuff.</p><p>To build your first layout, please select a preset to the right to pre-populate the grid.  Or, you may select "Use Empty Grid" to start with a completely blank grid.</p><p>Once you have a preset selected, click "Finish".</p>',position:{my:"right top",at:"left center"},nextHandler:{showButton:!1,clickElement:"#grid-wizard-button-preset-use-preset, span.grid-wizard-use-empty-grid",message:'Please click <strong>"Finish"</strong> or <strong>"Use Empty Grid"</strong> to continue.'}},{iframeTarget:"div.grid-container",title:"Adding Blocks",content:"<p>To add a block, simply place your mouse into the grid then click at where you'd like the top-left point of the block to be.</p><p>Drag your mouse and the block will appear!  Once the block appears, you may choose the block type.</p><p>Hint: Don't worry about being precise, you may always move or resize the block.</p>",position:{my:"right top",at:"left top",adjustY:100},maxWidth:280},{iframeTarget:"div.grid-container",title:"Modifying Blocks",content:'					<p style="font-size:12px;">After you\'ve added the desired blocks to your layout, you may move, resize, delete, or change the options of the block at any time.</p>					<ul style="font-size:12px;">						<li><strong>Moving Blocks</strong> &ndash; Click and drag the block.  If you wish to move multiple blocks simultaneously, double-click on a block to enter <em>Mass Block Selection Mode</em>.</li>						<li><strong>Resizing Blocks</strong> &ndash; Grab the border or corner of the block and drag your mouse.</li>						<li><strong>Block Options (e.g. header image)</strong> &ndash; Hover over the block then click the block options icon in the top-right.</li>						<li><strong>Deleting Blocks</strong> &ndash; Move your mouse over the desired block, then click the <em>X</em> icon in the top-right.</li>					</ul>',position:{my:"right top",at:"left top",adjustY:100},maxWidth:280},{target:e("#save-button-container"),title:"Saving",content:"<p>Now that you hopefully have a few changes to be saved, you can save using this spiffy Save button.</p><p>For those of you who like hotkeys, use <strong>Ctrl + S</strong> to save.</p>",position:{my:"top right",at:"bottom center"},tip:"top right"},{target:e("li#mode-design a"),title:"Design Mode",content:"<p>Thanks for sticking with us!</p><p>Now that you have an understanding of the Grid Mode, we hope you stick with us and head on over to the Design Mode.</p>",position:{my:"top left",at:"bottom center",adjustY:5},tip:"top left",buttonText:"Continue to Design Mode",buttonCallback:function(){e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"ran_tour",mode:"grid",complete:function(){Headway.ranTour.grid=!0,e("li#mode-design a").trigger("click"),window.location=e("li#mode-design a").attr("href")}})}}],tourStepsDesign=[{beginning:!0,title:"Welcome to the Headway Design Editor!",content:"<p>In the <strong>Design Editor</strong>, you can style your elements however you'd like.</p><p>Whether it's fonts, colors, padding, borders, shadows, or rounded corners, you can use the design editor.</p><p>Stick around to learn more!</p>"},{target:"#side-panel-top",title:"Element Selector",content:"<p>The element selector allows you choose which element to edit.</p>",position:{my:"right top",at:"left center"},callback:function(){e("li#element-block-header > span.element-name").trigger("click")}},{target:"#toggle-inspector",title:"Inspector",content:"					<p>Instead of using the <em>Element Selector</em>, let the Inspector do the work for you.</p>					<p><strong>Try it out!</strong> Point and right-click on the element you wish to edit and it will become selected!</p>				",position:{my:"top right",at:"bottom center",adjustX:10,adjustY:5}},{target:"window",title:"Have fun building with Headway!",content:'<p>We hope you find Headway to the most powerful and easy-to-use WordPress framework around.</p><p>If you have any questions, please don\'t hesitate to visit the <a href="http://support.headwaythemes.com/?utm_source=visualeditor&utm_medium=headway&utm_campaign=tour" target="_blank">support forums</a>.</p>',end:!0}],{start:function(){if(Headway.mode=="grid"){var t=tourStepsGrid;hidePanel(),openBox("grid-wizard")}else{if(Headway.mode!="design")return;var t=tourStepsDesign;showPanel(),require(["modules/design/mode-design"],function(){showDesignEditor()}),typeof e("div#panel").data("ui-tabs")!="undefined"&&selectTab("editor-tab",e("div#panel"))}e('<div class="black-overlay"></div>').hide().attr("id","black-overlay-tour").css("zIndex",15).appendTo("body").fadeIn(500),e(document.body).qtip({id:"tour",content:{text:t[0].content+'<div id="tour-next-container"><span id="tour-next" class="tour-button button button-blue">Continue Tour <span class="arrow">&rsaquo;</span></span></div>',title:{text:t[0].title,button:"Skip Tour"}},style:{classes:"qtip-tour",tip:{width:18,height:10,mimic:"center",offset:10}},position:{my:"center",at:"center",target:e(window),viewport:e(window),adjust:{y:5,method:"shift shift"}},show:{event:!1,ready:!0,effect:function(){e(this).fadeIn(500)}},hide:!1,events:{render:function(n,r){e("#iframe-notice").remove(),hideIframeOverlay(),openBox("grid-wizard");var i=r.elements.tooltip;r.step=0,i.bind("next",function(n){e(window).trigger("resize"),r.step+=1,r.step=Math.min(t.length-1,Math.max(0,r.step)),currentTourStep=t[r.step],e("div#black-overlay-tour").fadeOut(100,function(){e(this).remove()}),typeof currentTourStep.callback=="function"&&currentTourStep.callback.apply(r),currentTourStep.target=="window"?currentTourStep.target=e(window):typeof currentTourStep.target=="string"?currentTourStep.target=e(currentTourStep.target):typeof currentTourStep.iframeTarget=="string"&&(currentTourStep.target=$i(currentTourStep.iframeTarget).first()),r.set("position.target",currentTourStep.target),typeof currentTourStep.maxWidth!="undefined"&&window.innerWidth<1440?e(".qtip-tour").css("maxWidth",currentTourStep.maxWidth):e(".qtip-tour").css("maxWidth",350);var i="Next";if(typeof currentTourStep.buttonText=="string")var i=currentTourStep.buttonText;if(typeof currentTourStep.end!="undefined"&&currentTourStep.end===!0)var s='<div id="tour-next-container"><span id="tour-finish" class="tour-button button button-blue">Close Tour <span class="arrow">&rsaquo;</span></div>';else if(typeof currentTourStep.nextHandler=="undefined"||currentTourStep.nextHandler.showButton)var s='<div id="tour-next-container"><span id="tour-next" class="tour-button button button-blue">'+i+' <span class="arrow">&rsaquo;</span></div>';else var s='<div id="tour-next-container"><p>'+currentTourStep.nextHandler.message+"</p></div>";if(typeof currentTourStep.nextHandler!="undefined"&&e(currentTourStep.nextHandler.clickElement)){var o=function(t){e(".qtip-tour").triggerHandler("next"),t.preventDefault(),e(this).unbind("click",o)};e(currentTourStep.nextHandler.clickElement).bind("click",o)}r.set("content.text",currentTourStep.content+s),r.set("content.title",currentTourStep.title),typeof currentTourStep.end=="undefined"?(typeof currentTourStep.position!="undefined"?(r.set("position.my",currentTourStep.position.my),r.set("position.at",currentTourStep.position.at),typeof currentTourStep.position.adjustX!="undefined"?r.set("position.adjust.x",currentTourStep.position.adjustX):r.set("position.adjust.x",0),typeof currentTourStep.position.adjustY!="undefined"?r.set("position.adjust.y",currentTourStep.position.adjustY):r.set("position.adjust.y",0)):(r.set("position.my","top center"),r.set("position.at","bottom center")),typeof currentTourStep.tip!="undefined"&&r.set("style.tip.corner",currentTourStep.tip)):(r.set("position.my","center"),r.set("position.at","center"))}),e("div.qtip-tour").on("click","span#tour-next",function(t){typeof currentTourStep=="object"&&typeof currentTourStep.buttonCallback=="function"&&currentTourStep.buttonCallback.call(),e(".qtip-tour").triggerHandler("next"),t.preventDefault()}),e("div.qtip-tour").on("click","span#tour-finish",function(t){e(".qtip-tour").qtip("hide")})},hide:function(t,n){e("div#tour-overlay").remove(),e("div#black-overlay-tour").fadeOut(100,function(){e(this).remove()}),e(".qtip-tour").fadeOut(100,function(){e(this).qtip("destroy")}),Headway.ranTour[Headway.mode]==0&&Headway.ranTour.legacy!=1&&(e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"ran_tour",mode:Headway.mode}),Headway.ranTour[Headway.mode]=!0)}}})}}});var Url=function(){"use strict";var e={protocol:"protocol",host:"hostname",port:"port",path:"pathname",query:"search",hash:"hash"},t={ftp:21,gopher:70,http:80,https:443,ws:80,wss:443},n=function(n,r){var s=document,o=s.createElement("a"),r=r||s.location.href,u=r.match(/\/\/(.*?)(?::(.*?))?@/)||[];o.href=r;for(var a in e)n[a]=o[e[a]]||"";n.protocol=n.protocol.replace(/:$/,""),n.query=n.query.replace(/^\?/,""),n.hash=n.hash.replace(/^#/,""),n.user=u[1]||"",n.pass=u[2]||"",n.port=t[n.protocol]==n.port||n.port==0?"":n.port;if(!n.protocol&&!/^([a-z]+:)?\/\//.test(r)){var f=new Url(s.location.href.match(/(.*\/)/)[0]),l=f.path.split("/"),c=n.path.split("/");l.pop();for(var a=0,h=["protocol","user","pass","host","port"],p=h.length;a<p;a++)n[h[a]]=f[h[a]];while(c[0]=="..")l.pop(),c.shift();n.path=(r.substring(0,1)!="/"?l.join("/"):"")+"/"+c.join("/")}else n.path=n.path.replace(/^\/?/,"/");i(n)},r=function(e){return e=e.replace(/\+/g," "),e=e.replace(/%([ef][0-9a-f])%([89ab][0-9a-f])%([89ab][0-9a-f])/gi,function(e,t,n,r){var i=parseInt(t,16)-224,s=parseInt(n,16)-128;if(i==0&&s<32)return e;var o=parseInt(r,16)-128,u=(i<<12)+(s<<6)+o;return u>65535?e:String.fromCharCode(u)}),e=e.replace(/%([cd][0-9a-f])%([89ab][0-9a-f])/gi,function(e,t,n){var r=parseInt(t,16)-192;if(r<2)return e;var i=parseInt(n,16)-128;return String.fromCharCode((r<<6)+i)}),e=e.replace(/%([0-7][0-9a-f])/gi,function(e,t){return String.fromCharCode(parseInt(t,16))}),e},i=function(e){var t=e.query;e.query=new function(e){var t=/([^=&]+)(=([^&]*))?/g,n;while(n=t.exec(e)){var i=decodeURIComponent(n[1].replace(/\+/g," ")),s=n[3]?r(n[3]):"";this[i]!=null?(this[i]instanceof Array||(this[i]=[this[i]]),this[i].push(s)):this[i]=s}this.clear=function(){for(i in this)this[i]instanceof Function||delete this[i]},this.toString=function(){var e="",t=encodeURIComponent;for(var n in this){if(this[n]instanceof Function)continue;if(this[n]instanceof Array){var r=this[n].length;if(r)for(var i=0;i<r;i++)e+=e?"&":"",e+=t(n)+"="+t(this[n][i]);else e+=(e?"&":"")+t(n)+"="}else e+=e?"&":"",e+=t(n)+"="+t(this[n])}return e}}(t)};return function(e){this.toString=function(){return(this.protocol&&this.protocol+"://")+(this.user&&this.user+(this.pass&&":"+this.pass)+"@")+(this.host&&this.host)+(this.port&&":"+this.port)+(this.path&&this.path)+(this.query.toString()&&"?"+this.query)+(this.hash&&"#"+this.hash)},n(this,e)}}();define("deps/url",function(){}),define("modules/menu",["jquery","util.tour","helper.ace","deps/url"],function(e,t,n,r){var i={init:function(){i.bind()},bind:function(){e("ul#modes li").on("click",function(){e(this).siblings("li").removeClass("active"),e(this).addClass("active")}),e("ul#modes li a").bind("click",function(){var t=new Url(e(this).attr("href"));t.query["ve-layout"]=Headway.viewModels.layoutSelector.currentLayout(),e(this).attr("href",t.toString())}),e("#menu-link-view-site a").bind("click",function(){var t=new Url(Headway.homeURL);t.query["headway-trigger"]="layout-redirect",t.query.layout=Headway.viewModels.layoutSelector.currentLayout(),e(this).attr("href",t.toString())}),e("span#save-button").click(function(){return save(),!1}),e("#snapshots-button").bind("click",function(){openBox("snapshots")}),e("#tools-tour").bind("click",t.start),e("#tools-grid-wizard").bind("click",function(){hidePanel(),openBox("grid-wizard")}),e("#open-live-css").bind("click",function(){n.showEditor("live-css","css",e("textarea#live-css").val(),function(t){var n=t.getValue(),r=e("textarea#live-css");r.val(n),dataHandleInput(r),$i("style#live-css-holder").html(n),allowSaving()})}),e("#tools-clear-cache").bind("click",function(){var t={security:Headway.security,action:"headway_visual_editor",method:"clear_cache"};e.post(Headway.ajaxURL,t,function(e){e==="success"?showNotification({id:"cache-cleared",message:"The cache was successfully cleared!",success:!0}):showErrorNotification({id:"error-could-not-clear-cache",message:"Error: Could not clear cache."})})})}};return i}),define("modules/snapshots",["jquery","knockout"],function(e,t){var n={init:function(){n.bind(),n.setupViewModel()},setupViewModel:function(){Headway.viewModels.snapshots={snapshots:t.observableArray(Headway.snapshots),formatSnapshotDatetime:function(e){var t=e.split(/[- :]/);return(new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5]))).toLocaleString()},rollbackToSnapshot:function(t,n){if(!confirm("Are you sure you wish to rollback?\n\nYou will lose all between this snapshot and now unless you save another snapshot."))return!1;var r=e(n.target);if(r.attr("disabled"))return!1;r.attr("disabled",!0),r.addClass("button-depressed"),r.text("Rolling Back.."),e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"rollback_to_snapshot",layout:Headway.viewModels.layoutSelector.currentLayout(),snapshot_id:t.id,mode:Headway.mode},function(e){if(typeof e.error!="undefined")return;showNotification({id:"rolled-back-successfully",message:"Successfully rolled back to snapshot.<br /><br /><strong>Refreshing Visual Editor in 3 seconds</strong>.",success:!0}),r.text("Rolled Back!"),setTimeout(function(){allowVEClose(),document.location.reload(!0)},1e3)})},deleteSnapshot:function(t,n){if(!confirm("Are you sure you wish to delete this snapshot?\n\nYou cannot undo this or restore another snapshot to bring this snapshot back."))return!1;var r=e(n.target);if(r.hasClass("deletion-in-progress"))return!1;r.addClass("deletion-in-progress"),e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"delete_snapshot",layout:Headway.viewModels.layoutSelector.currentLayout(),snapshot_id:t.id,mode:Headway.mode},function(e){if(typeof e.error!="undefined")return;showNotification({id:"deleted-snapshot-successfully",message:"Successfully deleted snapshot.",success:!0}),Headway.viewModels.snapshots.snapshots.remove(t)})},saveSnapshot:function(t,n){var r=e(n.target);if(r.attr("disabled"))return!1;r.attr("disabled",!0),r.text("Saving Snapshot..."),r.siblings(".spinner").show();var i=prompt("(Optional)\n\nEnter name or description of the changes in this snapshot.");e.post(Headway.ajaxURL,{security:Headway.security,action:"headway_visual_editor",method:"save_snapshot",layout:Headway.viewModels.layoutSelector.currentLayout(),mode:Headway.mode,snapshot_comments:i},function(e){if(typeof e.timestamp=="undefined")return;showNotification({id:"snapshot-saved",message:"Snapshot saved.",success:!0}),Headway.viewModels.snapshots.snapshots.unshift({id:e.id,timestamp:e.timestamp,comments:e.comments}),r.text("Save Snapshot"),r.removeAttr("disabled"),r.siblings(".spinner").hide()})}},e(document).ready(function(){t.applyBindings(Headway.viewModels.snapshots,e("#box-snapshots").get(0))})},bind:function(){}};return n}),define("helper.wrappers",["modules/panel.inputs"],function(e){getWrapperID=function(e){return!$(e).length||!$(e).data("id")?null:$(e).data("id").toString().replace("wrapper-","")},openWrapperOptions=function(t){var t="wrapper-"+t,n=function(){var n=$("div#"+t+"-tab");n.tabs(),e.bind("div#"+t+"-tab"),handleInputTogglesInContainer(n.find("div.sub-tabs-content")),setupTooltips(),updateGridWidthInput($("div#"+t+"-tab")),$("div#"+t+"-tab").find('select[name="mirror-wrapper"]').val()&&($("div#"+t+"-tab ul.sub-tabs li:not(#sub-tab-config)").hide(),selectTab("sub-tab-config",$("div#"+t+"-tab")))},r=t.replace("wrapper-",""),i="Wrapper";typeof $i("#"+t).data("alias")!="undefined"&&$i("#"+t).data("alias")&&(i+=" ("+$i("#"+t).data("alias")+")"),addPanelTab(t,i,{url:Headway.ajaxURL,data:{security:Headway.security,action:"headway_visual_editor",method:"load_wrapper_options",wrapper_id:t.replace("wrapper-",""),unsaved_wrapper_options:getUnsavedWrapperOptionValues(t.replace("wrapper-","")),layout:Headway.viewModels.layoutSelector.currentLayout()},callback:n},!0,!0,"wrapper-options"),$("div#panel").tabs("option","active",$("#panel-top").children('li[role="tab"]').index($('[aria-controls="'+t+'-tab"]')))},getUnsavedWrapperOptionValues=function(e){if(typeof GLOBALunsavedValues=="object"&&typeof GLOBALunsavedValues["wrappers"]=="object"&&typeof GLOBALunsavedValues["wrappers"][e]=="object")var t=GLOBALunsavedValues.wrappers[e];return typeof t=="object"&&Object.keys(t).length>0?t:null},getWrapperMirror=function(e){return $i('.wrapper[data-id="'+e.replace("wrapper-","")+'"]').data("mirror-wrapper")},updateWrapperMirrorStatus=function(e,t,n){if(n)var r=n.find("option:selected").text();var e=e.replace("wrapper-",""),i=$i('.wrapper[data-id="'+e+'"]');if(t){var t=t.replace("wrapper-","");i.addClass("wrapper-mirrored"),i.headwayGrid("disable"),typeof n!="undefined"&&n.parents(".panel").find("ul.sub-tabs li:not(#sub-tab-config)").hide()}else i.removeClass("wrapper-mirrored"),i.headwayGrid("enable"),typeof n!="undefined"&&n.parents(".panel").find("ul.sub-tabs li:not(#sub-tab-config)").show();n?i.find(".wrapper-mirror-notice p").text('This wrapper is mirroring the blocks from "'+r+'"'):populateWrapperMirrorNotice($i('.wrapper[data-id="'+e+'"]')),i.data("ui-headwayGrid").updateGridContainerHeight(),i.data("ui-headwayGrid").resetGridCalculations(),i.data("ui-headwayGrid").alignAllBlocksWithGuides()},updateWrapperCustomClasses=function(e,t){if(Headway.mode!="design")return!1;var n=$i('.wrapper[data-id="'+e+'"]');return n.length?(n.removeClass(n.data("custom-classes")),n.data("custom-classes",t),n.addClass(t),n):!1}}),setupContextMenu=function(e){if(typeof e!="object")return!1;var e=$.extend(!0,{},{isIframeElement:!0},e);deactivateContextMenu(e.id);var t=Headway.touch?"taphold.contextMenu"+e.id:"contextmenu.contextMenu"+e.id;e.isIframeElement?$iDocument().on(t,e.elements,function(t,n){t.data=n,contextMenuCreator(e,t,!0)}):$(document).on(t,e.elements,function(t,n){t.data=n,contextMenuCreator(e,t,!1)});var n=function(t){if(t.which!==0&&t.which!==1||$(t.originalEvent.target).parents("#context-menu-"+e.id).length)return;var n=$("#context-menu-"+e.id);typeof e.onHide=="function"&&e.onHide.apply(n),n.remove()},r=Headway.touch?"touchstart":"click";$("body").on(r+".contextMenu"+e.id,n),$i("body").on(r+".contextMenu"+e.id,n)},deactivateContextMenu=function(e){return $(document).off(".contextMenu"+e),$iDocument().off(".contextMenu"+e),$("body").off(".contextMenu"+e),$i("body").off(".contextMenu"+e),!0},contextMenuCreator=function(e,t,n){t.stopPropagation();if(typeof e!="object")return!1;$(".context-menu").remove();var r=typeof e.title=="function"?e.title.apply(undefined,[t]):e.title,i=$('<ul id="context-menu-'+e.id+'" class="context-menu"><h3>'+r+"</h3></ul>");typeof e.onShow=="function"&&e.onShow.apply(i,[t]),e.contentsCallback.apply(i,[t]);var s=t,o=function(t){typeof e.onItemClick=="function"&&e.onItemClick.apply(this,[i,s]),typeof e.onHide=="function"&&e.onHide.apply(i),i.remove()},u=Headway.touch?"tap":"click";i.delegate("span",u,o);if(typeof t.originalEvent!="undefined"&&typeof t.originalEvent.clientX!="undefined")var a=t.originalEvent.clientX,f=t.originalEvent.clientY+40;else var a=t.data.x,f=t.data.y+40;i.css({left:a,top:f}),i.delegate("li:has(ul) span","hover",function(){var e=$(this).siblings("ul"),t=e.offset();if(!t||e.offset().left+e.outerWidth()<$("iframe.content").width())return;e.css("right",e.css("left")),e.css("left","auto"),e.css("width","190px"),e.css("zIndex","999999")}),i.appendTo($("body"));if(a+i.outerWidth()>$(window).width()){var l=$(window).width()-(a+i.outerWidth());i.css("left",a+l-20)}if(f+i.outerHeight()>$(window).height()){var l=$(window).height()-(f+i.outerHeight());i.css("top",f+l-20)}return t.preventDefault(),!1},define("helper.context-menus",function(){}),showNotification=function(e){var e=$.extend({},{id:null,message:null,error:!1,success:!1,closeTimer:3e3,closable:!1,closeOnEscKey:!1,closeCallback:function(){},closeConfirmMessage:null,fadeInDuration:350,timerFadeOutDuration:1500,closeFadeOutDuration:350,doNotShowAgain:!1,overwriteExisting:!1,opacity:1},e);if(e.doNotShowAgain&&$.cookie("headway-hide-notification-"+e.id))return;if($("#notification-"+e.id).length){if(!e.overwriteExisting)return $("#notification-"+e.id).fadeIn(e.fadeInDuration);hideNotification(e.id)}var t=$('<div class="notification"><p>'+e.message+"</p></div>");t.attr("id","notification-"+e.id),e.error&&t.addClass("notification-error"),e.success&&t.addClass("notification-success"),e.closable&&t.addClass("notification-closable"),t.css("opacity",e.notification).hide(),t.data("notification-args",e);if(e.closable){var n=$('<span class="close">Close</span>'),r=function(){if(e.closeConfirmMessage&&!confirm(e.closeConfirmMessage))return!1;hideNotification(e.id),$(document).unbind(".notification_"+e.id),$i("html").unbind(".notification_"+e.id)};n.appendTo(t),n.on("click",r),e.closeOnEscKey&&($(document).bind("keyup.notification_"+e.id,r),$i("html").bind("keyup.notification_"+e.id,r))}return e.closeTimer&&setTimeout(function(){t.fadeOut(e.timerFadeOutDuration,function(){$(this).remove()})},e.closeTimer),t.appendTo("#notification-center").fadeIn(350),t},showErrorNotification=function(e){var e=$.extend({},{error:!0,closeTimer:6e3},e);return showNotification(e)},hideNotification=function(e,t){var n=$("#notification-"+e);if(!n||!n.length)return!1;var r=n.data("notification-args");return typeof r.closeCallback=="function"&&r.closeCallback.apply(n),typeof t=="undefined"||t?n.fadeOut(r.closeFadeOutDuration,function(){$(this).remove(),r.doNotShowAgain&&$.cookie("headway-hide-notification-"+r.id,!0)}):(n.remove(),r.doNotShowAgain&&$.cookie("headway-hide-notification-"+r.id,!0)),n},updateNotification=function(e,t){var n=$("#notification-"+e);return n.find("p").html(t)},define("helper.notifications",function(){}),define("modules/grid/grid",["jquery","helper.history","helper.data"],function(e,t){e.widget("ui.headwayGrid",e.ui.mouse,{options:{useIndependentGrid:!1,columns:Headway.defaultGridColumnCount,columnWidth:Headway.globalGridColumnWidth,gutterWidth:Headway.globalGridGutterWidth,yGridInterval:5,minBlockHeight:10,selectedBlocksContainerClass:"selected-blocks-container",defaultBlockClass:"block",defaultBlockContentClass:"block-content"},_create:function(){this.wrapper=this.element,this.container=this.wrapper.find(".grid-container"),this.iframe=e(Headway.iframe),this.contents=e(this.iframe).contents(),this.document=e(this.iframe).contents(),this.options.useIndependentGrid=this.wrapper.data("wrapper-settings")["use-independent-grid"],this.options.columns=this.wrapper.data("wrapper-settings").columns?this.wrapper.data("wrapper-settings").columns:Headway.defaultGridColumnCount,this.options.columnWidth=this.wrapper.data("wrapper-settings")["column-width"]?this.wrapper.data("wrapper-settings")["column-width"]:Headway.globalGridColumnWidth,this.options.gutterWidth=this.wrapper.data("wrapper-settings")["gutter-width"]?this.wrapper.data("wrapper-settings")["gutter-width"]:Headway.globalGridGutterWidth,this.addColumnGuides(),this.updateGridCSS(),this.helperTemplate=e('<div class="ui-grid-helper block"></div>'),this.offset=this.container.offset(),this.wrapper.addClass("ui-headway-grid"),this.wrapper.disableSelection(),this._mouseInit(),this._on(this.wrapper,{mousedown:"wrapperMouseDown"}),this._on(this.contents,{mousedown:"iframeMouseDown",mouseup:"iframeMouseUp"}),this._on(this.iframe,{mouseleave:"iframeMouseLeave"}),this._on(this.contents,{mousemove:"iframeMouseMove"}),this._on(e(window),{resize:"resetGridCalculations"}),this._on(e(window),{resize:"alignAllBlocksWithGuides"}),this.initResizable(this.container.children("."+this.options.defaultBlockClass.replace(".",""))),this.initDraggable(this.container.children("."+this.options.defaultBlockClass.replace(".",""))),this.updateGridContainerHeight(),this.container.delegate("."+this.options.defaultBlockClass.replace(".",""),"dblclick",function(t){var n=e(this).parents(".ui-headway-grid").data("ui-headwayGrid");e(this).hasClass("grouped-block")&&n.container.find(".grouped-block").length===1?(e(this).removeClass("grouped-block"),n.container.removeClass("grouping-active"),hideNotification("mass-block-selection")):e(this).hasClass("grouped-block")?e(this).removeClass("grouped-block"):(e(this).addClass("grouped-block"),n.container.addClass("grouping-active"),showNotification({id:"mass-block-selection",message:"Mass Block Selection Mode",closable:!0,closeOnEscKey:!0,closeTimer:!1,opacity:.8,closeCallback:function(){$i(".grouped-block").removeClass("grouped-block"),n.container.removeClass("grouping-active")}}))}),this.alignAllBlocksWithGuides()},resetGridCalculations:function(){this.grid={columns:this.container.find(".grid-guide").length,columnWidth:parseInt(this.container.find(".grid-guide:eq(1)").outerWidth()),gutterWidth:parseInt(this.container.find(".grid-guide:eq(1)").css("marginLeft").replace("px",""))};var t=this;this.wrapper.find(".block:visible").each(function(){e(this).data("plugin_pep")&&(e(this).data("plugin_pep").options.grid=[t.grid.columnWidth+t.grid.gutterWidth,t.options.yGridInterval]),e(this).data("ui-resizable")&&(e(this).resizable("option","grid",[t.grid.columnWidth+t.grid.gutterWidth,t.options.yGridInterval]),e(this).resizable("option","maxWidth",t.grid.columns*(t.grid.columnWidth+t.grid.gutterWidth)))})},_destroy:function(){return this.element.resizable("destroy"),this.element.removeClass("ui-grid ui-grid-disabled").removeData("grid").unbind(".grid"),this._mouseDestroy(),this.element.find(".ui-resizable").resizable("destroy"),this},disable:function(){this.element.resizable("disable"),this.element.find(".ui-resizable").resizable("disable")},enable:function(){this.element.resizable("enable"),this.element.find(".ui-resizable").resizable("enable")},iframeMouseDown:function(t){this._iframeMouseDownEvent=t,this._iframeMouseDownEventElement=e(t.originalEvent.target)},iframeMouseUp:function(e){delete this._iframeMouseDownEvent,delete this._iframeMouseDownEventElement},iframeMouseLeave:function(e){$iDocument().trigger("mouseup")},iframeMouseMove:function(t){if(typeof this._iframeMouseDownEvent!="undefined"||typeof this._doingHoverBlockToTop!="undefined"||!Headway.touch)return;this._doingHoverBlockToTop=!0,setTimeout(e.proxy(function(){var n=[],r=t.pageX,i=t.pageY;e(this.container).find(".block").each(function(){var t=e(this),s=t.offset(),o=s.left,u=s.top,a=o+t.width(),f=u+t.height();if(r<o||r>a)return;if(i<u||i>f)return;n.push(t)}),n.sort(function(e,t){return t.width()*t.height()>e.width()*e.height()?1:0}),this.sendBlockToTop(e(n.pop())),delete this._doingHoverBlockToTop},this),50)},wrapperMouseDown:function(t){if(!t||this.container.hasClass("grouping-active")||getBlock(t.target))return;$i(".blank-block").each(function(){removePanelTab("block-"+getBlockID(e(this))),e(this).remove()})},_mouseStart:function(t){this.mouseStartPosition=[t.pageX-this.container.offset().left,t.pageY-this.container.offset().top];var n=e(t.target);return!t||t.ctrlKey||this.container.hasClass("grouping-active")||getBlock(t.target)||n.hasClass("wrapper-handle")||n.parents(".wrapper-handle").length||n.hasClass("ui-resizable-handle")&&n.parent().hasClass("wrapper")||this.wrapper.hasClass("wrapper-mirrored")?!0:(this._trigger("start",t),this.helper=e(this.helperTemplate).clone().appendTo(this.container),this.helper.css({width:this.grid.columnWidth,height:0,top:0,left:0,display:"none"}),this.wrapper.hasClass("wrapper-fluid")&&this.wrapper.find(".wrapper-buttons").hide(),this.draggingOnWrapper=!0,addBlockDimensionsTooltip(this.helper),!0)},_mouseDrag:function(t){var n=e(t.target);if(!t||!this.helper||t.ctrlKey||this.container.hasClass("grouping-active")||!this.helper&&getBlock(t.target)||n.hasClass("wrapper-handle")||n.parents(".wrapper-handle").length||n.hasClass("ui-resizable-handle")&&n.parent().hasClass("wrapper")||!this.draggingOnWrapper||typeof this.draggingOnWrapper=="undefined"||this.wrapper.hasClass("wrapper-mirrored"))return;var r=e(this.container),i=r.offset(),s=this.mouseStartPosition[0],o=this.mouseStartPosition[1],u=t.pageX-i.left,a=t.pageY-i.top;if(s>u){var f=u;u=s,s=f}if(o>a){var f=a;a=o,o=f}var l=i.left,c=i.top,h=r.height(),p=r.width();if(u>=p&&s>=p)return;if(a>=h&&o>=h)return;s<0&&(s=0),o<0&&(o=0),a>h&&(a=h);var d=s.toNearest(this.grid.columnWidth+this.grid.gutterWidth),v=o.toNearest(this.options.yGridInterval),m=u.toNearest(this.grid.columnWidth+this.grid.gutterWidth)-d-this.grid.gutterWidth,g=a.toNearest(this.options.yGridInterval)-o.toNearest(this.options.yGridInterval);Headway.blankBlockOptions={display:"block",left:d,top:v,width:m,height:g},d+m>this.grid.columns*(this.grid.columnWidth+this.grid.gutterWidth)&&(Headway.blankBlockOptions.width=p-Headway.blankBlockOptions.left),t.pageY>c+h&&(Headway.blankBlockOptions.height=h-v),this.helper.css(Headway.blankBlockOptions);var y=Math.round((Headway.blankBlockOptions.width+this.grid.gutterWidth)/(this.grid.columnWidth+this.grid.gutterWidth)),b=Math.round(Headway.blankBlockOptions.left/(this.grid.columnWidth+this.grid.gutterWidth));return y==0&&(y=1),y&&setBlockGridWidth(this.helper,y),b&&setBlockGridLeft(this.helper,b),this.alignBlockWithGuides(this.helper),Headway.blankBlockOptions.height<this.options.minBlockHeight?this.helper.addClass("block-error"):this.helper.hasClass("block-error")&&this.helper.removeClass("block-error"),e.support.touch||(this.helper.qtip("option","hide.delay",1e4),this.helper.qtip("option","show.delay",10),this.helper.qtip("show"),this.helper.qtip("option","content.text",blockDimensionsTooltipContent),this.helper.qtip("reposition")),this._trigger("drag",t),this.draggingOnWrapper=!0,!1},_mouseStop:function(e){if(!e||e.ctrlKey||this.container.hasClass("grouping-active")||!this.helper||this.wrapper.hasClass("wrapper-mirrored"))return;return this._trigger("stop",e),Headway.blankBlockOptions={width:getBlockGridWidth(this.helper),left:getBlockGridLeft(this.helper),pixelWidth:this.helper.width(),pixelLeft:this.helper.position().left,height:this.helper.height(),top:this.helper.position().top},this.helper.qtip("api")&&this.helper.qtip("api").destroy(!0),this.wrapper.find(".wrapper-buttons").show(),this.helper.remove(),delete this.helper,Headway.blankBlockOptions.pixelWidth<this.grid.columnWidth||Headway.blankBlockOptions.height<this.options.minBlockHeight?!1:(this.addBlankBlock(Headway.blankBlockOptions),this.mouseStartPosition=!1,delete this.draggingOnWrapper,!1)},initResizable:function(t){if(typeof t=="string")var t=e(t);t.resizable({handles:"n, e, s, w, ne, se, sw, nw",grid:[this.grid.columnWidth+this.grid.gutterWidth,this.options.yGridInterval],containment:this.container,minHeight:this.options.minBlockHeight,maxWidth:this.grid.columns*(this.grid.columnWidth+this.grid.gutterWidth),start:this.resizableStart,resize:this.resizableResize,stop:this.resizableStop})},resizableStart:function(t,n){var r=getBlock(n.element),i=r.parents(".ui-headway-grid").data("ui-headwayGrid"),s=parseInt(r.css("minHeight").replace("px","")),o=r.height();s<=o&&r.css("minHeight",0),r.addClass("block-hover"),r.qtip("option","hide.delay",1e4),r.qtip("show"),r.qtip("reposition"),e(r).data("old-position",getBlockPosition(r)),e(r).data("old-position-pixels",getBlockPositionPixels(r)),e(r).data("old-dimensions",getBlockDimensions(r)),e(r).data("old-dimensions-pixels",getBlockDimensionsPixels(r)),i.wrapper.hasClass("wrapper-fluid")&&i.wrapper.find(".wrapper-buttons").hide()},resizableResize:function(e,t){var n=getBlock(t.element),r=n.parents(".ui-headway-grid").data("ui-headwayGrid"),i=Math.round((n.width()+r.grid.gutterWidth)/(r.grid.columnWidth+r.grid.gutterWidth)),s=Math.round(n.position().left/(r.grid.columnWidth+r.grid.gutterWidth));setBlockGridWidth(n,i),setBlockGridLeft(n,s),r.alignBlockWithGuides(n);var o=n.data("qtip");$i("#qtip-"+o.id).remove(),o.rendered=!1,o.render(),o.show()},resizableStop:function(e,t){var n=getBlock(t.element),r=n.parents(".ui-headway-grid").data("ui-headwayGrid"),i=n.data("old-position"),s=n.data("old-dimensions"),o={left:Math.round(n.position().left/(r.grid.columnWidth+r.grid.gutterWidth)),top:getBlockPositionPixels(n).top},u={width:Math.ceil(n.width()/(r.grid.columnWidth+r.grid.gutterWidth)),height:getBlockDimensionsPixels(n).height};r.wrapper.find(".wrapper-buttons").show();var a=function(e,t){setBlockGridWidth(n,e.width),setBlockGridLeft(n,t.left),n.height(e.height),n.css("top",t.top+"px"),n.attr({"data-grid-top":t.top,"data-height":e.height}),f()},f=function(){n.css("width",""),n.css("left",""),r.alignBlockWithGuides(n),dataSetBlockDimensions(getBlockID(n),getBlockDimensions(n)),dataSetBlockPosition(getBlockID(n),getBlockPosition(n)),blockIntersectCheck(n)?allowSaving():disallowSaving(),n.qtip("option","show.delay",300),n.qtip("option","hide.delay",25),n.qtip("show"),n.qtip("reposition"),n.removeClass("block-hover")};Headway.history.add({description:"Resized block",up:function(){a(u,o)},down:function(){a(s,i)}})},initDraggable:function(t){typeof t=="string"&&(t=e(t)),t.css("cursor","move").pep({grid:[this.grid.columnWidth+this.grid.gutterWidth,this.options.yGridInterval],constrainTo:"parent",shouldEase:!1,start:this.draggableStart,stop:this.draggableStop,drag:this.draggableDrag})},draggableStart:function(t,n){if(t.ctrlKey)return!1;if(e(t.target).hasClass("ui-resizable-handle"))return e(n.el).trigger("stop"),!1;var r=n.el,i=getBlock(r).parents(".ui-headway-grid").data("ui-headwayGrid");blockGroupingOriginals={},blockGroupingOriginals[getBlockID(r)]={top:getBlockPositionPixels(r).top,left:getBlockPositionPixels(r).left},e(r).hasClass("grouped-block")?(e(r).data("plugin_pep").$el=i.container.find(".grouped-block"),i.container.find(".grouped-block").each(function(t){e(this).data("old-position",getBlockPosition(e(this))),e(this).data("old-position-pixels",getBlockPositionPixels(e(this)))}),i.sendBlockToTop(i.container.find(".grouped-block"))):(i.container.removeClass("grouping-active"),i.container.find(".grouped-block").removeClass("grouped-block"),hideNotification("mass-block-selection"),i.sendBlockToTop(e(r)),e(r).data("plugin_pep").$el=e(r),e(r).data("old-position",getBlockPosition(r)),e(r).data("old-position-pixels",getBlockPositionPixels(r))),i.wrapper.hasClass("wrapper-fluid")&&i.wrapper.find(".wrapper-buttons").hide(),e(getBlock(n.el)).qtip("hide"),e(getBlock(n.el)).qtip("disable")},draggableDrag:function(t,n){if(e(n.startEvent.target).hasClass("ui-resizable-handle"))return!1;var r=n.el,i=e(r),s,o=getBlock(e(r)).parents(".grid-container"),u=getBlock(e(r)).parents(".ui-headway-grid").data("ui-headwayGrid"),a=getBlock(e(r)).parents(".wrapper");$i(".grid-container").length>1&&!u.container.find(".grouped-block").length&&($i(".grid-container").not(o).each(function(){var n=e(this).closest(".wrapper")[0].getBoundingClientRect(),i=e(this)[0].getBoundingClientRect();s=t.pageX>n.left&&t.pageX<n.right&&t.pageY>n.top+$iDocument().scrollTop()&&t.pageY<n.bottom+$iDocument().scrollTop(),s?e(this).addClass("ui-state-hover"):e(this).removeClass("ui-state-hover");if(s){var o=e(r).data("wrapper-droppable-clone"),a={top:t.pageY-i.top-$iDocument().scrollTop(),left:t.pageX-i.left};if(!o){var o=e(r).clone().css({transform:"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"",left:e(r).position().left.toNearest(u.grid.columnWidth+u.grid.gutterWidth)}).appendTo(e(this));o.data("left-difference",a.left-e(r).position().left.toNearest(u.grid.columnWidth+u.grid.gutterWidth)),e(r).data("ghost-position",e(r).position()).css({transform:"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":""}).addClass("block-ghost"),e(r).data("wrapper-droppable-clone",o),delete e(r).data("plugin_pep").translation,delete e(r).data("plugin_pep").cssX,delete e(r).data("plugin_pep").cssY}else e(o).closest(e(this)).length||e(o).appendTo(e(this));var f=parseInt(a.top).toNearest(u.options.yGridInterval),l=parseInt(a.left-o.data("left-difference")).toNearest(u.grid.columnWidth+u.grid.gutterWidth);return parseInt(l)+parseInt(e(r).width())>e(this).width()&&(l=e(this).width()-e(r).width()),e(r).height()+f>e(this).height()&&(f=e(this).height()-e(r).height()),f<0&&(f=0),l<0&&(l=0),e(r).height()>e(this).height()&&(e(this).attr("data-original-height")||e(this).attr("data-original-height",e(this).height()),e(this).height(e(r).height())),e(o).css({transform:"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"",top:parseInt(f).toNearest(u.options.yGridInterval),left:parseInt(l).toNearest(u.grid.columnWidth+u.grid.gutterWidth)}),!1}}),s||($i(".block-ghost").each(function(){e(this).data("wrapper-droppable-clone").remove(),e(this).removeData("wrapper-droppable-clone"),e(this).removeClass("block-ghost"),e(this).css({left:e(this).data("ghost-position").left,top:e(this).data("ghost-position").top,transform:"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":""})}),$i("[data-original-height]").each(function(){e(this).height(e(this).data("original-height")),e(this).removeAttr("data-original-height")})));if(s)return!1;e(getBlock(n.helper)).qtip("hide")},draggableStop:function(t,n){if(e(n.startEvent.target).hasClass("ui-resizable-handle"))return!1;var r=e(n.el),i=getBlock(e(r)).parents(".grid-container"),s=getBlock(e(r)).parents(".ui-headway-grid").data("ui-headwayGrid"),o,u;$i(".grid-container").length>1&&!s.container.find(".grouped-block").length&&$i(".grid-container").not(i).each(function(){var n=e(this).closest(".wrapper")[0].getBoundingClientRect();o=t.pageX>n.left&&t.pageX<n.right&&t.pageY>n.top+$iDocument().scrollTop()&&t.pageY<n.bottom+$iDocument().scrollTop();if(o||!t.originalEvent&&e(this).find(e(r).data("wrapper-droppable-clone")).length)return o=!0,u=e(this),!1;u=!1}),$i(".grid-container.ui-state-hover").removeClass("ui-state-hover");if(o&&$i(".grid-container").length>1){var a=u.parents(".wrapper").data("ui-headwayGrid"),f=r.parents(".grid-container");u.append(r),e(r).css(e(r).data("wrapper-droppable-clone").position()),e(r).css("transform",""),e(r).data("wrapper-droppable-clone").remove(),e(r).removeClass("block-ghost").removeData("wrapper-droppable-clone"),setBlockGridLeft(r,Math.round(e(r).position().left/(s.grid.columnWidth+s.grid.gutterWidth))),$i("[data-original-height]").removeAttr("data-original-height"),r.resizable("destroy"),u.parents(".wrapper").headwayGrid("initResizable",r),e.pep.unbind(r),u.parents(".wrapper").headwayGrid("initDraggable",r),blockIntersectCheck(!1,f),blockIntersectCheck(!1,u),dataSetBlockPosition(getBlockID(r),getBlockPosition(r)),dataSetBlockWrapper(getBlockID(r),getBlockWrapper(r).attr("id")),r.parents(".ui-headway-grid").first().data("ui-headwayGrid").alignBlockWithGuides(r)}if(s.container.find(".grouped-block").length)var l=s.container.find(".grouped-block");else var l=getBlock(n.el);s.wrapper.find(".wrapper-buttons").show();var c=[];if(l.length===1)var h="Moved block";else var h="Mass Moved Blocks: ";l.each(function(){c.push({block:e(this),newPosition:{left:Math.round(e(this).position().left/(s.grid.columnWidth+s.grid.gutterWidth)),top:getBlockPositionPixels(e(this)).top},newPositionPixels:getBlockPositionPixels(e(this)),oldPosition:e(this).data("old-position"),oldPositionPixels:e(this).data("old-position-pixels")}),l.length>1&&(h+=", ")}),l.length>1&&(h=h.substring(0,h.length-2));var p=function(e,t){var n=e.block,r=e.newPosition.left,i=e.newPosition.top,s=e.newPositionPixels.left;t&&(r=e.oldPosition.left,i=e.oldPosition.top,s=e.oldPositionPixels.left),setBlockGridLeft(n,r),n.attr({"data-grid-top":i}),n.css("top",i+"px"),n.css("left",s+"px"),n.css({transform:"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":""}),delete n.data("plugin_pep").translation,delete n.data("plugin_pep").cssX,delete n.data("plugin_pep").cssY,dataSetBlockPosition(getBlockID(n),getBlockPosition(n)),dataSetBlockWrapper(getBlockID(n),getBlockWrapper(n).attr("id")),blockIntersectCheck(n)?allowSaving():disallowSaving()};Headway.history.add({description:h,up:function(){jQuery.each(c,function(e,t){p(t,!1)})},down:function(){jQuery.each(c,function(e,t){p(t,!0)})}}),e(document).focus(),e(getBlock(n.el)).qtip("enable"),e(getBlock(n.el)).qtip("show"),e(r).data("hoverWaitTimeout",setTimeout(function(){e(getBlock(n.el)).qtip("reposition"),e(getBlock(n.el)).qtip("show")},300))},addBlankBlock:function(t,n){var r={top:0,left:0,width:140,height:this.options.minBlockHeight,id:null};t=e.extend({},r,t);if(typeof i=="undefined")var i=!0;typeof n=="undefined"&&(n=!1);var s=Math.ceil(Math.random()*1e9);Headway.blankBlock=e('<div><div class="block-content-fade block-content"></div></div>').attr("id","block-"+s).attr("data-id",s).attr("data-temp-id",s).attr("data-desired-id",t.id?t.id:null).data("id",s).data("temp-id",s).data("desired-id",t.id?t.id:null).addClass(this.options.defaultBlockClass.replace(".","")).addClass("blank-block").addClass("hide-content-in-grid"),updateBlockContentCover(Headway.blankBlock);var o=Headway.blankBlock;return o.css({height:parseInt(t.height),top:parseInt(t.top),position:"absolute",visibility:"hidden",left:"",width:""}),setBlockGridLeft(o,t.left),setBlockGridWidth(o,t.width),o.attr({"data-height":parseInt(t.height),"data-grid-top":parseInt(t.top)}),o.appendTo(this.container),this.alignBlockWithGuides(o),o.css("visibility","visible"),n==0&&openBlockTypeSelector(e(Headway.blankBlock)),this.initResizable(o),this.initDraggable(o),blockIntersectCheck(o),o},setupBlankBlock:function(e,t,n){if(typeof n=="undefined")var n=!0;if(typeof t=="undefined")var t=!1;Headway.blankBlock.removeClass("blank-block"),Headway.blankBlock.addClass("block-type-"+e),Headway.blankBlock.data("type",e),n&&loadBlockContent({blockElement:Headway.blankBlock,blockOrigin:{type:e,id:0,layout:Headway.viewModels.layoutSelector.currentLayout()},blockSettings:{dimensions:getBlockDimensions(Headway.blankBlock),position:getBlockPosition(Headway.blankBlock)}}),getBlockTypeObject(e)["fixed-height"]===!0?Headway.blankBlock.addClass("block-fixed-height"):Headway.blankBlock.addClass("block-fluid-height"),getBlockTypeObject(e)["show-content-in-grid"]&&Headway.blankBlock.removeClass("hide-content-in-grid"),dataAddBlock(Headway.blankBlock),dataSetBlockPosition(getBlockID(Headway.blankBlock),getBlockPosition(Headway.blankBlock)),dataSetBlockDimensions(getBlockID(Headway.blankBlock),getBlockDimensions(Headway.blankBlock)),dataSetBlockWrapper(getBlockID(Headway.blankBlock),Headway.blankBlock.closest(".wrapper").attr("id")),blockIntersectCheck(Headway.blankBlock)?allowSaving():disallowSaving(),updateBlockContentCover(Headway.blankBlock);var r=Headway.blankBlock;return Headway.history.add({description:"Added "+getBlockTypeNice(e)+" block",up:function(){r.show(),typeof GLOBALunsavedValues["blocks"][getBlockID(r)]["delete"]!="undefined"&&delete GLOBALunsavedValues.blocks[getBlockID(r)]["delete"],blockIntersectCheck(r,r.parents(".grid-container"))},down:function(){r.hide(),removePanelTab("block-"+getBlockID(r)),dataDeleteBlock(getBlockID(r)),blockIntersectCheck(!1,r.parents(".grid-container"))}}),delete Headway.blankBlock,delete Headway.blankBlockOptions,r},addBlock:function(t){var n={top:0,left:0,width:1,height:this.options.minBlockHeight,type:null,id:null,settings:[]},t=e.extend({},n,t);if(this.addBlankBlock(t,!0)){var r=this.setupBlankBlock(t.type,!0,!1),i=getBlockID(r);return e.each(t.settings,function(e,t){dataSetBlockOption(i,e,t),e=="mirror-block"&&updateBlockMirrorStatus(!1,r,t,!1)}),typeof t.settings.duplicateOf!="undefined"&&r.data("duplicateOf",t.settings.duplicateOf),refreshBlockContent(i,!1,!1,!1),this.updateGridContainerHeight(),r}return!1},sendBlockToTop:function(e){if(typeof e=="string")var e=getBlock(e);if(!e||!e.length)return;$i(".block").css("zIndex",1),e.css("zIndex",2)},updateGridContainerHeight:function(){var t=this.container,n=this.wrapper;t.css("height",this.wrapper.height());if(t.find(".block:visible").length){var r=0;t.find(".block:visible").each(function(){var t=e(this).outerHeight()+e(this).position().top;t>r&&(r=t)}),t.height(r)}},addColumnGuides:function(){var t=this.container;t.find(".grid-guides").remove();var n=e('<div class="grid-guides grid-guides-grey"></div><!-- #grid -->');for(i=1;i<=this.options.columns;i++)n.append('<div class="grid-guide grid-width-1 grid-guide-'+i+'"></div>');n.prependTo(t)},alignBlockWithGuides:function(t){var n=this.container.children(".grid-guides:visible");if(!n.length)return;var r=parseInt(getBlockGridLeft(t)),i=parseInt(getBlockGridWidth(t));if(typeof r=="undefined"||isNaN(r)||r<0)r=0;if(typeof i=="undefined"||isNaN(i)||i==0)i=1;var s=r+1<this.grid.columns?r+1:this.grid.columns,o=n.find(".grid-guide-"+s),u=r+i<this.grid.columns?r+i:this.grid.columns,a=n.find(".grid-guide-"+u);a.length||(a=o);if(r+1<=r+i){var f=parseInt(o.css("marginLeft").replace("px","")),l=parseInt(a.css("marginLeft").replace("px","")),c=o.position().left+f,h=a.position().left+a.outerWidth()-o.position().left-1;r==0&&(h+=l),t.css({top:e(t).position().top,transform:"",left:Math.ceil(c)+"px",width:Math.ceil(h)+"px"})}},alignAllBlocksWithGuides:function(){var t=this;this.container.find(".block:visible").each(function(){t.alignBlockWithGuides(e(this))})},updateGridCSS:function(){var t=this,n=this.wrapper,r=e("div#wrapper-"+getWrapperID(n)+"-tab"),i="div#"+n.attr("id");return n.attr("data-temp-id")&&(i='div.wrapper[data-temp-id="'+n.attr("data-temp-id")+'"]'),typeof this.options.useIndependentGrid!="undefined"&&this.options.useIndependentGrid===!0||typeof this.options.useIndependentGrid=="string"&&hwBoolean(this.options.useIndependentGrid)?updateGridCSS(i,this.options.columns,this.options.columnWidth,this.options.gutterWidth,r):updateGridCSS(i,this.options.columns,Headway.globalGridColumnWidth,Headway.globalGridGutterWidth,r),this.resetGridCalculations(),e($iDocument()).ready(function(){t.alignAllBlocksWithGuides()}),n}}),e.extend(e.ui.headwayGrid,{version:"2.1"})}),define("modules/grid/grid-wizard",["deps/chosen.jquery"],function(e){afterGridWizardLoad=function(){$("div#box-grid-wizard div.box-content").tabs({active:0}),$("select#grid-wizard-pages-to-clone").chosen()},bindGridWizard=function(){var e={"right-sidebar":[{top:0,left:0,width:24,height:130,type:"header"},{top:140,left:0,width:24,height:40,type:"navigation"},{top:190,left:0,width:18,height:320,type:"content"},{top:190,left:18,width:6,height:270,type:"widget-area",mirroringOrigin:"sidebar-1"},{top:520,left:0,width:24,height:70,type:"footer"}],"left-sidebar":[{top:0,left:0,width:24,height:130,type:"header"},{top:140,left:0,width:24,height:40,type:"navigation"},{top:190,left:0,width:6,height:270,type:"widget-area",mirroringOrigin:"sidebar-1"},{top:190,left:6,width:18,height:320,type:"content"},{top:520,left:0,width:24,height:70,type:"footer"}],"two-right":[{top:0,left:0,width:24,height:130,type:"header"},{top:140,left:0,width:24,height:40,type:"navigation"},{top:190,left:0,width:16,height:320,type:"content"},{top:190,left:16,width:4,height:270,type:"widget-area",mirroringOrigin:"sidebar-1"},{top:190,left:20,width:4,height:270,type:"widget-area",mirroringOrigin:"sidebar-2"},{top:520,left:0,width:24,height:70,type:"footer"}],"two-both":[{top:0,left:0,width:24,height:130,type:"header"},{top:140,left:0,width:24,height:40,type:"navigation"},{top:190,left:0,width:4,height:270,type:"widget-area",mirroringOrigin:"sidebar-1"},{top:190,left:4,width:16,height:320,type:"content"},{top:190,left:20,width:4,height:270,type:"widget-area",mirroringOrigin:"sidebar-2"},{top:520,left:0,width:24,height:70,type:"footer"}],"all-content":[{top:0,left:0,width:24,height:130,type:"header"},{top:140,left:0,width:24,height:40,type:"navigation"},{top:190,left:0,width:24,height:320,type:"content"},{top:520,left:0,width:24,height:70,type:"footer"}]};$("div#boxes").delegate("div#box-grid-wizard span.layout-preset","mousedown",function(){$("div#box-grid-wizard span.layout-preset-selected").removeClass("layout-preset-selected"),$(this).addClass("layout-preset-selected")}),$("div#boxes").delegate("span#grid-wizard-button-preset-next","click",function(){var e=$("div#box-grid-wizard span.layout-preset-selected").attr("id").replace("layout-","");switch(e){case"right-sidebar":$("div#grid-wizard-presets-mirroring-select-sidebar-1").show(),$("div#grid-wizard-presets-mirroring-select-sidebar-2").hide(),$("div#grid-wizard-presets-mirroring-select-sidebar-1 h5").text("Right Sidebar");break;case"left-sidebar":$("div#grid-wizard-presets-mirroring-select-sidebar-1").show(),$("div#grid-wizard-presets-mirroring-select-sidebar-2").hide(),$("div#grid-wizard-presets-mirroring-select-sidebar-1 h5").text("Left Sidebar");break;case"two-right":$("div#grid-wizard-presets-mirroring-select-sidebar-1").show(),$("div#grid-wizard-presets-mirroring-select-sidebar-2").show(),$("div#grid-wizard-presets-mirroring-select-sidebar-1 h5").text("Left Sidebar"),$("div#grid-wizard-presets-mirroring-select-sidebar-2 h5").text("Right Sidebar");break;case"two-both":$("div#grid-wizard-presets-mirroring-select-sidebar-1").show(),$("div#grid-wizard-presets-mirroring-select-sidebar-2").show(),$("div#grid-wizard-presets-mirroring-select-sidebar-1 h5").text("Left Sidebar"),$("div#grid-wizard-presets-mirroring-select-sidebar-2 h5").text("Right Sidebar");break;case"all-content":$("div#grid-wizard-presets-mirroring-select-sidebar-1").hide(),$("div#grid-wizard-presets-mirroring-select-sidebar-2").hide()}$(this).hide(),$("span#grid-wizard-button-preset-previous").show(),$("span#grid-wizard-button-preset-use-preset").show(),$("div#grid-wizard-presets-step-1").hide(),$("div#grid-wizard-presets-step-2").show()}),$("div#boxes").delegate("span#grid-wizard-button-preset-previous","click",function(){$(this).hide(),$("span#grid-wizard-button-preset-use-preset").hide(),$("span#grid-wizard-button-preset-next").show(),$("div#grid-wizard-presets-step-2").hide(),$("div#grid-wizard-presets-step-1").show()}),$("div#boxes").delegate("span#grid-wizard-button-preset-use-preset","click",function(){var t=$("div#box-grid-wizard span.layout-preset-selected").attr("id").replace("layout-","");return $i(".block").each(function(){deleteBlock(this)}),$.each(e[t],function(){var e=this;delete e.mirroringOrigin;var t=typeof this.mirroringOrigin!="undefined"?this.mirroringOrigin:this.type,n=$("div#grid-wizard-presets-mirroring-select-"+t+" select").val();n!==""&&(e.settings={},e.settings["mirror-block"]=n),$i(".ui-headway-grid").first().data("ui-headwayGrid").addBlock(e)}),closeBox("grid-wizard")}),$("div#boxes").delegate("span#grid-wizard-button-clone-page","click",function(){var e=$("select#grid-wizard-pages-to-clone").val();if(e===""||!e)return alert("Please select a page to clone.");if($(this).hasClass("button-depressed"))return;$(this).text("Cloning...").addClass("button-depressed").css("cursor","default");var t=$.ajax(Headway.ajaxURL,{type:"POST",async:!0,data:{action:"headway_visual_editor",method:"get_layout_blocks_in_json",security:Headway.security,layout:e},success:function(e,t){if(t==0)return!1;$i(".wrapper").each(function(){deleteWrapper(getWrapperID($(this)),!0)});var n=e.wrappers,r=e.blocks,i={};return $.each(n,function(e,t){var n=t.styling;delete t.styling;var r=addWrapper("bottom",t.settings,!0),s=getWrapperID(r);i[e.replace("wrapper-","")]=s,typeof t["mirror_id"]!="undefined"&&(updateWrapperMirrorStatus(s,t.mirror_id),dataSetWrapperOption(s,"mirror-wrapper",t.mirror_id)),$.each(n,function(e,t){dataSetDesignEditorProperty({element:"wrapper",property:e,value:t!==null?t.toString():null,specialElementType:"instance",specialElementMeta:"wrapper-"+s});if(e.indexOf("margin")===0){var n=e.replace("margin-","").capitalize();r.css("margin"+n,t+"px")}else if(e.indexOf("padding")===0){var i=e.replace("padding-","").capitalize();r.css("padding"+i,t+"px")}})}),$.each(r,function(){var e=this.mirror_id?this.mirror_id:this.id,t={type:this.type,top:this.position.top,left:this.position.left,width:this.dimensions.width,height:this.dimensions.height,settings:$.extend({},this.settings,{"mirror-block":e})},n=typeof this.wrapper_id!="undefined"&&this.wrapper_id?this.wrapper_id:"default";if(typeof i[n.replace("wrapper-","")]!="undefined")var r="#wrapper-"+i[n.replace("wrapper-","")],s=$i(".ui-headway-grid").filter(r).first();else var s=$i(".ui-headway-grid").last();var o=s.data("ui-headwayGrid").addBlock(t),u=getBlockID(o),a=this.id;typeof this.styling!="undefined"&&this.styling&&$.each(this.styling,function(e,t){var e=e.replace("block-"+a,"block-"+u);$.each(t.properties,function(n,r){dataSetDesignEditorProperty({group:"blocks",element:t.element,property:n,value:r!==null?r.toString():null,specialElementType:"instance",specialElementMeta:e})})})}),closeBox("grid-wizard")}})}),$("div#boxes").delegate("span#grid-wizard-button-assign-template","click",function(){var e=$("select#grid-wizard-assign-template").val().replace("template-","");return e===""?alert("Please select a shared layout to assign."):($.post(Headway.ajaxURL,{action:"headway_visual_editor",method:"assign_template",security:Headway.security,template:e,layout:Headway.viewModels.layoutSelector.currentLayout()},function(t){if(typeof t=="undefined"||t=="failure")return showErrorNotification({id:"error-could-not-assign-template",message:"Error: Could not assign shared layout."}),!1;$("div#layout-selector li.layout-selected").removeClass("layout-item-customized"),$("div#layout-selector li.layout-selected").addClass("layout-item-template-used"),$("div#layout-selector li.layout-selected span.status-template").text(t),showIframeLoadingOverlay(),changeTitle("Visual Editor: Assigning Shared Layout"),startTitleActivityIndicator(),Headway.viewModels.layoutSelector.currentLayoutTemplate("template-"+e),Headway.viewModels.layoutSelector.currentLayoutTemplateName($('span.layout[data-layout-id="template-'+e+'"]').find(".template-name").text()),headwayIframeLoadNotification="Shared Layout assigned successfully!",loadIframe(Headway.instance.iframeCallback)}),closeBox("grid-wizard"))}),$("div#boxes").delegate("span.grid-wizard-use-empty-grid","click",function(){$i(".block").each(function(){deleteBlock(this)}),closeBox("grid-wizard")}),initiateLayoutImport=function(e){var t=e;if(!t.val())return alert("You must select a Headway layout file before importing.");var n=t.get(0).files[0];if(n&&typeof n.name!="undefined"&&typeof n.type!="undefined"){var r=new FileReader;r.onload=function(e){var t=e.target.result,n=JSON.parse(t);if(n["data-type"]!="layout")return alert("Cannot load layout file.  Please insure that the selected file is a valid Headway layout export.");typeof n["image-definitions"]!="undefined"&&Object.keys(n["image-definitions"]).length?(showNotification({id:"importing-images",message:"Currently importing images.",closeTimer:1e4}),$.post(Headway.ajaxURL,{action:"headway_visual_editor",method:"import_images",security:Headway.security,importFile:n},function(e){var t=e;if(typeof t["error"]!="undefined")return alert("Error while importing images for layout: "+t.error);importLayout(t)})):importLayout(n)},r.readAsText(n)}else alert("Cannot load layout file.  Please insure that the selected file is a valid Headway layout export.")},importLayout=function(e){$i(".wrapper").each(function(){deleteWrapper(getWrapperID(this),!0)});var t=e.blocks,n=e.wrappers,r={};return $.each(n,function(e,t){var n=t.styling||{};delete t.styling;var i=addWrapper("bottom",t.settings,!0),s=getWrapperID(i);r[e.replace("wrapper-","")]=s,typeof t["mirror_id"]!="undefined"&&(updateWrapperMirrorStatus(s,t.mirror_id),dataSetWrapperOption(s,"mirror-wrapper",t.mirror_id)),$.each(n,function(e,t){dataSetDesignEditorProperty({element:"wrapper",property:e,value:t!==null?t.toString():null,specialElementType:"instance",specialElementMeta:"wrapper-"+s});if(e.indexOf("margin")===0){var n=e.replace("margin-","").capitalize();i.css("margin"+n,t+"px")}else if(e.indexOf("padding")===0){var r=e.replace("padding-","").capitalize();i.css("padding"+r,t+"px")}})}),$.each(t,function(){var e={type:this.type,top:this.position.top,left:this.position.left,width:this.dimensions.width,height:this.dimensions.height,settings:$.extend({},this.settings,{"mirror-block":this.mirror_id})},t=typeof this.wrapper_id!="undefined"&&this.wrapper_id?this.wrapper_id:"default";if(typeof r[t.replace("wrapper-","")]!="undefined")var n="#wrapper-"+r[t.replace("wrapper-","")],i=$i(".ui-headway-grid").filter(n).first();else var i=$i(".ui-headway-grid").last();var s=i.data("ui-headwayGrid").addBlock(e),o=getBlockID(s),u=this.id;typeof this.styling!="undefined"&&this.styling&&$.each(this.styling,function(e,t){var e=e.replace("block-"+u,"block-"+o);$.each(t.properties,function(n,r){dataSetDesignEditorProperty({group:"blocks",element:t.element,property:n,value:r!==null?r.toString():null,specialElementType:"instance",specialElementMeta:e})})})}),showNotification({id:"layout-successfully-imported",message:"Layout successfully imported.<br /><br />Remember to save if you wish to keep the layout.",closeTimer:!1,closable:!0,success:!0}),closeBox("grid-wizard"),allowSaving(),!0},$("div#boxes").delegate("#grid-wizard-import-select-file","click",function(){$(this).siblings('input[type="file"]').trigger("click")}),$("div#boxes").delegate('#grid-wizard-import input[type="file"]',"change",function(e){if(e.target.files[0].name.split(".").slice(-1)[0]!="json")return $(this).val(null),alert("Invalid layout file.  Please be sure that the layout is a valid JSON formatted file.");initiateLayoutImport($(this))}),$("div#boxes").delegate("#grid-wizard-export-download-file","click",function(){var e={action:"headway_visual_editor",security:Headway.security,method:"export_layout",layout:Headway.viewModels.layoutSelector.currentLayout()},t=Headway.ajaxURL+"?"+$.param(e);return window.open(t)})}}),define("modules/grid/mode-grid",["jquery","modules/grid/grid","deps/itstylesheet","modules/grid/wrappers","modules/grid/grid-wizard","deps/jquery.pep","helper.blocks","helper.wrappers"],function(e,t,n){var r={init:function(){bindGridWizard()},iframeCallback:function(){$i(".block").each(function(){updateBlockContentCover(e(this)),loadBlockContent({blockElement:e(this),blockOrigin:getBlockID(e(this))})}),gridStylesheet=new ITStylesheet({document:Headway.iframe.contents()[0],href:"/?headway-trigger=compiler&file=ve-iframe-grid-dynamic"},"find"),addEdgeInsertWrapperButtons(),addWrapperButtons($i("div.wrapper")),bindWrapperButtons(),setupWrapperSortables(),setupWrapperResizable(),setupWrapperContextMenu(),assignDefaultWrapperID(),$i(".grid-container").length===1&&!$i(".block").length&&$i(".grid-container").height(500),$i("div.wrapper").headwayGrid(),$i("div.wrapper-mirrored").headwayGrid("disable"),updateGridWidthInput("#sub-tab-grid-content"),setupBlockContextMenu(),bindBlockDimensionsTooltip()}};return updateGridCSS=function(e,t,n,r,s){if(r>0)var o=n*t+(t-1)*r;else var o=n*t;var u=n*t/o,a=r*t/o,f=100/t*u;if(a>0)var l=100/t*a;else var l=0;var c=9,h=e+" ";gridStylesheet.update_rule(h+".grid-guides .grid-guide",{margin:"0 0 0 "+Math.round(l,c)+"%"});for(i=1;i<=t;i++)gridStylesheet.update_rule(h+".grid-width-"+i,{width:Math.round(f*i+(i-1)*l,c)+"%"}),gridStylesheet.update_rule(h+".grid-left-"+i,{left:"0 0 0 "+Math.round((f+l)*i,c)+"%"});gridStylesheet.update_rule(h+"div.grid-container",{width:o+1+"px"}),gridStylesheet.update_rule(e+".wrapper-fixed",{width:o+"px"}),typeof s!="undefined"&&s.length&&updateGridWidthInput(s)},r}),require.config({paths:{knockout:"deps/knockout",underscore:"deps/underscore",jqueryUI:"deps/jquery.ui",qtip:"deps/jquery.qtip"},shim:{underscore:{exports:"_"}}}),require(["jquery","util.loader"],function(e){startTitleActivityIndicator(),Headway.blockTypeURLs=e.parseJSON(Headway.blockTypeURLs.replace(/&quot;/g,'"')),Headway.allBlockTypes=e.parseJSON(Headway.allBlockTypes.replace(/&quot;/g,'"')),Headway.ranTour=e.parseJSON(Headway.ranTour.replace(/&quot;/g,'"')),Headway.designEditorProperties=e.parseJSON(Headway.designEditorProperties.replace(/&quot;/g,'"')),Headway.layouts=e.parseJSON(Headway.layouts.replace(/&quot;/g,'"')),require(["modules/layout-selector"],function(e){e.init()}),require(["modules/panel","modules/iframe"],function(e,t){e.init(),t.init()}),require(["modules/menu"],function(e){e.init()}),require(["modules/snapshots"],function(e){e.init()}),require(["util.tour"],function(e){Headway.ranTour[Headway.mode]==0&&Headway.ranTour.legacy==0&&e.start()}),require(["helper.data","helper.blocks","helper.wrappers","helper.context-menus","helper.notifications","helper.boxes","helper.history"],function(e,t,n,r,i,s,o){o.init()});switch(Headway.mode){case"grid":require(["modules/grid/mode-grid","modules/iframe","modules/layout-selector"],function(e){Headway.instance=e,e.init(),waitForIframeLoad(e.iframeCallback)});break;case"design":require(["modules/design/mode-design","modules/iframe","modules/layout-selector"],function(e){Headway.instance=e,e.init(),waitForIframeLoad(e.iframeCallback)})}e(document).ready(function(){e("body").addClass("show-ve")}),e(window).bind("load",function(){setTimeout(function(){e("div#ve-loading-overlay").remove()},1e3)})}),define("app",function(){});